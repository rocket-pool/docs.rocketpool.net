import { Tab, Tabs } from "@rspress/core/theme";

# [Modalità Nativa] Guida all'Aggiornamento Redstone e al Merge

Questa guida coprirà tutto ciò che devi sapere per preparare il tuo nodo all'aggiornamento Redstone e al Merge se utilizzi la **Modalità Nativa**.

## Cose da Fare Prima di Aggiornare alla v1.5.0

Prima di aggiornare alla v1.5.0 e successive dello Smartnode, segui questa checklist per assicurarti di essere preparato:

### Passa a un Execution Client Completo

Il Merge richiede di eseguire il proprio Execution client, quindi non potrai più utilizzare provider remoti come Infura o Pocket.

A causa di questo cambiamento, se stai attualmente utilizzando un Execution client leggero, dovresti passare a un client completo mentre sei ancora sulla v1.4, lascialo sincronizzare completamente, e poi aggiornare alla v1.5.

### Configura l'Engine API

Il Merge cambia il modo in cui il tuo Execution client comunica con il tuo Consensus client.
Invece di utilizzare il vecchio sistema RPC basato su HTTP o Websocket, il Merge richiede un nuovo sistema esposto dal tuo Execution client chiamato Engine API.

Questa è una connessione speciale che permette al Consensus client di sostituire il vecchio sistema di mining Proof-of-Work con il Proof-of-Stake; è il cuore del Merge.
È anche **autenticato** con un token segreto, così solo il tuo Consensus client può connettersi al tuo Execution client - nient'altro può farlo.

Dato che gestisci i tuoi Execution e Consensus client, dovrai configurare l'Engine API manualmente.
Come farlo dipende interamente da quali client stai utilizzando.

CoinCashew ha [una guida ottima e concisa](https://www.coincashew.com/coins/overview-eth/ethereum-merge-upgrade-checklist-for-home-stakers-and-validators) su come configurare l'Engine API sui tuoi Execution e Consensus client.
Dai un'occhiata, e testa la nuova configurazione verificando che continui ad attestare correttamente prima di aggiornare.

Ti mostreremo come configurare il tuo Validator client in modo che utilizzi il fee recipient corretto richiesto dal software Smartnode automaticamente qui sotto.

## Aggiornamento alla v1.5.0

L'aggiornamento dello stack Smartnode alla v1.5.0 non è diverso da qualsiasi altro aggiornamento.
Segui semplicemente [le normali istruzioni qui](../../node-staking/updates#updating-the-smartnode-stack).

## Cose che Dovresti Fare Dopo l'Aggiornamento

In modalità Nativa, ci sono diverse cose che dovrai fare manualmente dopo l'aggiornamento:

### Assicurati di un Aggiornamento Riuscito

La prima cosa da fare è assicurarti che il tuo nodo funzioni correttamente.
Considera di seguire questi passaggi:

- Controlla gli script di log per l'Execution client, il Consensus client, il Validator client e il daemon Smartnode (il servizio `rp-node`) per assicurarti che funzionino tutti normalmente senza errori.
- Conferma con un Block Explorer (come il tuo dashboard Grafana e [https://beaconcha.in](https://beaconcha.in)) che stai ancora attestando correttamente
  - Ricorda che se hai abilitato la protezione Doppelganger, perderai alcune attestazioni dopo il riavvio. Questo è normale!

### Configura il Fee Recipient nel tuo Validator Client

Uno dei dettagli **critici** da configurare prima del Merge è il **fee recipient** specificato dal tuo validator client.
Come descritto nell'[articolo panoramica](./whats-new#fee-recipients-and-your-distributor), questo può essere uno di due valori:

- Se hai **scelto** la Smoothing Pool, deve essere l'indirizzo del **contratto Smoothing Pool**. Puoi ottenere l'indirizzo dalla [pagina ufficiale dei contratti](/it/protocol/contracts-integrations).
- Se **non** sei nella Smoothing Pool, deve essere l'indirizzo del **contratto fee distributor** del tuo nodo. Puoi ottenere l'indirizzo eseguendo `rocketpool node status`, nella sezione `Fee Distributor and Smoothing Pool`.

In modalità Nativa, hai la scelta di lasciare che lo Smartnode lo gestisca per te se utilizzi il servizio daemon Smartnode, `rp-node`, o gestirlo tu stesso se non utilizzi il daemon.

#### Gestione Automatica tramite il Daemon

Il daemon Smartnode determinerà automaticamente il fee recipient appropriato per il tuo nodo e lo gestirà nel caso cambi (come entrare e uscire dalla Smoothing Pool).
Questa è l'opzione **più sicura**, perché lo Smartnode assicurerà sempre che sia impostato su un valore che **previene la [penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system)**.

Il modo in cui lo fa è mantenendo un file con il fee recipient corretto al suo interno, e aggiornandolo regolarmente per garantirne la correttezza.
Quando deve essere aggiornato, modifica il file e riavvia automaticamente il tuo Validator client così carica il nuovo recipient - in modo simile a come riavvia il tuo Validator client dopo aver stakato un nuovo minipool.

Seleziona il tuo client qui sotto per imparare come configurarlo:

<div className="p-3">
  <Tabs>
    <Tab label="Lighthouse">
      Modifica il servizio Validator Client aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento della riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --suggested-fee-recipient ${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode e verrà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>
    <Tab label="Nimbus">
      Modifica il servizio Validator Client aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento della riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --suggested-fee-recipient=${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode e verrà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>
    <Tab label="Prysm">
      Modifica il servizio Validator Client aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento della riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --suggested-fee-recipient ${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode e verrà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>
    <Tab label="Teku">
      Modifica il servizio Validator Client aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento della riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --validators-proposer-default-fee-recipient=${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode e verrà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>

  </Tabs>
</div>

#### Gestione Manuale del Fee Recipient

::: danger AVVERTENZA
Facendo questo, ti assumi la piena responsabilità di assicurarti che il tuo fee recipient sia sempre impostato all'indirizzo corretto.

Leggi le [specifiche sulla penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per capire a cosa deve essere impostato data la tua configurazione, e quando puoi cambiarlo in sicurezza da un valore a un altro.

Il mancato rispetto potrebbe comportare la penalizzazione dei tuoi minipool!
:::

**Prima del deploy di Redstone**, puoi semplicemente utilizzare l'indirizzo rETH per la rete su cui ti trovi (che può essere trovato nella [pagina ufficiale dei contratti](/it/protocol/contracts-integrations)).
L'indirizzo rETH è sempre sicuro in ogni caso.

**Una volta che Redstone è stato deployato**, puoi vedere l'indirizzo esatto a cui dovresti impostare il tuo fee recipient tramite `rocketpool node status`. Per esempio, se hai scelto la Smoothing Pool, mostrerà l'indirizzo della Smoothing Pool e noterà che devi usarlo come tuo fee recipient:

<img src="../../node-staking/images/native-fee-rc-in.png" width="100%" height="auto" />

Se _non_ hai scelto la Smoothing Pool, mostrerà l'indirizzo del tuo fee distributor e noterà che devi usarlo come tuo fee recipient:

<img src="../../node-staking/images/native-fee-rc-out.png" width="100%" height="auto" />

Seleziona il tuo Consensus client qui sotto per imparare come configurarlo.

<div className="p-3">
  <Tabs>
    <Tab label="Lighthouse">
      Aggiungi il seguente argomento della riga di comando al file di definizione del servizio del tuo Validator Client:

      ```
      --suggested-fee-recipient `address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** del deploy dell'aggiornamento Redstone (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **fee distributor** del tuo nodo dopo il deploy di Redstone, che puoi recuperare con `rocketpool node status` una volta avvenuto l'aggiornamento del contratto
      - L'[indirizzo Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se scegli la Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà sempre il fee recipient corretto da utilizzare.

      **Leggi attentamente le [specifiche sulla penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per comprendere le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>
    <Tab label="Nimbus">
      Aggiungi il seguente argomento della riga di comando al file di definizione del servizio di Nimbus:

      ```
      --suggested-fee-recipient=`address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** del deploy dell'aggiornamento Redstone (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **fee distributor** del tuo nodo dopo il deploy di Redstone, che puoi recuperare con `rocketpool node status` una volta avvenuto l'aggiornamento del contratto
      - L'[indirizzo Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se scegli la Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà sempre il fee recipient corretto da utilizzare.

      **Leggi attentamente le [specifiche sulla penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per comprendere le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>
    <Tab label="Prysm">
      Aggiungi il seguente argomento della riga di comando al file di definizione del servizio del tuo Validator Client:

      ```
      --suggested-fee-recipient `address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** del deploy dell'aggiornamento Redstone (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **fee distributor** del tuo nodo dopo il deploy di Redstone, che puoi recuperare con `rocketpool node status` una volta avvenuto l'aggiornamento del contratto
      - L'[indirizzo Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se scegli la Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà sempre il fee recipient corretto da utilizzare.

      **Leggi attentamente le [specifiche sulla penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per comprendere le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>
    <Tab label="Teku">
      Aggiungi il seguente argomento della riga di comando al file di definizione del servizio del tuo Validator Client:

      ```
      --validators-proposer-default-fee-recipient=`address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** del deploy dell'aggiornamento Redstone (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **fee distributor** del tuo nodo dopo il deploy di Redstone, che puoi recuperare con `rocketpool node status` una volta avvenuto l'aggiornamento del contratto
      - L'[indirizzo Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se scegli la Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà sempre il fee recipient corretto da utilizzare.

      **Leggi attentamente le [specifiche sulla penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per comprendere le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>

  </Tabs>
</div>

### Configura MEV-Boost

[MEV-boost](https://boost.flashbots.net/) è il sistema fornito da Flashbots per dare ricompense MEV ai validatori Proof-of-Stake dopo il Merge.

**Rocket Pool richiede che tutti i nodi lo utilizzino per massimizzare i loro rendimenti e quindi mantenere il protocollo competitivo con altri servizi di staking.**

Dovrai apportare alcune modifiche al tuo Beacon Node / Consensus client per connetterlo a MEV-boost.

MEV-boost non è attualmente disponibile su Hoodi o Mainnet, quindi non è necessario configurarlo in questo momento.
Ovviamente, non verrai penalizzato per non averlo utilizzato durante questo periodo di transizione.

Una volta disponibile, annunceremo una data entro la quale deve essere installato e connesso al tuo nodo.
Flashbots fornirà istruzioni che potrai seguire in quel momento, e le collegheremo qui.

::: danger NOTA
Una volta che annunceremo che MEV-boost deve essere abilitato da tutti i node operator, devi assicurarti di averlo installato e configurato correttamente con il tuo Beacon Node!

Non farlo comporterà la [penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) del tuo minipool.
:::

### Configura un Nodo di Fallback

Poiché il Merge non è compatibile con provider remoti come Infura e Pocket, perderai la possibilità di utilizzarli come Execution client di fallback quando il tuo primario va offline.

Lo Smartnode ha ancora la capacità di fornire un Execution client di fallback (e ora anche un Consensus client di fallback), ma ora dovrai utilizzare Execution e Consensus client che controlli tu.

Per maggiori informazioni sulla configurazione di un nodo di fallback, consulta la [guida al nodo di fallback](../../node-staking/fallback).

### Inizializza il tuo Fee Distributor

Se non intendi scegliere la [Smoothing Pool](./whats-new#smoothing-pool) e richiedere tutte le tue priority fee e ricompense MEV al tuo [contratto fee distributor](./whats-new#fee-recipients-and-your-distributor), dovrai eventualmente inizializzarlo (creare l'istanza del contratto sulla chain) per richiedere le ricompense da esso al tuo indirizzo di prelievo.

Questa è un'operazione abbastanza economica e deve essere fatta solo una volta.

::: tip SUGGERIMENTO
L'inizializzazione del tuo fee distributor può essere fatta in **qualsiasi momento**.
Puoi lasciare che le ricompense si accumulino nel suo indirizzo molto prima di inizializzarlo, e il tuo saldo rimarrà dopo l'inizializzazione.

Ti consigliamo di farlo quando i prezzi del gas sono bassi per minimizzare il costo di overhead.

Nota che **deve essere inizializzato per richiedere le tue ricompense.**
:::

### Scegli la Smoothing Pool

Se intendi approfittare subito della [Smoothing Pool](./whats-new#smoothing-pool), dovresti sceglierla prima della fine del primo periodo di ricompense di Redstone per massimizzare il tuo importo di "eleggibilità".

La scelta può essere fatta eseguendo il seguente comando:

```shell
rocketpool node join-smoothing-pool
```

### Richiedi le Ricompense

L'aggiornamento Redstone sostituisce il vecchio sistema di ricompense costoso e problematico con uno [nuovo di zecca](./whats-new#new-rewards-system) che è molto più economico, supporta il restaking automatico di RPL (sia in importi parziali che completi), e - cosa più importante - **ti permette di richiedere le tue ricompense quando vuoi**.

Poiché non c'è più un limite di tempo per richiedere le ricompense, e poiché è più economico richiedere molti intervalli di ricompense contemporaneamente, la funzionalità di richiesta automatica delle ricompense dello Smartnode **è stata rimossa**.
Ora potrai richiedere le ricompense tramite il seguente comando:

```shell
rocketpool node claim-rewards
```

Questo ti mostrerà tutte le ricompense che hai accumulato in tutti gli intervalli di ricompense a partire dall'aggiornamento Redstone.
