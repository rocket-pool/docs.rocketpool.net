import { Tab, Tabs } from "@rspress/core/theme";

# [Modalità Nativa] Guida all'Aggiornamento Redstone e al Merge

Questa guida coprirà tutto ciò che devi sapere per preparare il tuo nodo all'aggiornamento Redstone e al Merge se stai utilizzando la **Modalità Nativa**.

## Cose da Fare Prima dell'Aggiornamento alla v1.5.0

Prima di aggiornare alla v1.5.0 e versioni successive dello Smartnode, segui questa checklist per assicurarti di essere pronto:

### Passa a un Client di Esecuzione Completo

Il Merge richiede che tu esegua il tuo client di Esecuzione, quindi non potrai più utilizzare provider remoti come Infura o Pocket.

A causa di questo cambiamento, se stai attualmente utilizzando un client di Esecuzione leggero, dovresti passare a un client completo mentre sei ancora sulla v1.4, lasciarlo sincronizzare completamente e poi aggiornare alla v1.5.

### Configura l'Engine API

Il Merge cambia il modo in cui il tuo client di Esecuzione comunica con il tuo client di Consenso.
Invece di utilizzare il vecchio sistema RPC basato su HTTP o Websocket, il Merge richiede un nuovo sistema esposto dal tuo client di Esecuzione chiamato Engine API.

Questa è una connessione speciale che permette al client di Consenso di sostituire il vecchio sistema di mining Proof-of-Work con il Proof-of-Stake; è il cuore del Merge.
È anche **autenticato** con un token segreto, così solo il tuo client di Consenso può connettersi al tuo client di Esecuzione - nient'altro può farlo.

Poiché gestisci i tuoi client di Esecuzione e Consenso, dovrai configurare l'Engine API manualmente.
Come farlo dipende interamente dai client che stai utilizzando.

CoinCashew ha [una guida ottima e concisa](https://www.coincashew.com/coins/overview-eth/ethereum-merge-upgrade-checklist-for-home-stakers-and-validators) su come configurare l'Engine API sui tuoi client di Esecuzione e Consenso.
Dai un'occhiata, e testa la nuova configurazione assicurandoti che attesti ancora correttamente prima di aggiornare.

Ti mostreremo come configurare il tuo client Validator in modo che utilizzi automaticamente il fee recipient corretto richiesto dal software Smartnode qui sotto.

## Aggiornamento alla v1.5.0

L'aggiornamento dello stack Smartnode alla v1.5.0 non è diverso da qualsiasi altro aggiornamento.
Segui semplicemente [le normali istruzioni qui](../../node-staking/updates#updating-the-smartnode-stack).

## Cose che Dovresti Fare Dopo l'Aggiornamento

In modalità Nativa, ci sono diverse cose che dovrai fare manualmente dopo l'aggiornamento:

### Assicurati che l'Aggiornamento sia Riuscito

La prima cosa da fare è assicurarti che il tuo nodo funzioni correttamente.
Considera di effettuare i seguenti passaggi:

- Controlla i tuoi script di log per il client di Esecuzione, il client di Consenso, il client Validator e il daemon Smartnode (il servizio `rp-node`) per assicurarti che funzionino tutti normalmente senza errori.
- Conferma con un Block Explorer (come il tuo dashboard Grafana e [https://beaconcha.in](https://beaconcha.in)) che stai ancora attestando correttamente
  - Ricorda che se hai abilitato la protezione Doppelganger, perderai alcune attestazioni dopo il riavvio. Questo è normale!

### Configura il Fee Recipient nel tuo Client Validator

Uno dei dettagli **critici** da configurare prima del Merge è il **fee recipient** specificato dal tuo client validator.
Come descritto nell'[articolo panoramica](./whats-new#fee-recipients-and-your-distributor), questo può essere uno di due valori:

- Se **hai aderito** allo Smoothing Pool, questo deve essere l'indirizzo del **contratto Smoothing Pool**. Puoi ottenere l'indirizzo dalla [pagina ufficiale dei contratti](/it/protocol/contracts-integrations).
- Se **non** sei nello Smoothing Pool, questo deve essere l'indirizzo del **contratto distributore di commissioni** del tuo nodo. Puoi ottenere l'indirizzo eseguendo `rocketpool node status`, sotto la sezione `Fee Distributor and Smoothing Pool`.

In modalità Nativa, hai la scelta di lasciare che lo Smartnode gestisca questo per te se utilizzi il servizio daemon Smartnode, `rp-node`, o gestirlo tu stesso se non utilizzi il daemon.

#### Gestione Automatica tramite il Daemon

Il daemon Smartnode determinerà automaticamente il fee recipient appropriato per il tuo nodo e lo gestirà nel caso cambi (come quando aderisci o esci dallo Smoothing Pool).
Questa è l'opzione **più sicura**, perché lo Smartnode assicurerà sempre che sia impostato su un valore che **previene la [penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system)**.

Il modo in cui lo fa è mantenendo un file con il fee recipient corretto al suo interno, e aggiornandolo regolarmente per garantire la sua correttezza.
Quando deve essere aggiornato, modifica il file e riavvia automaticamente il tuo client Validator in modo che carichi il nuovo recipient - in modo simile a come riavvia il tuo client Validator dopo aver fatto stake di un nuovo minipool.

Seleziona il tuo client qui sotto per imparare come configurarlo:

<div className="p-3">
  <Tabs>
    <Tab label="Lighthouse">
      Modifica il tuo servizio Client Validator aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento da riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --suggested-fee-recipient ${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode, e sarà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>
    <Tab label="Nimbus">
      Modifica il tuo servizio Client Validator aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento da riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --suggested-fee-recipient=${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode, e sarà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>
    <Tab label="Prysm">
      Modifica il tuo servizio Client Validator aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento da riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --suggested-fee-recipient ${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode, e sarà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>
    <Tab label="Teku">
      Modifica il tuo servizio Client Validator aggiungendo la seguente riga _prima_ della riga `ExecStart`:

      ```
      EnvironmentFile=`data dir`/validators/rp-fee-recipient-env.txt
      ```

      Per esempio:

      ```
      EnvironmentFile=/srv/rocketpool/data/validators/rp-fee-recipient-env.txt
      ```

      Successivamente, aggiungi il seguente argomento da riga di comando _alla fine_ della tua riga `ExecStart`:

      ```
      --validators-proposer-default-fee-recipient=${FEE_RECIPIENT}
      ```

      Il tuo VC ora utilizzerà il file gestito dal daemon Smartnode, e sarà automaticamente riavviato ogni volta che il fee recipient cambia.
    </Tab>

  </Tabs>
</div>

#### Gestione Manuale del Fee Recipient

::: danger ATTENZIONE
Facendo questo, ti assumi la piena responsabilità di assicurarti che il tuo fee recipient sia sempre impostato sull'indirizzo corretto.

Si prega di leggere la [specifica delle penalità](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per capire su cosa deve essere impostato data la tua configurazione, e quando puoi cambiarlo in sicurezza da un valore all'altro.

La mancata osservanza potrebbe comportare la penalizzazione dei tuoi minipool!
:::

**Prima che Redstone venga distribuito**, puoi semplicemente utilizzare l'indirizzo rETH per la rete su cui ti trovi (che può essere trovato nella [pagina ufficiale dei contratti](/it/protocol/contracts-integrations)).
L'indirizzo rETH è sempre sicuro in ogni caso.

**Una volta che Redstone è stato distribuito**, puoi vedere l'indirizzo esatto su cui dovresti impostare il tuo fee recipient tramite `rocketpool node status`. Per esempio, se hai aderito allo Smoothing Pool, mostrerà l'indirizzo dello Smoothing Pool e noterà che devi utilizzarlo come tuo fee recipient:

<img src="../../node-staking/images/native-fee-rc-in.png" width="100%" height="auto" />

Se _non_ hai aderito allo Smoothing Pool, mostrerà il tuo indirizzo del distributore di commissioni e noterà che devi utilizzarlo come tuo fee recipient:

<img src="../../node-staking/images/native-fee-rc-out.png" width="100%" height="auto" />

Seleziona il tuo client di Consenso qui sotto per imparare come configurarlo.

<div className="p-3">
  <Tabs>
    <Tab label="Lighthouse">
      Aggiungi il seguente argomento da riga di comando al file di definizione del servizio del tuo Client Validator:

      ```
      --suggested-fee-recipient `address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** che l'aggiornamento Redstone venga distribuito (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **distributore di commissioni** del tuo nodo dopo che Redstone è stato distribuito, che puoi recuperare con `rocketpool node status` una volta che avviene l'aggiornamento del contratto
      - L'[indirizzo dello Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se aderisci allo Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà il fee recipient corretto da utilizzare in qualsiasi momento.

      **Si prega di leggere attentamente la [specifica delle penalità](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per capire le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>
    <Tab label="Nimbus">
      Aggiungi il seguente argomento da riga di comando al file di definizione del servizio di Nimbus:

      ```
      --suggested-fee-recipient=`address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** che l'aggiornamento Redstone venga distribuito (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **distributore di commissioni** del tuo nodo dopo che Redstone è stato distribuito, che puoi recuperare con `rocketpool node status` una volta che avviene l'aggiornamento del contratto
      - L'[indirizzo dello Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se aderisci allo Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà il fee recipient corretto da utilizzare in qualsiasi momento.

      **Si prega di leggere attentamente la [specifica delle penalità](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per capire le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>
    <Tab label="Prysm">
      Aggiungi il seguente argomento da riga di comando al file di definizione del servizio del tuo Client Validator:

      ```
      --suggested-fee-recipient `address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** che l'aggiornamento Redstone venga distribuito (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **distributore di commissioni** del tuo nodo dopo che Redstone è stato distribuito, che puoi recuperare con `rocketpool node status` una volta che avviene l'aggiornamento del contratto
      - L'[indirizzo dello Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se aderisci allo Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà il fee recipient corretto da utilizzare in qualsiasi momento.

      **Si prega di leggere attentamente la [specifica delle penalità](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per capire le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>
    <Tab label="Teku">
      Aggiungi il seguente argomento da riga di comando al file di definizione del servizio del tuo Client Validator:

      ```
      --validators-proposer-default-fee-recipient=`address`
      ```

      Dove `address` è:

      - L'[indirizzo rETH](/it/protocol/contracts-integrations/#token-contracts) **prima** che l'aggiornamento Redstone venga distribuito (es., `0xae78736Cd615f374D3085123A210448E74Fc6393` su Mainnet)
      - Il **distributore di commissioni** del tuo nodo dopo che Redstone è stato distribuito, che puoi recuperare con `rocketpool node status` una volta che avviene l'aggiornamento del contratto
      - L'[indirizzo dello Smoothing Pool](/it/protocol/contracts-integrations/#protocol-contracts) se aderisci allo Smoothing Pool

      Come promemoria, `rocketpool node status` ti mostrerà il fee recipient corretto da utilizzare in qualsiasi momento.

      **Si prega di leggere attentamente la [specifica delle penalità](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) per capire le condizioni e le aspettative riguardo al fee recipient.**
    </Tab>

  </Tabs>
</div>

### Configura MEV-Boost

[MEV-boost](https://boost.flashbots.net/) è il sistema che Flashbots fornisce per dare ricompense MEV ai validatori Proof-of-Stake dopo il Merge.

**Rocket Pool richiede a tutti i nodi di utilizzarlo per massimizzare i loro ritorni e quindi mantenere il protocollo competitivo con altri servizi di staking.**

Dovrai apportare alcune modifiche al tuo Beacon Node / client di Consenso per connetterlo a MEV-boost.

MEV-boost attualmente non è disponibile su Hoodi o Mainnet, quindi non è necessario configurarlo in questo momento.
Naturalmente, non sarai penalizzato per non averlo utilizzato durante questo periodo di transizione.

Una volta che diventerà disponibile, annunceremo una data entro la quale dovrà essere installato e connesso al tuo nodo.
Flashbots fornirà istruzioni che potrai seguire in quel momento, e le collegheremo qui.

::: danger NOTA
Una volta che annunceremo che MEV-boost deve essere abilitato da tutti gli operatori di nodi, devi assicurarti di averlo installato e configurato correttamente con il tuo Beacon Node!

Non farlo risulterà nella [penalizzazione](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system) del tuo minipool.
:::

### Configura un Nodo di Fallback

Poiché il Merge non è compatibile con provider remoti come Infura e Pocket, perderai la capacità di utilizzarli come client di Esecuzione di fallback quando il tuo primario va offline.

Lo Smartnode ha ancora la capacità di fornire un client di Esecuzione di fallback (e ora anche un client di Consenso di fallback), ma ora dovrai utilizzare client di Esecuzione e Consenso che controlli.

Per ulteriori informazioni sulla configurazione di un nodo di fallback, consulta la [guida al nodo di fallback](../../node-staking/fallback).

### Inizializza il tuo Distributore di Commissioni

Se non hai intenzione di aderire allo [Smoothing Pool](./whats-new#smoothing-pool) e richiedere tutte le tue commissioni prioritarie e ricompense MEV al tuo [contratto distributore di commissioni](./whats-new#fee-recipients-and-your-distributor), dovrai eventualmente inizializzarlo (creare l'istanza del contratto sulla catena) per poter richiedere le ricompense al tuo indirizzo di prelievo.

Questa è un'operazione abbastanza economica e deve essere fatta solo una volta.

::: tip SUGGERIMENTO
L'inizializzazione del tuo distributore di commissioni può essere effettuata in **qualsiasi momento**.
Puoi lasciare che le ricompense si accumulino nel suo indirizzo molto prima di inizializzarlo, e il tuo saldo rimarrà dopo l'inizializzazione.

Ti consigliamo di farlo quando i prezzi del gas sono bassi per minimizzare il costo generale.

Nota che **deve essere inizializzato per poter richiedere le tue ricompense.**
:::

### Aderisci allo Smoothing Pool

Se hai intenzione di approfittare subito dello [Smoothing Pool](./whats-new#smoothing-pool), dovresti aderire prima della fine del primo periodo di ricompense Redstone per massimizzare il tuo importo di "eleggibilità".

Aderire può essere fatto eseguendo il seguente comando:

```shell
rocketpool node join-smoothing-pool
```

### Richiedi Ricompense

L'aggiornamento Redstone sostituisce il vecchio sistema di ricompense costoso e problematico con un [sistema completamente nuovo](./whats-new#new-rewards-system) che è molto più economico, supporta il restaking automatico di RPL (sia importi parziali che completi), e - soprattutto - **ti permette di richiedere le tue ricompense quando vuoi**.

Poiché non c'è più un limite di tempo per richiedere le ricompense, e poiché è più economico richiedere molti intervalli di ricompense in una volta, la funzionalità di richiesta automatica delle ricompense dello Smartnode **è stata rimossa**.
Ora sarai in grado di richiedere le ricompense tramite il seguente comando:

```shell
rocketpool node claim-rewards
```

Questo ti mostrerà tutte le ricompense che hai accumulato attraverso tutti gli intervalli di ricompense a partire dall'aggiornamento Redstone.
