import { Tab, Tabs } from "@rspress/core/theme";

# Staking tramite Exchange Decentralizzato su Layer 2

Come promemoria, non devi scambiare ETH per rETH direttamente tramite Rocket Pool per godere dei benefici dello staking decentralizzato.
Tutto ciò che devi fare è detenere rETH poiché cresce intrinsecamente di valore - non importa come lo ottieni!

Detto questo, una delle principali preoccupazioni (specialmente negli ultimi tempi) è il costo del gas associato allo staking o allo scambio di ETH per rETH.

Per aiutare a ridurre questo, la rete Ethereum ha iniziato ad adottare l'uso di [rollup](https://www.youtube.com/watch?v=7pWxCklcNsU) - noti anche come **Layer 2**.

Il Layer 2 comprende diverse reti separate che vivono sotto Ethereum, eseguendo molte transazioni come farebbe normalmente Ethereum, ma raggruppandole tutte in un'unica "mega" transazione e pubblicando _quella_ sulla catena principale di Ethereum invece.
Idealmente, ciò significa che otterresti tutti i benefici di sicurezza associati alla natura decentralizzata di Ethereum, ma godendo di **commissioni gas molto più basse** per le tue transazioni poiché i costi di esecuzione e archiviazione su Layer 2 possono essere molto più bassi e solo una parte delle tue transazioni deve essere archiviata su Layer 1 dove lo stato è molto più costoso.

Rocket Pool attualmente supporta due reti Layer 2: [Optimism](https://www.optimism.io/) e [Arbitrum](https://arbitrum.io/).
Entrambe hanno versioni funzionanti di [Uniswap](https://docs.uniswap.org/protocol/introduction), il protocollo di exchange decentralizzato più utilizzato.
Con Uniswap, puoi scambiare rapidamente e facilmente ETH per rETH.

Il vantaggio di utilizzare questo approccio è che **le commissioni gas saranno sostanzialmente inferiori** rispetto ad altri metodi.
Se questo è importante per te perché vuoi mettere in stake una piccola quantità di ETH, allora usare una rete Layer 2 sarà probabilmente la tua opzione di scelta.

Lo svantaggio è che potresti non ottenere il miglior affare su rETH.
Uniswap richiede una piccola commissione che viene data ai suoi fornitori di liquidità, e le grandi transazioni richiederanno grandi pool di liquidità per ottenere buoni affari senza troppo impatto sul prezzo.
Le reti Layer 2 tendono ad avere una liquidità rETH inferiore rispetto alla rete principale Ethereum.

Pertanto, ti consigliamo di confrontare il totale rETH che otterresti su una rete Layer 2 con quello che otterresti tramite gli altri metodi per determinare se ha senso per te perseguire questo percorso.

Puoi visualizzare i saldi attuali di ETH e rETH del [pool Optimism](https://info.uniswap.org/#/optimism/pools/0xaefc1edaede6adadcdf3bb344577d45a80b19582) e del [pool Arbitrum](https://info.uniswap.org/#/arbitrum/pools/0xaac7de2b91293ba1791503d9127d2bdf2159db65) per determinare se hanno abbastanza rETH per coprire il tuo scambio.

Nell'esempio seguente, dimostreremo come interagire con le reti Layer 2 e usare Uniswap per scambiare ETH per rETH.

::: warning NOTA
Attualmente questo metodo è disponibile solo su Mainnet.
Se vuoi esercitarti sulla Hoodi Testnet, devi [scambiare direttamente con Rocket Pool](./via-rp).

**Il resto di questa guida presuppone che tu sia su Mainnet.**
:::

Questo processo può essere completato con qualsiasi wallet compatibile web3.
A scopo dimostrativo, useremo [MetaMask](https://metamask.io/) poiché è una delle scelte di wallet più popolari.

**Dovresti essere in grado di seguire usando passaggi simili con un wallet diverso se scegli - trova semplicemente la funzione comparabile nel tuo wallet per ogni passaggio.**

## Configurazione di MetaMask su Mainnet

Inizia installando [MetaMask](https://metamask.io/) se non l'hai già fatto.
Segui le istruzioni sul loro sito per installare l'estensione, creare un account e accedere.

Successivamente, apri il pannello MetaMask usando la sua icona nella barra degli strumenti del browser.
Clicca sul **menu a discesa della rete** nella barra degli strumenti in alto e assicurati che **Ethereum Mainnet** sia selezionato:

<img src="./images/mm_network_main.png" width="100%" height="auto" />

L'indirizzo direttamente sotto è il tuo **indirizzo del wallet Ethereum**.

Prima di procedere oltre, dovrai fornire ETH a questo wallet.
Se non hai già ETH nell'account da un uso precedente, puoi farlo trasferendo ETH da un account esistente a questo indirizzo del wallet.

## Trasferimento di ETH da Layer 1 a Layer 2 tramite Hop

Ci sono diversi modi per fare il bridge di ETH dalla Mainnet di Ethereum a una rete Layer 2.
In questa dimostrazione, useremo il protocollo [Hop](https://docs.hop.exchange/faq) - un modo semplice e affidabile per spostare ETH (e alcune altre monete) da Layer 1 a diverse reti Layer 2, o tra reti Layer 2.

Vai al sito web di exchange Hop qui:

[https://app.hop.exchange/send?token=ETH](https://app.hop.exchange/send?token=ETH)

La schermata iniziale dovrebbe apparire così:

<img src="./images/hop.png" width="100%" height="auto" />

Inizia cliccando sul pulsante **Connect a Wallet** nell'angolo in alto a destra.
Ti verrà mostrata una schermata che ti chiede quale fornitore di wallet vuoi usare.
Per questo esempio, seleziona **MetaMask**.

::: tip NOTA
Se non stai usando MetaMask, uno degli altri fornitori come WalletConnect sarà probabilmente compatibile con il tuo wallet.
:::

Cliccando quel pulsante, MetaMask apparirà con un prompt che ti chiede di selezionare quali account vuoi usare.
Supponendo che tu ne abbia solo uno, il tuo account dovrebbe essere già selezionato.
Clicca **Next**.

Ti chiederà quindi se desideri dare a Hop l'accesso per visualizzare gli indirizzi dei tuoi account:

<img src="./images/hop_connect.png" width="100%" height="auto" />

Clicca **Connect** e dopo una breve pausa, il tuo wallet sarà connesso a Hop.
Ora dovresti vedere il suo saldo ETH nell'angolo in alto a destra dello schermo.

Ora, puoi usare i due menu a discesa nelle caselle **From** e **To (estimated)** per selezionare le tue reti e inserire la quantità di ETH che vuoi inviare nella casella **From**.

Ad esempio, questo è come apparirebbe inviare 0,1 ETH da Layer 1 ad Arbitrum:

<img src="./images/hop_send.png" width="100%" height="auto" />

::: warning NOTA
Come promemoria, Uniswap (e quindi lo staking di Rocket Pool) è attualmente **supportato solo su Optimism e Arbitrum**.
Devi selezionare una di quelle reti.
:::

Quando sei pronto, clicca il pulsante **Send**.
Metamask apparirà con un dialogo di conferma che ti mostra la commissione gas associata alla transazione:

<img src="./images/hop_confirm.png" width="100%" height="auto" />

Se ti senti a tuo agio con quelle commissioni gas, clicca **Confirm** per iniziare la transazione.
Dopo pochi istanti, MetaMask apparirà con un messaggio di conferma della transazione riuscita, e i tuoi ETH saranno ora disponibili sulla rete Layer 2 di tua scelta!

## Connessione a Uniswap su Layer 2

Ora che il tuo wallet è configurato e finanziato, vai a questo URL che aprirà Uniswap e mostrerà automaticamente lo scambio di ETH per rETH:

[https://app.uniswap.org/#/swap?inputCurrency=eth](https://app.uniswap.org/#/swap?inputCurrency=eth)

La pagina inizialmente apparirà così:

<img src="./images/uni_connect.png" width="100%" height="auto" />

Clicca su uno dei pulsanti `Connect Wallet` come quello evidenziato nell'angolo in alto a destra.
Ti verrà mostrata una schermata che ti chiede quale fornitore di wallet vuoi usare.
Per questo esempio, seleziona **MetaMask**.

::: tip NOTA
Se non stai usando MetaMask, uno degli altri fornitori come WalletConnect sarà probabilmente compatibile con il tuo wallet.
:::

Cliccando quel pulsante, MetaMask apparirà con un altro prompt chiedendoti di selezionare quali account vuoi usare, proprio come ha fatto con Hop.
Lascia il tuo account selezionato, clicca **Next**, e poi clicca **Connect** come hai fatto con Hop prima.
Dopo una breve pausa, il tuo wallet sarà connesso a Uniswap.
Ora dovresti vedere il suo saldo ETH nell'angolo in alto a destra dello schermo.

La prima cosa da fare è cambiare la tua rete dalla mainnet di Ethereum al Layer 2 a cui hai appena scambiato.
Clicca sul menu a discesa della rete in alto a destra dello schermo (evidenziato in rosso qui):

<img src="./images/uni_network.png" width="100%" height="auto" />

Una volta fatto, MetaMask ti chiederà di confermare che vuoi aggiungere una rete personalizzata:

<img src="./images/uni_net_confirm.png" width="100%" height="auto" />

Clicca **Approve** e poi clicca **Switch Network**.
Questo cambierà MetaMask per usare la nuova rete Layer 2 invece della mainnet di Ethereum per le transazioni.

::: warning NOTA
Prima di fare qualsiasi transazione con MetaMask, _verifica sempre_ quale rete sta attualmente usando aprendo MetaMask e guardando il menu a discesa della rete in alto!
È facile cambiare accidentalmente a una rete diversa e dimenticarsene!
:::

## Aggiungere rETH a MetaMask

Il prossimo passo è aggiungere il token rETH a MetaMask in modo da poter vedere il tuo saldo e accedervi per lo scambio.
Clicca sulla scheda **Assets**, poi clicca **Add Token**:

<img src="./images/mm_add_token.png" width="100%" height="auto" />

Assicurati che **Custom Token** sia selezionato in questo dialogo, e seleziona la scheda appropriata per la rete Layer 2 che hai scelto sotto:

<div className="p-3">
  <Tabs>
    <Tab label="Optimism">
      Nella casella **Token Contract Address**, inserisci il seguente valore:

      ```shell
      0x9bcef72be871e61ed4fbbc7630889bee758eb81d
      ```

      Il **Token Symbol** dovrebbe essere popolato automaticamente con `rETH`, e i **Decimals of Precision** dovrebbero essere popolati automaticamente con `18`.

      Accetta il resto dei prompt, e poi vedrai il token rETH apparire nella tua lista.
    </Tab>
    <Tab label="Arbitrum">
      Nella casella **Token Contract Address**, inserisci il seguente valore:

      ```shell
      0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8
      ```

      Il **Token Symbol** dovrebbe essere popolato automaticamente con `rETH`, e i **Decimals of Precision** dovrebbero essere popolati automaticamente con `18`.

      Accetta il resto dei prompt, e poi vedrai il token rETH apparire nella tua lista.
    </Tab>

  </Tabs>
</div>

## Scambiare ETH per rETH con Uniswap

Il passaggio finale del processo è fare lo scambio!

Clicca sul menu a discesa **Select a token** e inserisci l'indirizzo per rETH che hai appena aggiunto a MetaMask (puoi anche semplicemente digitare rETH, ma **assicurati che sia il token corretto e non un token impostore o truffa** verificando prima il suo indirizzo).

::: warning NOTA
Potresti inizialmente ricevere un avviso che appare così:

<img src="./images/unknown_token.jpg" width="100%" height="auto" />

Questo è solo un avviso temporaneo finché Uniswap non aggiunge rETH alla sua lista di token canonici sul Layer che stai usando.
Finché l'indirizzo del token è `0x9bcef72be871e61ed4fbbc7630889bee758eb81d` su Optimism o `0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8` su Arbitrum, puoi aggiungerlo in sicurezza.
:::

Successivamente, inserisci la quantità di ETH che vuoi scambiare e l'interfaccia di Uniswap ti mostrerà la quantità di rETH che riceverai in cambio:

<img src="./images/arb_swap.png" width="100%" height="auto" />

::: warning NOTA
Nota che la quantità di rETH che ricevi sarà **inferiore** alla quantità di ETH che metti.
Questo è normale, perché **rETH vale più di ETH** e si apprezza continuamente nel tempo.
Puoi vedere questo nel tasso di cambio evidenziato in fondo allo screenshot.
:::

Ora clicca **Swap** per vedere i dettagli dello scambio, inclusa la quantità minima che potresti ricevere a causa dello slippage.
Se sei soddisfatto, clicca **Confirm Swap**.
Questo invierà la richiesta a MetaMask, dove puoi rivedere il costo totale della transazione prima di confermarla:

<img src="./images/arb_gas.png" width="100%" height="auto" />

::: tip NOTA
Presta **molta attenzione** alla commissione gas stimata qui.
Probabilmente noterai che è **circa 10 volte più economico** in termini di commissioni gas fare questo scambio su una rete Layer 2 rispetto alla Mainnet di Ethereum!
:::

Se sei soddisfatto delle commissioni gas rispetto alla quantità totale di rETH che riceverai, clicca **Confirm** per inviare la transazione.
Dopo un breve periodo, dovresti vedere una notifica da MetaMask che è stata completata con successo, e ora vedrai il token rETH nel tuo wallet.

Ecco fatto! Ora stai facendo staking con Rocket Pool. Tutto ciò che devi fare è conservare il tuo rETH, e guadagnerai automaticamente le tue ricompense di staking man mano che il valore del token rETH aumenta.
