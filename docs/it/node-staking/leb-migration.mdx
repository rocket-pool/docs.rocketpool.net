import { Tab, Tabs } from "@rspress/core/theme";

::: danger AVVISO
I depositi dei minipool sono attualmente disabilitati in preparazione per Saturn 1.
:::

# Migrazione di un Minipool da 16 ETH a 8 ETH

Gli operatori dei nodi hanno la possibilità di **migrare direttamente** i loro minipool da 16 ETH esistenti in minipool da 8 ETH.
Così facendo, verranno aggiunti 8 ETH ai loro [saldi di credito dei depositi](./credit) che potranno essere utilizzati per **creare minipool aggiuntivi senza richiedere ETH agli operatori dei nodi**.

In pratica, questo processo consente a un operatore di nodo di **convertire gratuitamente un minipool da 16 ETH in due minipool da 8 ETH** (_sebbene richiederà comunque ETH per il gas e un collaterale RPL sufficiente per gestire entrambi i minipool_).

La migrazione di un minipool esistente da 16 ETH a uno da 8 ETH è formalmente nota come **riduzione del bond**.
Si tratta di un processo in due fasi e comporta la validazione da parte dell'Oracle DAO.
Ti guideremo attraverso l'intero processo nelle sezioni seguenti.

### Regole per la Riduzione del Bond

Una riduzione del bond prevede i seguenti passaggi:

1. Avvio della riduzione del bond, effettuato dall'operatore del nodo.
2. Un periodo di attesa (il "controllo scrub della riduzione del bond"), che consente all'Oracle DAO il tempo di verificare che la riduzione del bond sia legale e di annullare eventuali riduzioni del bond che violano le regole.
3. Completamento della riduzione del bond, effettuato dall'operatore del nodo.

Per eseguire una riduzione del bond con successo senza essere annullata, il minipool deve seguire queste regole:

1. Il minipool deve essere aggiornato al [delegato Atlas](./minipools/delegates); il vecchio delegato Redstone non può essere utilizzato.
1. Il validatore del minipool sulla Beacon Chain deve essere **in attesa o in staking attivo**. Non può essere slashed, in uscita / uscito o prelevabile / prelevato.
1. Il saldo del validatore del minipool sulla Beacon Chain deve essere **almeno 31,99 ETH** (32 ETH con un piccolo margine per complicazioni temporali che potrebbero causare attestazioni mancate dopo uno skim delle ricompense).

Il minipool deve rispettare queste condizioni per **l'intera durata** del controllo scrub, durante il quale l'Oracle DAO lo monitorerà per garantire il rispetto delle condizioni sopra indicate.

Se, in qualsiasi momento durante il controllo scrub, viene riscontrato che un minipool viola queste condizioni, la riduzione del bond verrà **annullata**.
Il minipool stesso non sarà interessato; continuerà a esistere come un minipool da 16 ETH, validando e agendo come se l'intero processo di riduzione del bond non fosse mai avvenuto.
Tuttavia, **non sarà più idoneo per le riduzioni del bond**.
Una volta che la riduzione del bond di un minipool viene annullata, non può mai più essere tentata.

::: warning NOTA
Una volta completata con successo la riduzione del bond, l'importo del bond del minipool verrà ridotto da 16 ETH a 8 ETH e **la commissione del minipool verrà reimpostata al valore corrente della rete**.

Se riduci un minipool da 16 ETH con una commissione del 20%, **non manterrai quella commissione del 20%**.
Verrà ridotta al valore della rete (**attualmente impostato a un fisso 14%**).

Si noti che, come dimostrato nella sezione [matematica di esempio](./create-validator.mdx#rewards), un minipool da 8 ETH al 14% è _ancora più redditizio_ di un minipool da 16 ETH al 20%, quindi mantenere un tasso di commissione elevato non è una ragione convincente per mantenere un bond da 16 ETH.
:::

### Passaggio 1: Avvio della Riduzione del Bond

Per avviare il processo di riduzione del bond, inserisci il seguente comando:

```shell
rocketpool minipool begin-bond-reduction
```

Questo inizierà fornendo una breve spiegazione del processo (sebbene, se hai letto questa guida, dovrebbe esserti già tutto familiare).
Una volta riconosciuto di aver compreso il processo, ti mostrerà quali minipool hanno attualmente un bond che può essere ridotto, insieme al loro bond e commissione attuali:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)

```

Una volta selezionato uno o più minipool da ridurre, lo Smartnode verificherà se quei minipool sono idonei per la riduzione del bond.

Per essere idoneo, devono essere soddisfatte queste condizioni:

- Il minipool è stato aggiornato per utilizzare il [contratto delegato del minipool Atlas](./minipools/delegates).
- Il validatore del minipool deve avere un saldo della Beacon Chain di almeno 32 ETH.
- Il validatore del minipool deve essere in attesa o attivo.
- Hai abbastanza RPL in stake per supportare il livello minimo di collaterale RPL che sarebbe richiesto _dopo_ la riduzione del bond.

In caso contrario, stamperà un avviso di errore che spiega cosa deve essere fatto prima; per esempio:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)
2

Cannot reduce bond for minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5:
The minipool version is too low. It must be upgraded first using `rocketpool minipool delegate-upgrade`.
You do not have enough RPL staked to support this bond reduction; it would bring you below the minimum RPL staking requirement. You will have to stake more RPL first.
```

Questo mostra che il minipool selezionato richiede un aggiornamento del delegato e il nodo necessita di più RPL in stake per ridurre il bond di quel minipool.

Quando hai soddisfatto i prerequisiti, selezionare un minipool in questo comando ti chiederà semplicemente di scegliere il prezzo del gas per la transazione e la conferma dell'azione.
Dopo aver accettato la conferma, inizierà la riduzione del bond del minipool.

### Monitoraggio del Timer del Controllo Scrub

Una volta avviata una riduzione del bond, puoi visualizzare quanto tempo manca prima che possa essere completata nei log del daemon del tuo `node`:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Per gli utenti in **Docker Mode** e **Hybrid Mode**, questo può essere fatto con il seguente comando:

      ```shell
      rocketpool service logs node
      ```
    </Tab>
    <Tab label="Native Mode">
      Consulta lo script che utilizzi per rivedere i log di sistema del daemon del tuo nodo.
    </Tab>

  </Tabs>
</div>

Vedrai una nuova voce che indica quanto tempo rimane fino al completamento del controllo scrub per la riduzione del tuo bond:

```
rocketpool_node  | 2023/02/25 09:04:21 Checking for minipool bonds to reduce...
rocketpool_node  | 2023/02/25 09:04:21 Minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 has 12m0s left until it can have its bond reduced.
```

Una volta che questo timer raggiunge lo zero e non appare più in questi log, puoi completare la riduzione del bond.

### Passaggio 2: Completamento della Riduzione del Bond

Quando il timer dello scrub è terminato con successo, ci sono due modi per completare la riduzione del bond del tuo minipool:

1. Lascia che il daemon del `node` lo gestisca per te; lo fa durante il controllo di routine che esegue ogni cinque minuti (lo stesso che stampa la riga del tempo rimanente nel log sopra). Se rileva una riduzione del bond idonea, **completerà automaticamente la riduzione** - proprio come fa con lo staking dei minipool in attesa e il controllo del tuo destinatario delle commissioni. Vedrai l'output nel log del `node` che mostra quando ha rilevato e completato una riduzione del bond.
2. Completa manualmente la riduzione del bond utilizzando il seguente comando:
   ```shell
   rocketpool minipool reduce-bond
   ```
   Il comando è semplice; segui le istruzioni per completare il processo una volta che il tuo minipool è idoneo per la riduzione del bond.

Durante la riduzione del bond, Rocket Pool **distribuisce il saldo esistente del tuo minipool** utilizzando il bond e la commissione pre-riduzione del bond del minipool per garantire che sia tu che gli staker di rETH riceviate la vostra giusta quota del saldo esistente, e che la riduzione del bond non modifichi le ricompense che entrambe le parti _avrebbero_ ottenuto su quel saldo.

### I Risultati di un Bond Ridotto

Puoi verificare la riduzione del bond riuscita usando `rocketpool minipool status`.

**Prima** della riduzione del bond, per il minipool di esempio che abbiamo seguito, quel comando produrrebbe il seguente output:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             15.000000%
Node deposit:         16.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            16.000000 ETH
Minipool Balance (EL): 0.150713 ETH
Your portion:          0.086660 ETH
Available refund:      0.000000 ETH
Total EL rewards:      0.086660 ETH
...
Beacon balance (CL):   32.000152 ETH
Your portion:          16.000087 ETH
...
```

**Dopo** la riduzione del bond, il comando restituirebbe questo output:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             14.000000%
Node deposit:         8.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 0.086769 ETH
Your portion:          0.000000 ETH
Available refund:      0.086769 ETH
Total EL rewards:      0.086769 ETH
...
Beacon balance (CL):   32.000037 ETH
Your portion:          8.000013 ETH
...
```

Nota come le cose sono cambiate:

- `Node fee` (commissione) è passata dal 15% al 14%
- `Node deposit` (il tuo bond) è passato da 16 ETH a 8 ETH
- `RP deposit` (l'importo preso in prestito) è passato da 16 ETH a 24 ETH
- `Minipool Balance (EL)` è passato da 0.150713 ETH a 0.086769 ETH
- `Your portion (EL)` è passato da 0.086660 ETH a 0 ETH
- `Available refund` è passato da 0 ETH a 0.086769 ETH
- `Your portion (CL)` è passato da 16.000087 ETH a 8.000013 ETH

I cambiamenti in `Node fee`, `Node deposit`, `RP deposit` e `Your portion (CL)` indicano che il bond è stato ridotto con successo.

I cambiamenti in `Minipool Balance (EL)`, `Your portion (EL)` e `Available refund` indicano i risultati della **distribuzione del saldo del minipool** avvenuta come parte del processo di riduzione del bond.
Per chiarire come interpretare questi risultati:

- Se guardi [la transazione](https://zhejiang.beaconcha.in/tx/0xf02f6b1a4ea68f356909e6f1974dc3c24d301ba115b97f3013c3c829ba2ca57c), vedrai anche che ha inviato 0.06413383 ETH dal minipool allo staking pool.
- Nell'esempio "prima", la quota dello staking pool è il saldo del minipool meno la porzione dell'operatore del nodo, ovvero `0.150713 - 0.086660 = 0.064053` che è l'importo trasferito allo staking pool durante la riduzione del bond (più un piccolo importo da uno skim delle ricompense avvenuto durante il controllo scrub).
- La quota dell'_operatore del nodo_, d'altra parte, non viene inviata all'indirizzo di prelievo dell'operatore del nodo. Viene invece segnalata come un **rimborso disponibile**, motivo per cui l'importo del rimborso è aumentato da 0 ETH a quello che era precedentemente l'importo "your portion" del saldo del minipool sull'EL.
  - Puoi richiedere questo rimborso in qualsiasi momento utilizzando il seguente comando:
    ```shell
    rocketpool minipool refund
    ```

C'è un altro importante risultato della riduzione del bond, che può essere osservato usando `rocketpool node status`:

```
Your Smartnode is currently using the Zhejiang Test Network.

=== Account and Balances ===
The node 0x9BA1401Eb7D779eC51f910B066e9C4351cD28911 has a balance of 347.796908 ETH and 16799.835547 RPL.
The node has 8.000000 ETH in its credit balance, which can be used to make new minipools.
```

Il processo di riduzione del bond ha **aumentato il** [saldo di credito dei depositi](./credit) **del nodo** di 8 ETH.
Questo credito può essere utilizzato per [creare un altro minipool da 8 ETH](./create-validator.mdx#depositing-eth-and-creating-a-minipool) gratuitamente (nessun ETH richiesto dal portafoglio del nodo, tranne che per il gas)!
