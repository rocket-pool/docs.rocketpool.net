import { Tab, Tabs } from "@rspress/core/theme";

# Importazione / Recupero di un Wallet Esistente

Se hai già un wallet che vorresti utilizzare per il tuo nodo, o se stai recuperando un wallet che hai già creato in precedenza con lo Smartnode, questa guida ti aiuterà attraverso il processo di importazione / recupero.

Seleziona l'opzione appropriata dalle sezioni qui sotto.

## Recupero di un Wallet Smartnode

Se hai generato il tuo wallet del nodo usando lo Smartnode e stai semplicemente recuperandolo su una nuova macchina, il processo è abbastanza semplice.
Assicurati di aver già installato il software Smartnode, quindi esegui semplicemente il seguente comando una volta installato:

```shell
rocketpool wallet recover
```

::: warning NOTA
Se, per qualche motivo, vuoi recuperare il wallet ma _non_ le chiavi dei validator associate ai minipool del tuo nodo, puoi specificare il flag `-k` per saltare il processo di ricostruzione:

```shell
rocketpool wallet recover -k
```

Se non specifichi questo flag, lo Smartnode tenterà di recuperare le chiavi dei validator per i tuoi minipool; tuttavia, nota che questo non funzionerà finché il tuo client Execution non avrà terminato la sincronizzazione.
Si prega di guardare il suo file di log per vedere quando è finito; una volta terminato, puoi eseguire questo passaggio.
:::

Questo prima ti chiederà una password che vuoi utilizzare per crittografare il tuo wallet.
Dopo di che, chiederà la tua **frase di recupero mnemonica di 24 parole**.
Inseriscila con attenzione - non verrà mostrata sullo schermo per sicurezza, ed è molto facile commettere un errore mentre la digiti, quindi prenditi il tuo tempo.

Quando hai finito, dovresti vedere un output simile a questo:

```shell
$ rocketpool wallet recover

Please enter a password to secure your wallet with:

Please confirm your password:

Please enter your recovery mnemonic phrase:

Recovering node wallet...
The node wallet was successfully recovered.
Node account: <l'indirizzo del tuo wallet>
No validator keys were found.
```

Se non vedi errori, allora il tuo wallet e i validator saranno recuperati.

Una volta terminato, assicurati di riavviare il client Validator con il seguente comando per gli utenti Docker e Hybrid mode:

```shell
docker restart rocketpool_validator
```

Gli utenti **Native mode** dovranno semplicemente riavviare il loro processo del container Validator.

Questo garantirà che il VC raccolga tutte le chiavi dei validator appena ripristinate.

## Importazione di un Indirizzo Esistente come Wallet del Nodo

Se hai un indirizzo che vorresti utilizzare per un nodo, ma _non_ lo hai creato con lo Smartnode (ad es., lo hai creato con MetaMask o un hardware wallet), allora questa è la sezione da seguire.

::: danger AVVISO
Facendo questo, il tuo indirizzo diventerà un **hot wallet**.
La chiave privata sarà memorizzata sulla macchina del tuo nodo.

Se stai importando un indirizzo che è un cold wallet, come un hardware wallet, tieni presente che **la protezione fornita dall'hardware wallet non esisterà più!**

Se utilizzi questo wallet per _qualsiasi altra attività di criptovaluta_, **devi migrare tutti i suoi fondi a un indirizzo separato (ad es. un hardware wallet diverso) prima di importarlo nel tuo nodo! Lascia solo abbastanza ETH su questo indirizzo per i costi del gas del tuo nodo (tipicamente 0,5 ETH è sufficiente).**

Assicurati di aver protetto la tua macchina il più possibile seguendo i passaggi nella guida [Protezione del tuo Nodo](./securing-your-node) prima di importare il tuo indirizzo come wallet del nodo.
:::

Questa capacità è disponibile solo con Smartnode **v1.4.3 o superiore**.
Se hai una versione inferiore, dovrai prima aggiornarla.

Questo è un processo in più fasi, quindi segui attentamente le sezioni seguenti.

### Passo 1: Aggiungere Chiavi di Validator Generate Esternamente

**Se non hai minipool esistenti associati all'indirizzo che stai importando, puoi saltare questo passaggio.**

Se il tuo indirizzo è già stato registrato come wallet di nodo di Rocket Pool (ad esempio tramite un servizio come **Allnodes**) e ha già minipool attivi, e vorresti importarli nello stack Smartnode insieme al tuo indirizzo, dovrai fornire i file keystore privati per ciascuno dei loro validator corrispondenti.
Questi file saranno crittografati con una password di tua scelta, quindi avrai bisogno di quella password per ciascun file.

Devi ottenere questi file dal servizio che sta attualmente eseguendo il tuo nodo per importarlo.
Alcuni provider di servizi potrebbero essere in grado di recuperare questi file su richiesta.
Se usi Allnodes, puoi ottenere questi file durante il processo di configurazione iniziale ma **non sarai in grado di recuperarli in futuro a meno che non li abbia salvati durante la creazione del minipool.**

Seleziona la tua modalità di installazione e segui i passaggi qui sotto.

<div className="p-3">
  <Tabs>
    <Tab label="Docker e Hybrid Mode">
      Prima, assicurati di aver avviato lo Smartnode con `rocketpool service start`.
      Questo creerà una cartella speciale che può essere utilizzata per contenere i file keystore crittografati per i tuoi validator.

      Per impostazione predefinita, la cartella si trova in `~/.rocketpool/data/custom-keys`.
      Se hai personalizzato le tue directory di installazione o dati, sostituisci di conseguenza per trovare la cartella `custom-keys`.

      Controlla con un esploratore di file o il comando `ls` per assicurarti che questa cartella esista.
      In caso contrario, nessun problema - crea semplicemente la cartella con il seguente comando:

      ```shell
      mkdir ~/.rocketpool/data/custom-keys
      ```
    </Tab>
    <Tab label="Native Mode">
      Crea una cartella chiamata `custom-keys` all'interno della cartella `data` del tuo Smartnode (ad esempio, `/srv/rocketpool/data/custom-keys`).
    </Tab>

  </Tabs>
</div>

Successivamente, posiziona ciascuno dei file keystore dei validator in questa cartella.
I nomi dei file non importano, ma devono essere file JSON che sono conformi al formato [EIP-2335](https://eips.ethereum.org/EIPS/eip-2335#scrypt-test-vector).

Lo Smartnode cercherà in questa directory eventuali file keystore che hai posizionato qui nei passaggi successivi.

::: warning NOTA
Il processo di importazione guarderà _solo_ le chiavi dei validator associate ai minipool registrati all'indirizzo che stai importando.
**Non puoi** utilizzare questo processo per importare altre chiavi di validator, come per validator di solo staking, nel client Validator gestito dallo stack Smartnode.

Si prega di consultare la documentazione per l'esecuzione in [Reverse Hybrid Mode](./advanced-config#allowing-external-validator-clients-to-connect-to-the-smartnode) se sei interessato a farlo.
:::

### Passo 2 (Opzionale): Test di Importazione dell'Indirizzo

Se desideri testare il processo di recupero per assicurarti di avere il mnemonic e le password corrette **senza effettivamente rigenerare la chiave privata del wallet del tuo nodo o importare le chiavi dei validator**, puoi farlo con il seguente comando:

```shell
rocketpool wallet test-recovery -a 0x1234abcd...
```

Dove `0x1234abcd...` è l'indirizzo che vuoi importare, iniziando con il prefisso `0x`.
**Avrai bisogno della tua frase mnemonica per importare la chiave privata per il tuo indirizzo.**

::: tip SUGGERIMENTO
Se, per qualche motivo, vuoi recuperare il wallet ma _non_ le chiavi dei validator per i tuoi minipool, puoi specificare il flag `-k` per saltare il processo di recupero delle chiavi dei validator.
Per esempio:

```shell
rocketpool wallet test-recovery -a 0x1234abcd... -k
```

:::

Lo Smartnode cercherà automaticamente attraverso i percorsi di derivazione più popolari (ad es. quelli utilizzati da Ledger Live, MyEtherWallet, Trezor e lo stack Smartnode) e gli indici di indirizzo per trovare le impostazioni che corrispondono all'indirizzo che hai fornito.

::: tip SUGGERIMENTO
Se hai un percorso di derivazione personalizzato, usa il flag `-d` per specificarlo.
Per esempio:

```shell
rocketpool wallet test-recovery -d "m/44'/60'/0'/%d"
```

Usa `%d` per la porzione del percorso che può essere iterata per utilizzare diversi indici.

Se hai un indice di indirizzo personalizzato, usa il flag `-i` per specificarlo.
Per esempio, se il tuo indirizzo era il 6° sul percorso di derivazione standard, potresti usare:

```shell
rocketpool wallet test-recovery -i 5
```

Puoi usare sia i flag `-d` che `-i` contemporaneamente se ne hai bisogno.
:::

Prima, ti verrà richiesta la frase mnemonica del tuo indirizzo:

```
Please enter the number of words in your mnemonic phrase (24 by default):
24

Enter Word Number 1 of your mnemonic:
```

Inseriscila con attenzione, e lo Smartnode inizierà a cercare attraverso tutte le opzioni standard per trovarla (a meno che non le abbia esplicitamente specificate usando i flag `-d` e/o `-i`).

Successivamente, se hai file keystore privati da importare dal Passo 1, ti verrà richiesta la password per ciascuno di quei file keystore:

```
It looks like you have some custom keystores for your minipool's validators.
You will be prompted for the passwords each one was encrypted with, so they can be loaded into the Validator Client that Rocket Pool manages for you.

Please enter the password that the keystore for <validator pubkey> was encrypted with:
```

Saranno organizzati per elenco di **pubkey**, **non per nomi di file**.
Assicurati di sapere quale file corrisponde a quale pubkey del validator in modo da inserire le password corrette.

Una volta fatto questo, il processo di test di recupero procederà e riporterà se è riuscito o fallito:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

Quanto sopra indica un test di recupero riuscito.

### Passo 3: Importare l'Indirizzo

::: danger AVVISO
Se il tuo indirizzo è un nodo Rocket Pool che _non_ è gestito dal tuo Smartnode self-hosted (ad es. ospitato da un servizio esterno come **Allnodes**), **È CRITICO** che tu coordini con il servizio che gestisce il tuo nodo **prima di iniziare questo processo di importazione** e informi loro che vorresti migrare al tuo sistema self-hosted.

**DEVI CONFERMARE** che hanno spento la validazione per il tuo nodo e **non la riprenderanno MAI**, e confermare manualmente che i tuoi validator non stiano più attestando usando un esploratore Blockchain come [https://beaconcha.in](https://beaconcha.in).
Devi confermare che ogni validator ha perso **ALMENO 2 ATTESTAZIONI** per assicurarti di poter migrare in sicurezza.
Altrimenti, entrambi attesterete contemporaneamente e **I TUOI MINIPOOL SARANNO SLASHED!**

Lo Smartnode ti chiederà di confermare che hai fatto questo prima di permetterti di procedere con il processo di importazione.
:::

Se il test di recupero è riuscito, o se lo hai saltato, successivamente importerai il wallet e rigenererai tutti i suoi file di chiave associati.
Il processo è esattamente lo stesso di quanto sopra, ma usa il comando `recover` invece del comando `test-recovery`:

```shell
rocketpool wallet recover -a 0x1234abcd...
```

Quando esegui questo comando, ti verrà prima richiesta una password per crittografare il tuo wallet del nodo importato.

```
Please enter a password to secure your wallet with:

Please confirm your password:
```

Dopo di che, i prompt del mnemonic e della password del keystore del validator personalizzato procederanno come prima.

Una volta inserite tutte queste informazioni, lo Smartnode recupererà il tuo indirizzo e (se non disabilitato) le chiavi dei validator personalizzate per i tuoi minipool:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

La chiave privata del tuo indirizzo sarà ora memorizzata nel file `data/wallet` (ad es. `~/.rocketpool/data/wallet`), e la password per essa sarà memorizzata nel file `data/password` (ad es. `~/.rocketpool/data/password`).

Le chiavi private per ciascuno dei tuoi validator saranno memorizzate nelle cartelle `data/validators` per ciascuno dei client Consensus che lo Smartnode supporta.

::: danger NOTA
Importando un indirizzo in questo modo, le chiavi dei validator **non** sono state derivate dal tuo wallet del nodo, e quindi **non possono** essere recuperate successivamente semplicemente eseguendo `rocketpool wallet recover` come con un normale wallet del nodo.

Se mai avrai bisogno di recuperare o importare questo wallet di nuovo, dovrai seguire questo stesso processo il che significa che **dovrai avere questi keystore privati dei validator e le loro password salvate da qualche parte in sicurezza.**

Se mai li perdi, **non sarai più in grado di recuperare queste chiavi dei validator!**
:::

### Passo 4: Pulizia

A questo punto, puoi ora eliminare tutti i file keystore privati nella directory `data/custom-keys`.
Lo Smartnode li avrà già importati e assegnato password casuali ad essi, quindi quei file keystore non sono più necessari.

Infine, assicurati che **non** ci sia un file chiamato `custom-key-passwords` nella tua directory `data` (ad es. `~/.rocketpool/data/custom-key-passwords`).
Lo Smartnode costruirà questo file temporaneo solo durante il processo di recupero, e lo rimuoverà automaticamente indipendentemente dal fatto che il processo di recupero sia riuscito o meno; se per qualche motivo non è riuscito a rimuoverlo, ti avviserà nell'output della console.
Tuttavia, non fa mai male essere troppo prudenti.

## Prossimi Passi

Una volta importato o recuperato il wallet del tuo nodo, segui i prossimi passi nella guida [Introduzione all'Interfaccia a Riga di Comando](./cli-intro).
