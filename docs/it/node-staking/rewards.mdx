import claim_rewards_gb from "./images/claim-rewards-gb.png";
import autostake from "./images/autostake.png";

# Richiesta delle Ricompense per Node Operator

Come Node Operator di Rocket Pool, hai diritto a ricompense regolari che verranno fornite sotto forma di token RPL e (se sei iscritto allo Smoothing Pool) anche ETH.
Questa sezione descriverà come funzionano queste ricompense e come puoi richiederle.

## Ricompense e Checkpoint

A intervalli regolari, Rocket Pool segnalerà un **checkpoint** sulla rete.
Attualmente, i checkpoint si verificano **ogni 28 giorni**.

A un nuovo checkpoint, l'Oracle DAO creerà collettivamente uno **snapshot vero** dello stato dei Node Operator nella rete Rocket Pool, che utilizzerà per determinare le ricompense in RPL e ETH dello Smoothing Pool per ciascun nodo durante quell'intervallo. Si noti che la "commissione bonus" per i minipool Saturn 0 viene distribuita utilizzando le ricompense dello Smoothing Pool (i minipool Saturn 0 sono quelli creati dopo il 28/10/2024, che hanno una commissione contrattuale del 5%).

Queste informazioni vengono compilate in un [Merkle Tree](https://en.wikipedia.org/wiki/Merkle_tree) - un modo estremamente efficiente per rendere tutti i dettagli disponibili agli smart contract.
Il Merkle Tree viene costruito in un file JSON e ospitato sull'[InterPlanetary File System (IPFS)](https://en.wikipedia.org/wiki/InterPlanetary_File_System) e replicato su [un repository GitHub che manteniamo](https://github.com/rocket-pool/rewards-trees/).

Una volta inviato l'albero, gli smart contract di Rocket Pool creeranno nuovi token RPL e li sposteranno, insieme all'intero saldo ETH dello Smoothing Pool, nel vault di Rocket Pool per l'archiviazione sicura.
Potrai quindi visualizzare quanti RPL e ETH hai guadagnato durante quell'intervallo e richiedere quelle ricompense.

Il sistema di ricompense ha le seguenti caratteristiche:

- Ogni intervallo è indipendente. La quantità di RPL ed ETH che hai guadagnato in un intervallo non influisce sui guadagni per gli intervalli successivi.
- Puoi **lasciare accumulare le ricompense** per tutto il tempo che desideri. Non è necessario richiedere le ricompense entro un tempo specifico; saranno sempre disponibili per te da richiedere e forniranno sempre esattamente la stessa quantità di RPL ed ETH **indipendentemente da quando le richiedi**.
- Puoi richiedere un intervallo alla volta o **più intervalli** tutti in una volta.
- La tua prima transazione di richiesta utilizza circa 85k gas. Ogni transazione di richiesta successiva costa circa 55k gas.
  - Se stai richiedendo più intervalli contemporaneamente, ogni intervallo supplementare costa **6k gas**, quindi è più conveniente richiederli tutti in una volta.
- Puoi **rimettere in stake una parte (o tutto) delle tue ricompense RPL** come parte della transazione di richiesta, quindi tutto viene fatto in una singola transazione (il che riduce ulteriormente i costi del gas).
- Attualmente, **tutte le tue richieste devono essere su Mainnet** ma abbiamo l'infrastruttura in atto per costruire la capacità di richiedere su reti Layer 2 in una data successiva.

Per ulteriori informazioni su come viene costruito il Merkle Tree e su come vengono calcolate le ricompense, [visita il nostro repository `research` e visualizza le specifiche ufficiali](https://github.com/rocket-pool/rocketpool-research/tree/master/Merkle%20Rewards%20System).
Di seguito abbiamo fornito una breve spiegazione.

### Ricompense RPL

L'attuale tasso di ricompensa di RPL è **5% di inflazione annua** e le ricompense vengono pagate ogni periodo di 28 giorni.
Dal 21/10/2024, l'inflazione dell'ultimo periodo è stata di 77.533. Poiché il 70% viene distribuito ai Node Operator di Rocket Pool, ciò corrisponde a 54.273 RPL in quel periodo.

Questo importo sarà diviso tra tutti i Node Operator sulla rete, in base al loro [peso del nodo](https://rpips.rocketpool.net/RPIPs/RPIP-30#specification).
I Node Operator guadagnano l'APY massimo per le posizioni RPL in stake che valgono 0-15% dell'ETH preso in prestito.
Lo stake RPL oltre il 15% dell'ETH preso in prestito guadagna comunque ulteriori ricompense, ma a un APY marginale ridotto.

Se sono trascorsi meno di 28 giorni tra il momento in cui hai registrato il tuo nodo e il checkpoint, le tue ricompense in quel primo intervallo di ricompense saranno **proporzionate** per tenerne conto. Ad esempio, se ti sei registrato il giorno 14 dell'intervallo, riceverai il 50% delle ricompense normali.

Dopo quel primo intervallo, il tuo nodo sarà stato registrato abbastanza a lungo negli intervalli successivi da ricevere ricompense complete per tutti.

Il comando `rocketpool node status` ti mostrerà il tuo attuale rapporto di collateralizzazione in qualsiasi momento. Questo rapporto di collateralizzazione sarà basato sui prezzi al momento in cui esegui il comando. Tuttavia, se vuoi sapere quale sarà il tuo rapporto di collateralizzazione al prossimo round di ricompense, segui i passaggi successivi:

- Esegui il comando `/when` nel canale "random" del [Discord di Rocketpool](https://discord.com/channels/405159462932971535/405503016234385409) e vedi quante ore mancano prima dell'inizio del prossimo periodo di ricompense.
- L'oDAO effettua uno snapshot del prezzo ogni 19,2 ore (cioè circa 5760 blocchi \* 12 secondi, esclusi i blocchi mancati). Pertanto, controllare il contratto di invio del prezzo dell'oDAO in Etherscan ti dirà se è stato effettuato uno snapshot del prezzo nelle 19,2 ore precedenti prima del momento indicato nel punto precedente. Se è così, lo snapshot del prezzo è stato effettuato. In caso contrario, deve ancora essere fatto e puoi stimare quando accadrà guardando l'ultimo round di invii di prezzo dell'oDAO e aggiungendo 19,2 ore.
- Per verificare quale rapporto di prezzo RPL/ETH è stato catturato come snapshot dall'oDAO per il prossimo round di ricompense, controlla il contratto di invio del prezzo dell'oDAO in Etherscan (che puoi ottenere eseguendo il comando `/get_address_of_contract contract:rocketNetworkPrices` nel canale "random" del Discord di Rocketpool). Successivamente, apri una o più delle transazioni inviate dai membri dell'oDAO. <a href="/images/node/rewards/rewards-1.png" target="_blank"><img src="/images/node/rewards/rewards-1.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Scorri verso il basso e nella sezione "More Details", fai clic su **"+ Click to show more"**, quindi fai clic su **"Decode Input Data"**. <a href="/images/node/rewards/rewards-2.png" target="_blank"><img src="/images/node/rewards/rewards-2.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Il prezzo RPL (mostrato in unità wei) visualizzato nella casella Input Data, diviso per 10^18 (per convertirlo in unità ETH) moltiplicato per il numero di RPL in stake, dovrebbe essere >= 1,6 ETH (per minipool da 16 ETH) e >= 2,4 ETH (per LEB8), moltiplicato per il numero di minipool di ciascun tipo che gestisci. <a href="/images/node/rewards/rewards-3.png" target="_blank"><img src="/images/node/rewards/rewards-3.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Se il tuo rapporto di collateralizzazione è inferiore all'importo richiesto come spiegato nel punto precedente, puoi mettere in stake ulteriori RPL nel tempo tra quando l'oDAO ha effettuato l'ultimo snapshot del prezzo (vedi punto 3 sopra) e il momento in cui inizia il prossimo round di ricompense (vedi punti 1 e 2 sopra), per riportare il tuo nodo a un rapporto di collateralizzazione >=10%.
- Un'alternativa al controllo degli invii di prezzo dell'oDAO in Etherscan è tenere d'occhio il canale "events" del Discord di Rocketpool e cercare il messaggio **RPL Price Update** dal bot Rocket Watch (vedi esempio sotto) nelle ultime 19,2 ore prima dell'inizio del prossimo periodo di ricompense. <a href="/images/node/rewards/rewards-4.png" target="_blank"><img src="/images/node/rewards/rewards-4.png" style={{ display: "block", margin: "0 auto" }} /></a>

### Ricompense ETH dello Smoothing Pool

Insieme alle ricompense RPL, l'intero saldo ETH dello Smoothing Pool viene distribuito durante i checkpoint delle ricompense.
Dell'intero saldo delle ricompense dello Smoothing Pool, la percentuale che corrisponde agli staker del pool (50% per i minipool da 16 ETH o 75% per gli LEB8), meno la rispettiva commissione del nodo, verrà inviata al contratto rETH. Lì può essere 1) bruciata per ETH dagli staker del pool che vogliono uscire, o 2) utilizzata per creare più minipool.
La parte rimanente sarà distribuita tra i Node Operator idonei.

I nodi che sono iscritti allo Smoothing Pool per l'intervallo, anche se solo per parte del tempo, sono idonei per una porzione del saldo totale dello Smoothing Pool.
Il saldo viene catturato al checkpoint delle ricompense e l'Oracle DAO determina la porzione di ciascun nodo idoneo.
La porzione è determinata dai seguenti fattori:

- Quantità di tempo nello Smoothing Pool in questo intervallo
- Prestazioni di attestazione sulla Beacon Chain per ciascun minipool
- La commissione di ciascun minipool

Se desideri saperne di più, consulta il repository `research` collegato sopra per una ripartizione completa di come vengono calcolate le ricompense.

### (Opzionale) Generazione del Rewards Tree

Quando viene raggiunto un nuovo checkpoint di ricompense, l'Oracle DAO inizierà a costruire il rewards tree per quell'intervallo.
La costruzione di questo albero richiede attualmente circa 2 ore e le ricompense per l'intervallo non sono disponibili per la richiesta finché l'albero non è stato costruito e inviato.
Una volta disponibile, il tuo nodo scaricherà automaticamente questo file e potrai visualizzare e richiedere le tue ricompense per quell'intervallo.

Se desideri generare l'albero tu stesso invece di scaricare quello pre-costruito dall'Oracle DAO, puoi farlo!

- Accedi al TUI `rocketpool service config`.
- Naviga alla sezione `Smartnode and TX Fees`.
- Cambia la `Rewards Tree Mode` da `Download` a `Generate`.
- Se il tuo client di Execution primario non è un nodo archive, puoi aggiungere un URL per un nodo archive separato nella casella `Archive-Mode EC URL`.
  - Questo è necessario per generare i rewards tree storici.
  - L'Archive EC verrà utilizzato solo per la generazione dell'albero; non verrà utilizzato per altre funzioni dello Smartnode.
  - [Infura](https://infura.io/product/ethereum) e [Alchemy](https://www.alchemy.com/supernode) offrono accesso ai nodi archive. **Si noti che i livelli gratuiti di solito non sono sufficienti per gestire la generazione dell'albero, quindi avrai bisogno di uno dei livelli a pagamento.**

Ora il tuo Smartnode costruirà l'albero completamente indipendentemente dall'Oracle DAO, utilizzando solo i dati forniti dai tuoi client di Execution e Consensus.
Puoi guardarlo durante un checkpoint dell'intervallo di ricompense con `rocketpool service logs watchtower`.

Se desideri ricostruire alberi passati da intervalli precedenti, puoi farlo con il seguente comando:

```shell
rocketpool network generate-rewards-tree
```

Segui le istruzioni, quindi usa `rocketpool service logs watchtower` per visualizzare i suoi progressi.

## Richiesta delle Ricompense

Per visualizzare le tue ricompense non richieste in sospeso, esegui il seguente comando:

```shell
rocketpool node claim-rewards
```

Man mano che gli intervalli passano e accumuli ricompense, l'output sarà simile a questo:

<img src={claim_rewards_gb} width="100%" height="auto" />

Qui puoi vedere rapidamente quante ricompense hai guadagnato in ciascun intervallo e puoi decidere quale/i richiedere.

Puoi anche specificare un importo che desideri rimettere in stake durante questa richiesta:

<img src={autostake} width="100%" height="auto" />

Questo ti permetterà di comporre le tue ricompense RPL in una transazione, risparmiando sui costi del gas.

Segui semplicemente le istruzioni, assicurati che il tuo wallet del nodo abbia abbastanza ETH per pagare i costi del gas per la richiesta e hai finito!
**Le tue ricompense verranno inviate al tuo indirizzo di prelievo.**

::: tip SUGGERIMENTO
Per visualizzare le ricompense totali del tuo nodo, incluse quelle che hai già richiesto, usa il seguente comando:

```shell
rocketpool node rewards
```

Questo fornirà una ripartizione di quanto RPL ed ETH hai richiesto finora e quanto è ancora non richiesto:

```
=== ETH ===
You have earned 8.1935 ETH from the Beacon Chain (including your commissions) so far.
You have claimed 0.0634 ETH from the Smoothing Pool.
You still have 3.4788 ETH in unclaimed Smoothing Pool rewards.

=== RPL ===
The current rewards cycle started on 27 Sep 22 21:26 EDT.
It will end on 30 Sep 22 21:26 EDT (20h35m17s from now).
You currently have 675.616380 unclaimed RPL from staking rewards.

Your estimated RPL staking rewards for this cycle: 36.851544 RPL (this may change based on network activity).
Based on your current total stake of 6615.797278 RPL, this is approximately 67.77% APR.
Your node has received 208.551820 RPL staking rewards in total.

You may claim these rewards at any time. You no longer need to claim them within this interval.
```

:::

## Ricompense del Livello di Execution nel tuo Fee Distributor

Se **non** sei iscritto allo Smoothing Pool, la parte del livello di Execution delle tue ricompense dalle proposte di blocchi (incluse le commissioni di transazione e MEV) verrà inviata al contratto [Fee Distributor](./fee-distrib-sp#fee-distributors-and-the-smoothing-pool) del tuo nodo.

Per verificare il saldo del tuo Fee Distributor, puoi utilizzare un chain explorer come [https://etherscan.io](https://etherscan.io) o semplicemente eseguire `rocketpool node status` - ci sarà una sezione chiamata **Fee Distributor and Smoothing Pool** che lo mostra:

```
=== Fee Distributor and Smoothing Pool ===
The node is not opted into the Smoothing Pool.
To learn more about the Smoothing Pool, please visit /it/legacy/redstone/whats-new.html#smoothing-pool.
The node's fee distributor 0xA0bfbFC582f5814585f8455Ed6D7B620eA9a9EE4 has a balance of 1.143598 ETH.
```

### Distribuzione del Saldo

Per accedere al saldo del Fee Distributor, lo **distribuirai** (da cui il nome, _Fee Distributor_).
Questo calcolerà la tua quota delle ricompense (in base alla commissione media del minipool del tuo nodo) e la invierà all'indirizzo di prelievo del tuo nodo; il resto viene inviato allo staking pool.

La distribuzione può essere effettuata **in qualsiasi momento**.
Puoi sederti sul saldo e lasciarlo accumulare se lo desideri, o distribuirlo regolarmente.

Per distribuire il saldo, esegui il seguente comando:

```shell
rocketpool node distribute-fees
```

Questo mostrerà quanto va a te e quanto va allo staking pool:

```
Your node's average commission is 15.00%.
Your fee distributor's balance of 1.143599 ETH will be distributed as follows:
 Your withdrawal address will receive 0.657569 ETH.
 rETH pool stakers will receive 0.486030 ETH.
```

Conferma semplicemente il prezzo del gas che desideri e invia la transazione.
Una volta completata, la tua parte delle ricompense sarà disponibile nell'indirizzo di prelievo del tuo nodo.
