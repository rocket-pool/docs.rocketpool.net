import { Tab, Tabs } from "@rspress/core/theme";
import tuiOdao from "./images/tui-odao.png";

# Настройка узла Oracle DAO

Как минимум, стандартный узел Rocket Pool запускает следующее:

- CLI Smartnode
- Демон API Smartnode
- Демон `node` Smartnode
- Демон `watchtower` Smartnode

Опционально узел также может запускать следующие компоненты:

- Execution Client
- Beacon Node
- Validator Client
- MEV-Boost
- Prometheus
- Prometheus Node Exporter
- Grafana

Каждый из этих компонентов может быть запущен как контейнер Docker в стандартной настройке, как сервис `systemd` в настройке "Native Mode" или как внешне управляемые объекты, к которым Smartnode может подключаться через их соответствующие маршруты API.

Удобно, что узлы Oracle DAO такие же, как обычные узлы Rocket Pool, но демон `watchtower` выполняет дополнительные обязанности Oracle DAO, и для целей мониторинга производительности собирается больше метрик Prometheus.

## Начальная настройка узла

Лучший способ начать — следовать [стандартным инструкциям по настройке](../node-staking/platform) для обычного узла Rocket Pool.
Этот процесс поможет вам определить, как вы хотите настроить и запустить ваш узел.

Если вы хотите запускать minipools (валидаторы) на вашем узле, пожалуйста, следуйте обычной документации по узлам от начала до конца и вернитесь сюда, когда закончите.

Если вы _не_ намерены запускать minipools и вместо этого будете использовать его исключительно для обязанностей Oracle DAO, вы можете пропустить все шаги, связанные со стейкингом RPL и созданием minipool.
Другие шаги, такие как регистрация узла, установление хорошей позиции безопасности, мониторинг работоспособности и производительности узла, а также обновление Smartnode после обновления, все еще применимы к вам, и вы должны внимательно их изучить, прежде чем продолжить.
Вернитесь сюда, когда закончите.

## Дополнительная конфигурация Oracle DAO

Существует две дополнительные настройки, которые вам необходимо настроить, чтобы выполнять ваши обязанности Oracle DAO.
Пожалуйста, выберите режим, который вы используете для настройки вашего узла, из вкладок ниже.

<div className="p-3">
  <Tabs>
    <Tab label="(service config) Интерактивный UI">
      Откройте TUI `rocketpool service config` и перейдите в раздел `Smartnode and TX Fees`.
      Здесь вы увидите две опции внизу:

      <img src={tuiOdao} width="100%" height="auto"/>

      `Archive-Mode EC URL` должен быть HTTP-конечной точкой RPC API для вашего архивного Execution Client.
      **Обратите внимание, что если вы уже используете ваш архивный EC в качестве основного клиента в режиме внешнего управления, вы можете игнорировать эту настройку.**
    </Tab>
    <Tab label="(service config) Без интерфейса">

      Выполните следующую команду для настройки вашего узла без интерфейса:

      ```shell
      rocketpool service config --smartnode-archiveECUrl "http://your Archive EC URL"
      ```

      Где:

      `--smartnode-archiveECUrl` должен быть HTTP-конечной точкой RPC API для вашего архивного Execution Client.
      **Обратите внимание, что если вы уже используете ваш архивный EC в качестве основного клиента в режиме внешнего управления, вы можете игнорировать эту настройку.**

      Наконец, перезапустите ваш демон `watchtower` (например, с помощью `docker restart rocketpool_watchtower` в режиме Docker или Hybrid, или `sudo systemctl restart rp_watchtower` в режиме Native), чтобы настройки вступили в силу.
    </Tab>
    <Tab label="Прямой файл конфигурации">
      Откройте файл `user-settings.yml` в вашей директории Smartnode (`~/.rocketpool` по умолчанию) в текстовом редакторе.
      Прокрутите вниз до раздела `smartnode`:

      ```
      smartnode:
      archiveECUrl: http://your Archive EC URL
      dataPath: /home/user/.rocketpool/data
      manualMaxFee: "0"
      minipoolStakeGasThreshold: "150"
      network: mainnet
      priorityFee: "2"
      projectName: rocketpool
      rewardsTreeMode: generate
      ```

      Замените значения в поле `archiveECUrl`, где:

      `archiveECUrl` должен быть HTTP-конечной точкой RPC API для вашего архивного Execution Client.
      **Обратите внимание, что если вы уже используете ваш архивный EC в качестве основного клиента в режиме внешнего управления, вы можете игнорировать эту настройку.**

      Наконец, перезапустите ваш демон `watchtower` (например, с помощью `docker restart rocketpool_watchtower` в режиме Docker или Hybrid, или `sudo systemctl restart rp_watchtower` в режиме Native), чтобы настройки вступили в силу.
    </Tab>

  </Tabs>
</div>

## Команды Smartnode для Oracle DAO

Группа команд `odao` CLI Smartnode используется для взаимодействия с контрактами и обязанностями Oracle DAO в сети:

```
NAME:
   rocketpool odao - Manage the Rocket Pool oracle DAO

USAGE:
   rocketpool odao command [command options] [arguments...]

COMMANDS:
   status, s             Get oracle DAO status
   members, m            Get the oracle DAO members
   member-settings, b    Get the oracle DAO settings related to oracle DAO members
   proposal-settings, a  Get the oracle DAO settings related to oracle DAO proposals
   minipool-settings, i  Get the oracle DAO settings related to minipools
   propose, p            Make an oracle DAO proposal
   proposals, o          Manage oracle DAO proposals
   join, j               Join the oracle DAO (requires an executed invite proposal)
   leave, l              Leave the oracle DAO (requires an executed leave proposal)

OPTIONS:
   --help, -h  show help
```

### status

Команда `status` просто суммирует несколько деталей об Oracle DAO, таких как количество членов и количество предложений:

```
The node is a member of the oracle DAO - it can create unbonded minipools, vote on DAO proposals and perform watchtower duties.

There are currently 8 member(s) in the oracle DAO.

There are 29 oracle DAO proposal(s) in total:
- 22 proposal(s) have passed and been executed
- 7 proposal(s) were cancelled, defeated, or have expired
```

### members

Команда `members` печатает подробную информацию о каждом члене Oracle DAO, включая их идентификатор, контактную информацию, адрес узла, залог RPL и время последней отправки предложения для голосования:

```
The oracle DAO has 8 members:

--------------------

Member ID:            kermit-2
URL:                  https://www.rocketpool.net
Node address:         0x04ddB06D1429578691F630B67A53916445DA38bE
Joined at:            31 Jul 21 23:32 EDT
Last proposal:        27 Sep 22 21:18 EDT
RPL bond amount:      5000.000000
Unbonded minipools:   0
...
```

### member-settings

`member-settings` показывает текущие значения для каждого из настраиваемых параметров, связанных с членством в Oracle DAO:

```
ODAO Voting Quorum Threshold: 51.000000%
Required Member RPL Bond: 1750.000000 RPL
Max Number of Unbonded Minipools: 250
Consecutive Challenge Cooldown: 300 Blocks
Challenge Meeting Window: 900 Blocks
Cost for Non-members to Challenge Members: 1.000000 ETH
```

Эта команда описана более подробно в разделе [Предложения Oracle DAO](./proposals).

### proposal-settings

`proposal-settings` показывает текущие значения для каждого из настраиваемых параметров, связанных с предложениями, по которым может голосовать Oracle DAO:

```
Cooldown Between Proposals: 1h0m0s
Proposal Voting Window: 168h0m0s
Delay Before Voting on a Proposal is Allowed: 15m0s
Window to Execute an Accepted Proposal: 168h0m0s
Window to Act on an Executed Proposal: 168h0m0s
```

Эта команда описана более подробно в разделе [Предложения Oracle DAO](./proposals).

### minipool-settings

`minipool-settings` показывает текущие значения для каждого из настраиваемых параметров, связанных с minipools в сети Rocket Pool:

```
Scrub Period: 1h0m0s
```

### propose

Команда `propose` используется для отправки предложений по управлению, по которым может голосовать остальная часть Oracle DAO.
Они могут включать изменение настройки или изменение членов Oracle DAO (т.е. приглашение или исключение других членов).

Эта команда описана более подробно в разделе [Предложения Oracle DAO](./proposals).

### proposals

Команда `proposals` используется для взаимодействия с существующими предложениями по управлению Oracle DAO.
Она может просматривать их, отзывать предложения, которые вы сделали, голосовать по ним и выполнять их (если применимо), заставляя их вступать в силу после одобрения другими членами:

```
NAME:
   rocketpool odao proposals - Manage oracle DAO proposals

USAGE:
   rocketpool odao proposals command [command options] [arguments...]

COMMANDS:
   list, l     List the oracle DAO proposals
   details, d  View proposal details
   cancel, c   Cancel a proposal made by the node
   vote, v     Vote on a proposal
   execute, x  Execute a proposal

OPTIONS:
   --help, -h  show help

```

Эта команда описана более подробно в разделе [Предложения Oracle DAO](./proposals).

### join / leave

Команды `join` и `leave` используются для присоединения к Oracle DAO после того, как вы были приглашены, или для выхода из Oracle DAO после того, как другие члены одобрили ваш запрос на выход.

## Присоединение к Oracle DAO

### Залог RPL

Чтобы присоединиться к Oracle DAO, ваш кошелек узла должен иметь достаточно RPL, чтобы покрыть требуемый залог для членства.
Он будет заблокирован в хранилище Rocket Pool как часть процесса присоединения.
Точная сумма RPL, необходимая для залога, будет определена во время вашего приглашения и будет сообщена вам другими членами Oracle DAO перед вашим присоединением.

::: warning ПРИМЕЧАНИЕ
В отличие от всех других вознаграждений ETH и RPL, залог RPL _не_ отправляется на адрес вывода средств вашего узла при выходе из Oracle DAO.
Он отправляется обратно на сам кошелек вашего узла.
Считайте это дополнительным стимулом для защиты кошелька вашего узла от компрометации.
:::

### Принятие приглашения

После того, как ваш узел настроен и вы были приглашены присоединиться к Oracle DAO существующими членами, вы можете использовать команду `rocketpool odao join` для принятия приглашения.
Это будет включать две транзакции:

- Одну для блокировки RPL, необходимого для вашего залога
- Одну для присоединения к Oracle DAO, когда залог будет получен

После того, как вы присоединились, ваш демон `watchtower` автоматически начнет выполнять свои требуемые обязанности.
Вы можете проверить это, просмотрев его логи (например, `rocketpool service logs watchtower` для стандартных установок на основе Docker); watchtower выполняет свой цикл обязанностей каждые 4-6 минут, и вы заметите отчетливое изменение в его выводе после того, как присоединитесь к Oracle DAO.

### Следующие шаги

Теперь, когда вы присоединились к Oracle DAO, взгляните на следующий раздел, чтобы узнать, как протестировать ваш узел в этой роли.
