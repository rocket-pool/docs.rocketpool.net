import { Tab, Tabs } from "@rspress/core/theme";

# Импорт / восстановление существующего кошелька

Если у вас уже есть кошелек, который вы хотели бы использовать для своего узла, или если вы восстанавливаете кошелек, который вы уже создали с помощью Smartnode ранее, это руководство поможет вам в процессе импорта / восстановления.

Пожалуйста, выберите соответствующий вариант из разделов ниже.

## Восстановление кошелька Smartnode

Если вы сгенерировали кошелек своего узла с помощью Smartnode и просто восстанавливаете его на новой машине, процесс довольно прост.
Убедитесь, что вы уже установили программное обеспечение Smartnode, и затем просто выполните следующую команду после его установки:

```shell
rocketpool wallet recover
```

::: warning ПРИМЕЧАНИЕ
Если по какой-то причине вы хотите восстановить кошелек, но _не_ ключи валидатора, прикрепленные к минипулам вашего узла, вы можете указать флаг `-k`, чтобы пропустить процесс восстановления:

```shell
rocketpool wallet recover -k
```

Если вы не укажете этот флаг, Smartnode попытается восстановить ключи валидатора для ваших минипулов; однако обратите внимание, что это не сработает, пока ваш клиент исполнения не завершит синхронизацию.
Пожалуйста, следите за его файлом журнала, чтобы увидеть, когда это будет сделано; как только это произойдет, вы можете выполнить этот шаг.
:::

Сначала вас попросят ввести пароль, который вы хотите использовать для шифрования вашего кошелька.
После этого вас попросят ввести вашу **мнемоническую фразу восстановления из 24 слов**.
Вводите её осторожно — она не будет отображаться на экране в целях безопасности, и очень легко сделать ошибку при её вводе, поэтому не торопитесь.

Когда вы закончите, вы должны увидеть вывод, похожий на этот:

```shell
$ rocketpool wallet recover

Please enter a password to secure your wallet with:

Please confirm your password:

Please enter your recovery mnemonic phrase:

Recovering node wallet...
The node wallet was successfully recovered.
Node account: <your wallet address>
No validator keys were found.
```

Если вы не видите никаких ошибок, то ваш кошелек и валидаторы будут восстановлены.

После того, как вы закончите, обязательно перезапустите клиент валидатора с помощью следующей команды для пользователей режима Docker и гибридного режима:

```shell
docker restart rocketpool_validator
```

Пользователи **Native mode** просто должны будут перезапустить процесс своего контейнера валидатора.

Это гарантирует, что VC подберет все недавно восстановленные ключи валидатора.

## Импорт существующего адреса в качестве кошелька узла

Если у вас есть адрес, который вы хотели бы использовать для узла, но _не_ создали его с помощью Smartnode (например, вы создали его с помощью MetaMask или аппаратного кошелька), то это раздел, который нужно выполнить.

::: danger ПРЕДУПРЕЖДЕНИЕ
Делая это, ваш адрес станет **горячим кошельком**.
Приватный ключ будет храниться на вашей машине узла.

Если вы импортируете адрес, который является холодным кошельком, таким как аппаратный кошелек, имейте в виду, что **защита, предоставляемая аппаратным кошельком, больше не будет существовать!**

Если вы используете этот кошелек для _любой другой криптовалютной деятельности вообще_, **вы должны перенести все его средства на отдельный адрес (например, другой аппаратный кошелек) перед импортом его в ваш узел! Оставьте на этом адресе только достаточное количество ETH для расходов на газ вашего узла (обычно достаточно 0,5 ETH).**

Пожалуйста, убедитесь, что вы максимально защитили свою машину, следуя шагам в руководстве [Securing your Node](./securing-your-node) перед импортом вашего адреса в качестве кошелька узла.
:::

Эта возможность доступна только с Smartnode **v1.4.3 или выше**.
Если у вас более низкая версия, вам нужно будет сначала обновиться.

Это многоэтапный процесс, поэтому внимательно следуйте приведенным ниже разделам.

### Шаг 1: добавление ключей валидатора, сгенерированных извне

**Если у вас нет существующих минипулов, прикрепленных к адресу, который вы импортируете, вы можете пропустить этот шаг.**

Если ваш адрес уже был зарегистрирован в качестве кошелька узла Rocket Pool (например, через сервис, такой как **Allnodes**) и уже имеет активные минипулы, и вы хотели бы импортировать их в стек Smartnode вместе со своим адресом, вам нужно будет предоставить приватные файлы хранилища ключей для каждого из соответствующих валидаторов.
Эти файлы будут зашифрованы паролем по вашему выбору, поэтому вам понадобится этот пароль для каждого файла.

Вам нужно получить эти файлы от сервиса, который в настоящее время запускает ваш узел, чтобы импортировать его.
Некоторые поставщики услуг могут извлечь эти файлы по запросу.
Если вы используете Allnodes, вы можете получить эти файлы во время начального процесса настройки, но **не сможете получить их в будущем, если вы не сохранили их во время создания минипула.**

Выберите свой режим установки и следуйте приведенным ниже шагам.

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Сначала убедитесь, что вы запустили Smartnode с помощью `rocketpool service start`.
      Это создаст специальную папку, которую можно использовать для хранения зашифрованных файлов хранилища ключей для ваших валидаторов.

      По умолчанию папка находится в `~/.rocketpool/data/custom-keys`.
      Если вы настроили свою установку или каталоги данных, подставьте соответственно, чтобы найти папку `custom-keys`.

      Проверьте с помощью проводника файлов или команды `ls`, чтобы убедиться, что эта папка существует.
      Если нет, не беспокойтесь — просто создайте папку с помощью следующей команды:

      ```shell
      mkdir ~/.rocketpool/data/custom-keys
      ```
    </Tab>
    <Tab label="Native Mode">
      Создайте папку под названием `custom-keys` внутри папки `data` вашего Smartnode (например, `/srv/rocketpool/data/custom-keys`).
    </Tab>

  </Tabs>
</div>

Затем поместите каждый из файлов хранилища ключей валидатора в эту папку.
Имена файлов не имеют значения, но они должны быть файлами JSON, которые соответствуют формату [EIP-2335](https://eips.ethereum.org/EIPS/eip-2335#scrypt-test-vector).

Smartnode будет искать в этом каталоге все файлы хранилища ключей, которые вы здесь разместили, на следующих шагах.

::: warning ПРИМЕЧАНИЕ
Процесс импорта будет _только_ искать ключи валидатора, которые прикреплены к минипулам, зарегистрированным на адрес, который вы импортируете.
Вы **не можете** использовать этот процесс для импорта других ключей валидатора, таких как для валидаторов соло-стейкинга, в клиент валидатора, управляемый стеком Smartnode.

Пожалуйста, ознакомьтесь с документацией по запуску в [обратном гибридном режиме](./advanced-config#allowing-external-validator-clients-to-connect-to-the-smartnode), если вы заинтересованы в этом.
:::

### Шаг 2 (необязательно): тестирование импорта адреса

Если вы хотите протестировать процесс восстановления, чтобы убедиться, что у вас правильная мнемоника и пароли **без фактической регенерации приватного ключа кошелька вашего узла или импорта ваших ключей валидатора**, вы можете сделать это с помощью следующей команды:

```shell
rocketpool wallet test-recovery -a 0x1234abcd...
```

Где `0x1234abcd...` — это адрес, который вы хотите импортировать, начинающийся с префикса `0x`.
**Вам понадобится ваша мнемоническая фраза для импорта приватного ключа для вашего адреса.**

::: tip СОВЕТ
Если по какой-то причине вы хотите восстановить кошелек, но _не_ ключи валидатора для ваших минипулов, вы можете указать флаг `-k`, чтобы пропустить процесс восстановления ключей валидатора.
Например:

```shell
rocketpool wallet test-recovery -a 0x1234abcd... -k
```

:::

Smartnode автоматически выполнит поиск по наиболее популярным путям деривации (например, используемым Ledger Live, MyEtherWallet, Trezor и стеком Smartnode) и индексам адресов, чтобы найти настройки, которые соответствуют предоставленному вами адресу.

::: tip СОВЕТ
Если у вас пользовательский путь деривации, используйте флаг `-d`, чтобы указать его.
Например:

```shell
rocketpool wallet test-recovery -d "m/44'/60'/0'/%d"
```

Используйте `%d` для части пути, которую можно итерировать для использования разных индексов.

Если у вас пользовательский индекс адреса, используйте флаг `-i`, чтобы указать его.
Например, если ваш адрес был 6-м на стандартном пути деривации, вы могли бы использовать:

```shell
rocketpool wallet test-recovery -i 5
```

Вы можете использовать флаги `-d` и `-i` одновременно, если требуется.
:::

Сначала вас попросят ввести мнемоническую фразу вашего адреса:

```
Please enter the number of words in your mnemonic phrase (24 by default):
24

Enter Word Number 1 of your mnemonic:
```

Введите её осторожно, и Smartnode начнет поиск по всем стандартным вариантам, чтобы найти её (если вы явно не указали их с помощью флагов `-d` и/или `-i`).

Затем, если у вас есть приватные файлы хранилища ключей для импорта из шага 1, вас попросят ввести пароли для каждого из этих файлов хранилища ключей:

```
It looks like you have some custom keystores for your minipool's validators.
You will be prompted for the passwords each one was encrypted with, so they can be loaded into the Validator Client that Rocket Pool manages for you.

Please enter the password that the keystore for <validator pubkey> was encrypted with:
```

Они будут организованы по списку **pubkey**, **а не по именам файлов**.
Убедитесь, что вы знаете, какой файл соответствует какому pubkey валидатора, чтобы ввести правильные пароли.

После того, как вы это сделаете, процесс тестового восстановления продолжится и сообщит об успехе или неудаче:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

Приведенное выше указывает на успешное тестовое восстановление.

### Шаг 3: импорт адреса

::: danger ПРЕДУПРЕЖДЕНИЕ
Если ваш адрес является узлом Rocket Pool, которым _не_ управляет ваш собственный самостоятельно размещенный Smartnode (например, размещенный внешним сервисом, таким как **Allnodes**), **КРИТИЧЕСКИ ВАЖНО**, чтобы вы согласовали с сервисом, запускающим ваш узел, **прежде чем вы начнете этот процесс импорта**, и сообщили им, что хотите перейти на свою собственную самостоятельно размещенную систему.

Вы **ДОЛЖНЫ ПОДТВЕРДИТЬ**, что они отключили валидацию для вашего узла и **НИКОГДА НЕ ВОЗОБНОВЯТ ЕЁ**, и вручную подтвердить, что ваши валидаторы больше не аттестуют, используя обозреватель блокчейна, такой как [https://beaconcha.in](https://beaconcha.in).
Вы должны подтвердить, что каждый валидатор пропустил **КАК МИНИМУМ 2 АТТЕСТАЦИИ**, чтобы убедиться, что вы можете безопасно мигрировать.
В противном случае вы оба будете аттестовать одновременно, и **ВАШИ МИНИПУЛЫ БУДУТ СЛЭШЕНЫ!**

Smartnode потребует, чтобы вы подтвердили, что сделали это, прежде чем позволить вам продолжить процесс импорта.
:::

Если тестовое восстановление прошло успешно или если вы его пропустили, вы затем импортируете кошелек и регенерируете все связанные с ним файлы ключей.
Процесс точно такой же, как и выше, но используйте команду `recover` вместо команды `test-recovery`:

```shell
rocketpool wallet recover -a 0x1234abcd...
```

Когда вы запустите эту команду, сначала вас попросят ввести пароль для шифрования импортированного кошелька вашего узла.

```
Please enter a password to secure your wallet with:

Please confirm your password:
```

После этого приглашения для мнемоники и пользовательских паролей хранилища ключей валидатора продолжатся, как это было раньше.

После того, как вы введете всю эту информацию, Smartnode восстановит ваш адрес и (если не отключено) пользовательские ключи валидатора для ваших минипулов:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

Приватный ключ вашего адреса теперь будет храниться в файле `data/wallet` (например, `~/.rocketpool/data/wallet`), а пароль для него будет храниться в файле `data/password` (например, `~/.rocketpool/data/password`).

Приватные ключи для каждого из ваших валидаторов будут храниться в папках `data/validators` для каждого из клиентов консенсуса, которые поддерживает Smartnode.

::: danger ПРИМЕЧАНИЕ
Импортируя адрес таким образом, ключи валидатора **не** были получены из кошелька вашего узла, и поэтому они **не могут** быть восстановлены позже простым запуском `rocketpool wallet recover`, как с обычным кошельком узла.

Если вам когда-либо понадобится восстановить или импортировать этот кошелек снова, вам нужно будет следовать тому же процессу, что означает, **что вам нужно будет иметь эти приватные хранилища ключей валидатора и их пароли, сохраненные где-то в безопасном месте.**

Если вы когда-либо потеряете их, **вы больше не сможете восстановить эти ключи валидатора!**
:::

### Шаг 4: очистка

На этом этапе вы теперь можете удалить все приватные файлы хранилища ключей в каталоге `data/custom-keys`.
Smartnode уже импортировал их и назначил им случайные пароли, поэтому эти файлы хранилища ключей больше не нужны.

Наконец, убедитесь, что **нет** файла с именем `custom-key-passwords` в вашем каталоге `data` (например, `~/.rocketpool/data/custom-key-passwords`).
Smartnode создаст этот временный файл только во время процесса восстановления и удалит его автоматически независимо от того, удался ли процесс восстановления или нет; если по какой-либо причине ему не удалось удалить его, он предупредит вас в выводе консоли.
Однако никогда не помешает быть слишком осторожным.

## Следующие шаги

После того, как вы импортировали или восстановили кошелек вашего узла, следуйте следующим шагам в руководстве [Intro to the Command Line Interface](./cli-intro).
