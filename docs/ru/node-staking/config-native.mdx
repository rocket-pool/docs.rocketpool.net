import nimbus_dashboard from "./images/nimbus-dashboard.png";
import tui_checkbox_checked from "./images/tui-checkbox-checked.png";
import tui_checkbox_unchecked from "./images/tui-checkbox-unchecked.png";
import tui_dropdown_closed from "./images/tui-dropdown-closed.png";
import tui_dropdown_open from "./images/tui-dropdown-open.png";
import tui_native_cc_url from "./images/tui-native-cc-url.png";
import tui_native_cc from "./images/tui-native-cc.png";
import tui_native_ec from "./images/tui-native-ec.png";
import tui_native_finished from "./images/tui-native-finished.png";
import tui_native_metrics from "./images/tui-native-metrics.png";
import tui_native_mev from "./images/tui-native-mev.png";
import tui_native_network from "./images/tui-native-network.png";
import tui_native_welcome from "./images/tui-native-welcome.png";
import tui_native_other from "./images/tui-native-other.png";
import tui_native_review from "./images/tui-native-review.png";
import tui_native_settings_home from "./images/tui-native-settings-home.png";
import tui_native_smartnode from "./images/tui-native-smartnode.png";
import tui_textbox from "./images/tui-textbox.png";

# Настройка стека Smartnode (Native режим)

В этом разделе мы рассмотрим различные методы настройки Smartnode, если вы используете **Native установку**, которая вообще не использует Docker.

::: warning ПРИМЕЧАНИЕ
Если вы используете установку на основе Docker, пожалуйста, посетите [руководство по настройке Docker](./config-docker) вместо этого.
:::

Существует три способа настройки:

- Через [Мастер настройки UI](#настройка-через-мастер) - это самый простой способ. Он задает вам только несколько базовых вопросов и использует хорошо протестированные значения по умолчанию для остальных. Это то, что вам будет представлено при первом запуске `rocketpool service config`.
- Через [Менеджер настроек UI](#настройка-через-менеджер-настроек) - это дает вам доступ ко всем настройкам Smartnode, чтобы вы могли настроить все так, как вы хотите.
- Без интерфейса через [Командную строку](#настройка-через-командную-строку) - это опция для людей, которые запускают Smartnode в безголовой (неинтерактивной) среде и нуждаются в автоматической настройке.

Выберите, о каком режиме вы хотите узнать больше, из списка выше, или просто прокрутите каждый вариант ниже.

## Настройка через Мастер

Чтобы настроить Smartnode, выполните команду настройки:

```shell
rp service config
```

Это запустит интерфейс на основе терминала, который позволит вам быстро и легко настроить ваш узел, а также предоставит дополнительный детальный контроль над настройками, которые относятся к Native режиму.

::: tip ПРИМЕЧАНИЕ
Если вы уже настроили Smartnode, вместо этого вы увидите [Менеджер настроек](#настройка-через-менеджер-настроек).
Вы можете выбрать повторное открытие Мастера оттуда, если вы предпочитаете его, и все ваши существующие настройки будут предварительно выбраны для вас.
:::

Когда вы запускаете пользовательский интерфейс настройки в первый раз (или если вы решите запустить Мастер снова позже), вам будет представлен экран, который выглядит так:

<img src={tui_native_welcome} width="100%" height="auto" />

::: tip СОВЕТ
Для использования Мастера **нажимайте `клавиши со стрелками` (вверх/вниз/влево/вправо) для навигации между элементами, такими как кнопки (выборы) или текстовые поля**.
Вы также можете использовать `Tab` и `Shift+Tab`, если хотите - это будет делать то же самое.

Для кнопок **та, которая в данный момент выбрана, будет выделена зеленым цветом**.
Черные кнопки не выбраны.
На скриншоте выше в данный момент выбрана кнопка `Next`, а `Quit` не выбрана.

**Нажмите `Enter` или `Пробел` для выбора кнопки**, аналогично щелчку мыши по ней.

**Нажмите `Escape` для возврата к предыдущему диалогу**, если вы передумали о чем-то.
Это пригодится по мере продвижения по различным страницам Мастера.

**Удерживайте `Ctrl` и нажмите `C` в любое время, чтобы выйти из Мастера без сохранения**.

Например, на экране выше вы могли бы нажимать клавиши со стрелками `влево` и `вправо` для перемещения между кнопками `Next` и `Quit`.

Нажатие `Enter` при выбранной `Next` перейдет к следующему экрану.
Нажатие `Enter` при выбранной `Quit` выйдет из Мастера без сохранения.
:::

Когда будете готовы начать, нажмите `Next`.

### Выбор сети

На следующем экране вам будет предложено выбрать, какую сеть вы хотите использовать:

<img src={tui_native_network} width="100%" height="auto" />

Вы можете выделить различные варианты с помощью клавиш со стрелками `Вверх` и `Вниз` (или `Tab` и `Shift+Tab`).
Когда вы меняете варианты, поле **Description** справа покажет вам краткое описание каждого варианта.
Это верно для всех страниц на основе выбора в Мастере, а не только для выбора сети, поэтому вы будете часто видеть этот стиль страницы.

Если вы хотите попрактиковаться в запуске узла Rocket Pool в тестовой сети Hoodi с фальшивыми ETH и RPL, которые можно получить бесплатно, выберите **Hoodi Testnet**.

Если вы готовы создать реальный узел Rocket Pool в Mainnet для получения реальных вознаграждений, выберите **Mainnet**.

### Настройка Execution клиента

Следующий экран предложит вам ввести URL HTTP-based RPC API вашего Execution клиента:

<img src={tui_native_ec} width="100%" height="auto" />

Введите здесь `http://127.0.0.1:8545`, если вы планируете запустить Execution клиент на том же компьютере, что и Smartnode (в остальной части этого руководства мы предполагаем, что это то, что вы планируете сделать).
Однако, если у вас уже есть Execution клиент, настроенный в другом месте, используйте его URL здесь.

Обратите внимание, что вы всегда можете изменить это, запустив `rp service config` снова позже.

### Настройка Consensus клиента

Далее вас спросят, какой Consensus клиент вы используете (или планируете использовать).
Поскольку каждый Consensus клиент имеет немного отличающееся поведение, Smartnode необходимо знать, какой из них вы используете, чтобы он мог соответствующим образом адаптировать свое собственное поведение.
Выберите свой клиент из списка на следующем экране:

<img src={tui_native_cc} width="100%" height="auto" />

Далее вы увидите экран с запросом URL API вашего клиента:

<img src={tui_native_cc_url} width="100%" height="auto" />

Введите здесь `http://127.0.0.1:5052`, если вы планируете запустить Beacon Node вашего Consensus клиента на том же компьютере, что и Smartnode (в остальной части этого руководства мы предполагаем, что это то, что вы планируете сделать).
Однако, если у вас уже есть Beacon Node, настроенный в другом месте, используйте его URL здесь.

### Другие настройки

На следующем экране будут несколько других различных настроек:

<img src={tui_native_other} width="100%" height="auto" />

Оставьте их в качестве параметров по умолчанию, если вы не решили использовать каталог, отличный от `/srv/rocketpool` для установки Smartnode.

### Резервные клиенты

Начиная с версии 1.5.0 стека Smartnode, вы можете предоставить "резервную" пару Execution клиента и Consensus клиента, которые могут взять на себя управление от ваших основных клиентов, если они когда-либо отключатся (например, потому что вы используете Geth и нуждаетесь в его обрезке).
В этой ситуации ваш основной узел по-прежнему будет отвечать за аттестацию и предложение блоков с ключами валидаторов ваших minipools, но он будет подключаться к внешней машине для взаимодействия с уровнем Execution и цепочками Beacon.

[Чтобы узнать больше о резервных узлах, смотрите этот раздел](./fallback) и вернитесь сюда, когда закончите.

### Метрики

Rocket Pool имеет возможность интеграции с Prometheus и Grafana для создания удобных веб-панелей, которые позволяют вам наблюдать за состоянием вашего узла с первого взгляда:

<img src={nimbus_dashboard} width="100%" height="auto" />

Последний вопрос в Мастере спросит вас, хотите ли вы включить это:

<img src={tui_native_metrics} width="100%" height="auto" />

Если вы решите включить это, вы узнаете больше о настройке и использовании в разделе [Настройка панели Grafana](./grafana.mdx) позже в процессе.

::: warning ПРИМЕЧАНИЕ
Все данные, собранные этой системой, **остаются на вашей машине**.
Rocket Pool не собирает никакую телеметрию и не отправляет ее в отдельную службу.
Это чисто для вас, чтобы вы могли контролировать свой собственный узел!
:::

### Настройка MEV

Начиная со Слияния уровней Execution и Consensus в сентябре 2022 года, валидаторы Ethereum теперь имеют возможность зарабатывать приоритетные комиссии и участвовать в Максимальной извлекаемой стоимости (или MEV, если коротко).

Начиная со Smartnode v1.7.0, MEV теперь _opt-out_, поэтому уведомление о его настройке представлено как часть первоначальной настройки, как вы видите на следующем экране:

<img src={tui_native_mev} width="100%" height="auto" />

[Пожалуйста, прочитайте наше руководство по MEV, чтобы узнать больше о MEV, его настройке и что делать в этом разделе мастера.](./mev.mdx)
Вернитесь сюда, когда закончите.

### Завершение

После этого вопроса вы закончили настройку конфигурации Smartnode.
Вы увидите следующий диалог:

<img src={tui_native_finished} width="100%" height="auto" />

Если вы довольны своей настройкой и готовы запустить Smartnode, нажмите здесь `Save and Exit`.

Если вы еще не закончили установку Rocket Pool, вернитесь к руководству по Native установке сейчас.
В противном случае следующий шаг - перезапустить ваши daemon службы:

```shell
sudo systemctl restart rp-node rp-watchtower
```

Если вы хотите просмотреть все настройки и настроить множество дополнительных параметров, которые не были включены в Мастер, нажмите `Review All Settings` и перейдите к [следующему разделу](#настройка-через-менеджер-настроек).

## Настройка через Менеджер настроек

Если вы уже запустили `rp service config`, вместо того, чтобы встретить вас Мастер, вы увидите экран **Менеджер настроек**:

<img src={tui_native_settings_home} width="100%" height="auto" />

На этом экране есть три основные функции:

1. **Список категорий**, который позволяет вам детализировать настройки для каждой категории стека Smartnode, которая относится к Native режиму
2. Кнопка **Review Changes and Save**, которую вы можете использовать, когда готовы увидеть, какие настройки вы изменили, и сохранить обновленную конфигурацию
3. Кнопка **Open the Config Wizard**, которая приведет вас к [Мастеру настройки](#настройка-через-мастер), если вы предпочитаете этот интерфейс

::: tip СОВЕТ
Для использования Менеджера настроек **нажимайте `клавиши со стрелками` (вверх/вниз/влево/вправо) для навигации между опциями на главной странице**.

Нажмите `Tab` для перехода **между списком категорий (1) и кнопками (2 и 3)** внизу экрана.
Кнопка, которая в данный момент выбрана, будет **выделена зеленым цветом**.

**Нажмите `Enter` или `Пробел` для выбора кнопки**, аналогично щелчку мыши по ней.

**Удерживайте `Ctrl` и нажмите `C` в любое время, чтобы выйти из Менеджера настроек без сохранения**.
:::

По мере прокрутки списка категорий для каждой опции появится полезное описание в **поле Описание** справа от экрана.
Не стесняйтесь их исследовать; ничего не будет сохранено, пока вы не пройдете через диалог Review через кнопку **Review Changes and Save**, и вы можете нажать **Ctrl+C** в любое время, чтобы выйти без сохранения, поэтому вы не случайно что-то испортите, играя с настройками здесь.

### Настройка параметров

На главном экране выберите любую из категорий клавишей `Enter`, чтобы просмотреть настройки для этой категории.
Например, вот экран для категории **Smartnode and TX Fees**:

<img src={tui_native_smartnode} width="100%" height="auto" />

Используйте `клавиши со стрелками` для перемещения вверх и вниз между настройками.
У той, которая в данный момент выбрана, будет белый квадрат в конце (если это текстовое поле или флажок), или она будет выделена белым (если это выпадающий список).

Нажмите `Escape`, чтобы вернуться на главный экран Менеджера настроек, когда закончите.

По мере прокрутки настроек каждая из них будет показывать краткое описание того, что она делает, в **поле Описание** справа.
Там также будет показано **значение по умолчанию** на случай, если вы хотите вернуть его к стандартной настройке.

В этом примере в данный момент выбрана настройка **RPL Claim Gas Threshold** (выделена зеленым прямоугольником в левой части экрана).
Она была изменена на `40`, но вы можете видеть, что она имеет значение по умолчанию `150` в правом верхнем углу (верхняя часть **поля Описание**).

::: tip СОВЕТ
Напоминаем, что ничего не будет сохранено на диск, пока вы не пройдете через диалог Review через кнопку **Review Changes and Save**.
Вам рекомендуется изучить все настройки, чтобы узнать о них.
:::

### Типы настроек и как их использовать

Менеджер настроек использует следующие типы настроек и элементы пользовательского интерфейса:

#### Текстовые поля

Текстовые поля используются для ввода произвольных строк текста или чисел.
Они выглядят так:

<img src={tui_textbox} width="100%" height="auto" />

Введите желаемые значения, затем **нажмите `Enter` или используйте `клавиши со стрелками` для навигации к другой настройке, чтобы сохранить ваши изменения.**
Если вы этого не сделаете, Менеджер настроек будет считать, что вы все еще обновляете эту настройку, и не пометит ее как измененную.

#### Выпадающие списки

Выпадающие списки используются для выбора опции из списка вариантов.
Они выглядят так (когда они открыты):

<img src={tui_dropdown_open} width="100%" height="auto" />

**Зеленый** элемент - тот, который в данный момент выбран.
Используйте `клавиши со стрелками` для изменения опций - по мере этого **поле Описание** справа будет обновляться, чтобы рассказать вам больше о выбранной в данный момент опции.
Когда вы довольны своим выбором, нажмите `Enter`, чтобы выбрать выбранную опцию, и выпадающий список закроется, показывая опцию, которая в данный момент выбрана:

<img src={tui_dropdown_closed} width="100%" height="auto" />

#### Флажки

Флажки используются для простых вопросов Да/Нет.
Они выглядят так:

<img src={tui_checkbox_checked} width="100%" height="auto" />

Когда они отмечены, у них будет `X` посередине, как вы видите выше.
Когда они _не отмечены_, они будут просто пустыми, как это:

<img src={tui_checkbox_unchecked} width="100%" height="auto" />

Чтобы изменить настройку, просто выберите ее и нажмите `Enter`.

### Сохранение изменений

Когда вы довольны своими изменениями и хотите просмотреть их перед сохранением, нажмите кнопку **Review Changes and Save** на главном экране.
Напоминаем, что для этого нажмите клавишу `Tab`.

Вам будет представлен вид, который выглядит так:

<img src={tui_native_review} width="100%" height="auto" />

**Поле Review** здесь представит все настройки, которые вы изменили, показывая старые значения и новые.
Например, первая строка здесь показывает, что **RPL Claim Gas Threshold** раньше был `150`, и он был изменен на `40`.

::: tip ПРИМЕЧАНИЕ
На этом этапе ваши изменения **все еще не были сохранены**.
Если вы хотите вернуться и изменить что-то, нажмите `Escape`, чтобы вернуться на главный экран.
:::

Когда вы удовлетворены изменениями, нажмите `Enter`, чтобы сохранить новую конфигурацию на диск.
Затем вы выйдете из терминального UI и увидите это сообщение:

```
Your changes have been saved!
Please restart your daemon service for them to take effect.
```

Если вы еще не закончили установку Rocket Pool, вернитесь к руководству по Native установке сейчас.
В противном случае теперь вы можете перезапустить ваши daemon службы:

```shell
sudo systemctl restart rp-node rp-watchtower
```

## Настройка через командную строку

Если вы используете Smartnode в безголовой среде, где вы не можете взаимодействовать с терминальным UI, вы можете настроить свой узел через командную строку вместо этого.

Команда `rocketpool service config` принимает в качестве аргументов каждую настройку, которую обычно можно настроить через терминальный UI.
Выполните следующую команду, чтобы увидеть их список (обратите внимание, что он довольно длинный):

```
rocketpool service config --help
```

Вывод будет выглядеть так:

```
NAME:
   rocketpool service config - Configure the Rocket Pool service

USAGE:
   rocketpool service config

OPTIONS:
   --executionClientMode value  Choose which mode to use for your Execution client - locally managed (Docker Mode), or externally managed (Hybrid Mode).
                                Type: choice
                                Options: local, external
 (default: "local")
   --executionClient value  Select which Execution client you would like to run.
                            Type: choice
                            Options: geth, infura, pocket
 (default: "geth")
   --useFallbackExecutionClient         Enable this if you would like to specify a fallback Execution client, which will temporarily be used by the Smartnode and your Consensus client if your primary Execution client ever goes offline.
                                        Type: bool

...
```

Каждая опция будет иметь свое имя, свой тип, свое значение по умолчанию и (если это параметр выбора) свои опции.
Используя этот текст, вы можете найти опцию(и), которую вы хотите установить, и указать их через соответствующие аргументы.

::: tip ПРИМЕЧАНИЕ
Эта команда строится поверх вашей существующей конфигурации, поэтому, если у вас уже сохранены некоторые настройки и вы просто хотите изменить другие, вам не нужно их повторять.
Она обновит только те настройки, которые вы включили в качестве аргументов в эту команду.
:::

Если вы еще не закончили установку Rocket Pool, вернитесь к руководству по Native установке сейчас.
В противном случае следующий шаг - перезапустить ваши daemon службы:

```shell
sudo systemctl restart rp-node rp-watchtower
```
