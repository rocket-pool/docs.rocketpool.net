import { Tab, Tabs } from "@rspress/core/theme";

# Удаление истории до слияния

Все Execution-клиенты теперь поддерживают частичное удаление истории в соответствии с [EIP-4444](https://eips.ethereum.org/EIPS/eip-4444). Пользователи могут существенно
сократить требования к хранилищу для своей ноды, удалив историю блоков до слияния, начиная с версии Smartnode `v1.17.0`. Ознакомьтесь с
этой статьей в блоге, чтобы узнать больше о частичном удалении истории: https://blog.ethereum.org/2025/07/08/partial-history-exp

::: tip ПРИМЕЧАНИЕ

    Имейте в виду, что шаги по удалению истории до слияния зависят от выбранного Execution-клиента вашей ноды:
    - Пользователям Nethermind потребуется полная повторная синхронизация для удаления истории до слияния.
    - Пользователи Geth могут использовать команду `rocketpool service prune-eth1` или провести полную повторную синхронизацию.
    - Пользователи Besu и Reth могут выполнить онлайн-обрезку, пока их нода продолжает аттестацию.

:::

Следующие шаги по удалению истории до слияния предназначены только для нод в режиме Docker. Если вы используете внешний клиент в
гибридном режиме или нативном режиме, обратитесь к документации, предоставленной вашим Execution-клиентом.

Начните с открытия менеджера настроек:

```shell
rocketpool service config
```

Чтобы изменить режим обрезки Execution-клиента, перейдите в меню `Execution Client (ETH1)` и выберите настройку `History Expiry` в выпадающем меню `Pruning Mode`

![](../images/tui-history-expiry.png)

После выбора нажмите `escape`, чтобы вернуться в главное меню, затем нажмите `tab`, чтобы выделить кнопку `Review Changes and Save`. Нажмите
клавишу `enter`, чтобы продолжить. Вам будет представлено меню для предварительного просмотра изменений в настройках вашего Execution-клиента.

![](../images/tui-review-history-expiry.png)

Нажмите клавишу `enter` на `Save Settings`, чтобы сохранить и выйти из менеджера настроек, затем введите `y`, чтобы перезапустить контейнер `rocketpool_eth1`.

```shell
Your changes have been saved!
The following containers must be restarted for the changes to take effect:
	rocketpool_eth1
Would you like to restart them automatically now? [y/n]
```

С этого момента шаги различаются в зависимости от того, какой Execution-клиент вы используете:

<div className="p-3">
  <Tabs>

        <Tab label="Nethermind">
        Ноды Nethermind требуют полной повторной синхронизации для удаления истории до слияния. Вы должны повторно синхронизировать свой Execution-клиент после сохранения
        настройки `History Expiry` и перезапуска контейнера `eth1`.

        ::: warning ПРЕДУПРЕЖДЕНИЕ
        Если у вас не настроена резервная нода, ваша нода перестанет валидировать во время повторной синхронизации. Резервная нода
        позволит вашей основной ноде продолжать аттестацию и предлагать блоки во время обрезки или повторной синхронизации. Нажмите [здесь](/ru/node-staking/fallback),
        чтобы узнать, как настроить резервную ноду.
        :::

        Используйте следующую команду для повторной синхронизации вашего Execution-клиента:
        ```shell
        rocketpool service resync-eth1
        ```

        Готово! Нода больше не будет хранить данные до слияния, что значительно улучшит возможность размещения ноды на диске объемом 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Geth">

        Ноды Geth требуют оффлайн-обрезки для удаления истории до слияния. Вы должны обрезать свой Execution-клиент после сохранения
        настройки `History Expiry` и перезапуска контейнера `eth1`. Альтернативно вы можете провести полную повторную синхронизацию для удаления истории до слияния.

        ::: tip ПРИМЕЧАНИЕ
        Мы рекомендуем обрезку вместо полной повторной синхронизации. Если вы хотите начать заново с чистой базой данных Geth или у вас проблема
        с обрезкой, вы можете повторно синхронизировать Execution-клиент с помощью `rocketpool service resync-eth1`. Оба варианта должны привести к удалению истории до слияния.
        :::

        ::: warning ПРЕДУПРЕЖДЕНИЕ
        Если у вас не настроена резервная нода, ваша нода перестанет валидировать во время обрезки или повторной синхронизации. Резервная нода
        позволит вашей основной ноде продолжать аттестацию и предлагать блоки во время обрезки или повторной синхронизации. Нажмите [здесь](/ru/node-staking/fallback),
        чтобы узнать, как настроить резервную ноду.
        :::

        Пожалуйста, выполните следующую команду для обрезки вашего Execution-клиента:
        ```shell
        rocketpool service prune-eth1
        ```
        Вы можете нажать [здесь](/ru/node-staking/pruning#starting-a-prune), чтобы узнать больше об обрезке.

        Готово! Нода больше не будет хранить данные до слияния, что значительно улучшит возможность размещения ноды на диске объемом 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Besu">

        Готово! Ноды Besu будут выполнять онлайн-обрезку, продолжая аттестацию и предлагать блоки.
        Нода больше не будет хранить данные до слияния, что значительно улучшит возможность размещения ноды на диске объемом 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Reth">

        Готово! Ноды Reth будут выполнять онлайн-обрезку, продолжая аттестацию и предлагать блоки.
        Нода больше не будет хранить данные до слияния, что значительно улучшит возможность размещения ноды на диске объемом 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
         ```

    </Tab>

  </Tabs>
</div>
