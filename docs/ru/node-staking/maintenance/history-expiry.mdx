import { Tab, Tabs } from "@rspress/core/theme";

# Удаление истории до слияния

Все клиенты исполнения теперь поддерживают частичное удаление истории в соответствии с [EIP-4444](https://eips.ethereum.org/EIPS/eip-4444). Пользователи могут существенно
сократить требования к хранению для своей ноды, удалив историю блоков до слияния, начиная с версии Smartnode `v1.17.0`. Ознакомьтесь с
этой записью в блоге, чтобы узнать больше о частичном удалении истории: https://blog.ethereum.org/2025/07/08/partial-history-exp

::: tip ПРИМЕЧАНИЕ

    Помните, что шаги для удаления истории до слияния зависят от выбранного клиента исполнения вашей ноды:
    - Пользователям Nethermind потребуется полная ресинхронизация для удаления истории до слияния.
    - Пользователи Geth могут использовать команду `rocketpool service prune-eth1` или провести полную ресинхронизацию.
    - Пользователи Besu и Reth могут выполнить онлайн-обрезку, пока их нода продолжает аттестацию.

:::

Следующие шаги по удалению истории до слияния предназначены только для нод в режиме Docker. Если вы используете внешний клиент в
гибридном режиме или нативном режиме, обратитесь к документации вашего клиента исполнения.

Начните с открытия менеджера настроек:

```shell
rocketpool service config
```

Чтобы изменить режим обрезки клиента исполнения, перейдите в меню `Execution Client (ETH1)` и выберите настройку `History Expiry` в выпадающем меню для `Pruning Mode`

![](../images/tui-history-expiry.png)

После того как вы сделали выбор, нажмите `escape`, чтобы вернуться в главное меню, затем нажмите `tab`, чтобы выделить кнопку `Review Changes and Save`. Нажмите
клавишу `enter`, чтобы продолжить. Вам будет представлено меню для предварительного просмотра изменений настроек вашего клиента исполнения.

![](../images/tui-review-history-expiry.png)

Нажмите клавишу `enter` на `Save Settings`, чтобы сохранить и выйти из менеджера настроек, затем введите `y`, чтобы перезапустить контейнер `rocketpool_eth1`.

```shell
Your changes have been saved!
The following containers must be restarted for the changes to take effect:
	rocketpool_eth1
Would you like to restart them automatically now? [y/n]
```

С этого момента шаги отличаются в зависимости от того, какой клиент исполнения вы используете:

<div className="p-3">
  <Tabs>

        <Tab label="Nethermind">
        Ноды Nethermind требуют полной ресинхронизации для удаления истории до слияния. Вы должны ресинхронизировать свой клиент исполнения после сохранения
        настройки `History Expiry` и перезапуска контейнера `eth1`.

        ::: warning ПРЕДУПРЕЖДЕНИЕ
        Если у вас не настроена резервная нода, ваша нода прекратит валидацию во время ресинхронизации. Резервная нода
        позволит вашей основной ноде продолжать аттестацию и предложение блоков во время обрезки или ресинхронизации. Нажмите [здесь](/ru/node-staking/fallback),
        чтобы узнать, как настроить резервную ноду.
        :::

        Используйте следующую команду для ресинхронизации вашего клиента исполнения:
        ```shell
        rocketpool service resync-eth1
        ```

        Все готово! Нода больше не будет хранить данные до слияния, что существенно повышает возможность размещения ноды на диске 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Geth">

        Ноды Geth требуют офлайн-обрезки для удаления истории до слияния. Вы должны обрезать свой клиент исполнения после сохранения
        настройки `History Expiry` и перезапуска контейнера `eth1`. В качестве альтернативы вы можете провести полную ресинхронизацию для удаления истории до слияния.

        ::: tip ПРИМЕЧАНИЕ
        Мы рекомендуем обрезку вместо полной ресинхронизации. Если вы хотите начать заново с чистой базой данных Geth или у вас проблема
        с обрезкой, вы можете ресинхронизировать клиент исполнения с помощью `rocketpool service resync-eth1`. Оба варианта должны привести к удалению истории до слияния.
        :::

        ::: warning ПРЕДУПРЕЖДЕНИЕ
        Если у вас не настроена резервная нода, ваша нода прекратит валидацию во время обрезки или ресинхронизации. Резервная нода
        позволит вашей основной ноде продолжать аттестацию и предложение блоков во время обрезки или ресинхронизации. Нажмите [здесь](/ru/node-staking/fallback),
        чтобы узнать, как настроить резервную ноду.
        :::

        Выполните следующую команду для обрезки вашего клиента исполнения:
        ```shell
        rocketpool service prune-eth1
        ```
        Вы можете нажать [здесь](/ru/node-staking/pruning#starting-a-prune), чтобы узнать больше об обрезке.

        Все готово! Нода больше не будет хранить данные до слияния, что существенно повышает возможность размещения ноды на диске 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Besu">

        Все готово! Ноды Besu выполнят онлайн-обрезку, продолжая аттестацию и предложение блоков.
        Нода больше не будет хранить данные до слияния, что существенно повышает возможность размещения ноды на диске 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Reth">

        Все готово! Ноды Reth выполнят онлайн-обрезку, продолжая аттестацию и предложение блоков.
        Нода больше не будет хранить данные до слияния, что существенно повышает возможность размещения ноды на диске 2 ТБ.
        Мы рекомендуем отслеживать прогресс с помощью следующей команды.
        ```shell
        rocketpool service logs eth1
         ```

    </Tab>

  </Tabs>
</div>
