# Перенос с одной ноды на другую

Иногда ваша машина для ноды больше не способна выполнять свою работу, и вам необходимо перейти на другую.
Это может произойти, если вы, например, обновляете вашу ноду, или если вы переходите с облачной ноды на локально размещённую на выделенном оборудовании, или даже если ваша нода испытывает катастрофический аппаратный сбой и вам нужно запустить ваши валидаторы на резервной машине.
Независимо от случая, это руководство поможет вам понять, как безопасно перенести ваш кошелёк и ключи валидаторов с одной ноды на другую без получения слэшинга.

## Слэшинг и база данных слэшинга

Основная причина, по которой мы призываем вас проявлять такую осторожность при переносе вашего кошелька с одной машины на другую или восстановлении вашего кошелька на другой машине, заключается в риске **слэшинга**.
Слэшинг происходит, когда один или несколько ваших ключей валидатора делают что-то, что нарушает правила Beacon Chain и выглядит так, как будто вы пытаетесь атаковать сеть.
В ответ цепь принудительно выведет ваш валидатор и наложит серьёзный штраф — размер штрафа зависит от того, сколько валидаторов также получили слэшинг в течение двухнедельного периода от вашего, но в настоящее время минимум составляет **1 ETH**, а максимума нет.

Хотя существует несколько условий, которые могут быть интерпретированы как "атака на сеть", реалистично единственное, что происходит случайно, это **двойная аттестация** (или **двойное предложение**).
Это происходит, когда ваш валидатор отправляет две аттестации (или два предложения блока) для одного и того же слота с разными голосами (например, он голосует за два разных блока-кандидата для конкретного слота вместо того, чтобы выбрать один).

Для борьбы с этим ваш Validator Client хранит так называемую **базу данных слэшинга**.
База данных слэшинга — это просто запись голосов вашего валидатора (то есть слот каждого голоса и хэш блока, за который был этот голос), чтобы он знал, что не голосовать за то, за что он уже голосовал.

### Как избежать слэшинга

Каждый Validator Client поддерживает базу данных слэшинга, чтобы гарантировать, что ваша нода никогда не сделает двойную аттестацию или двойное предложение.
Проблема же возникает в ситуациях, когда вы начинаете валидировать **без** базы данных слэшинга и, следовательно, не имеете записи о том, за что ваши валидаторы ранее голосовали.
Это может произойти в нескольких ситуациях:

1. Вы только что сменили Consensus клиенты, и новый клиент не переносит базу данных слэшинга из старого (чего Smartnode не делает при смене клиента).
2. У вас кошелёк загружен на одной машине, и вы активно аттестуете с ней, а затем загружаете ваш кошелёк на вторую машину _пока первая машина всё ещё активно аттестует_.
3. Вы прекращаете валидировать на одной машине и загружаете ваш кошелёк на вторую машину, но вы не подождали достаточно долго, чтобы текущая эпоха была финализирована, поэтому ваша вторая машина аттестует для слотов, для которых ваши валидаторы уже аттестовали.

Стандартный способ избежать слэшинга — это **подождать как минимум 15 минут после вашей последней успешной аттестации** перед запуском вашего Validator Client и аттестацией снова, и **убедиться, что ваши ключи валидатора присутствуют только на одной единственной машине**.

Более конкретно, план заключается в том, чтобы подождать, пока ваш валидатор намеренно пропустит аттестацию, **и этот пропуск был финализирован**.
Как только финализация достигнута, ваш валидатор больше не может голосовать за финализированную эпоху, и безопасно снова начать аттестовать с ним.

15-минутное ожидание исходит из эмпирического правила, что при нормальной работе (например, с нормальным консенсусом) Beacon Chain занимает около 7 минут для финализации эпохи.
Ожидание 15 минут гарантирует, что вы пропустили как минимум одну эпоху и подождали достаточно долго, чтобы эта эпоха была финализирована, с небольшим запасом для безопасности.

## Чек-лист переноса ноды

С учётом вышеуказанного контекста, вот полезный чек-лист, которому вы можете следовать при переносе вашей ноды, чтобы гарантировать, что вы не получите слэшинг.
Он разработан для максимальной безопасности, поэтому, хотя вы можете думать, что некоторые из шагов не нужны, мы **настоятельно** рекомендуем выполнить их все до конца.

1. **Подготовьте новую ноду**, следуя этим руководствам, начиная с раздела "Подготовка ноды" и заканчивая, как только у вас установлен Smartnode и синхронизируются Execution и Consensus клиенты.
   - :warning: **НЕ** инициализируйте новый кошелёк или восстанавливайте ваш старый кошелёк на ноде. Позвольте ей синхронизировать клиенты _без присутствия кошелька_.

2. **ПОДОЖДИТЕ**, пока ваши клиенты полностью синхронизируются на новой ноде.
3. Подтвердите, что вы правильно записали вашу мнемоническую фразу, запустив `rocketpool wallet test-recovery` на вашей новой машине. Это _симулирует_ восстановление ключей, чтобы подтвердить, что кошелёк вашей ноды и все ключи валидаторов ваших minipool могут быть восстановлены правильно, но не будет _на самом деле_ восстанавливать их и сохранять на диск, поэтому нет риска слэшинга.
   1. Если Smartnode не удаётся восстановить кошелёк вашей ноды, используя предоставленную вами мнемоническую фразу, то ваша мнемоническая фраза может быть недействительной. **ОСТАНОВИТЕ** прохождение этого процесса; удаление ключей с вашей старой ноды означает, что они могут быть **потеряны навсегда**.
   2. В этой ситуации мы рекомендуем выйти из ваших валидаторов и вывести ваш капитал как можно скорее, чтобы вы могли начать заново с новой нодой, для которой у вас есть рабочая мнемоническая фраза.
4. **Остановите валидацию** на вашей старой ноде (например, используя `rocketpool service stop`, чтобы выключить клиент валидатора).
5. **Удалите ваши ключи** с вашей старой ноды (например, используя `rocketpool wallet purge`).
   1. **ПРОВЕРЬТЕ**, что ключи были удалены, посмотрев на папку `data` вашей ноды (по умолчанию это `~/.rocketpool/data/validators/`) — каждый Consensus клиент будет иметь свою собственную папку под этой папкой данных со своей копией ключей.
   2. Пожалуйста, смотрите раздел [Проверка удаления ключей](#verifying-key-removal) ниже для инструкций о том, как это сделать.
   3. Убедитесь, что **все из них** были удалены.

6. **Выключите** вашу старую ноду и отключите её от Интернета, удалив кабель Ethernet или модуль Wi-Fi.

7. **Сотрите SSD** с вашей старой ноды, используя один из следующих методов:
   1. Используйте загрузочный USB-накопитель с установкой Linux (например, популярный [GParted](https://gparted.org/download.php)) и используйте его для стирания диска.
   2. **Физически извлеките его** из вашей старой ноды, подключите его к другой машине, используя USB-конвертер, и используйте инструмент, такой как [GParted](https://installati.one/debian/11/gparted/), для стирания диска.
   3. **Физически извлеките его** из вашей старой ноды и ударьте его молотком, чтобы сломать его и убедиться, что он никогда не будет использоваться снова.

8. **ПОДОЖДИТЕ** как минимум 15 минут перед продолжением. Используйте обозреватель блоков, такой как [https://beaconcha.in](https://beaconcha.in), чтобы посмотреть на запись аттестации вашего валидатора. Подождите, пока как минимум одна аттестация будет записана как пропущенная _и соответствующая эпоха была финализирована_.
   1. ПРИМЕЧАНИЕ: если у вас несколько minipool, вы должны убедиться, что _все они_ пропустили как минимум одну аттестацию, которая была финализирована.

9. **Восстановите кошелёк вашей ноды** на новой машине, следуя инструкциям в [Импорт / Восстановление существующего кошелька](../recovering-rp.mdx).

10. **Перезапустите ваш Validator Client**, чтобы убедиться, что ваши ключи валидатора загружены (например, с помощью `docker restart rocketpool_validator`).

Ключи вашего валидатора теперь будут загружены на вашей новой ноде, и вы можете безопасно начать аттестовать с ней.

## Проверка удаления ключей

Ключи валидатора хранятся на вашем диске в форме файлов `json`.
Они хранятся в папке `data` вашей ноды.
По умолчанию вы можете найти их здесь:

```shell
~/.rocketpool/data/validators/
```

::: warning ПРИМЕЧАНИЕ
Если вы изменили ваш каталог `data`, используя TUI `service config` (например, вы используете ключ Aegis и установили его как вашу папку `data`, вышеуказанный путь должен быть изменён на `<ваша папка data>/validators`.)
:::

Каждый клиент будет иметь свою копию ключей, так как каждый клиент ожидает их в другом формате или конфигурации.

Чтобы **найти** ключи на диске, выполните следующую команду:

```shell
sudo find ~/.rocketpool/data/validators -type f -name "*.json"
```

Например, на машине с двумя minipool, вывод будет выглядеть так:

```shell
/home/joe/.rocketpool/data/validators/teku/keys/0x831862d79685079037dbba67acfa1faf13a5863b94c1c39126e9a52155d32b7733ba65a56ba172e0fcb2b7d77e8a125b.json
/home/joe/.rocketpool/data/validators/teku/keys/0x900189d6bf7b0635ce1d81046c0d882d52ccf05e3f4fb29e7b9db4c9fb72c6587256fd41a785f103e15a253f3d24a610.json
/home/joe/.rocketpool/data/validators/lighthouse/validators/0x831862d79685079037dbba67acfa1faf13a5863b94c1c39126e9a52155d32b7733ba65a56ba172e0fcb2b7d77e8a125b/voting-keystore.json
/home/joe/.rocketpool/data/validators/lighthouse/validators/0x900189d6bf7b0635ce1d81046c0d882d52ccf05e3f4fb29e7b9db4c9fb72c6587256fd41a785f103e15a253f3d24a610/voting-keystore.json
/home/joe/.rocketpool/data/validators/nimbus/validators/0x831862d79685079037dbba67acfa1faf13a5863b94c1c39126e9a52155d32b7733ba65a56ba172e0fcb2b7d77e8a125b/keystore.json
/home/joe/.rocketpool/data/validators/nimbus/validators/0x900189d6bf7b0635ce1d81046c0d882d52ccf05e3f4fb29e7b9db4c9fb72c6587256fd41a785f103e15a253f3d24a610/keystore.json
/home/joe/.rocketpool/data/validators/prysm-non-hd/direct/accounts/all-accounts.keystore.json
/home/joe/.rocketpool/data/validators/prysm-non-hd/direct/keymanageropts.json
/home/joe/.rocketpool/data/validators/lodestar/validators/0x831862d79685079037dbba67acfa1faf13a5863b94c1c39126e9a52155d32b7733ba65a56ba172e0fcb2b7d77e8a125b/voting-keystore.json
/home/joe/.rocketpool/data/validators/lodestar/validators/0x900189d6bf7b0635ce1d81046c0d882d52ccf05e3f4fb29e7b9db4c9fb72c6587256fd41a785f103e15a253f3d24a610/voting-keystore.json
```

Это показывает пример, где ключи **не** были удалены и всё ещё находятся в файловой системе.

Если ваши ключи **были** удалены, вы не должны видеть _никаких_ шестнадцатеричных строк (больших строк, начинающихся с `0x`) в каких-либо папках для любого из клиентов в выводе этой команды.
