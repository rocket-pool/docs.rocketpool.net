# Подготовка Raspberry Pi

::: warning ПРИМЕЧАНИЕ
Эта страница оставлена здесь в архивных целях. Мы больше не рекомендуем запускать Rocket Pool на Raspberry Pi из-за возросших аппаратных требований и требований к производительности при работе валидатора Ethereum.
:::

Это руководство проведет вас через процесс запуска узла Rocket Pool с использованием Raspberry Pi.
Хотя это обычно не рекомендуется в большинстве руководств по стейкингу, мы признаем, что это привлекательно, потому что это гораздо более доступный вариант, чем создание целого ПК.
С этой целью мы усердно работали над настройкой и оптимизацией множества настроек и определили конфигурацию, которая, кажется, работает хорошо.

Эта настройка запустит **полный узел Execution** и **полный узел Consensus** на Pi, заставляя вашу систему вносить вклад в здоровье сети Ethereum, одновременно действуя как оператор узла Rocket Pool.

## Предварительная настройка

Чтобы запустить узел Rocket Pool на Raspberry Pi, вам сначала понадобится работающий Raspberry Pi.
Если у вас уже есть один работающий - отлично! Вы можете пропустить к разделу [Монтирование SSD](#mounting-the-ssd).
Просто убедитесь, что у вас **прикреплен вентилятор** перед тем, как продолжить.
Если вы начинаете с нуля, то читайте дальше.

### Что вам понадобится

Это рекомендуемые компоненты, которые вам нужно будет купить для запуска Rocket Pool на Pi:

- **Raspberry Pi 4 Model B**, **модель с 8 ГБ**
  - Примечание: хотя вы _можете_ использовать 4 ГБ с этой настройкой, мы настоятельно рекомендуем использовать 8 ГБ для спокойствия... это действительно не намного дороже.
- **USB-C блок питания** для Pi. Вам нужен тот, который обеспечивает **как минимум 3 ампера**.
- **MicroSD карта**. Она не должна быть большой, 16 ГБ достаточно, и они сейчас довольно дешевые... но она должна быть как минимум **Class 10 (U1)**.
- **Адаптер MicroSD к USB** для вашего ПК. Это необходимо, чтобы вы могли установить операционную систему на карту перед загрузкой ее в Pi. Если у вашего ПК уже есть SD-порт, то вам не нужно покупать новый.
- Несколько **радиаторов**. Вы собираетесь запускать Pi под большой нагрузкой 24/7, и он будет нагреваться. Радиаторы помогут, чтобы он не тормозил сам себя. В идеале вам нужен набор из 3: один для процессора, один для ОЗУ и один для USB-контроллера. [Вот хороший пример хорошего набора](https://www.canakit.com/raspberry-pi-4-heat-sinks.html).
- **Корпус**. Здесь есть два способа: с вентилятором и без вентилятора.
  - С вентилятором:
    - **Вентилятор** 40 мм. То же, что и выше, цель - поддерживать охлаждение при запуске вашего узла Rocket Pool.
    - **Корпус с креплением для вентилятора**, чтобы все связать вместе. Вы также можете получить корпус со встроенными вентиляторами [вот такой](https://www.amazon.com/Raspberry-Armor-Metal-Aluminium-Heatsink/dp/B07VWM4J4L), чтобы вам не нужно было покупать вентиляторы отдельно.
  - Без вентилятора:
    - **Корпус без вентилятора**, который действует как один гигантский радиатор, например [этот](https://www.amazon.com/Akasa-RA08-M1B-Raspberry-case-Aluminium/dp/B081VYVNTX). Это хороший вариант, так как он бесшумный, но ваш Pi **будет** довольно сильно нагреваться - особенно во время процесса первоначальной синхронизации блокчейна. Спасибо пользователю Discord Ken за указание нам в этом направлении!
  - Как общее правило, мы рекомендуем идти **с вентилятором**, потому что мы собираемся значительно разогнать Pi.

Вы можете получить много этих вещей в комплекте для удобства - например, [Canakit предлагает комплект](https://www.amazon.com/CanaKit-Raspberry-8GB-Starter-Kit/dp/B08956GVXN) с множеством компонентов в комплекте.
Однако вы можете получить все это дешевле, если приобретете детали отдельно (и если у вас есть оборудование, вы можете [напечатать свой собственный корпус Pi на 3D-принтере](https://www.thingiverse.com/thing:3793664).)

Другие компоненты, которые вам понадобятся:

- **USB 3.0+ твердотельный накопитель**. Общая рекомендация - **накопитель объемом 2 ТБ**.
  - [Samsung T5](https://www.amazon.com/Samsung-T5-Portable-SSD-MU-PA2T0B/dp/B073H4GPLQ) - отличный пример того, который, как известно, работает хорошо.
  - :warning: Использование SATA SSD с адаптером SATA-к-USB **не рекомендуется** из-за [таких проблем](https://www.raspberrypi.org/forums/viewtopic.php?f=28&t=245931). Если вы пойдете по этому пути, мы включили тест производительности, который вы можете использовать, чтобы проверить, будет ли он работать или нет, в разделе [Тестирование производительности SSD](#testing-the-ssd-s-performance).
- **Ethernet-кабель** для доступа в Интернет. Он должен быть как минимум **Cat 5e** рейтинга.
  - Запуск узла через Wi-Fi **не рекомендуется**, но если у вас нет другого варианта, вы можете сделать это вместо использования ethernet-кабеля.
- **ИБП** (источник бесперебойного питания), который будет действовать как источник питания, если вы когда-нибудь потеряете электричество. Pi действительно не потребляет много энергии, поэтому даже небольшой ИБП прослужит некоторое время, но вообще, чем больше, тем лучше. Берите самый большой ИБП, который вы можете себе позволить. Кроме того, мы рекомендуем **прикрепить ваш модем, роутер и другое сетевое оборудование** к нему также - не имеет большого смысла поддерживать ваш Pi живым, если ваш роутер умрет.

В зависимости от вашего местоположения, распродаж, вашего выбора SSD и ИБП, и того, сколько из этих вещей у вас уже есть, вы, вероятно, потратите **около $200-$500 USD** на полную настройку.

## Настройка пространства подкачки

Pi имеет 8 ГБ (или 4 ГБ, если вы пошли по этому пути) ОЗУ.
Для нашей конфигурации этого будет достаточно.
Тем не менее, никогда не помешает добавить немного больше.
То, что мы собираемся сделать сейчас, - это добавить то, что называется **пространством подкачки**.
По сути, это означает, что мы собираемся использовать SSD как "резервное ОЗУ" на случай, если что-то пойдет ужасно, ужасно не так, и Pi закончит обычное ОЗУ.
SSD не такой быстрый, как обычное ОЗУ, поэтому, если он попадет в пространство подкачки, это замедлит работу, но не приведет к полному сбою и не сломает все.
Думайте об этом как о дополнительной страховке, которая вам (скорее всего) никогда не понадобится.

### Создание файла подкачки

Первый шаг - создать новый файл, который будет действовать как ваше пространство подкачки.
Решите, сколько вы хотите использовать - разумным началом будет 8 ГБ, поэтому у вас есть 8 ГБ обычного ОЗУ и 8 ГБ "резервного ОЗУ" на общую сумму 16 ГБ.
Чтобы быть супер безопасным, вы можете сделать его 24 ГБ, чтобы ваша система имела 8 ГБ обычного ОЗУ и 24 ГБ "резервного ОЗУ" на общую сумму 32 ГБ, но это, вероятно, излишне.
К счастью, поскольку ваш SSD имеет 1 или 2 ТБ пространства, выделение 8-24 ГБ для файла подкачки незначительно.

Ради этого руководства давайте выберем хорошую золотую середину - скажем, 16 ГБ пространства подкачки на общую ОЗУ 24 ГБ.
Просто замените любое число, которое вы хотите, по ходу дела.

Введите это, что создаст новый файл с именем `/mnt/rpdata/swapfile` и заполнит его 16 ГБ нулей.
Чтобы изменить количество, просто измените число в `count=16` на то, что вы хотите. **Обратите внимание, что это займет много времени, но это нормально.**

```shell
sudo dd if=/dev/zero of=/mnt/rpdata/swapfile bs=1G count=16 status=progress
```

Далее установите разрешения, чтобы только пользователь root мог читать или записывать в него (для безопасности):

```shell
sudo chmod 600 /mnt/rpdata/swapfile
```

Теперь отметьте его как файл подкачки:

```shell
sudo mkswap /mnt/rpdata/swapfile
```

Далее включите его:

```shell
sudo swapon /mnt/rpdata/swapfile
```

Наконец, добавьте его в таблицу монтирования, чтобы он автоматически загружался при перезагрузке вашего Pi:

```shell
sudo nano /etc/fstab
```

Добавьте новую строку в конце, чтобы файл выглядел так:

```
LABEL=writable  /        ext4   defaults        0 0
LABEL=system-boot       /boot/firmware  vfat    defaults        0       1
UUID=1ade40fd-1ea4-4c6e-99ea-ebb804d86266       /mnt/rpdata     ext4    defaults        0       0
/mnt/rpdata/swapfile                            none            swap    sw              0       0
```

Нажмите `Ctrl+O` и `Enter` для сохранения, затем `Ctrl+X` и `Enter` для выхода.

Чтобы проверить, что он активен, выполните эти команды:

```shell
sudo apt install htop
htop
```

Ваш вывод должен выглядеть так вверху:
![](./images/pi/Swap.png)

Если второе число в последней строке с меткой `Swp` (то, что после `/`) не равно нулю, тогда все готово.
Например, если оно показывает `0K / 16.0G`, то ваше пространство подкачки было активировано успешно.
Если оно показывает `0K / 0K`, то оно не сработало, и вам придется подтвердить, что вы правильно ввели предыдущие шаги.

Нажмите `q` или `F10`, чтобы выйти из `htop` и вернуться в терминал.

### Настройка Swappiness и Cache Pressure

По умолчанию Linux будет активно использовать много пространства подкачки, чтобы снять часть давления с ОЗУ системы.
Мы этого не хотим. Мы хотим, чтобы он использовал всю ОЗУ до самой последней секунды перед тем, как полагаться на SWAP.
Следующий шаг - изменить то, что называется "swappiness" системы, что в основном показывает, насколько активно она использует пространство подкачки.
Существует много споров о том, какое значение установить, но мы обнаружили, что значение 6 работает достаточно хорошо.

Мы также хотим уменьшить "давление кэша", которое определяет, насколько быстро Pi удалит кэш своей файловой системы.
Поскольку у нас будет много свободной ОЗУ с нашей настройкой, мы можем сделать это "10", что оставит кэш в памяти на некоторое время, уменьшая дисковый I/O.

Чтобы установить это, выполните эти команды:

```shell
sudo sysctl vm.swappiness=6
sudo sysctl vm.vfs_cache_pressure=10
```

Теперь поместите их в файл `sysctl.conf`, чтобы они применялись повторно после перезагрузки:

```shell
sudo nano /etc/sysctl.conf
```

Добавьте эти две строки в конец:

```shell
vm.swappiness=6
vm.vfs_cache_pressure=10
```

Затем сохраните и выйдите, как вы делали раньше (`Ctrl+O`, `Ctrl+X`).

## Следующие шаги

И с этим ваш Pi готов и готов к запуску Rocket Pool!
Перейдите к разделу [Выбор ваших ETH клиентов](../eth-clients).
