import { Tab, Tabs } from "@rspress/core/theme";

::: danger ПРЕДУПРЕЖДЕНИЕ
Депозиты minipool в настоящее время отключены в рамках подготовки к Saturn 1.
:::

# Миграция 16-ETH Minipool на 8-ETH

Node операторы имеют возможность **напрямую мигрировать** свои существующие 16-ETH minipool в 8-ETH minipool.
Это добавит 8 ETH к их [балансам кредита депозита](./credit), которые могут быть использованы для **создания дополнительных minipool без необходимости использования ETH от node операторов**.

По сути, этот процесс позволяет node оператору **конвертировать один 16-ETH minipool в два 8-ETH minipool бесплатно** (_хотя это потребует ETH для газа и достаточного залога RPL для обработки обоих minipool_).

Миграция существующего 16-ETH minipool в 8-ETH формально известна как **сокращение залога**.
Это двухэтапный процесс, включающий проверку Oracle DAO.
Мы проведем вас через весь процесс в разделах ниже.

### Правила сокращения залога

Сокращение залога включает следующие шаги:

1. Запуск сокращения залога, выполняемый node оператором.
2. Период ожидания («проверка scrub сокращения залога»), позволяющий Oracle DAO проверить законность сокращения залога и отменить любые сокращения залога, нарушающие правила.
3. Завершение сокращения залога, выполняемое node оператором.

Для успешного сокращения залога без отмены minipool должен следовать этим правилам:

1. Minipool должен быть обновлен до [делегата Atlas](./minipools/delegates); старый делегат Redstone использовать нельзя.
1. Validator minipool в Beacon Chain должен находиться в состоянии **ожидания или активного стейкинга**. Он не может быть slashed, выходящим / вышедшим или доступным для вывода / выведенным.
1. Баланс validator minipool в Beacon Chain должен быть **не менее 31.99 ETH** (32 ETH с небольшим буфером для неудачно рассчитанных по времени осложнений, приводящих к пропущенным аттестациям после снятия вознаграждений).

Minipool должен соблюдать эти условия на **всю продолжительность** проверки scrub, в течение которой Oracle DAO будет наблюдать за ним для обеспечения соответствия вышеуказанным условиям.

Если в любой момент во время проверки scrub minipool будет обнаружен в нарушении этих условий, сокращение залога будет **отменено**.
Сам minipool не будет затронут; он продолжит спокойно существовать как 16 ETH minipool, валидируя и действуя так, как будто весь процесс сокращения залога никогда не происходил.
Однако **он больше не будет иметь право на сокращение залога**.
После отмены сокращения залога minipool повторная попытка невозможна.

::: warning ПРИМЕЧАНИЕ
После успешного сокращения залога сумма залога minipool будет уменьшена с 16 ETH до 8 ETH, и **комиссия minipool будет сброшена до текущего сетевого значения**.

Если вы уменьшаете 16-ETH minipool с комиссией 20%, **вы не сохраните эту комиссию 20%**.
Она будет снижена до сетевого значения (**в настоящее время установлено на фиксированные 14%**).

Обратите внимание, что, как показано в разделе [примеров расчета](./create-validator.mdx#rewards), 8-ETH minipool с 14% _все еще более прибылен_, чем 16-ETH minipool с 20%, поэтому удержание высокой ставки комиссии не является убедительной причиной для сохранения залога 16 ETH.
:::

### Шаг 1: Начало сокращения залога

Чтобы начать процесс сокращения залога, введите следующую команду:

```shell
rocketpool minipool begin-bond-reduction
```

Это начнется с краткого описания процесса (хотя, если вы прочитали это руководство, все это уже должно быть вам знакомо).
После подтверждения понимания процесса будут показаны minipool, у которых в настоящее время есть залог, который может быть уменьшен, вместе с их текущим залогом и комиссией:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)

```

После выбора одного или нескольких minipool для уменьшения Smartnode проверит, имеют ли эти minipool право на сокращение залога.

Для получения права должны быть выполнены следующие условия:

- Minipool был обновлен для использования [контракта делегата minipool Atlas](./minipools/delegates).
- Validator minipool должен иметь баланс в Beacon Chain не менее 32 ETH.
- Validator minipool должен находиться в состоянии ожидания или быть активным.
- У вас достаточно застейканного RPL для поддержки минимального уровня залога RPL, который потребуется _после_ сокращения залога.

Если нет, будет выведено предупреждение об ошибке с объяснением, что нужно сделать сначала; например:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)
2

Cannot reduce bond for minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5:
The minipool version is too low. It must be upgraded first using `rocketpool minipool delegate-upgrade`.
You do not have enough RPL staked to support this bond reduction; it would bring you below the minimum RPL staking requirement. You will have to stake more RPL first.
```

Это показывает, что выбранный minipool требует обновления делегата, и node необходимо застейкать больше RPL для уменьшения залога этого minipool.

Когда вы выполните предварительные условия, выбор minipool в этой команде просто предложит вам выбрать цену газа для транзакции и подтверждение действия.
После принятия подтверждения начнется сокращение залога minipool.

### Мониторинг таймера проверки Scrub

После запуска сокращения залога вы можете просмотреть, сколько времени осталось до его завершения, в логах вашего демона `node`:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Для пользователей **Docker Mode** и **Hybrid Mode** это можно сделать с помощью следующей команды:

      ```shell
      rocketpool service logs node
      ```
    </Tab>
    <Tab label="Native Mode">
      Обратитесь к скрипту, который вы используете для просмотра системных логов вашего node демона.
    </Tab>

  </Tabs>
</div>

Вы увидите новую запись, показывающую, сколько времени осталось до завершения проверки scrub для вашего сокращения залога:

```
rocketpool_node  | 2023/02/25 09:04:21 Checking for minipool bonds to reduce...
rocketpool_node  | 2023/02/25 09:04:21 Minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 has 12m0s left until it can have its bond reduced.
```

Когда этот таймер достигнет нуля и больше не будет появляться в этих логах, вы сможете завершить сокращение залога.

### Шаг 2: Завершение сокращения залога

Когда таймер scrub успешно завершится, есть два способа завершить сокращение залога вашего minipool:

1. Позволить демону `node` обработать это за вас; он делает это во время рутинной проверки, которую выполняет каждые пять минут (та же, что печатает строку оставшегося времени в логе выше). Если он обнаружит, что у вас есть подходящее сокращение залога, **он автоматически завершит сокращение** - точно так же, как он делает со стейкингом ожидающих minipool и проверкой вашего получателя комиссий. Вы увидите вывод в логе `node`, показывающий, когда он обнаружил и завершил сокращение залога.
2. Завершить сокращение залога вручную с помощью следующей команды:
   ```shell
   rocketpool minipool reduce-bond
   ```
   Команда проста; следуйте подсказкам для завершения процесса, когда ваш minipool станет подходящим для сокращения залога.

Во время сокращения залога Rocket Pool **распределяет существующий баланс вашего minipool**, используя залог и комиссию minipool до сокращения залога, чтобы обеспечить справедливую долю существующего баланса для вас и стейкеров rETH, и чтобы сокращение залога не изменило вознаграждения, которые любая из сторон _получила бы_ на этом балансе.

### Результаты сокращенного залога

Вы можете проверить успешное сокращение залога с помощью `rocketpool minipool status`.

**До** сокращения залога для примера minipool, которому мы следовали, эта команда выдала бы следующий вывод:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             15.000000%
Node deposit:         16.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            16.000000 ETH
Minipool Balance (EL): 0.150713 ETH
Your portion:          0.086660 ETH
Available refund:      0.000000 ETH
Total EL rewards:      0.086660 ETH
...
Beacon balance (CL):   32.000152 ETH
Your portion:          16.000087 ETH
...
```

**После** сокращения залога команда вернула бы этот вывод:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             14.000000%
Node deposit:         8.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 0.086769 ETH
Your portion:          0.000000 ETH
Available refund:      0.086769 ETH
Total EL rewards:      0.086769 ETH
...
Beacon balance (CL):   32.000037 ETH
Your portion:          8.000013 ETH
...
```

Обратите внимание, как все изменилось:

- `Node fee` (комиссия) изменилась с 15% на 14%
- `Node deposit` (ваш залог) изменился с 16 ETH на 8 ETH
- `RP deposit` (сумма, которую вы взяли в долг) изменилась с 16 ETH на 24 ETH
- `Minipool Balance (EL)` изменился с 0.150713 ETH на 0.086769 ETH
- `Your portion (EL)` изменилась с 0.086660 ETH на 0 ETH
- `Available refund` изменился с 0 ETH на 0.086769 ETH
- `Your portion (CL)` изменилась с 16.000087 ETH на 8.000013 ETH

Изменения в `Node fee`, `Node deposit`, `RP deposit` и `Your portion (CL)` указывают на успешное сокращение залога.

Изменения в `Minipool Balance (EL)`, `Your portion (EL)` и `Available refund` указывают на результаты **распределения баланса minipool**, которое произошло в рамках процесса сокращения залога.
Чтобы прояснить, как интерпретировать эти результаты:

- Если посмотреть на [транзакцию](https://zhejiang.beaconcha.in/tx/0xf02f6b1a4ea68f356909e6f1974dc3c24d301ba115b97f3013c3c829ba2ca57c), вы также увидите, что она отправила 0.06413383 ETH из minipool в стейкинг пул.
- В примере «до» доля стейкинг пула - это баланс minipool минус доля node оператора, или `0.150713 - 0.086660 = 0.064053`, что является суммой, переведенной в стейкинг пул во время сокращения залога (плюс небольшая сумма от снятия вознаграждений, произошедшего во время проверки scrub).
- С другой стороны, доля _node оператора_ не отправляется на адрес вывода node оператора. Вместо этого она отмечается как **доступный возврат**, поэтому сумма возврата увеличилась с 0 ETH до того, что ранее было суммой «ваша доля» баланса minipool на EL.
  - Вы можете запросить этот возврат в любое время с помощью следующей команды:
    ```shell
    rocketpool minipool refund
    ```

Есть еще один важный результат сокращения залога, который можно наблюдать с помощью `rocketpool node status`:

```
Your Smartnode is currently using the Zhejiang Test Network.

=== Account and Balances ===
The node 0x9BA1401Eb7D779eC51f910B066e9C4351cD28911 has a balance of 347.796908 ETH and 16799.835547 RPL.
The node has 8.000000 ETH in its credit balance, which can be used to make new minipools.
```

Процесс сокращения залога **увеличил** [баланс кредита депозита](./credit) node на 8 ETH.
Этот кредит можно использовать для [создания еще одного 8-ETH minipool](./create-validator.mdx#depositing-eth-and-creating-a-minipool) бесплатно (не требуется ETH от кошелька node, кроме как для газа)!
