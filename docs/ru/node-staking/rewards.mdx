import claim_rewards_gb from "./images/claim-rewards-gb.png";
import autostake from "./images/autostake.png";

# Получение вознаграждений операторов узлов

Как оператор узла Rocket Pool, вы имеете право на регулярные вознаграждения, которые будут предоставляться в форме токена RPL и (если вы присоединились к Smoothing Pool) немного ETH.
Этот раздел описывает, как работают эти вознаграждения и как вы можете их получить.

## Вознаграждения и контрольные точки

Через регулярные интервалы Rocket Pool отмечает **контрольную точку** в сети.
В настоящее время контрольные точки происходят **каждые 28 дней**.

На новой контрольной точке Oracle DAO коллективно создает **истинный снимок** состояния операторов узлов в сети Rocket Pool, который используется для определения вознаграждений RPL и Smoothing Pool ETH для каждого узла в течение этого интервала. Обратите внимание, что "бонусная комиссия" для minipools Saturn 0 распределяется с использованием вознаграждений smoothing pool (minipools Saturn 0 - это те, которые были созданы после 28.10.2024 и имеют контрактную комиссию 5%).

Эта информация компилируется в [дерево Меркла](https://en.wikipedia.org/wiki/Merkle_tree) - чрезвычайно эффективный способ сделать все детали доступными для смарт-контрактов.
Дерево Меркла встраивается в JSON-файл и размещается в [InterPlanetary File System (IPFS)](https://en.wikipedia.org/wiki/InterPlanetary_File_System) и дублируется в [репозитории GitHub, который мы поддерживаем](https://github.com/rocket-pool/rewards-trees/).

После отправки дерева смарт-контракты Rocket Pool создадут новые токены RPL и переместят их вместе со всем балансом ETH Smoothing Pool в хранилище Rocket Pool для безопасного хранения.
Затем вы можете посмотреть, сколько вознаграждений RPL и ETH вы заработали в течение этого интервала и получить эти вознаграждения.

Система вознаграждений имеет следующие особенности:

- Каждый интервал независим. Количество RPL и ETH, которое вы заработали в одном интервале, не влияет на заработок в последующих интервалах.
- Вы можете **позволить вознаграждениям накапливаться** столько, сколько хотите. Вам не нужно получать вознаграждения в определенное время; они всегда будут доступны для получения и всегда будут предоставлять точно такое же количество RPL и ETH **независимо от того, когда вы их получите**.
- Вы можете получать по одному интервалу за раз или **несколько интервалов** сразу.
- Ваша первая транзакция получения использует около 85k газа. Каждая последующая транзакция получения стоит около 55k газа.
  - Если вы получаете несколько интервалов одновременно, каждый дополнительный интервал стоит **6k газа**, поэтому наиболее выгодно получать как можно больше за раз.
- Вы можете **пере-застейкать часть (или все) ваших вознаграждений RPL** в рамках транзакции получения, чтобы все было выполнено в одной транзакции (что дополнительно снижает расходы на газ).
- В настоящее время **все ваши получения должны быть в Mainnet**, но у нас есть инфраструктура для возможности получения в сетях Layer 2 в будущем.

Для получения дополнительной информации о том, как строится дерево Меркла и как рассчитываются вознаграждения, [пожалуйста, посетите наш репозиторий `research` и просмотрите официальные спецификации](https://github.com/rocket-pool/rocketpool-research/tree/master/Merkle%20Rewards%20System).
Мы предоставили их краткое объяснение ниже.

### Вознаграждения RPL

Текущая ставка вознаграждений RPL составляет **5% инфляции в год**, и вознаграждения выплачиваются каждый 28-дневный период.
По состоянию на 21.10.2024 инфляция за последний период составила 77,533. Поскольку 70% распределяется операторам узлов Rocket Pool, это составило 54,273 RPL за этот период.

Эта сумма будет разделена между всеми операторами узлов в сети на основе их [веса узла](https://rpips.rocketpool.net/RPIPs/RPIP-30#specification).
Операторы узлов получают максимальный APY для позиций застейканного RPL стоимостью 0-15% от заимствованного ETH.
Стейк RPL свыше 15% заимствованного ETH все еще приносит дополнительные вознаграждения, но с пониженным предельным APY.

Если между моментом регистрации вашего узла и контрольной точкой прошло менее 28 дней, ваши вознаграждения за первый интервал вознаграждений будут **пропорционально уменьшены**. Например, если вы зарегистрировались на 14-й день интервала, вы получите 50% от обычных вознаграждений.

После этого первого интервала ваш узел будет зарегистрирован достаточно долго в последующих интервалах, чтобы вы получили полные вознаграждения за все из них.

Команда `rocketpool node status` покажет вам ваш текущий коэффициент обеспечения в любой момент времени. Этот коэффициент обеспечения будет основан на ценах на момент выполнения команды. Однако, если вы хотите узнать, каким будет ваш коэффициент обеспечения на следующем раунде вознаграждений, выполните следующие шаги:

- Выполните команду `/when` в канале "random" в [Rocketpool Discord](https://discord.com/channels/405159462932971535/405503016234385409) и посмотрите, сколько часов осталось до начала следующего периода вознаграждений.
- oDAO делает снимок цены каждые 19.2 часа (т.е. около 5760 блоков \* 12 секунд, исключая пропущенные блоки). Поэтому проверка контракта отправки цен oDAO в Etherscan скажет вам, был ли сделан снимок цены за 19.2 часа до времени, указанного в пункте выше. Если это так, снимок цены был сделан. Если нет, его еще предстоит сделать, и вы можете оценить, когда это произойдет, посмотрев на последний раунд отправки цен oDAO и добавив 19.2 часа.
- Чтобы проверить, какое соотношение цен RPL/ETH было взято в качестве снимка oDAO для следующего раунда вознаграждений, проверьте контракт отправки цен oDAO в Etherscan (который вы можете получить, выполнив команду `/get_address_of_contract contract:rocketNetworkPrices` в канале "random" в Rocketpool Discord). После этого откройте одну или несколько транзакций, отправленных членами oDAO. <a href="/images/node/rewards/rewards-1.png" target="_blank"><img src="/images/node/rewards/rewards-1.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Прокрутите вниз и в разделе "More Details" нажмите **"+ Click to show more"**, а затем нажмите **"Decode Input Data"**. <a href="/images/node/rewards/rewards-2.png" target="_blank"><img src="/images/node/rewards/rewards-2.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Цена RPL (показанная в единицах wei), отображаемая в поле Input Data, деленная на 10^18 (для преобразования в единицы ETH), умноженная на количество застейканного RPL, должна быть >= 1.6 ETH (для 16 ETH minipools) и >= 2.4 ETH (для LEB8), умноженных на количество minipools каждого типа, которые вы управляете. <a href="/images/node/rewards/rewards-3.png" target="_blank"><img src="/images/node/rewards/rewards-3.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Если ваш коэффициент обеспечения ниже требуемой суммы, как объяснено в предыдущем пункте, вы можете застейкать дополнительный RPL в промежутке времени между тем, когда oDAO сделал последний снимок цены (см. пункт 3 выше), и временем начала следующего раунда вознаграждений (см. пункты 1 и 2 выше), чтобы вернуть ваш узел к коэффициенту обеспечения >=10%.
- Альтернативой проверке отправок цен oDAO в etherscan является отслеживание канала "events" в Rocketpool discord и поиск сообщения **RPL Price Update** от бота Rocket Watch (см. пример ниже) в течение последних 19.2 часов до начала следующего периода вознаграждений. <a href="/images/node/rewards/rewards-4.png" target="_blank"><img src="/images/node/rewards/rewards-4.png" style={{ display: "block", margin: "0 auto" }} /></a>

### Вознаграждения ETH Smoothing Pool

Наряду с вознаграждениями RPL весь баланс ETH Smoothing Pool распределяется во время контрольных точек вознаграждений.
Из всего баланса вознаграждений Smoothing Pool процент, который соответствует пул-стейкерам (50% для 16 ETH minipools или 75% для LEB8), минус соответствующая комиссия узла, будет отправлен в контракт rETH. Там он может либо 1) быть сожжен за ETH от пул-стейкеров, которые хотят выйти, либо 2) быть использован для создания большего количества minipools.
Оставшаяся часть будет распределена среди подходящих операторов узлов.

Узлы, присоединившиеся к smoothing pool на интервал, даже если только на часть времени, имеют право на часть общего баланса Smoothing Pool.
Баланс фиксируется на контрольной точке вознаграждений, и Oracle DAO определяет долю каждого подходящего узла.
Доля определяется следующими факторами:

- Время в Smoothing Pool в этом интервале
- Производительность аттестации в Beacon Chain для каждого minipool
- Комиссия каждого minipool

Если вы хотите узнать больше, пожалуйста, см. репозиторий `research`, указанный выше, для полного описания того, как рассчитываются вознаграждения.

### (Опционально) Генерация дерева вознаграждений

Когда достигается новая контрольная точка вознаграждений, Oracle DAO начнет строить дерево вознаграждений для этого интервала.
Построение этого дерева в настоящее время занимает примерно 2 часа, и вознаграждения за интервал недоступны для получения до тех пор, пока дерево не будет построено и отправлено.
Как только оно станет доступным, ваш узел автоматически загрузит этот файл, и вы сможете просмотреть и получить свои вознаграждения за этот интервал.

Если вы хотите сгенерировать дерево самостоятельно вместо загрузки предварительно построенного от Oracle DAO, вы можете это сделать!

- Войдите в TUI `rocketpool service config`.
- Перейдите в раздел `Smartnode and TX Fees`.
- Измените `Rewards Tree Mode` с `Download` на `Generate`.
- Если ваш основной Execution client не является архивным узлом, вы можете добавить URL для отдельного архивного узла в поле `Archive-Mode EC URL`.
  - Это необходимо для генерации исторических деревьев вознаграждений.
  - Archive EC будет использоваться только для генерации дерева; он не будет использоваться для каких-либо других обязанностей Smartnode.
  - [Infura](https://infura.io/product/ethereum) и [Alchemy](https://www.alchemy.com/supernode) предлагают доступ к архивным узлам. **Обратите внимание, что бесплатные уровни обычно недостаточны для обработки генерации дерева, поэтому вам потребуется один из платных уровней.**

Теперь ваш Smartnode будет строить дерево полностью независимо от Oracle DAO, используя только данные, предоставленные вашими Execution и Consensus клиентами.
Вы можете наблюдать за этим во время контрольной точки интервала вознаграждений с помощью `rocketpool service logs watchtower`.

Если вы хотите перестроить прошлые деревья из предыдущих интервалов, вы можете сделать это с помощью следующей команды:

```shell
rocketpool network generate-rewards-tree
```

Следуйте подсказкам, а затем используйте `rocketpool service logs watchtower` для просмотра прогресса.

## Получение вознаграждений

Чтобы просмотреть ваши ожидающие неполученные вознаграждения, выполните следующую команду:

```shell
rocketpool node claim-rewards
```

По мере того, как проходят интервалы и вы накапливаете вознаграждения, вывод будет выглядеть так:

<img src={claim_rewards_gb} width="100%" height="auto" />

Здесь вы можете быстро увидеть, сколько вознаграждений вы заработали в каждом интервале, и решить, какой из них вы хотите получить.

Вы также можете указать сумму, которую хотите пере-застейкать во время этого получения:

<img src={autostake} width="100%" height="auto" />

Это позволит вам компаундировать ваши вознаграждения RPL в одной транзакции, что экономит расходы на газ.

Просто следуйте подсказкам, убедитесь, что в кошельке вашего узла достаточно ETH для оплаты расходов на газ для получения, и готово!
**Ваши вознаграждения будут отправлены на ваш адрес вывода.**

::: tip TIP
Чтобы просмотреть общие вознаграждения вашего узла, включая те, которые вы уже получили, используйте следующую команду:

```shell
rocketpool node rewards
```

Это предоставит разбивку того, сколько RPL и ETH вы уже получили, и сколько еще не получено:

```
=== ETH ===
You have earned 8.1935 ETH from the Beacon Chain (including your commissions) so far.
You have claimed 0.0634 ETH from the Smoothing Pool.
You still have 3.4788 ETH in unclaimed Smoothing Pool rewards.

=== RPL ===
The current rewards cycle started on 27 Sep 22 21:26 EDT.
It will end on 30 Sep 22 21:26 EDT (20h35m17s from now).
You currently have 675.616380 unclaimed RPL from staking rewards.

Your estimated RPL staking rewards for this cycle: 36.851544 RPL (this may change based on network activity).
Based on your current total stake of 6615.797278 RPL, this is approximately 67.77% APR.
Your node has received 208.551820 RPL staking rewards in total.

You may claim these rewards at any time. You no longer need to claim them within this interval.
```

:::

## Вознаграждения Execution-Layer в вашем Fee Distributor

Если вы **не** присоединились к Smoothing Pool, часть ваших вознаграждений Execution-layer от предложений блоков (включая комиссии за транзакции и MEV) будет отправлена в контракт [Fee Distributor](./fee-distrib-sp#fee-distributors-and-the-smoothing-pool) вашего узла.

Чтобы проверить баланс вашего Fee Distributor, вы можете использовать обозреватель цепи, такой как [https://etherscan.io](https://etherscan.io), или просто выполнить `rocketpool node status` - там будет раздел **Fee Distributor and Smoothing Pool**, который показывает это:

```
=== Fee Distributor and Smoothing Pool ===
The node is not opted into the Smoothing Pool.
To learn more about the Smoothing Pool, please visit /ru/legacy/redstone/whats-new.html#smoothing-pool.
The node's fee distributor 0xA0bfbFC582f5814585f8455Ed6D7B620eA9a9EE4 has a balance of 1.143598 ETH.
```

### Распределение баланса

Чтобы получить доступ к балансу Fee Distributor, вы должны **распределить** его (отсюда и название, _Fee Distributor_).
Это рассчитает вашу долю вознаграждений (на основе средней комиссии minipool вашего узла) и отправит ее на адрес вывода вашего узла; остальное отправляется в стейкинг-пул.

Распределение может быть выполнено **в любое время**.
Вы можете сидеть на балансе и позволить ему накапливаться, если вы выберете, или распределять его регулярно.

Чтобы распределить баланс, выполните следующую команду:

```shell
rocketpool node distribute-fees
```

Это покажет, сколько идет вам и сколько идет в стейкинг-пул:

```
Your node's average commission is 15.00%.
Your fee distributor's balance of 1.143599 ETH will be distributed as follows:
 Your withdrawal address will receive 0.657569 ETH.
 rETH pool stakers will receive 0.486030 ETH.
```

Просто подтвердите цену газа, которую хотите, и отправьте транзакцию.
После завершения ваша часть вознаграждений будет доступна на адресе вывода вашего узла.
