import { Tab, Tabs } from "@rspress/core/theme";

::: danger ПРЕДУПРЕЖДЕНИЕ
Депозиты minipool в настоящее время отключены в рамках подготовки к Saturn 1.
:::

# Создание нового Minipool (Validator)

Напоминаем, что `minipool` в терминах Rocket Pool означает уникальный экземпляр смарт-контракта на уровне Execution Layer, которым управляет ваша нода.
Minipool обрабатывает часть ваших ETH, известную как **сумма залога**, и часть ETH из пула стейкинга rETH, известную как **заемная сумма**.
Он объединяет их вместе, чтобы сформировать 32 ETH в общей сложности, которые затем отправляются в контракт депозита Beacon Chain для создания нового validator.
Таким образом, чтобы создать validator с помощью Rocket Pool, вам необходимо **создать minipool**.

::: danger ПРЕДУПРЕЖДЕНИЕ
Создание minipool регулируется двумя очередями.

Первая - это очередь депозитов Rocket Pool, которая управляется протоколом Rocket Pool и определяет, когда ваш minipool получит заемные ETH. В пуле депозитов должны быть доступны ETH, чтобы сопоставить ваши 8 ETH с 24 ETH в пуле депозитов и создать minipool.

Вторая - это очередь Beacon Chain, которая управляется Ethereum Beacon Chain и определяет, когда ваш validator станет активным.

Обратите внимание, что время активации вашего minipool может сильно варьироваться в зависимости от вашей позиции в каждой очереди и текущего состояния сети.
:::

::: tip ПРИМЕЧАНИЕ
Время активации очереди validator Beacon Chain (и выхода) может сильно варьироваться в зависимости от текущего состояния сети.

Это находится вне контроля Rocket Pool и является функцией самого Beacon Chain.

Следующий инструмент предоставляет хорошую оценку того, как долго вам придется ждать:
[https://www.validatorqueue.com/](https://www.validatorqueue.com/)

Пожалуйста, ознакомьтесь с этим инструментом, чтобы получить представление о том, как долго вам придется ждать активации вашего validator.
:::

### Стейкинг RPL через сайт

Самый простой и безопасный способ застейкать RPL для вашей ноды - использовать функцию **Stake-on-Behalf** протокола, которая была
повторно введена с обновлением Atlas. Таким образом, вы можете застейкать RPL для вашей ноды, пока RPL все еще находится в кошельке,
который вы использовали для его приобретения. Другими словами, вам **не нужно отправлять RPL в горячий кошелек вашей ноды**, чтобы застейкать его.

#### Добавление адреса в белый список для стейкинга от имени

Чтобы застейкать от имени вашей ноды, адрес должен быть в белом списке. Ваш адрес для вывода средств всегда находится в белом списке,
и вы можете пропустить этот шаг, если ваш RPL хранится по адресу для вывода средств. Вам нужно добавить адрес в белый список только один раз,
чтобы стейкать с него. Вы можете сделать это с помощью следующей команды Smartnode:

```shell
rocketpool node add-address-to-stake-rpl-whitelist address-or-ens
```

Где `address-or-ens` - это адрес или имя ENS, которое разрешается в желаемый адрес. Вам будет предложено
подтвердить добавление в белый список, и после подтверждения транзакции вы можете перейти на соответствующую страницу ниже.

#### Стейкинг RPL от имени

Выберите, какую сеть вы используете, на вкладках ниже, чтобы перейти к ней:

<div className="p-3">
  <Tabs>
    <Tab label="Mainnet">[https://node.rocketpool.net/stake-rpl-on-behalf-of-node](https://node.rocketpool.net/stake-rpl-on-behalf-of-node)</Tab>
    <Tab label="Hoodi Testnet">[https://testnet.node.rocketpool.net/stake-rpl-on-behalf-of-node](https://testnet.node.rocketpool.net/stake-rpl-on-behalf-of-node)</Tab>
  </Tabs>
</div>

Начните с подключения вашего кошелька к сайту с помощью MetaMask, WalletConnect или любого из других методов, которые поддерживает сайт.
Затем вам будет представлен этот диалог для поиска адреса вашей ноды.

Введите адрес вашей ноды и нажмите "Lookup".

**Убедитесь, что у вас правильный адрес ноды, прежде чем делать это!**
Если вам нужно подтвердить адрес вашей ноды, вы можете быстро получить его через CLI с помощью команды `rocketpool node status`.

Это проверит, что адрес является зарегистрированной нодой и что нода добавила подключенный кошелек в белый список. Адреса для вывода средств находятся в белом списке по умолчанию, однако если вы хотите разрешить другие адреса, вам нужно будет добавить их в белый список с помощью следующей команды на вашей ноде.

```shell
rocketpool node add-address-to-stake-rpl-whitelist address-or-ens
```

Это двухэтапный процесс.

Сначала введите количество RPL, которое вы хотите застейкать, и нажмите `Approve` - это **одобрит** контракту стейкинга доступ к такому количеству RPL в вашем кошельке, но **не более этой суммы**.

::: tip СОВЕТ
Вы можете одобрить больше, чем сумма, которую вы собираетесь застейкать, если вы доверяете контракту стейкинга Rocket Pool и не хотите выполнять эту дополнительную транзакцию Approve каждый раз, когда захотите застейкать больше RPL.
:::

После того, как RPL одобрен, вы сможете застейкать от имени ноды.

Введите количество RPL, которое вы хотите застейкать, в поле `Stake RPL`, и введите адрес вашей ноды в поле `on behalf of Node Address`.

Когда вы введете эту информацию, нажмите кнопку `Stake` и одобрите транзакцию.

<video controls="controls" src="https://cdn-rocketpool.s3.us-west-2.amazonaws.com/stake_behalf.mp4" />

Она будет отправлена в сеть Ethereum, и как только она будет включена в блок, все готово!

Если вы запустите `rocketpool node status`, вы должны увидеть ваш застейканный RPL в разделе `=== RPL Stake ===`.

#### Удаление адреса из белого списка стейкинга

Если вы когда-либо захотите удалить адрес из вашего белого списка stake-on-behalf, вы можете сделать это с помощью следующей команды Smartnode:

```shell
rocketpool node remove-address-from-stake-rpl-whitelist address-or-ens
```

Где `address-or-ens` - это адрес или имя ENS, разрешающееся в адрес, который вы хотите удалить из белого списка.

### Стейкинг через CLI ноды

Если вы не можете (или не хотите) использовать сайт для стейкинга вашего RPL, вы также можете застейкать его через CLI ноды напрямую.

Сначала переведите ваш RPL с кошелька, с которого вы его приобрели, на адрес вашей ноды.

::: danger ПРЕДУПРЕЖДЕНИЕ
**Пожалуйста, делайте это осторожно и убедитесь, что вы отправляете RPL на адрес вашей ноды - переводы в Ethereum невозможно отменить!**
**Отправка RPL на неправильный адрес приведет к потере вашего RPL.**

Используйте команду `rocketpool node status`, чтобы проверить адрес вашей ноды, если вы не уверены, какой он.
:::

Выполните следующую команду:

```
rocketpool node stake-rpl
```

Вот вывод:

```
Please choose an amount of RPL to stake:
1: Your entire RPL balance (1440.000000 RPL)?
2: A custom amount
```

Выберите, сколько вы хотите застейкать, затем подтвердите операцию.

Первый раз, когда вы запустите эту команду, это будет включать две транзакции - одну для **одобрения** контракта стейкинга Rocket Pool для доступа к вашему RPL, и одну для **стейкинга** вашего RPL с ним.
Последующие запуски потребуют только транзакцию **stake**, так как токен уже был одобрен.

После завершения обеих транзакций вы можете проверить сумму застейканного RPL с помощью `rocketpool node status`.
Следующая часть вывода - это то, что вы хотите проверить:

```
The node has a total stake of 300.000000 RPL.
This is currently 29.76% of its borrowed ETH and 89.29% of its bonded ETH.
It can earn max apy on up to 151.209677 RPL (15% of borrowed ETH), and still earn at lower APY with more RPL.
```

Это покажет вам, сколько minipool вы можете создать для каждого размера залога на основе вашего обеспечения RPL.

## (Необязательно) Поиск пользовательского адреса для вашего Minipool

По умолчанию, когда вы создаете новый minipool, Rocket Pool сгенерирует случайный уникальный адрес для него.
Однако Smartnode предоставляет возможность поиска пользовательского **vanity-адреса** для minipool.

Vanity-адрес - это адрес, где вы лично выбираете символы, с которых начинается адрес.
Это чисто косметическое упражнение и не окажет никакого практического влияния на работу вашего minipool.
Поскольку адреса Ethereum находятся в шестнадцатеричной системе, допустимы следующие символы:

```
0 1 2 3 4 5 6 7 8 9 a b c d e f
```

В качестве нескольких примеров вы можете сделать так, чтобы адрес вашего minipool начинался с кучи нулей (`0x000000...`), `0x600d` (шестнадцатеричное значение для "good") или `0xa77e57ed` (шестнадцатеричное значение для "attested", подходящий префикс для minipool).

Чтобы найти такой vanity-адрес, вам нужно будет **поискать его**.
Этот процесс поиска включает выбор числа, применение его в качестве "соли" к алгоритму хеширования и сравнение результатов с тем, что вы ищете.
Результаты фактически случайны (хотя любая данная соль всегда производит один и тот же результат), поэтому единственный способ найти адрес с желаемым префиксом - попробовать множество и множество солей, пока вы не найдете соль, которая работает.

Если вы хотите получить пользовательский vanity-адрес для использования в вашем minipool при его создании, вы можете использовать следующую команду для поиска:

```
rocketpool minipool find-vanity-address
```

Это попросит вас указать префикс, который вы хотите найти, и спросит, какой тип депозита вы будете делать (депозит 16 ETH или 32 ETH - см. ниже для получения дополнительной информации об этих типах).
После того, как вы введете эту информацию, он начнет пробовать множество и множество солей, пока не найдет ту, которая производит желаемый префикс!

Вот полный пример процесса:

```
$ rocketpool minipool find-vanity-address
Please specify the address prefix you would like to search for (must start with 0x):
0xa77e57
Running with 12 threads.
Found on thread 3: salt 0x5cd7fb = 0xA77E57c892C9e98B0B81289e4AfdA62fb59c5DDD
Finished in 1.91145873s
```

В этом случае мы искали `0xa77e57` в качестве префикса и нашли соль `0x5cd7fb`, которая могла его сгенерировать.
На следующем шаге, когда мы создаем minipool, мы можем указать эту соль в качестве необязательного аргумента, чтобы создать новый minipool по адресу, связанному с солью (`0xA77E57c892C9e98B0B81289e4AfdA62fb59c5DDD`, как показано выше).

Как правило, каждый дополнительный символ, который вы ищете, умножит время поиска примерно на 16.
Из-за этого **мы рекомендуем искать префиксы только из 7 или 8 символов максимум, если у вас нет очень мощной машины с множеством ядер CPU**.
В противном случае поиск соли, которая производит желаемый префикс, может занять слишком много времени.

Например, AMD 5600x с 6 ядрами (12 потоками) на частоте 4.8 ГГц может искать около 3.2 миллиона солей в секунду.
В среднем потребуется несколько секунд, чтобы найти префикс из 6 символов, несколько минут для префикса из 7 символов и несколько часов для префикса из 8 символов.

::: tip ПРИМЕЧАНИЕ
Соль, которая генерируется, специфична для следующих переменных:

- Сеть, которую вы используете (либо Hoodi Testnet, либо Mainnet)
- Адрес ноды
- Сумма залога
- Соль

Если вы измените любую из этих переменных, адрес minipool для данной соли также изменится.
:::

Для более продвинутого использования (например, поиск другого адреса ноды или изменение количества ядер CPU, используемых для поиска), посмотрите справочный текст с помощью `rocketpool minipool find-vanity-address --help`.

## Внесение депозита ETH и создание Minipool

::: tip СОВЕТ
Если рыночная стоимость rETH выше, чем его обеспечение ETH (т.е. rETH торгуется с премией на рынке), существует возможность арбитража разницы при создании minipool.
Стоимость арбитража равна количеству ETH протокола в minipool, умноженному на премию (минус небольшое количество газа).
Например, если создавать minipool при премии 2.5%: `16 ETH * .025 = 0.4 ETH`.
Другими словами, вы можете получить обратно 0.4 ETH в этих условиях просто за создание minipool!

Если вы заинтересованы в использовании этой возможности, рассмотрите возможность использования разработанного сообществом инструмента [rocketarb](https://github.com/xrchz/rocketarb#readme) для получения прибыли от возможности MEV rETH арбитража, которую создает запуск вашего minipool.

Чтобы узнать больше о rocketarb, не стесняйтесь спрашивать об этом на [сервере Discord RP](https://discord.gg/rocketpool).
:::

После всего, что вы сделали до сих пор, вы наконец готовы внести свой ETH, создать новый minipool и создать validator Beacon Chain.
Это делается с помощью следующей команды:

```shell
rocketpool node deposit
```

::: danger ПРЕДУПРЕЖДЕНИЕ

Хотя CLI автоматизирует многие из следующих шагов для вас, мы <strong>настоятельно</strong> рекомендуем отслеживать вашу ноду и транзакции, чтобы обеспечить успешный переход из состояния `prelaunch` в `staking`.

Неудачные транзакции (из-за скорректированных настроек газа или недостаточного количества ETH) могут привести к переходу вашего minipool в состояние `dissolved`, чего вы хотите избежать.

[Узнайте больше о том, как подтвердить успешный стейкинг](./create-validator#confirming-a-successful-stake)

:::

::: tip ПРИМЕЧАНИЕ
Если вы хотите использовать соль для vanity-адреса, который вы нашли, используя процесс выше, вместо этого выполните следующую команду:

```shell
rocketpool node deposit --salt <your salt, e.g. 0x1234abcd>
```

:::

Сначала вы увидите примечание о том, что внесение депозита нового minipool **автоматически распределит** любой баланс в контракте [распределителя комиссий](./fee-distrib-sp) вашей ноды (используется для получения вознаграждений MEV, если вы не участвуете в [Smoothing Pool](./fee-distrib-sp#the-smoothing-pool)):

```
Your eth2 client is on the correct network.
NOTE: by creating a new minipool, your node will automatically claim and distribute any balance you have in your fee distributor contract. If you don't want to claim your balance at this time, you should not create a new minipool.
Would you like to continue? [y/n]
```

Если у вас уже есть minipool и баланс в вашем распределителе комиссий, вы можете решить не создавать еще один minipool, если распределение этого баланса вызывает налогооблагаемое событие в вашей юрисдикции.

После этого вы будете уведомлены о вашей ставке комиссии для нового minipool и примечании о том, может ли [кредитный баланс](./credit) вашей ноды быть использован для покрытия стоимости залога minipool для вас:

```
Your minipool will use the current fixed commission rate of 5.00%.
If you participate in the smoothing pool, your minipool will receive at least a 5% commission boost, and up to a 9% commission boost based on RPL stake.
You currently have 8.00 ETH in your credit balance.
This deposit will use 8.000000 ETH from your credit balance and will not require any ETH from your node.
```

Далее вам будут предложены текущие рекомендации по стоимости газа в сети; подтвердите выбор цены на газ и следуйте остальным подсказкам.

```
Your consensus client is synced, you may safely create a minipool.
+============== Suggested Gas Prices ==============+
| Avg Wait Time |  Max Fee  |    Total Gas Cost    |
| 15 Seconds    | 15 gwei   | 0.0244 to 0.0366 ETH |
| 1 Minute      | 10 gwei   | 0.0157 to 0.0235 ETH |
| 3 Minutes     | 7 gwei    | 0.0100 to 0.0150 ETH |
| >10 Minutes   | 6 gwei    | 0.0080 to 0.0120 ETH |
+==================================================+
These prices include a maximum priority fee of 2.00 gwei.
Please enter your max fee (including the priority fee) or leave blank for the default of 10 gwei:
Using a max fee of 10.00 gwei and a priority fee of 2.00 gwei.
You are about to deposit 8.000000 ETH to create a minipool with a minimum possible commission rate of 14.000000%.
ARE YOU SURE YOU WANT TO DO THIS? Exiting this minipool and retrieving your capital cannot be done until:
- Your minipool has been *active* on the Beacon Chain for 256 epochs (approx. 27 hours)
- The Shapella upgrade of the Ethereum network has been deployed
- The Atlas upgrade of the Rocket Pool protocol has been deployed
- Your minipool has been upgraded to use the Atlas delegate
 [y/n]
y
Creating minipool...
Transaction has been submitted with hash <transaction hash>.
You may follow its progress by visiting:
<link to transaction>
Waiting for the transaction to be included in a block... you may wait here for it, or press CTRL+C to exit and return to the terminal.
The node deposit of 8.000000 ETH was made successfully!
Your new minipool's address is: <new minipool address>
The validator pubkey is: <new validator public key>
Your minipool is now in Initialized status.
Once the remaining ETH has been assigned to your minipool from the staking pool, it will move to Prelaunch status.
After that, it will move to Staking status once 1h0m0s have passed.
You can watch its progress using `rocketpool service logs node`.
```

Обратите внимание, что создание minipool **является дорогой транзакцией**!
Обратите пристальное внимание на общую стоимость и убедитесь, что вы ее принимаете.

Если вы примете, создание вашего minipool будет запущено.
После завершения транзакции вам будет предоставлен адрес вашего нового контракта minipool на уровне Execution Layer и соответствующий публичный ключ validator на Beacon Chain.
Вы можете посетить их с помощью любых обозревателей блоков, если хотите.

## Подтверждение успешного стейкинга

После создания ваш minipool будет переведен в состояние `initialized`.
Он останется здесь, пока не настанет ваша очередь в очереди Rocket Pool получить 24 ETH из пула стейкинга, чтобы вы могли застейкать свой новый validator на Beacon Chain.

Когда это произойдет, ваш minipool перейдет в состояние `prelaunch` на определенный период времени (в настоящее время 12 часов).
Ваш депозит 8 ETH будет переведен в Beacon Chain, и Oracle DAO [проверит, что все правильно](https://github.com/rocket-pool/rocketpool-research/blob/master/Reports/withdrawal-creds-exploit.md).
В это время вы можете наблюдать за validator, ища его публичный ключ validator с помощью обозревателя Beacon Chain, такого как [https://beaconcha.in](https://beaconcha.in) (или [https://hoodi.beaconcha.in](https://hoodi.beaconcha.in) для Hoodi Testnet).

Вы можете проверить статус нового minipool с помощью команды `rocketpool minipool status`.
Например, когда он перешел в `prelaunch`, вы, вероятно, увидите что-то вроде этого:

```
1 Prelaunch minipool(s):
--------------------
Address:              <your minipool address>
Penalties:             0
Status updated:        2024-10-31, 04:51 +0000 UTC
Node fee:              5.000000%
Node deposit:          8.000000 ETH
RP ETH assigned:       2024-10-31, 04:51 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 31.000000 ETH
Your portion:          7.000000 ETH
Available refund:      0.000000 ETH
Total EL rewards:      7.000000 ETH
Validator pubkey:      <your validator public key>
Validator index:       0
Validator seen:        no
Use latest delegate:   no
Delegate address:      <your delegate address>
Rollback delegate:     <none>
Effective delegate:    <your delegate address>
0 finalized minipool(s):
```

После этого периода prelaunch ваш minipool войдет в статус `staking` и отправит дополнительный ETH из пула стейкинга в контракт депозита.
Это будет сделано контейнером Docker `rocketpool_node` (или службой `rp-node`, если вы использовали настройку Native) - если по какой-либо причине вы слишком долго переходите в статус `staking`, просмотр журналов для этого контейнера / службы, вероятно, скажет вам, что не так.
Вы можете проверить эти журналы с помощью команды `rocketpool service logs node` (или `/srv/rocketpool/node_log.sh` в настройках режима Native).

Выполнение `rocketpool minipool status` затем покажет что-то вроде этого:

```
$ rocketpool minipool status
1 Staking minipool(s):
--------------------
Address:              <your validator address>
Penalties:             0
RP ETH assigned:       2024-10-31, 05:53 +0000 UTC
Node fee:              5.000000%
Node deposit:          8.000000 ETH
RP ETH assigned:       2024-10-31, 04:51 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 0.000000 ETH
Your portion:          0.000000 ETH
Available refund:      0.000000 ETH
Total EL rewards:      0.000000 ETH
Validator pubkey:     <your validator public key>
Validator index:      <your validator index number>
Validator active:     yes
Validator balance:    32.018460 ETH
Expected rewards:     16.010614 ETH
Use latest delegate:  no
Delegate address:     <your delegate address>
Rollback delegate:    <none>
Effective delegate:   <your delegate address>
0 finalized minipool(s):
```

::: warning ПРИМЕЧАНИЕ
Транзакция для перехода из `prelaunch` в `staking` отправляется автоматически вашей нодой и подчиняется настройкам газа в `rocketpool service config`.
Если настройки газа не позволяют ноде отправить транзакцию или в кошельке ноды недостаточно ETH для оплаты транзакции, minipool станет `dissolved` через две недели после того, как он вошел в `prelaunch`.
Если это произойдет, восстановление баланса будет дорогостоящим и длительным процессом, поэтому обязательно внимательно следите за вашим minipool, пока он не достигнет статуса `staking`!
:::

Как только Beacon Chain примет оба депозита (один от вас и один из пула стейкинга), ваш validator войдет в очередь Beacon Chain, где он будет ждать своей очереди на активацию и начало стейкинга.

На этом этапе вы закончили!
Поздравляем!
Вы официально создали validator с Rocket Pool!

Взгляните на следующие разделы в разделе "Мониторинг и обслуживание", чтобы узнать, как отслеживать производительность и работоспособность вашего validator с течением времени.

## Создание нескольких Minipool

Удобно, что ваша нода Rocket Pool способна размещать столько minipool, сколько вы хотите.
Вам **не нужно** создавать новую ноду для каждого minipool.

Если вы хотите создать второй (или третий, или четвертый...) minipool для вашей ноды, все, что вам нужно сделать, это снова запустить `rocketpool node deposit`.
Кроме того, вы не сможете повторно использовать старую соль vanity-адреса - вам нужно будет найти другую уникальную для каждого из ваших minipool.

## Следующие шаги

Теперь, когда у вас есть minipool в работе, следующие шаги покажут вам, как отслеживать работоспособность вашей ноды, проверять наличие обновлений и применять их, а также обслуживать ее на протяжении всего срока службы.

**Пожалуйста, прочитайте раздел `Мониторинг и обслуживание` далее, чтобы узнать больше об этих темах.**
