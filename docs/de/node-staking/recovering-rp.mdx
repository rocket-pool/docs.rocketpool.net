import { Tab, Tabs } from "@rspress/core/theme";

# Importieren / Wiederherstellen einer bestehenden Wallet

Wenn Sie bereits eine Wallet haben, die Sie für Ihren Node verwenden möchten, oder wenn Sie eine Wallet wiederherstellen, die Sie zuvor mit dem Smartnode erstellt haben, hilft Ihnen diese Anleitung durch den Import- / Wiederherstellungsprozess.

Bitte wählen Sie die entsprechende Option aus den folgenden Abschnitten.

## Wiederherstellen einer Smartnode Wallet

Wenn Sie Ihre Node Wallet mit dem Smartnode generiert haben und sie einfach auf einer neuen Maschine wiederherstellen, ist der Prozess recht einfach.
Stellen Sie sicher, dass Sie die Smartnode-Software bereits installiert haben, und führen Sie dann einfach den folgenden Befehl aus, sobald sie installiert ist:

```shell
rocketpool wallet recover
```

::: warning HINWEIS
Wenn Sie aus irgendeinem Grund die Wallet wiederherstellen möchten, aber _nicht_ die Validator-Schlüssel, die mit den Minipools Ihres Nodes verbunden sind, können Sie das `-k`-Flag angeben, um den Rebuild-Prozess zu überspringen:

```shell
rocketpool wallet recover -k
```

Wenn Sie dieses Flag nicht angeben, versucht der Smartnode, die Validator-Schlüssel für Ihre Minipools wiederherzustellen. Beachten Sie jedoch, dass dies erst funktioniert, wenn Ihr Execution-Client die Synchronisierung abgeschlossen hat.
Bitte beobachten Sie die Logdatei, um zu sehen, wann dies abgeschlossen ist. Sobald dies der Fall ist, können Sie diesen Schritt ausführen.
:::

Dies wird Sie zuerst nach einem Passwort fragen, das Sie zum Verschlüsseln Ihrer Wallet verwenden möchten.
Danach werden Sie nach Ihrer **24-Wort-Wiederherstellungsphrase** gefragt.
Geben Sie sie sorgfältig ein - sie wird aus Sicherheitsgründen nicht auf dem Bildschirm angezeigt, und es ist sehr einfach, beim Tippen einen Fehler zu machen, also nehmen Sie sich Zeit.

Wenn Sie fertig sind, sollten Sie eine Ausgabe ähnlich dieser sehen:

```shell
$ rocketpool wallet recover

Please enter a password to secure your wallet with:

Please confirm your password:

Please enter your recovery mnemonic phrase:

Recovering node wallet...
The node wallet was successfully recovered.
Node account: <your wallet address>
No validator keys were found.
```

Wenn Sie keine Fehler sehen, wurden Ihre Wallet und Validatoren wiederhergestellt.

Sobald Sie fertig sind, stellen Sie sicher, dass Sie den Validator-Client mit dem folgenden Befehl für Docker- und Hybrid-Modus-Benutzer neu starten:

```shell
docker restart rocketpool_validator
```

**Native Mode**-Benutzer müssen einfach ihren Validator-Container-Prozess neu starten.

Dies stellt sicher, dass der VC alle neu wiederhergestellten Validator-Schlüssel aufnimmt.

## Importieren einer bestehenden Adresse als Node Wallet

Wenn Sie eine Adresse haben, die Sie für einen Node verwenden möchten, diese aber _nicht_ mit dem Smartnode erstellt haben (z.B. mit MetaMask oder einer Hardware-Wallet erstellt), dann folgen Sie diesem Abschnitt.

::: danger WARNUNG
Dadurch wird Ihre Adresse zu einer **Hot Wallet**.
Der private Schlüssel wird auf Ihrer Node-Maschine gespeichert.

Wenn Sie eine Adresse importieren, die eine Cold Wallet ist, wie z.B. eine Hardware-Wallet, beachten Sie, dass **der durch die Hardware-Wallet gebotene Schutz nicht mehr existiert!**

Wenn Sie diese Wallet für _irgendeine andere Kryptowährungsaktivität verwenden_, **müssen Sie alle ihre Mittel auf eine separate Adresse (z.B. eine andere Hardware-Wallet) übertragen, bevor Sie sie in Ihren Node importieren! Lassen Sie nur genug ETH auf dieser Adresse für die Gaskosten Ihres Nodes (normalerweise sind 0,5 ETH ausreichend).**

Bitte stellen Sie sicher, dass Sie Ihre Maschine so weit wie möglich gesichert haben, indem Sie die Schritte im [Absichern Ihres Nodes](./securing-your-node)-Leitfaden befolgen, bevor Sie Ihre Adresse als Node Wallet importieren.
:::

Diese Funktion ist nur mit Smartnode **v1.4.3 oder höher** verfügbar.
Wenn Sie eine niedrigere Version haben, müssen Sie zuerst upgraden.

Dies ist ein mehrstufiger Prozess, also folgen Sie den folgenden Abschnitten sorgfältig.

### Schritt 1: Extern generierte Validator-Schlüssel hinzufügen

**Wenn Sie keine bestehenden Minipools an die Adresse angehängt haben, die Sie importieren, können Sie diesen Schritt überspringen.**

Wenn Ihre Adresse bereits als Rocket Pool Node Wallet registriert wurde (z.B. über einen Dienst wie **Allnodes**) und bereits aktive Minipools hat, und Sie diese zusammen mit Ihrer Adresse in den Smartnode-Stack importieren möchten, müssen Sie die privaten Keystore-Dateien für jeden ihrer entsprechenden Validatoren bereitstellen.
Diese Dateien werden mit einem Passwort Ihrer Wahl verschlüsselt, daher benötigen Sie auch dieses Passwort für jede Datei.

Sie müssen diese Dateien vom Dienst erhalten, der derzeit Ihren Node betreibt, um ihn zu importieren.
Einige Dienstanbieter können diese Dateien möglicherweise auf Anfrage abrufen.
Wenn Sie Allnodes verwenden, können Sie diese Dateien während Ihres anfänglichen Einrichtungsprozesses erhalten, aber **Sie werden sie in Zukunft nicht mehr abrufen können, es sei denn, Sie haben sie während der Minipool-Erstellung gespeichert.**

Wählen Sie Ihren Installationsmodus und folgen Sie den folgenden Schritten.

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Stellen Sie zunächst sicher, dass Sie den Smartnode mit `rocketpool service start` gestartet haben.
      Dies erstellt einen speziellen Ordner, der verwendet werden kann, um die verschlüsselten Keystore-Dateien für Ihre Validatoren zu speichern.

      Standardmäßig befindet sich der Ordner unter `~/.rocketpool/data/custom-keys`.
      Wenn Sie Ihre Installation oder Datenverzeichnisse angepasst haben, ersetzen Sie entsprechend, um den `custom-keys`-Ordner zu finden.

      Überprüfen Sie mit einem Datei-Explorer oder dem `ls`-Befehl, ob dieser Ordner existiert.
      Falls nicht, kein Problem - erstellen Sie den Ordner einfach mit folgendem Befehl:

      ```shell
      mkdir ~/.rocketpool/data/custom-keys
      ```
    </Tab>
    <Tab label="Native Mode">
      Erstellen Sie einen Ordner namens `custom-keys` innerhalb des `data`-Ordners Ihres Smartnodes (zum Beispiel `/srv/rocketpool/data/custom-keys`).
    </Tab>

  </Tabs>
</div>

Als Nächstes platzieren Sie jede der Validator-Keystore-Dateien in diesem Ordner.
Die Namen der Dateien sind nicht wichtig, aber sie müssen JSON-Dateien sein, die dem [EIP-2335](https://eips.ethereum.org/EIPS/eip-2335#scrypt-test-vector)-Format entsprechen.

Der Smartnode wird in diesem Verzeichnis nach allen Keystore-Dateien suchen, die Sie hier in den nächsten Schritten platziert haben.

::: warning HINWEIS
Der Importprozess wird _nur_ nach Validator-Schlüsseln suchen, die an Minipools angehängt sind, die auf die Adresse registriert sind, die Sie importieren.
Sie **können** diesen Prozess **nicht** verwenden, um andere Validator-Schlüssel, wie z.B. für Solo-Staking-Validatoren, in den vom Smartnode-Stack verwalteten Validator-Client zu importieren.

Bitte sehen Sie sich die Dokumentation für den Betrieb im [Reverse Hybrid Mode](./advanced-config#allowing-external-validator-clients-to-connect-to-the-smartnode) an, wenn Sie daran interessiert sind.
:::

### Schritt 2 (Optional): Testen des Imports der Adresse

Wenn Sie den Wiederherstellungsprozess testen möchten, um sicherzustellen, dass Sie die richtige Mnemonic und Passwörter haben, **ohne tatsächlich den privaten Schlüssel Ihrer Node Wallet zu regenerieren oder Ihre Validator-Schlüssel zu importieren**, können Sie dies mit folgendem Befehl tun:

```shell
rocketpool wallet test-recovery -a 0x1234abcd...
```

Wobei `0x1234abcd...` die Adresse ist, die Sie importieren möchten, beginnend mit dem `0x`-Präfix.
**Sie benötigen Ihre Mnemonic-Phrase, um den privaten Schlüssel für Ihre Adresse zu importieren.**

::: tip TIPP
Wenn Sie aus irgendeinem Grund die Wallet wiederherstellen möchten, aber _nicht_ die Validator-Schlüssel für Ihre Minipools, können Sie das `-k`-Flag angeben, um den Validator-Schlüssel-Wiederherstellungsprozess zu überspringen.
Zum Beispiel:

```shell
rocketpool wallet test-recovery -a 0x1234abcd... -k
```

:::

Der Smartnode wird automatisch durch die beliebtesten Ableitungspfade (z.B. die von Ledger Live, MyEtherWallet, Trezor und dem Smartnode-Stack verwendeten) und Adressindizes suchen, um die Einstellungen zu finden, die der von Ihnen angegebenen Adresse entsprechen.

::: tip TIPP
Wenn Sie einen benutzerdefinierten Ableitungspfad haben, verwenden Sie das `-d`-Flag, um ihn anzugeben.
Zum Beispiel:

```shell
rocketpool wallet test-recovery -d "m/44'/60'/0'/%d"
```

Verwenden Sie `%d` für den Teil des Pfads, der iteriert werden kann, um verschiedene Indizes zu verwenden.

Wenn Sie einen benutzerdefinierten Adressindex haben, verwenden Sie das `-i`-Flag, um ihn anzugeben.
Zum Beispiel, wenn Ihre Adresse die 6. auf dem Standard-Ableitungspfad war, könnten Sie verwenden:

```shell
rocketpool wallet test-recovery -i 5
```

Sie können beide Flags `-d` und `-i` gleichzeitig verwenden, wenn Sie dies benötigen.
:::

Zuerst werden Sie nach der Mnemonic-Phrase Ihrer Adresse gefragt:

```
Please enter the number of words in your mnemonic phrase (24 by default):
24

Enter Word Number 1 of your mnemonic:
```

Geben Sie sie sorgfältig ein, und der Smartnode wird beginnen, durch alle Standardoptionen zu suchen, um sie zu finden (es sei denn, Sie haben sie explizit mit den `-d`- und/oder `-i`-Flags angegeben).

Als Nächstes, wenn Sie private Keystore-Dateien aus Schritt 1 zum Importieren haben, werden Sie nach den Passwörtern für jede dieser Keystore-Dateien gefragt:

```
It looks like you have some custom keystores for your minipool's validators.
You will be prompted for the passwords each one was encrypted with, so they can be loaded into the Validator Client that Rocket Pool manages for you.

Please enter the password that the keystore for <validator pubkey> was encrypted with:
```

Sie werden nach **Pubkey**-Liste organisiert, **nicht nach Dateinamen**.
Stellen Sie sicher, dass Sie wissen, welche Datei zu welchem Validator-Pubkey gehört, damit Sie die richtigen Passwörter eingeben.

Sobald Sie dies getan haben, wird der Test-Wiederherstellungsprozess fortgesetzt und meldet, ob er erfolgreich war oder fehlgeschlagen ist:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

Das oben Genannte zeigt eine erfolgreiche Test-Wiederherstellung an.

### Schritt 3: Importieren der Adresse

::: danger WARNUNG
Wenn Ihre Adresse ein Rocket Pool Node ist, der _nicht_ von Ihrem eigenen selbst gehosteten Smartnode verwaltet wird (z.B. von einem externen Dienst wie **Allnodes** gehostet), **IST ES KRITISCH**, dass Sie sich mit dem Dienst, der Ihren Node betreibt, abstimmen, **bevor Sie diesen Importprozess beginnen**, und ihnen mitteilen, dass Sie zu Ihrem eigenen selbst gehosteten System migrieren möchten.

Sie **MÜSSEN BESTÄTIGEN**, dass sie die Validierung für Ihren Node heruntergefahren haben und sie **NIEMALS wieder aufnehmen werden**, und manuell bestätigen, dass Ihre Validatoren nicht mehr attestieren, indem Sie einen Blockchain-Explorer wie [https://beaconcha.in](https://beaconcha.in) verwenden.
Sie müssen bestätigen, dass jeder Validator **MINDESTENS 2 ATTESTATIONEN** verpasst hat, um sicherzustellen, dass Sie sicher migrieren können.
Andernfalls werden beide gleichzeitig attestieren und **IHRE MINIPOOLS WERDEN GESLASHT!**

Der Smartnode wird verlangen, dass Sie dies bestätigen, bevor er Ihnen erlaubt, mit dem Importprozess fortzufahren.
:::

Wenn die Test-Wiederherstellung erfolgreich war oder wenn Sie sie übersprungen haben, werden Sie als Nächstes die Wallet importieren und alle zugehörigen Schlüsseldateien regenerieren.
Der Prozess ist genau derselbe wie oben, aber verwenden Sie den `recover`-Befehl anstelle des `test-recovery`-Befehls:

```shell
rocketpool wallet recover -a 0x1234abcd...
```

Wenn Sie diesen Befehl ausführen, werden Sie zuerst nach einem Passwort gefragt, um Ihre importierte Node Wallet zu verschlüsseln.

```
Please enter a password to secure your wallet with:

Please confirm your password:
```

Danach werden die Mnemonic- und benutzerdefinierten Validator-Keystore-Passwort-Eingabeaufforderungen wie zuvor fortgesetzt.

Sobald Sie all diese Informationen eingegeben haben, wird der Smartnode Ihre Adresse wiederherstellen und (falls nicht deaktiviert) die benutzerdefinierten Validator-Schlüssel für Ihre Minipools:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

Der private Schlüssel Ihrer Adresse wird jetzt in der Datei `data/wallet` gespeichert (z.B. `~/.rocketpool/data/wallet`), und das Passwort dafür wird in der Datei `data/password` gespeichert (z.B. `~/.rocketpool/data/password`).

Die privaten Schlüssel für jeden Ihrer Validatoren werden in den `data/validators`-Ordnern für jeden der Consensus-Clients gespeichert, die der Smartnode unterstützt.

::: danger HINWEIS
Durch das Importieren einer Adresse auf diese Weise wurden die Validator-Schlüssel **nicht** von Ihrer Node Wallet abgeleitet, und daher **können sie später nicht einfach durch Ausführen von `rocketpool wallet recover` wiederhergestellt werden**, wie bei einer normalen Node Wallet.

Wenn Sie diese Wallet jemals wiederherstellen oder importieren müssen, müssen Sie denselben Prozess befolgen, was bedeutet, dass **Sie diese Validator-privaten Keystores und ihre Passwörter irgendwo sicher gesichert haben müssen.**

Wenn Sie sie jemals verlieren, **können Sie diese Validator-Schlüssel nicht mehr wiederherstellen!**
:::

### Schritt 4: Aufräumen

An diesem Punkt können Sie nun alle privaten Keystore-Dateien im `data/custom-keys`-Verzeichnis löschen.
Der Smartnode wird sie bereits importiert und ihnen zufällige Passwörter zugewiesen haben, sodass diese Keystore-Dateien nicht mehr erforderlich sind.

Stellen Sie schließlich sicher, dass sich **keine** Datei namens `custom-key-passwords` in Ihrem `data`-Verzeichnis befindet (z.B. `~/.rocketpool/data/custom-key-passwords`).
Der Smartnode wird diese temporäre Datei nur während des Wiederherstellungsprozesses erstellen und sie automatisch entfernen, unabhängig davon, ob der Wiederherstellungsprozess erfolgreich war oder nicht. Falls er sie aus irgendeinem Grund nicht entfernen konnte, wird er Sie in der Konsolenausgabe darauf hinweisen.
Es schadet jedoch nie, zu vorsichtig zu sein.

## Nächste Schritte

Sobald Sie Ihre Node Wallet importiert oder wiederhergestellt haben, folgen Sie den nächsten Schritten im [Intro zur Kommandozeilenschnittstelle](./cli-intro)-Leitfaden.
