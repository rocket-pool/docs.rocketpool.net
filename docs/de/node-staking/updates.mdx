import { Tab, Tabs } from "@rspress/core/theme";
import tuiEcContainerTag from "./images/tui-ec-container-tag.png";
import tuiCcContainerTag from "./images/tui-cc-container-tag.png";

# Auf Updates prüfen

Eine der Verantwortlichkeiten eines Node Operators ist sicherzustellen, dass Ihr System mit den neuesten Sicherheitspatches auf dem neuesten Stand ist.
Automatische Updates sind praktisch, können aber den Betrieb Ihres Nodes beeinträchtigen, daher kann es vorzuziehen sein, sie manuell auszuführen.
In jedem Fall **müssen Sie sicherstellen, dass Ihre Maschine regelmäßig gepatcht wird!**

::: tip HINWEIS
In den meisten Fällen erfordert ein Update keine Ausfallzeit von mehr als einigen Minuten.
Sie könnten besorgt sein, dass eine solche Ausfallzeit Ihr Beacon Chain Guthaben negativ beeinflusst.
Seien Sie versichert, die Strafe für eine so kurze Offline-Zeit ist **völlig vernachlässigbar**.

Jede verpasste Attestierung bestraft Sie mit etwas weniger als dem Betrag, den Sie für eine erfolgreiche Attestierung verdienen würden.
Als Faustregel gilt: Wenn Sie eine Stunde offline sind, verdienen Sie alles wieder zurück, nachdem Sie eine Stunde lang wieder online sind.

Beachten Sie auch, dass es **absolut keine Chance** gibt, dass Sie durch kurzes Offline-Gehen _geslasht_ werden.
Slashing tritt nur auf, wenn Sie das Netzwerk angreifen, und Offline-Gehen für Wartungsarbeiten zählt nicht als Angriff auf das Netzwerk.

**Bitte halten Sie Ihre Systeme auf dem neuesten Stand - machen Sie sich keine Sorgen über die Ausfallzeitstrafen!**
:::

## Aktualisierung Ihres Betriebssystems

Sie sollten häufig den Paketmanager oder Update-Dienst Ihres Betriebssystems überprüfen, um sicherzustellen, dass Sie neue wichtige Sicherheitspatches schnell anwenden.
Die genauen Anweisungen variieren für jedes Betriebssystem und können in der Dokumentation Ihres Systems gefunden werden, aber hier sind einige Beispiele.

<div className="p-3">
  <Tabs>
    <Tab label="Ubuntu">
      Geben Sie in einem Terminal Folgendes ein:

      ```shell
      sudo apt update
      ```

      Dies greift auf die Paketserver zu und überprüft, ob für eines Ihrer installierten Pakete neue Versionen verfügbar sind.
      Wenn Updates verfügbar sind, sieht die Ausgabe so aus:

      ```
      Fetched 3974 kB in 2s (1641 kB/s)
      Reading package lists... Done
      Building dependency tree
      Reading state information... Done
      12 packages can be upgraded. Run 'apt list --upgradable' to see them.
      ```

      Sie können die Updates mit folgendem Befehl installieren:

      ```shell
      sudo apt dist-upgrade
      ```

      Dies zeigt Ihnen die Liste der Pakete, die aktualisiert werden sollen, und wenn die Gesamtinstallationsgröße groß genug ist, zeigt es Ihnen die Größe an und fordert Sie auf zu bestätigen, dass Sie akzeptieren:

      ```
      12 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
      Need to get 51.3 MB of archives.
      After this operation, 52.2 kB of additional disk space will be used.
      Do you want to continue? [Y/n]
      ```

      Stellen Sie sicher, dass Sie genügend Speicherplatz zur Verfügung haben, drücken Sie dann `y` und `Enter`, um den Update-Prozess zu starten.

      Sobald der Fortschrittsbalken fertig ist und Sie zurück zur Terminal-Eingabeaufforderung gelangen, führen Sie folgenden Befehl aus, um alte Versionen von Paketen aufzuräumen, die gerade ersetzt wurden:

      ```shell
      sudo apt autoremove
      ```

      Prüfen Sie als Nächstes, ob Ihr System neu gestartet werden muss:

      ```shell
      cat /var/run/reboot-required
      ```

      Wenn der obige Befehl `No such file or directory` ausgibt, ist kein Neustart erforderlich und Sie können den folgenden Schritt überspringen.

      Wenn der Befehl jedoch `*** System restart required ***` ausgibt, sollten Sie Ihre Maschine neu starten, um die Updates abzuschließen, sobald es Ihnen möglich ist:

      ```shell
      sudo reboot
      ```

      Rocket Pool wird ordnungsgemäß heruntergefahren und automatisch mit dem System wieder hochfahren, sobald es neu gestartet wird.
    </Tab>
    <Tab label="MacOS">
      Um die OS-Pakete zu aktualisieren, verwenden Sie die Benutzeroberfläche, um `Apple -> Software-Update` auszuwählen.

      Um Pakete selbst zu aktualisieren, ist der einfachste Weg über `homebrew` im Terminal:

      ```shell
      brew update && brew upgrade
      ```
    </Tab>

  </Tabs>
</div>

## Aktualisierung des Smartnode Stacks

Gelegentlich wird Rocket Pool eine neue Version des Smartnode Stacks veröffentlichen.
Updates können neue Versionen der CLI oder der Rocket Pool Docker-Container sowie neue Versionen der Execution und Consensus Clients enthalten.

Der zuverlässigste Weg, um über neue Releases informiert zu werden, ist das Abonnement des Rocket Pool Discord-Servers; sie werden immer im Releases-Kanal gepostet und Sie erhalten eine Benachrichtigung.

::: warning HINWEIS
Beachten Sie, dass das Ausführen von `apt update` die Node-Software nicht aktualisiert.
Dies muss manuell mit den folgenden Schritten erfolgen.
:::

::: tip TIPP
Wenn Sie das Smartnode-Upgrade abgeschlossen haben, wird das Grafana-Dashboard weiterhin anzeigen, dass ein Update verfügbar ist.
Es wird automatisch innerhalb eines Tages gelöscht, wenn das System das nächste Mal automatisch nach Updates sucht.

Wenn Sie es sofort nach dem Update löschen möchten, führen Sie einfach aus:
`sudo apt update`
:::

::: tip TIPP
Wenn Sie Ihre CPU-Architektur nicht kennen, können Sie den folgenden Befehl ausführen, um sie herauszufinden:

```shell
uname -m
```

Die Ausgabe dieses Befehls gibt Ihre Architektur aus.
**Beachten Sie, dass `x86_64` dasselbe ist wie `x64` und `amd64`.**
**Beachten Sie, dass `aarch64` dasselbe ist wie `arm64`.**
:::

Die Schritte zum Upgrade hängen davon ab, welchen Modus Ihr Node verwendet. Wählen Sie aus den folgenden Optionen:

<div className="p-3">
  <Tabs>
    <Tab label="Linux (Docker oder Hybrid-Modus)">
      Stoppen Sie die Rocket Pool Dienste:

      ```shell
      rocketpool service stop
      ```

      Laden Sie die neue Smartnode CLI herunter:

      Für `x64`-Systeme (die meisten normalen Maschinen):

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool
      ```

      Für `arm64`-Systeme:

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool
      ```

      Führen Sie nun den Installationsbefehl aus:

      ```shell
      rocketpool service install -d
      ```

      Das `-d`-Flag weist ihn an, Systemabhängigkeiten wie Docker zu ignorieren, da Sie diese bereits haben.

      Wenn Sie sehen möchten, was sich geändert hat, öffnen Sie den Settings Manager - die Review-Seite zeigt Ihnen, was neu ist:

      ```shell
      rocketpool service config
      ```

      Wenn Sie fertig sind, starten Sie Rocket Pool wieder:

      ```shell
      rocketpool service start
      ```

      Überprüfen Sie schließlich die Version, um sicherzustellen, dass sowohl CLI als auch Smartnode Stack auf dem neuesten Stand sind:

      ```shell
      rocketpool service version
      ```

      Die Ausgabe sollte ungefähr so aussehen:

      ```
      Your Smartnode is currently using the Hoodi Test Network.

      Rocket Pool client version: 1.5.0
      Rocket Pool service version: 1.5.0
      Selected Eth 1.0 client: Geth (Locally managed)
      Image: ethereum/client-go:v1.10.21
      Selected Eth 2.0 client: Lighthouse (Locally managed)
      Image: rocketpool/lighthouse:mevboost-5ee3bc5
      ```

      Sowohl Client als auch Service sollten mit der neuen Release-Version übereinstimmen.
    </Tab>
    <Tab label="Linux (Native-Modus)">
      <p className="rspress-directive warning">
        <p className="rspress-directive-title">HINWEIS</p>
        Dies aktualisiert nur den Smartnode Stack selbst - es aktualisiert **nicht** Ihre Execution oder Consensus Clients.
        Sie müssen dies manuell tun (siehe den nächsten Abschnitt unten).
      </p>

      Stoppen Sie die Rocket Pool Dienste:

      ```shell
      sudo systemctl stop rp-node rp-watchtower
      ```

      Laden Sie die neue Smartnode CLI herunter und sichern Sie die alten CLI- und Daemon-Binaries, falls Sie sie zurückbringen müssen:

      Für `x64`-Systeme (die meisten normalen Maschinen):

      ```shell
      sudo mv /usr/local/bin/rocketpool /usr/local/bin/rocketpool_bak

      sudo mv /usr/local/bin/rocketpoold /usr/local/bin/rocketpoold_bak

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-amd64 -O /usr/local/bin/rocketpool

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-daemon-linux-amd64 -O /usr/local/bin/rocketpoold

      sudo chmod +x /usr/local/bin/rocketpool /usr/local/bin/rocketpoold
      ```

      Für `arm64`-Systeme:

      ```shell
      sudo mv /usr/local/bin/rocketpool /usr/local/bin/rocketpool_bak

      sudo mv /usr/local/bin/rocketpoold /usr/local/bin/rocketpoold_bak

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-arm64 -O /usr/local/bin/rocketpool

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-daemon-linux-arm64 -O /usr/local/bin/rocketpoold

      sudo chmod +x /usr/local/bin/rocketpool /usr/local/bin/rocketpoold
      ```

      Wenn Sie sehen möchten, was sich geändert hat, öffnen Sie den Settings Manager - die Review-Seite zeigt Ihnen, was neu ist:

      ```shell
      rp service config
      ```

      Wenn Sie fertig sind, starten Sie Rocket Pool wieder:

      ```shell
      sudo systemctl start rp-node rp-watchtower
      ```

      Überprüfen Sie schließlich die Version, um sicherzustellen, dass sowohl CLI als auch Smartnode Stack auf dem neuesten Stand sind:

      ```
      rocketpool service version

      Rocket Pool client version: 1.0.0-rc3
      Rocket Pool service version: 1.0.0-rc3
      Selected Eth 1.0 client: Geth (rocketpool/client-go:v1.10.4)
      Selected Eth 2.0 client: Nimbus (statusim/nimbus:v1.4.0)
      ```

      Sowohl Client als auch Service sollten mit der neuen Release-Version übereinstimmen.
    </Tab>
    <Tab label="macOS (Docker oder Hybrid-Modus)">
      Stoppen Sie die Rocket Pool Dienste:

      ```shell
      rocketpool service stop
      ```

      Laden Sie die neue Smartnode CLI herunter:

      Für `x64`-Systeme (die meisten Macs):

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-amd64 -O /usr/local/bin/rocketpool
      ```

      Für `arm64`-Systeme, wie den Mac mini mit M1:

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-arm64 -O /opt/homebrew/bin/rocketpool
      ```

      Führen Sie nun den Installationsbefehl aus:

      ```shell
      rocketpool service install -d
      ```

      Das `-d`-Flag weist ihn an, Systemabhängigkeiten wie Docker zu ignorieren, da Sie diese bereits haben.

      Wenn Sie sehen möchten, was sich geändert hat, öffnen Sie den Settings Manager - die Review-Seite zeigt Ihnen, was neu ist:

      ```shell
      rocketpool service config
      ```

      Wenn Sie fertig sind, starten Sie Rocket Pool wieder:

      ```shell
      rocketpool service start
      ```

      Überprüfen Sie schließlich die Version, um sicherzustellen, dass sowohl CLI als auch Smartnode Stack auf dem neuesten Stand sind:

      ```shell
      rocketpool service version

      Rocket Pool client version: 1.0.0-rc3
      Rocket Pool service version: 1.0.0-rc3
      Selected Eth 1.0 client: Geth (rocketpool/client-go:v1.10.4)
      Selected Eth 2.0 client: Nimbus (statusim/nimbus:v1.4.0)
      ```

      Sowohl Client als auch Service sollten mit der neuen Release-Version übereinstimmen.

    </Tab>

  </Tabs>
</div>

## Manuelles Aktualisieren des Execution oder Consensus Clients

Jede neue Version des Smartnode Stacks enthält aktualisierte Referenzen auf die neuesten kompatiblen Versionen der Execution und Consensus Docker-Container.
In einigen Fällen möchten Sie jedoch möglicherweise einen dieser Clients aktualisieren, _bevor_ Sie auf eine neue Smartnode Stack-Version warten.
Dieser Abschnitt zeigt Ihnen, wie Sie genau das tun.

<div className="p-3">
  <Tabs>
    <Tab label="Docker-Modus">
      Das Aktualisieren auf neue Client-Versionen ist im Docker-Modus einfach.

      Öffnen Sie zunächst den Settings Manager:

      ```shell
      rocketpool service config
      ```

      Um die Execution Client-Version zu ändern, gehen Sie zur Kategorie **Execution Client**.
      Ändern Sie die Einstellung **Container Tag**:

      <img src={tuiEcContainerTag} width="100%" height="auto"/>

      Um die Consensus Client-Version zu ändern, gehen Sie zur Kategorie **Consensus Client**.
      Ändern Sie die Einstellung **Beacon Node Container Tag**:

      <img src={tuiCcContainerTag} width="100%" height="auto"/>

      Wenn Sie mit Ihren Änderungen zufrieden sind, speichern und beenden Sie wie gewohnt.
      Der Smartnode wird anbieten, alle betroffenen Container automatisch neu zu starten.
    </Tab>
    <Tab label="Native-Modus">
      Fahren Sie zunächst Ihren Execution Client, Beacon Node und/oder Validator Client Service herunter, je nachdem, was Sie aktualisieren möchten.
      Zum Beispiel, Herunterfahren von Geth:

      ```shell
      sudo systemctl stop geth
      ```

      Als Nächstes laden Sie die neueste Binärversion vom Anbieter Ihres Clients herunter (oder bauen Sie sie aus dem Quellcode) und ersetzen Sie die alte Binärdatei durch die neue.
      Wir empfehlen, dass Sie **die alte Binärdatei an einen Backup-Speicherort verschieben**, anstatt sie zu überschreiben, nur für den Fall, dass der neue Client Probleme hat.

      Starten Sie schließlich den Client-Dienst wieder - zum Beispiel, Starten von Geth:

      ```shell
      sudo systemctl start geth
      ```

      Sie sollten die Log-Skripte nach dem Upgrade genau verfolgen, um sicherzustellen, dass der neue Client wie erwartet funktioniert.
    </Tab>

  </Tabs>
</div>
