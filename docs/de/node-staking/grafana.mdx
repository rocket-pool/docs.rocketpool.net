import { Tab, Tabs } from "@rspress/core/theme";

# Einrichten des Grafana Dashboards

Jetzt, da Ihr Node läuft, möchten Sie wahrscheinlich eine bequeme Möglichkeit haben, alles auf einen Blick zu überwachen, um sicherzustellen, dass er korrekt funktioniert (und welche Art von Einnahmen er für Sie generiert).

Es gibt viele Tools, die diese Aufgabe erfüllen.
Eines der beliebtesten heißt [Grafana](https://grafana.com/) - ein benutzerfreundliches, universelles Dashboard-System, auf das Sie mit einem Browser zugreifen können.

Rocket Pool wird out-of-the-box mit Unterstützung für Grafana und seine Abhängigkeiten geliefert; es wird sogar mit einem vorgefertigten Dashboard für jeden Consensus Client geliefert.
Hier ist zum Beispiel ein Snapshot, wie das Dashboard im Hoodi-Testnetzwerk aussieht:

![](./images/grafana-1.3.jpg)

Das Standard-Dashboard enthält die folgenden Informationen in einem praktischen Format:

- **Oben links:** einige wichtige Statistiken über die Gesundheit und Leistung Ihrer Maschine und alle ausstehenden Systemupdates
- **Oben rechts:** die Aktivität und Leistung Ihrer Validatoren auf der Beacon Chain, zusammen mit einigen Execution und Consensus Client Statistiken
- **Unten links:** Details über das gesamte Rocket Pool Netzwerk, als Referenz
- **Unten rechts:** Details über Ihre Staking-Belohnungen, sowohl ETH als auch RPL

In diesem Leitfaden zeigen wir Ihnen, wie Sie das Metriken-System von Rocket Pool aktivieren, damit Sie dieses Dashboard verwenden können - oder sogar Ihr eigenes erstellen!

## Übersicht über den Rocket Pool Metrics Stack

Wenn Sie sich während des Smartnode-Konfigurationsprozesses dafür entscheiden, Metriken zu aktivieren, fügt Ihr Node die folgenden Prozesse hinzu:

- [Prometheus](https://prometheus.io/) - ein Datenerfassungs-, Speicher- und Berichtssystem, das alle oben genannten Metriken (und viele mehr) erfasst und speichert, damit sie im Laufe der Zeit betrachtet werden können
- Der Prometheus [Node Exporter](https://github.com/prometheus/node_exporter) - ein Dienst, der Informationen über die Gesundheit Ihrer Maschine sammelt (wie CPU-Auslastung, RAM-Auslastung, freier Festplattenspeicher und Swap-Speicher usw.) und an Prometheus meldet
- Grafana, das Tool, das die Daten von Prometheus über eine praktische Website auf Ihrem Node verfügbar macht
- Ein optionales benutzerdefiniertes Set von Skripten, das alle verfügbaren Betriebssystem-Updates an Prometheus meldet, damit Sie wissen, ob Ihr System gepatcht werden muss

Die Standardkonfiguration erstellt Docker-Container mit all diesen Diensten, die neben den restlichen Docker-Containern der Smartnode leben.
Sie öffnet einen Port auf Ihrer Node-Maschine für Grafana, damit Sie von jedem Gerät in Ihrem lokalen Netzwerk mit einem Browser auf das Dashboard zugreifen können.

## Aktivieren des Metrics Server

<div className="p-3">
  <Tabs>
    <Tab label="Docker">
      Die Aktivierung von Metriken im Docker-Modus ist am einfachsten.

      Führen Sie zunächst den Smartnode-Konfigurationsbefehl erneut aus:

      ```shell
      rocketpool service config
      ```

      Gehen Sie zum Abschnitt `Monitoring / Metrics` und aktivieren Sie das Kontrollkästchen `Enable Metrics`.

      Für diejenigen, die ihre Port-Einstellungen feinabstimmen möchten, können Sie dies hier tun.
      Beachten Sie, dass alle diese Ports auf das interne Docker-Netzwerk beschränkt sind, mit Ausnahme des Grafana-Ports - dieser wird auf Ihrer Maschine geöffnet (damit Sie von anderen Geräten wie Ihrem Desktop oder Telefon mit einem Browser darauf zugreifen können), daher möchten Sie dies möglicherweise ändern, wenn der Standardport mit etwas kollidiert, das Sie bereits haben.

      Speichern und beenden Sie, und die Smartnode startet die Prometheus-, Node Exporter- und Grafana-Docker-Container für Sie.

      Sie modifiziert auch Ihre Consensus und Validator Clients, damit sie ihre eigenen Metriken an Prometheus weitergeben.

      Der Betriebssystem- und Rocket Pool Update-Tracker ist **standardmäßig nicht installiert** für maximale Flexibilität, aber der Prozess ist einfach.
      Wenn Sie ihn installieren möchten, damit Ihr Dashboard Ihnen anzeigt, wie viele Updates für Ihr System verfügbar sind, können Sie dies mit diesem Befehl tun:

      ```shell
      rocketpool service install-update-tracker
      ```

      Unter der Haube installiert dies einen Dienst, der sich in den Paketmanager Ihres Betriebssystems einhängt, regelmäßig nach Updates sucht und diese Informationen an Prometheus sendet.
      Dieser Dienst ist für jedes Betriebssystem unterschiedlich, aber es wurde bestätigt, dass er auf folgenden funktioniert:

      - Ubuntu 20.04+
      - Debian 9 und 10
      - CentOS 7 und 8
      - Fedora 34


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">HINWEIS</p>
        Das automatische Aktivieren des Dienstes ist nicht mit SELinux kompatibel.
        Wenn Ihr System SELinux standardmäßig aktiviert hat (wie bei CentOS und Fedora der Fall), bringt Sie der Installationsbefehl _zum größten Teil dorthin_, gibt Ihnen aber am Ende auch Anweisungen, wie Sie den Prozess manuell abschließen.
      </p>


      Während dieser Überprüfung vergleicht es auch Ihre installierte Rocket Pool Smartnode-Version mit der neuesten Version und informiert Sie, wenn eine neue Version verfügbar ist.

      Wenn Sie den Update-Tracker aktiviert haben, besteht der letzte Schritt darin, den Node Exporter mit folgendem Befehl neu zu starten:

      ```shell
      docker restart rocketpool_exporter
      ```

      Danach sollten Sie fertig sein.
    </Tab>
    <Tab label="Hybrid">
      Der Hybrid-Modus funktioniert ähnlich wie der Docker-Modus; der einzige Unterschied besteht darin, dass Sie die richtigen Kommandozeilen-Flags zum Aktivieren von Metriken manuell zu Ihrer Execution und Consensus Client Servicedefinition hinzufügen müssen.

      Zuerst aktualisieren wir Ihren Execution Client.
      Öffnen Sie die `systemd`-Unit-Datei, die Sie beim Installieren Ihres Execution Clients erstellt haben, und stellen Sie sicher, dass sie die richtigen Flags hat, basierend darauf, welchen Client Sie verwenden:

      <div className="p-3">
        <Tabs>
          <Tab label="Geth">
            ```
            --metrics --metrics.addr 0.0.0.0 --metrics.port 9105
            ```
          </Tab>
          <Tab label="Nethermind">
            ```
            --Metrics.Enabled true --Metrics.ExposePort 9105
            ```
          </Tab>
          <Tab label="Besu">
            ```
            --metrics-enabled --metrics-host=0.0.0.0 --metrics-port=9105
            ```
          </Tab>
        </Tabs>
      </div>

      Als Nächstes aktualisieren wir Ihren Consensus Client.
      Öffnen Sie die `systemd`-Unit-Datei, die Sie beim Installieren Ihres Consensus Clients erstellt haben, und stellen Sie sicher, dass sie die richtigen Flags hat, basierend darauf, welchen Client Sie verwenden:

      <div className="p-3">
        <Tabs>
          <Tab label="Lighthouse">
            ```
            --metrics --metrics-address 0.0.0.0 --metrics-port 9100 --validator-monitor-auto
            ```
          </Tab>
          <Tab label="Lodestar">
            ```
            --metrics --metrics.address 0.0.0.0 --metrics.port 9100
            ```
          </Tab>
          <Tab label="Nimbus">
            ```
            --metrics --metrics-address=0.0.0.0 --metrics-port=9100
            ```
          </Tab>
          <Tab label="Prysm">
            ```
            --monitoring-host 0.0.0.0 --monitoring-port 9100
            ```

            Wenn Sie das Flag `--disable-monitoring` sehen, entfernen Sie es.
          </Tab>
          <Tab label="Teku">
            ```
            --metrics-enabled=true --metrics-interface=0.0.0.0 --metrics-port=9100 --metrics-host-allowlist=*
            ```
          </Tab>

        </Tabs>
      </div>

      Wenn Sie diese Flags bereits gesetzt haben und unterschiedliche Ports für Ihre Solo-Validator-Überwachung verwenden, lassen Sie sie unverändert und notieren Sie sich, welche Ports Sie verwenden.

      Scrollen Sie nun nach oben und folgen Sie den Anweisungen im `Docker`-Tab dieses Abschnitts, um den Prozess abzuschließen - beachten Sie dabei, dass Sie die dort aufgeführten Ports durch alle benutzerdefinierten Ports ersetzen müssen, die Sie beim Ausführen von `rocketpool service config` verwenden.

    </Tab>
    <Tab label="Native">
      Die native Installation von Grafana und Prometheus wird nur für fortgeschrittene Benutzer empfohlen. Sie erfordert Linux-Administrationsfähigkeiten wie `systemd`, Dateiberechtigungen, Benutzer- und Netzwerkverwaltung.

      Stellen Sie zunächst sicher, dass Ihr Execution Client und Consensus Client Metriken aktiviert haben. Siehe den 'Hybrid'-Tab für Details.

      Überprüfen Sie als Nächstes vorgefertigte Prometheus- und node_exporter-Pakete auf [der offiziellen Download-Seite](https://prometheus.io/download/).
      Wählen Sie Pakete mit der richtigen Architektur für Ihre Plattform (amd64 oder arm64).
      Die neueste LTS (Long Time Support)-Version von Prometheus wird empfohlen.

      Um zum Beispiel Prometheus v2.45.3 LTS und node_exporter v1.7.0 für Linux amd64 mit `wget` herunterzuladen, tun Sie Folgendes:

      ```shell
      wget https://github.com/prometheus/prometheus/releases/download/v2.45.3/prometheus-2.45.3.linux-amd64.tar.gz
      wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz
      wget https://github.com/prometheus/alertmanager/releases/download/v0.26.0/alertmanager-0.26.0.linux-amd64.tar.gz
      ```

      Extrahieren Sie die Prometheus- und node_exporter-Executables aus den heruntergeladenen Archiven.

      ```shell
      sudo tar -zxvf prometheus-2.45.3.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/prometheus' --strip-components=1
      sudo tar -zxvf node_exporter-1.7.0.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/node_exporter' --strip-components=1
      sudo tar -zxvf alertmanager-0.26.0.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/alertmanager' --strip-components=1
      ```

      Erstellen Sie Verzeichnisse für Prometheus- & Alertmanager-Configs.

      ```shell
      sudo mkdir /etc/prometheus
      sudo mkdir /etc/alertmanager
      sudo mkdir /var/lib/prometheus
      sudo mkdir /var/lib/alertmanager
      ```

      Erstellen Sie die Datei `/etc/prometheus/prometheus.yml` mit folgendem Inhalt:

      ```yaml
      global:
      scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
      scrape_timeout: 12s # Timeout must be shorter than the interval
      evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.

      scrape_configs:
      - job_name: "prometheus"
      static_configs:
      - targets: ["localhost:9091"]

      - job_name: "node"
      static_configs:
      - targets: ["localhost:9103"]
      #     - targets: ['localhost:9103', 'node_hostname:9103']
      - job_name: "eth1"
      static_configs:
      - targets: ["localhost:9105"]
      # Uncomment the line below if you are using geth as Execution Client
      #metrics_path: /debug/metrics/prometheus

      - job_name: "eth2"
      static_configs:
      - targets: ["localhost:9100"]

      - job_name: "validator"
      static_configs:
      - targets: ["validator:9101"]

      - job_name: "rocketpool"
      scrape_interval: 5m
      scrape_timeout: 5m
      static_configs:
      - targets: ["node:9102"]

      - job_name: "watchtower"
      scrape_interval: 5m
      scrape_timeout: 5m
      static_configs:
      - targets: ["watchtower:9104"]

      alerting:
      alertmanagers:
      - static_configs:
      - targets: ["localhost:9093"]
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">HINWEIS</p>
        Ändern Sie die Portnummern für den Execution Client und Consensus Client bei Bedarf.

        Sie führen Ihren Node möglicherweise auf einem anderen Host aus als der Host, auf dem Prometheus ausgeführt wird. Installieren Sie in diesem Fall
        node_exporter auf Ihrem Rocketpool-Node-Host und aktualisieren Sie `targets` des `node`-Jobs, um alle Maschinen einzuschließen, die Sie überwachen möchten.
        Passen Sie auch `metrics_path` an, wenn Ihr Execution Client Geth ist - er stellt einen nicht standardmäßigen Endpunkt für Metriken bereit.
      </p>

      Erstellen Sie die Datei `/etc/alertmanager/alertmanager.yml` mit folgendem Inhalt:

      ```yaml
      global:
      # ResolveTimeout is the default value used by alertmanager if the alert does
      # not include EndsAt, after this time passes it can declare the alert as resolved if it has not been updated.
      # This has no impact on alerts from Prometheus, as they always include EndsAt.
      # default = 5m
      resolve_timeout: 5m

      route:
      # The labels by which incoming alerts are grouped together.
      group_by: ["alertname"]
      # How long to initially wait to send a notification for a group
      # of alerts. Allows to wait for an inhibiting alert to arrive or collect
      # more initial alerts for the same group.
      group_wait: 30s
      # How long to wait before sending a notification about new alerts that
      # are added to a group of alerts for which an initial notification has
      # already been sent. (Usually ~5m or more.)
      group_interval: 5m
      # How long to wait before sending a notification again if it has already been sent successfully for an alert.
      repeat_interval: 4h
      routes:
      # severity=info: Don't send the follow-up resolved notification.
      - match:
      severity: info
      continue: false
      # The notification destination
      receiver: "node_operator_no_resolved"
      # all other alerts get sent notifications for the initial firing _and_ resolved notifications.
      - receiver: "node_operator_default"
      #match: We want this to match all alerts (severity=info is first though so it will stop)

      # The notification destination
      receiver: "node_operator_default"

      receivers:
      - name: "node_operator_default"
      discord_configs:
      - webhook_url: "https://discord.com/api/webhooks/1206697259694170212/_Pk1eVVgXFLdwU1k0rfwehSvNLiAQJytVV_Ze8QYOhupHnhiB5c8awPBTfuw41lN9GJk"

      - name: "node_operator_no_resolved"
      discord_configs:
      - webhook_url: "https://discord.com/api/webhooks/1206697259694170212/_Pk1eVVgXFLdwU1k0rfwehSvNLiAQJytVV_Ze8QYOhupHnhiB5c8awPBTfuw41lN9GJk"
      send_resolved: false

      inhibit_rules:
      # Inhibit rules mute a new alert (target) that matches an existing alert (source).
      - source_match:
      # if the existing alert (source) is severity=critical
      severity: "critical"
      target_match:
      # and the new alert (target) is severity=warning
      severity: "warning"
      # and the alertname, job, and instance labels have the same value
      equal: ["alertname", "job", "instance"]
      ```

      Erstellen Sie Systembenutzer für Prometheus und Alertmanager.

      ```shell
      sudo useradd -r -s /sbin/nologin prometheus
      sudo useradd -r -s /sbin/nologin alertmanager
      ```

      Ändern Sie Eigentümerschaft und Berechtigungen von Prometheus/Alertmanager-Dateien.

      ```shell
      sudo chown prometheus:prometheus /usr/local/bin/prometheus
      sudo chown alertmanager:alertmanager /usr/local/bin/alertmanager
      sudo chown prometheus:prometheus /usr/local/bin/node_exporter
      sudo chown -R prometheus:prometheus /etc/prometheus
      sudo chown -R alertmanager:alertmanager /etc/alertmanager
      sudo chown -R prometheus:prometheus /var/lib/prometheus
      sudo chown -R alertmanager:alertmanager /var/lib/alertmanager
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/prometheus
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/alertmanager
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/node_exporter
      ```

      Erstellen Sie die Datei `/lib/systemd/system/node-exporter.service` für die node_exporter-Servicekonfiguration.

      ```
      [Unit]
      Description=Node metrics exporter for Prometheus
      Documentation=https://prometheus.io/docs/introduction/overview
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=prometheus
      Group=prometheus
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/prometheus
      RuntimeDirectory=node-exporter
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/node_exporter --web.listen-address=:9103

      [Install]
      WantedBy=multi-user.target
      ```


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">HINWEIS</p>
        Wenn Sie den Port ändern möchten, auf dem node_exporter läuft, ändern Sie den Befehl beim Parameter `ExecStart`. Der Standardport ist 9100.
      </p>

      Erstellen Sie die Datei `/lib/systemd/system/prometheus.service` für die Prometheus-Servicekonfiguration.

      ```
      [Unit]
      Description=Prometheus instance
      Documentation=https://prometheus.io/docs/introduction/overview
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=prometheus
      Group=prometheus
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/prometheus
      RuntimeDirectory=prometheus
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/prometheus --config.file /etc/prometheus/prometheus.yml --web.listen-address=:9091

      [Install]
      WantedBy=multi-user.target
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">HINWEIS</p>
        Wenn Sie den Port ändern möchten, auf dem Prometheus läuft, ändern Sie den Befehl beim Parameter `ExecStart`. Der Standardport ist 9090.
      </p>

      Erstellen Sie die Datei `/lib/systemd/system/alertmanager.service` für die Alertmanager-Servicekonfiguration.

      ```
      [Unit]
      Description=Alertmanager instance
      Documentation=https://prometheus.io/docs/alerting/latest/alertmanager/
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=alertmanager
      Group=alertmanager
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/alertmanager
      RuntimeDirectory=alertmanager
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/alertmanager --config.file /etc/alertmanager/alertmanager.yml --web.listen-address=:9093

      [Install]
      WantedBy=multi-user.target
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">HINWEIS</p>
        Wenn Sie den Port ändern möchten, auf dem Alertmanager läuft, ändern Sie den Befehl beim Parameter `ExecStart`. Der Standardport ist 9093.
      </p>

      Informieren Sie `systemd` über neue Services.

      ```shell
      sudo systemctl daemon-reload
      ```

      Aktivieren und starten Sie den node-exporter-Service.

      ```shell
      sudo systemctl enable node-exporter
      sudo systemctl start node-exporter
      ```

      Überprüfen Sie den Service-Status, um sicherzustellen, dass er läuft.

      ```shell
      sudo systemctl status node-exporter
      ```

      Aktivieren und starten Sie den Prometheus-Service.

      ```shell
      sudo systemctl enable prometheus
      sudo systemctl start prometheus
      ```

      Aktivieren und starten Sie den Alertmanager-Service.

      ```shell
      sudo systemctl enable alertmanager
      sudo systemctl start alertmanager
      ```

      Überprüfen Sie den Service-Status, um sicherzustellen, dass er läuft.

      ```shell
      sudo systemctl status prometheus
      sudo systemctl status alertmanager
      ```

      Richten Sie das Paket-Repository für Grafana ein.

      ```shell
      sudo apt-get update
      sudo apt-get install -y apt-transport-https software-properties-common
      sudo mkdir -p /etc/apt/keyrings/
      wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null
      echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
      ```

      Installieren Sie Grafana.

      ```shell
      sudo apt-get update
      sudo apt-get install grafana
      ```

      Überprüfen Sie die Einstellungen in `/etc/grafana/grafana.ini`. Ändern Sie `http_port` auf 3100, um mit den anderen in diesem Dokument bereitgestellten Abschnitten übereinzustimmen.

      Konfigurieren Sie eine Datenquelle, um Metriken von Prometheus in Grafana zu visualisieren. Erstellen Sie die Datei `/etc/grafana/provisioning/datasources/prometheus.yml`.

      ```yaml
      apiVersion: 1

      deleteDatasources:
      - name: Prometheus
      orgId: 1

      datasources:
      - name: Prometheus
      type: prometheus
      access: proxy
      orgId: 1
      url: http://localhost:9091
      basicAuth: false
      isDefault: true
      version: 1
      editable: true
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">HINWEIS</p>
        Bearbeiten Sie `url`, wenn Sie den Prometheus-Listening-Port geändert haben.
      </p>

      Aktivieren und starten Sie den Service für Grafana.

      ```shell
      sudo systemctl daemon-reload
      sudo systemctl enable grafana-server
      sudo systemctl start grafana-server
      ```

      Überprüfen Sie, ob Grafana läuft.

      ```shell
      sudo systemctl status grafana-server
      ```

      Das ist so ziemlich alles.
    </Tab>

  </Tabs>
</div>

## Firewall konfigurieren, um Verbindungen für die Überwachung zuzulassen

::: warning HINWEIS
Wenn Sie UFW wie im Abschnitt [Sichern Ihres Nodes](./securing-your-node) referenziert aktiviert haben, müssen Sie einige Ports öffnen, um lokale Verbindungen zwischen Prometheus und Ihren Execution/Consensus Clients zu ermöglichen. Folgen Sie den nachstehenden Schritten.
:::

<div className="p-3">
  <Tabs>
    <Tab label="Docker">
      Führen Sie Folgendes aus und ersetzen Sie die Ports bei Bedarf:

      ```shell
      RP_NET=$(docker inspect rocketpool_net | grep -Po "(?<=\"Subnet\": \")[0-9./]+")
      sudo ufw allow from $RP_NET to any port 9105 comment "Allow Prometheus access to Execution Client"
      sudo ufw allow from $RP_NET to any port 9100 comment "Allow Prometheus access to Consensus Client"
      sudo ufw allow from $RP_NET to any port 9103 comment "Allow Prometheus access to Exporter"
      ```
    </Tab>
    <Tab label="Native">
      Wenn Ihr RocketPool-Node und Prometheus auf verschiedenen Hosts liegen, müssen Sie die Firewall auf Ihrem Node-Host konfigurieren, um eingehenden Verkehr
      von der Prometheus-Host-IP zu den Node-Überwachungs-Ports zu erlauben.
      Sie müssen auch UFW auf der Prometheus-Maschine konfigurieren, um ausgehenden Verkehr vom Prometheus-Host zum RocketPool-Node-Host zu erlauben.

      Bei Node-Host-IP `192.168.1.5` und Prometheus-Host-IP `192.168.1.6` lauten die UFW-Regeln für den Node:

      ```shell
      sudo ufw allow from 192.168.1.6 to any port 9100:9105 proto tcp comment 'Allow Prometheus host to scrape metrics of this host'
      ```

      Und für den Prometheus-Host:

      ```shell
      sudo ufw allow out from any to 192.168.1.5 port 9100:9105 proto tcp comment 'Allow this host to scrape node metrics'
      ```

      Angenommen, Ihr Grafana-Listening-Port ist 3100, lesen Sie weiter, um herauszufinden, wie Sie Grafana in Ihrem Netzwerk verfügbar machen.
    </Tab>

  </Tabs>
</div>

Sie können dann die Firewall öffnen, um externen Geräten Zugriff auf Ihr Grafana-Dashboard zu ermöglichen.

<div className="p-3">
  <Tabs>
    <Tab label="Network">
      Verwenden Sie dies, wenn Sie von jedem Gerät in Ihrem lokalen Netzwerk auf Grafana zugreifen möchten, aber den Zugriff überall sonst verweigern möchten.
      Dies wird der häufigste Anwendungsfall sein.

      Bitte überprüfen Sie zuerst, ob Ihr lokales Netzwerk die Struktur `192.168.1.xxx` verwendet.
      Möglicherweise müssen Sie den untenstehenden Befehl anpassen, um der Konfiguration Ihres lokalen Netzwerks zu entsprechen, wenn es eine andere Adressstruktur verwendet (z.B. `192.168.99.xxx`).

      ```shell
      # This assumes your local IP structure is 192.168.1.xxx
      sudo ufw allow from 192.168.1.0/24 proto tcp to any port 3100 comment 'Allow grafana from local network'
      ```

    </Tab>
    <Tab label="Subnet">
      Verwenden Sie dies, wenn Ihr Rocket Pool Node nicht mit demselben Subnetz verbunden ist wie das Gerät, von dem aus Sie Grafana anzeigen. Dies kann passieren, wenn Ihr Node direkt mit dem Modem Ihres ISPs verbunden ist und das Gerät, mit dem Sie Grafana anzeigen, mit einem sekundären Router verbunden ist.

      Bitte überprüfen Sie zuerst, ob Ihr lokales Netzwerk die Struktur `192.168.1.xxx` verwendet.
      Möglicherweise müssen Sie den untenstehenden Befehl anpassen, um der Konfiguration Ihres lokalen Netzwerks zu entsprechen, wenn es eine andere Adressstruktur verwendet (z.B. `192.168.99.xxx`).

      ```shell
      # To allow any devices in the broader subnet
      # for example allowing 192.168.2.20 to access
      # grafana on 192.168.1.20
      sudo ufw allow from 192.168.1.0/16 proto tcp to any port 3100 comment 'Allow grafana from local subnets'
      ```
    </Tab>
    <Tab label="Anywhere">
      Dies ermöglicht Ihnen den Zugriff auf Grafana von überall.
      Wenn Sie von außerhalb Ihres lokalen Netzwerks darauf zugreifen möchten, müssen Sie dennoch den Grafana-Port (Standard 3100) in Ihren Router-Einstellungen weiterleiten.

      ```shell
      # Allow any IP to connect to Grafana
      sudo ufw allow 3100/tcp comment 'Allow grafana from anywhere'
      ```
    </Tab>

  </Tabs>
</div>

## Einrichten von Grafana

Jetzt, da der Metrics Server bereit ist, können Sie mit jedem Browser in Ihrem lokalen Netzwerk darauf zugreifen.

Beziehen Sie sich auf die nachstehenden Tabs für Ihren Smartnode-Installationsmodus.

Navigieren Sie zur folgenden URL und ersetzen Sie die Variablen entsprechend Ihrem Setup:

```
http://<Ihre Node IP>:<Grafana Port>
```

Wenn beispielsweise die IP Ihres Nodes `192.168.1.5` war und Sie den Standard-Grafana-Port 3100 verwendet haben, würden Sie diese URL in Ihrem Browser aufrufen:

```
http://192.168.1.5:3100
```

Sie sehen einen Anmeldebildschirm wie diesen:

<img src="./images/grafana-login.png" width="100%" height="auto" />

Die Standard-Grafana-Informationen sind:

```
Username: admin
Password: admin
```

Sie werden dann aufgefordert, das Standardpasswort für das `admin`-Konto zu ändern.
Wählen Sie etwas Starkes und vergessen Sie es nicht!

::: tip Tipp
Wenn Sie das Admin-Passwort verlieren, können Sie es mit folgendem Befehl auf Ihrem Node zurücksetzen:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      ```shell
      docker exec -it rocketpool_grafana grafana-cli admin reset-admin-password admin
      ```

    </Tab>
    <Tab label="Native">
      ```shell
      sudo grafana-cli admin reset-admin-password admin
      ```
    </Tab>

  </Tabs>
</div>

Sie können sich dann erneut mit den Standard-`admin`-Anmeldedaten bei Grafana anmelden und werden aufgefordert, das Passwort für das `admin`-Konto zu ändern.
:::

Dank der Arbeit von Community-Mitglied **tedsteen** verbindet sich Grafana automatisch mit Ihrer Prometheus-Instanz, sodass es Zugriff auf die von ihr gesammelten Metriken hat.
Alles, was Sie tun müssen, ist das Dashboard zu holen!

## Importieren des Rocket Pool Dashboards

Jetzt, da Sie Grafana mit Prometheus verbunden haben, können Sie das Standard-Dashboard importieren (oder Ihr eigenes mit den von ihm bereitgestellten Metriken erstellen, wenn Sie mit diesem Prozess vertraut sind).

Beginnen Sie, indem Sie zum Menü **Create** (das Plus-Symbol in der rechten Seitenleiste) gehen und auf **Import** klicken:

<img src="./images/grafana-import.png" width="100%" height="auto" />

Wenn Sie nach der Dashboard-ID im Feld **Import via grafana.com** gefragt werden, geben Sie `21863` ein oder verwenden Sie die vollständige URL ([(https://grafana.com/grafana/dashboards/21863](https://grafana.com/grafana/dashboards/21863)) und klicken Sie auf die Schaltfläche **Load**.

Sie werden hier mit einigen Informationen über das Dashboard aufgefordert, wie seinem Namen und wo Sie es speichern möchten (der Standard-**General**-Ordner ist in Ordnung, es sei denn, Sie verwenden viele Dashboards und möchten sie organisieren).

Unter dem Dropdown-Menü **Prometheus** unten sollten Sie nur eine Option mit der Bezeichnung **Prometheus (default)** haben.
Wählen Sie diese Option.

Ihr Bildschirm sollte so aussehen:

<img src="./images/grafana-import2.png" width="100%" height="auto" />

Wenn Ihrer übereinstimmt, klicken Sie auf die Schaltfläche **Import** und Sie werden sofort zu Ihrem neuen Dashboard geleitet.

Auf den ersten Blick sollten Sie viele Informationen über Ihren Node und Ihre Validatoren sehen.
Jede Box kommt mit einem praktischen Tooltip in der oberen linken Ecke (das `i`-Symbol), über das Sie mehr darüber erfahren können.
Hier ist zum Beispiel der Tooltip für die Box **Your Validator Share**:

<img src="./images/tooltip.png" width="100%" height="auto" />

Wir sind jedoch noch nicht fertig mit der Einrichtung - es gibt noch ein wenig mehr Konfiguration zu tun.

::: warning HINWEIS
Einige der Boxen (insbesondere die APR-Boxen) wurden vorübergehend deaktiviert aufgrund der Art und Weise, wie Shapella abgeschöpfte Belohnungen bereitstellt.

Sie werden in einer zukünftigen Version der Smartnode, die historische Belohnungen ordnungsgemäß verfolgen kann, wieder aktiviert.
:::

## Anpassen des Hardware-Monitors an Ihr System

Jetzt, da das Dashboard hochgefahren ist, bemerken Sie möglicherweise, dass einige Boxen leer sind, wie **SSD Latency** und **Network Usage**.
Wir müssen das Dashboard an Ihre spezifische Hardware anpassen, damit es weiß, wie diese Dinge erfasst werden.

### CPU Temp

Um Ihr CPU-Temperatur-Messgerät zu aktualisieren, klicken Sie auf den Titel der Box **CPU Temp** und wählen Sie **Edit** aus dem Dropdown-Menü.
Ihr Bildschirm sieht nun ungefähr so aus:

<img src="./images/cpu-temp.png" width="100%" height="auto" />

Dies ist der Bearbeitungsmodus von Grafana, in dem Sie ändern können, was angezeigt wird und wie es aussieht.
Wir interessieren uns für das rot hervorgehobene Abfragefeld rechts von der Schaltfläche **Metrics browser**.

Standardmäßig steht in diesem Feld Folgendes:

```
node_hwmon_temp_celsius{job="node", chip="", sensor=""}
```

Es gibt zwei Felder in diesem Text, die derzeit leer sind: `chip` und `sensor`.
Diese sind für jede Maschine einzigartig, daher müssen Sie sie basierend darauf ausfüllen, was Ihre Maschine bereitstellt.

Folgen Sie dazu diesen Schritten:

1. Entfernen Sie den Teil `, sensor=""`, sodass er mit `chip=""}` endet. Zur Klarheit sollte das Ganze jetzt `node_hwmon_temp_celsius{job="node", chip=""}` sein.
2. Setzen Sie Ihren Cursor zwischen die Anführungszeichen von `chip=""` und drücken Sie `Strg+Leertaste`. Dies öffnet ein Autovervollständigungsfeld mit den verfügbaren Optionen, das so aussieht:

<img src="./images/grafana-autocomplete.png" width="100%" height="auto" />

3. Wählen Sie die Option aus, die der CPU Ihres Systems entspricht.
4. Sobald diese ausgewählt ist, fügen Sie `, sensor=""` wieder in die Zeichenfolge ein. Setzen Sie Ihren Cursor zwischen die Anführungszeichen von `sensor=""` und drücken Sie `Strg+Leertaste`, um ein weiteres Autovervollständigungsmenü zu erhalten. Wählen Sie den Sensor aus, den Sie überwachen möchten.

::: tip Tipp
Wenn Sie nicht wissen, welcher `chip` oder `sensor` korrekt ist, müssen Sie alle ausprobieren, bis Sie denjenigen finden, der richtig aussieht. Um dabei zu helfen, installieren Sie das `lm-sensors`-Paket (zum Beispiel `sudo apt install lm-sensors` auf Debian / Ubuntu) und führen Sie den Befehl `sensors -u` aus, um zu sehen, welche Sensoren Ihr Computer hat. Sie können versuchen, eine Chip-ID aus Grafanas Liste mit dem, was Sie hier sehen, basierend auf ihren Namen und IDs zu korrelieren.

Zum Beispiel ist dies eine der Ausgaben unseres `sensors -u`-Befehls:

```
k10temp-pci-00c3
Tctl:
  temp1_input: 33.500
Tdie:
  temp2_input: 33.500
```

In unserem Fall ist der entsprechende Chip in Grafana `pci0000:00_0000:00:18_3` und der entsprechende Sensor ist `temp1`.
:::

Sobald Sie mit Ihren Auswahlen zufrieden sind, klicken Sie auf die blaue Schaltfläche **Apply** in der oberen rechten Ecke des Bildschirms, um die Einstellungen zu speichern.

::: warning HINWEIS
Nicht alle Systeme stellen CPU-Temperaturinformationen zur Verfügung - insbesondere virtuelle Maschinen oder cloudbasierte Systeme.
Wenn Ihres nichts im Autovervollständigungsfeld für `chip` hat, ist dies wahrscheinlich der Fall und Sie können Ihre CPU-Temperatur nicht überwachen.
:::

### SSD Latency

Das Diagramm **SSD Latency** verfolgt, wie lange Lese-/Schreibvorgänge dauern.
Dies ist hilfreich, um zu messen, wie schnell Ihre SSD ist, damit Sie wissen, ob sie zu einem Engpass wird, wenn Ihr Validator unter schlechter Leistung leidet.
Um die SSD zu aktualisieren, die Sie im Diagramm verfolgen möchten, klicken Sie auf den Titel **SSD Latency** und wählen Sie **Edit**.

Dieses Diagramm hat vier Abfragefelder (vier Textfelder) mit insgesamt acht `device=""`-Teilen.
Sie müssen die ersten vier dieser Teile mit dem Gerät aktualisieren, das Sie verfolgen möchten.

Setzen Sie einfach Ihren Cursor zwischen die Anführungszeichen und drücken Sie `Strg+Leertaste`, um Grafanas Autovervollständigungsliste zu erhalten, und wählen Sie die richtige Option für jeden der `device=""`-Teile aus.
**Sie möchten von der am weitesten links liegenden leeren Einstellung aus beginnen, oder die Autovervollständigungsliste erscheint möglicherweise nicht.**

::: tip Tipp
Wenn Sie nicht wissen, welches Gerät Sie verfolgen sollen, führen Sie den folgenden Befehl aus:

```
lsblk
```

Dies gibt einen Baum aus, der Ihre Geräte- und Partitionsliste zeigt, zum Beispiel:

```
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
...
loop25        7:25   0   132K  1 loop /snap/gtk2-common-themes/9
loop26        7:26   0  65,1M  1 loop /snap/gtk-common-themes/1515
nvme0n1     259:0    0 238,5G  0 disk
├─nvme0n1p1 259:1    0   512M  0 part /boot/efi
├─nvme0n1p2 259:2    0 150,1G  0 part /
├─nvme0n1p3 259:3    0  87,4G  0 part
└─nvme0n1p4 259:4    0   527M  0 part
```

Wenn Sie Dockers Standardspeicherort während Ihrer Smartnode-Installation nicht auf ein anderes Laufwerk geändert haben, ist das Laufwerk, das Sie verfolgen möchten, dasjenige, auf dem Ihr Betriebssystem installiert ist.
Suchen Sie in der Spalte `MOUNTPOINT` nach einem Eintrag mit der einfachen Bezeichnung `/`, und folgen Sie diesem zurück zu seinem übergeordneten Gerät (dasjenige mit `disk` in der Spalte `TYPE`).

Normalerweise ist dies `sda` für SATA-Laufwerke oder `nvme0n1` für NVMe-Laufwerke.

Wenn Sie Dockers Standardspeicherort auf ein anderes Laufwerk geändert _haben_ oder wenn Sie ein Hybrid-/Native-Setup ausführen, sollten Sie die gleiche Technik des "Folgens des Mount-Points" verwenden können, um zu bestimmen, auf welchem Gerät sich Ihre Chain-Daten befinden.
:::

Optional können Sie auch die Latenz eines zweiten Laufwerks auf Ihrem System verfolgen.
Dies richtet sich an Personen, die ihr Betriebssystem und ihre Chain-Daten auf separaten Laufwerken aufbewahren.
Um dies einzurichten, folgen Sie einfach den obigen Anweisungen für die letzten beiden Abfragefelder und ersetzen die Werte des `device=""`-Teils durch die des Laufwerks, das Sie verfolgen möchten.

Sobald Sie mit Ihren Auswahlen zufrieden sind, klicken Sie auf die blaue Schaltfläche **Apply** in der oberen rechten Ecke des Bildschirms, um die Einstellungen zu speichern.

### Network Usage

Dieses Diagramm verfolgt, wie viele Daten Sie über eine bestimmte Netzwerkverbindung senden und empfangen.
Wie Sie vielleicht erwarten, muss das Dashboard wissen, welches Netzwerk es verfolgen soll.

Um es zu ändern, klicken Sie auf den Titel **Network Usage** und wählen Sie **Edit**.

Dieses Diagramm hat zwei Abfragefelder mit insgesamt zwei `device=""`-Teilen.
Sie müssen diese mit dem Netzwerk aktualisieren, das Sie verfolgen möchten.

Setzen Sie Ihren Cursor zwischen die Anführungszeichen und drücken Sie `Strg+Leertaste`, um Grafanas Autovervollständigungsliste zu erhalten, und wählen Sie die richtige Option für jeden der `device=""`-Teile aus.

::: tip Tipp
Wenn Sie nicht wissen, welches Gerät Sie verfolgen sollen, führen Sie den folgenden Befehl aus:

```shell
sudo route
```

Die Ausgabe sieht ungefähr so aus:

```
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.1.1     0.0.0.0         UG    100    0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.1.1     0.0.0.0         255.255.255.255 UH    100    0        0 eth0
```

Schauen Sie in der Spalte `Destination` nach der Zeile mit dem Wert `default`.
Folgen Sie dieser Zeile bis zur Spalte `Iface`.
Das dort aufgeführte Gerät ist dasjenige, das Sie verwenden möchten - in diesem Beispiel `eth0`.
:::

Sobald Sie mit Ihren Auswahlen zufrieden sind, klicken Sie auf die blaue Schaltfläche **Apply** in der oberen rechten Ecke des Bildschirms, um die Einstellungen zu speichern.

### Total Net I/O

Dies verfolgt die Gesamtmenge der gesendeten und empfangenen Daten.
Sie könnten es nützlich finden zu beobachten, wenn beispielsweise Ihr ISP Sie auf eine bestimmte Datenmenge pro Monat beschränkt.

Die Einrichtung ist identisch mit der Box **Network Usage** oben, folgen Sie also einfach diesen Anweisungen auch für diese Box.

### Disk Space Used

Dies überwacht, wie voll Ihr Betriebssystem-Laufwerk wird, damit Sie wissen, wann es Zeit zum Aufräumen ist (und wenn Ihre Chain-Daten auf demselben Laufwerk liegen, Zeit zum [Bereinigen von Geth oder Nethermind](./pruning)).

Die Schritte sind die gleichen wie bei der Box **SSD Latency** oben, folgen Sie also einfach diesen Anweisungen auch für diese Box.
Zur Erinnerung, Sie möchten das Laufwerk, das die Partition beherbergt, die `/` in der Spalte `MOUNTPOINT` hat, für diese, da das Ihr Betriebssystem-Laufwerk sein wird.
Füllen Sie dies in das erste Abfragefeld ein.

Optional können Sie auch den freien Speicherplatz eines zweiten Laufwerks auf Ihrem System verfolgen.
Dies richtet sich an Personen, die ihr Betriebssystem und ihre Chain-Daten auf separaten Laufwerken aufbewahren.
Richten Sie dies ein, indem Sie demselben Prozess folgen, aber anstatt zu schauen, welche Partition `/` in der Spalte `MOUNTPOINT` hat, möchten Sie nach derjenigen suchen, die den Mount-Point Ihres zweiten Laufwerks hat.
Aktualisieren Sie das zweite Abfragefeld mit dem Laufwerk, das mit dieser Partition verbunden ist.

### Disk Temp

Dies verfolgt die aktuelle Temperatur Ihres Betriebssystem-Laufwerks. Die Schritte sind die gleichen wie bei der Box **CPU Temp** oben, folgen Sie also einfach diesen Anweisungen auch für diese Box und ersetzen CPU-Chip- und Sensorwerte durch die Ihres Betriebssystem-Laufwerks. Füllen Sie diese Werte in das erste Abfragefeld ein.

Optional können Sie auch die aktuelle Temperatur eines zweiten Laufwerks auf Ihrem System verfolgen. Richten Sie dies ein, indem Sie demselben Prozess folgen und die Chip- und Sensorwerte durch die Ihres zweiten Laufwerks ersetzen. Füllen Sie diese Werte in das zweite Abfragefeld ein.

## Anpassen des Dashboards

Während das Standard-Dashboard versucht, alles, was Sie auf einen Blick sehen möchten, gut zu erfassen, ist es ziemlich einfach, ein Grafana-Dashboard nach Belieben anzupassen.
Sie können neue Diagramme hinzufügen, die Art und Weise ändern, wie Diagramme aussehen, Dinge verschieben und vieles mehr!

Werfen Sie einen Blick auf [Grafanas Tutorials](https://grafana.com/tutorials/) Seite, um zu lernen, wie Sie damit spielen und es nach Ihren Wünschen einrichten können.

## Anpassen des Metrics Stack

Die im Rocket Pool Metrics Stack verwendeten Tools bieten eine Vielzahl von Konfigurationsoptionen, die über das hinausgehen, was in der Standard-Rocket Pool Installation enthalten ist. Dieser Abschnitt enthält Konfigurationsbeispiele für verschiedene Anwendungsfälle.

Im Allgemeinen sollten [Grafana-Konfigurationsoptionen](https://grafana.com/docs/grafana/latest/administration/configuration/) über Umgebungsvariablen in `override/grafana.yml` übergeben werden. Jede Konfigurationsoption kann mit der folgenden Syntax in eine Umgebungsvariable umgewandelt werden:

```
GF_<SectionName>_<KeyName>
```

### Grafana SMTP-Einstellungen zum Senden von E-Mails

Um E-Mails von Grafana zu senden, z.B. für Benachrichtigungen oder um andere Benutzer einzuladen, müssen SMTP-Einstellungen im Rocket Pool Metrics Stack konfiguriert werden.
Siehe die [Grafana SMTP-Konfiguration](https://grafana.com/docs/grafana/latest/administration/configuration/#smtp) Seite als Referenz.

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Öffnen Sie `~/.rocketpool/override/grafana.yml` in einem Texteditor.
      Fügen Sie einen `environment`-Abschnitt unter der Zeile `x-rp-comment: Add your customizations below this line` hinzu und ersetzen Sie die untenstehenden Werte durch die Ihres SMTP-Anbieters.

      ```yaml
      version: "3.7"
      services:
      grafana:
      x-rp-comment: Add your customizations below this line
      environment:
      ## SMTP settings start, replace values with those of your SMTP provider
      - GF_SMTP_ENABLED=true
      - GF_SMTP_HOST=mail.example.com:`port` # Gmail users should use smtp.gmail.com:587
      - GF_SMTP_USER=admin@example.com
      - GF_SMTP_PASSWORD=password
      - GF_SMTP_FROM_ADDRESS=admin@example.com
      - GF_SMTP_FROM_NAME="Rocketpool Grafana Admin"
      ## SMTP server settings end
      ```
    </Tab>
    <Tab label="Native">
      Öffnen Sie `/etc/grafana/grafana.ini` in einem Texteditor. Suchen Sie nach dem Abschnitt `[smtp]` und aktualisieren Sie ihn, wobei Sie die untenstehenden Werte durch die Ihres SMTP-Anbieters ersetzen.

      ```
      [smtp]
      enabled = true
      host = mail.example.com:`port` # Gmail users should use smtp.gmail.com:587
      user = admin@example.com
      # If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;"""
      password = """passw0rd"""
      from_address = admin@example.com
      from_name = "Rocketpool Grafana Admin"
      ```
    </Tab>

  </Tabs>
</div>

::: tip Tipp
Wenn Sie Gmail verwenden und [2-Schritt-Verifizierung](https://support.google.com/accounts/answer/185839) aktiviert ist, erstellen Sie ein [App-Passwort](https://support.google.com/mail/answer/185833?hl=de) für diesen Dienst.
:::

Nach diesen Änderungen **führen Sie Folgendes aus, um die Änderungen anzuwenden**:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      ```shell
      docker stop rocketpool_grafana

      rocketpool service start
      ```
    </Tab>
    <Tab label="Native">
      ```shell
      sudo systemctl restart grafana-server
      ```
    </Tab>

  </Tabs>
</div>

Um die SMTP-Einstellungen zu testen, gehen Sie zum Menü **Alerting** und klicken Sie auf **Contact points**.

<img src="./images/grafana-contact-points.png" width="100%" height="auto" />

Klicken Sie auf **New contact point** und wählen Sie **Email** als Contact point type.
Geben Sie eine E-Mail-Adresse im Abschnitt **Addresses** ein und klicken Sie auf **Test**.

<img src="./images/grafana-new-contact-point.png" width="100%" height="auto" />

Überprüfen Sie, ob die Test-E-Mail empfangen wurde.
Klicken Sie auf **Save contact point\***, wenn Sie fertig sind.
