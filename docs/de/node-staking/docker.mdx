import { Tab, Tabs } from "@rspress/core/theme";

# Erstellen eines Standard-Rocket-Pool-Nodes mit Docker

In diesem Abschnitt werden wir den Prozess der Installation des Rocket Pool Smartnode-Stacks mit dem Standard-[Docker](https://www.docker.com/resources/what-container)-basierten Setup durchgehen.
Dies wird alles installieren und konfigurieren, was Sie benötigen, um einen vollständigen Node zu betreiben, einschließlich:

- Die Rocket Pool **Smartnode**-Software
- Einen **Execution** (früher ETH1) Client Ihrer Wahl oder eine Verbindung zu einem bestehenden Client, den Sie bereits verwalten
- Einen **Consensus** (früher ETH2) Client Ihrer Wahl oder eine Verbindung zu einem bestehenden Client, den Sie bereits verwalten
- Einen **Validator**-Client, der Ihre Beacon Chain-Validierungsaufgaben übernimmt
- (Optional) einen **Monitoring-Stack** zur Erfassung von Leistungs- und Gesundheitsmetriken

Alles, was Sie tun müssen, ist ihm mitzuteilen, was Sie ausführen möchten!

::: tip HINWEIS
Die folgenden Anweisungen erfordern, dass Sie das **Terminal** Ihres Systems verwenden, um Befehle einzugeben und auszuführen.
Wenn Sie über SSH mit der Node-Maschine verbunden sind, tun Sie dies bereits.
Wenn Sie sich auf der Node-Maschine befinden und eine Desktop-Benutzeroberfläche verwenden, müssen Sie ein Terminalfenster öffnen, um die folgenden Befehle auszuführen.
Informieren Sie sich über die Anweisungen Ihres Betriebssystems, um zu erfahren, wie Sie dies tun, wenn Sie damit nicht vertraut sind.
:::

## Prozessübersicht

Auf hoher Ebene ist Folgendes an der Installation von Rocket Pool beteiligt:

1. Herunterladen der Rocket Pool-Befehlszeilenschnittstelle (CLI)
1. Verwenden Sie die CLI, um den Smartnode-Stack zu installieren
1. Konfigurieren Sie den Smartnode-Stack mit einer einfach zu bedienenden Benutzeroberfläche im Terminal
1. Fertig!

## Bevor Sie beginnen

::: warning
Wenn Sie Ubuntu verwenden, wird empfohlen, dass Sie vor der Installation von Rocket Pool überprüfen, ob Docker nicht zusammen mit dem Betriebssystem installiert wurde.

Der Ubuntu-Installer erhält Docker vom Snap-Paketmanager, der mit der vom Smartnode installierten Docker-Version in Konflikt steht.

Führen Sie `snap list` aus und stellen Sie sicher, dass `docker` nicht installiert wurde.

Dies ist beispielsweise die Ausgabe auf einer Maschine, auf der Docker nicht installiert ist:

```
Name    Version        Rev    Tracking       Publisher   Notes
core20  20230308       1852   latest/stable  canonical✓  base
lxd     5.0.2-838e1b2  24322  5.0/stable/…   canonical✓  -
snapd   2.59.1         18933  latest/stable  canonical✓  snapd
```

Und hier ist die Ausgabe, wenn es installiert wurde:

```
Name    Version        Rev    Tracking       Publisher   Notes
core20  20230308       1852   latest/stable  canonical✓  base
docker  20.10.17       2746   latest/stable  canonical✓  -
lxd     5.0.2-838e1b2  24322  5.0/stable/…   canonical✓  -
snapd   2.59.1         18933  latest/stable  canonical✓  snapd
```

Wenn Sie es in der `snap list`-Ausgabe sehen, entfernen Sie es unbedingt mit:

```shell
sudo systemctl stop snap.docker.dockerd.service

sudo snap remove --purge docker
```

Danach wird empfohlen, die Maschine neu zu starten (`sudo systemctl reboot`)
:::

## Herunterladen der Rocket Pool CLI

Die Anweisungen zum Herunterladen der CLI variieren je nach Betriebssystem.

::: warning HINWEIS
Sie müssen die folgenden Anweisungen **auf der Maschine ausführen, die Sie für Ihren Rocket Pool Node verwenden werden.**
Wenn Sie keine Tastatur und keinen Monitor verwenden, die direkt mit Ihrer Node-Maschine verbunden sind, müssen Sie remote darauf zugreifen (z. B. über SSH) und diese Befehle über diese Remote-Verbindung ausführen.
:::

<div className="p-3">
  <Tabs>
    <Tab label="Linux">
      Erstellen Sie unter Linux zunächst einen neuen Ordner, der die CLI-Anwendung enthält:

      ```shell
      mkdir -p ~/bin
      ```

      Laden Sie als Nächstes die CLI herunter.
      Dies hängt davon ab, welche Architektur Ihr System verwendet.

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">TIPP</p>
        Wenn Sie Ihre CPU-Architektur nicht kennen, können Sie den folgenden Befehl ausführen, um sie zu ermitteln:

        ```shell
        uname -m
        ```

        Die Ausgabe dieses Befehls gibt Ihre Architektur aus.
        **Beachten Sie, dass `x86_64` dasselbe ist wie `x64` und `amd64`.**
        **Beachten Sie, dass `aarch64` dasselbe ist wie `arm64`.**
      </p>

      Für `x64`-Systeme (die meisten normalen Computer):

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool
      ```

      Für `arm64`-Systeme:

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool
      ```

      Markieren Sie es als ausführbar, damit es Berechtigungen zum Ausführen hat:

      ```shell
      chmod +x ~/bin/rocketpool
      ```

      Als Nächstes **melden Sie sich ab und wieder an** (oder schließen Sie SSH und verbinden Sie sich erneut) oder starten Sie einfach neu.
      Dies liegt daran, dass der Pfad, in dem Sie die CLI gespeichert haben (`~/bin`), möglicherweise noch nicht in der `PATH`-Variable Ihres Systems (der Liste der Orte, an denen Ihr System nach ausführbaren Dateien sucht) enthalten ist.
      Das Abmelden und erneute Anmelden wird es dort platzieren.

      Testen Sie nun die Ausführung mit dem `--version`-Flag.
      Sie sollten eine Ausgabe wie diese sehen:

      ```shell
      rocketpool --version
      ```

      ```shell
      rocketpool version 1.18.10
      ```

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">TIPP</p>
        Wenn Sie eine Fehlermeldung wie diese sehen,

        ```shell
        -bash: /home/user/rocketpool: cannot execute binary file: Exec format error
        ```

        bedeutet dies, dass Sie oben die falsche Version heruntergeladen haben.
        Bitte überprüfen Sie, ob Ihr System **x64** oder **arm64** ist, indem Sie den Befehl im obigen Tipp verwenden, und laden Sie die entsprechende Version herunter.
        Wenn Ihr System keines von beiden ist, können Sie Rocket Pool nicht ausführen.
      </p>
    </Tab>
    <Tab label="MacOS">
      Laden Sie unter macOS die CLI für Ihre Maschine mit dem folgenden Befehl herunter.

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">TIPP</p>
        Wenn Sie Ihre CPU-Architektur nicht kennen, können Sie den folgenden Befehl ausführen, um sie zu ermitteln:

        ```shell
        uname -m
        ```

        Die Ausgabe dieses Befehls gibt Ihre Architektur aus.
        **Beachten Sie, dass `x86_64` dasselbe ist wie `x64` und `amd64`.**
        **Beachten Sie, dass `aarch64` dasselbe ist wie `arm64`.**
      </p>

      Für `x64`-Systeme (die meisten Macs):

      ```shell
      curl -L https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool
      ```

      Für `arm64`-Systeme, wie den Mac mini mit M1:

      ```shell
      curl -L https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-arm64 > /opt/homebrew/bin/rocketpool
      ```

      Für `x64`-Systeme (die meisten Macs):
      Markieren Sie es als ausführbar, damit es Berechtigungen zum Ausführen hat:

      ```shell
      chmod +x /usr/local/bin/rocketpool
      ```

      Für `arm64`-Systeme, wie den Mac mini mit M1:
      Markieren Sie es als ausführbar, damit es Berechtigungen zum Ausführen hat:

      ```shell
      chmod +x /opt/homebrew/bin/rocketpool
      ```

      Testen Sie nun die Ausführung mit dem `--version`-Flag.
      Sie sollten eine Ausgabe wie diese sehen:

      ```shell
      rocketpool --version
      ```

      ```
      rocketpool version 1.18.10
      ```

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">TIPP</p>
        Wenn Sie eine Fehlermeldung wie diese sehen,

        ```shell
        /usr/local/bin/rocketpool: Exec format error
        ```

        bedeutet dies, dass Sie oben die falsche Version heruntergeladen haben.
        Bitte überprüfen Sie, ob Ihr System x64 oder arm64 ist, indem Sie den Befehl im obigen Tipp verwenden, und laden Sie die entsprechende Version herunter.
        Wenn Ihr System keines von beiden ist, können Sie Rocket Pool nicht ausführen.
      </p>
    </Tab>

  </Tabs>
</div>

## Installation des Smartnode-Stacks

Nachdem Sie die CLI installiert haben, können Sie den Smartnode-Stack bereitstellen.
Dies bereitet Ihr System mit Docker, [docker-compose](https://docs.docker.com/compose/) vor und lädt die Smartnode-Dateien, damit sie einsatzbereit sind.
Es wird noch nichts tatsächlich ausgeführt; das kommt später.

Um den Smartnode-Stack bereitzustellen, müssen Sie den folgenden Befehl auf Ihrer Node-Maschine ausführen (entweder durch lokales Anmelden oder durch Remote-Verbindung wie über SSH):

```shell
rocketpool service install
```

Dies ruft die neueste Version des Smartnode-Stacks ab und richtet ihn ein.
Sie sollten eine Ausgabe wie diese sehen (_über einigen Release Notes für die neueste Version, die am Ende gedruckt werden_):

<img src="./images/rp-install-screen.png" width="100%" height="auto" />

Wenn keine Fehlermeldungen vorhanden sind, war die Installation erfolgreich.
Standardmäßig wird es im Verzeichnis `~/.rocketpool` innerhalb des Home-Ordners Ihres Benutzerkontos abgelegt.

::: warning HINWEIS
Beachten Sie, dass das Smartnode-Installationsprogramm `docker` und `docker-compose` nicht auf allen Plattformen automatisch installieren kann.
Wenn Sie während der Installation eine Fehlermeldung wie diese erhalten:

```
Automatic dependency installation for the Mint operating system is not supported.
Please install docker and docker-compose manually, then try again with the '-d' flag to skip OS dependency installation.
Be sure to add yourself to the docker group with 'sudo usermod -aG docker $USER' after installing docker.
Log out and back in, or restart your system after you run this command.
```

Dann müssen Sie diese beiden Dinge einfach manuell installieren.

Docker bietet allgemeine [Installationsanweisungen hier](https://docs.docker.com/engine/install/).

Docker-compose bietet allgemeine [Installationsanweisungen hier](https://docs.docker.com/compose/install/).

Nachdem beide installiert sind, stellen Sie sicher, dass Sie Ihrem Benutzerkonto die Berechtigung erteilen, Docker zu verwenden:

```shell
sudo usermod -aG docker $USER
```

Führen Sie schließlich das Installationsprogramm mit dem `-d`-Flag erneut aus, um die Docker-Installation zu überspringen:

```shell
rocketpool service install -d
```

:::

Danach **melden Sie sich ab und wieder an oder starten Sie Ihre SSH-Sitzung neu**, damit die Einstellungen wirksam werden.

Sobald dies abgeschlossen ist, ist der Smartnode-Stack einsatzbereit.

## Konfigurieren des Speicherorts von Docker

Standardmäßig speichert Docker alle seine Container-Daten auf dem Laufwerk Ihres Betriebssystems.
In einigen Fällen ist dies nicht das, was Sie möchten.

::: tip HINWEIS
Wenn Sie mit diesem Standardverhalten zufrieden sind, springen Sie zum nächsten Abschnitt.
:::

Erstellen Sie dazu eine neue Datei namens `/etc/docker/daemon.json` als Root-Benutzer:

```shell
sudo nano /etc/docker/daemon.json
```

Diese wird zunächst leer sein, was in Ordnung ist. Fügen Sie dies als Inhalt hinzu:

```json
{
  "data-root": "<your external mount point>/docker"
}
```

wobei `<your external mount point>` das Verzeichnis ist, in das Ihr anderes Laufwerk eingebunden ist.

Drücken Sie `Strg+O, Enter`, um die Datei zu speichern, und `Strg+X, Enter`, um den Editor zu verlassen.

Erstellen Sie als Nächstes den Ordner:

```shell
sudo mkdir -p <your external mount point>/docker
```

Starten Sie nun den Docker-Daemon neu, damit er die Änderungen übernimmt:

```shell
sudo systemctl restart docker
```

Danach speichert Docker seine Daten auf Ihrer gewünschten Festplatte.

## Konfigurieren des Smartnode-Stacks

Der nächste Schritt im Installationsprozess besteht darin, eine anfängliche Konfiguration Ihres Nodes durchzuführen.
Fahren Sie mit dem Abschnitt [Konfiguration von Rocketpool](./config/overview) fort, um eine Anleitung zu diesem Prozess zu erhalten.
