import { Tab, Tabs } from "@rspress/core/theme";

# Staking via un Échange Décentralisé sur Layer 2

Pour rappel, vous n'avez pas besoin d'échanger ETH contre rETH directement via Rocket Pool pour profiter des avantages du staking décentralisé.
Tout ce que vous devez faire est de détenir du rETH car il prend intrinsèquement de la valeur - la façon dont vous l'obtenez n'a pas d'importance !

Cela dit, l'une des principales préoccupations (surtout ces derniers temps) est le coût du gaz associé au staking ou à l'échange d'ETH contre rETH.

Pour aider à réduire cela, le réseau Ethereum a commencé à adopter l'utilisation de [rollups](https://www.youtube.com/watch?v=7pWxCklcNsU) - également connus sous le nom de **Layer 2**.

Layer 2 comprend plusieurs réseaux séparés qui vivent sous Ethereum, exécutant de nombreuses transactions comme Ethereum le ferait normalement, mais regroupant toutes ces transactions en une seule "méga" transaction et publiant _celle-ci_ sur la chaîne Ethereum principale à la place.
Idéalement, cela signifie que vous bénéficieriez de tous les avantages de sécurité associés à la nature décentralisée d'Ethereum, mais profiteriez de **frais de gaz beaucoup plus bas** pour vos transactions car les coûts d'exécution et de stockage sur les Layer 2 peuvent être beaucoup plus bas et seulement une partie de vos transactions doit être stockée sur Layer 1 où l'état est beaucoup plus coûteux.

Rocket Pool prend actuellement en charge deux réseaux Layer 2 : [Optimism](https://www.optimism.io/) et [Arbitrum](https://arbitrum.io/).
Tous deux ont des versions opérationnelles de [Uniswap](https://docs.uniswap.org/protocol/introduction), le protocole d'échange décentralisé le plus largement utilisé.
Avec Uniswap, vous pouvez rapidement et facilement échanger ETH contre rETH.

L'avantage d'utiliser cette approche est que **les frais de gaz seront substantiellement plus bas** qu'avec d'autres méthodes.
Si cela est important pour vous parce que vous voulez staker une petite quantité d'ETH, alors l'utilisation d'un réseau Layer 2 sera probablement votre option de choix.

L'inconvénient est que vous pourriez ne pas obtenir la meilleure offre sur rETH.
Uniswap nécessite des frais modestes qui sont donnés à ses fournisseurs de liquidité, et les grandes transactions nécessiteront de grandes pools de liquidité afin d'obtenir de bonnes offres sans trop d'impact sur le prix.
Les réseaux Layer 2 ont tendance à avoir une liquidité rETH inférieure à celle du réseau Ethereum principal.

Par conséquent, nous vous recommandons de comparer le total de rETH que vous obtiendriez sur un réseau Layer 2 avec ce que vous obtiendriez via les autres méthodes pour déterminer s'il est logique pour vous de poursuivre cette voie.

Vous pouvez consulter les soldes actuels d'ETH et de rETH de la [pool Optimism](https://info.uniswap.org/#/optimism/pools/0xaefc1edaede6adadcdf3bb344577d45a80b19582) et de la [pool Arbitrum](https://info.uniswap.org/#/arbitrum/pools/0xaac7de2b91293ba1791503d9127d2bdf2159db65) pour déterminer s'ils ont assez de rETH pour couvrir votre échange.

Dans l'exemple suivant, nous allons démontrer comment interagir avec les réseaux Layer 2 et utiliser Uniswap pour échanger ETH contre rETH.

::: warning NOTE
Actuellement, cette méthode n'est disponible que sur Mainnet.
Si vous voulez vous entraîner sur le Hoodi Testnet, vous devez [échanger directement avec Rocket Pool](./via-rp).

**Le reste de ce guide supposera que vous êtes sur Mainnet.**
:::

Ce processus peut être complété avec n'importe quel portefeuille compatible web3.
À des fins de démonstration, nous allons utiliser [MetaMask](https://metamask.io/) car c'est l'un des choix de portefeuille les plus populaires.

**Vous devriez pouvoir suivre en utilisant des étapes similaires avec un portefeuille différent si vous choisissez - trouvez simplement la fonction comparable dans votre portefeuille pour chaque étape.**

## Configuration de MetaMask sur Mainnet

Commencez par installer [MetaMask](https://metamask.io/) si vous ne l'avez pas déjà fait.
Suivez les instructions sur leur site pour installer l'extension, créer un compte et vous connecter.

Ensuite, ouvrez le panneau MetaMask en utilisant son icône dans la barre d'outils de votre navigateur.
Cliquez sur le **menu déroulant du réseau** dans la barre d'outils en haut et assurez-vous que **Ethereum Mainnet** est sélectionné :

<img src="./images/mm_network_main.png" width="100%" height="auto" />

L'adresse directement en dessous est votre **adresse de portefeuille Ethereum**.

Avant d'aller plus loin, vous devrez approvisionner ce portefeuille avec de l'ETH.
Si vous n'avez pas déjà d'ETH dans le compte d'une utilisation antérieure, vous pouvez le faire en transférant de l'ETH depuis un compte existant vers cette adresse de portefeuille.

## Transfert d'ETH de Layer 1 à Layer 2 via Hop

Il existe plusieurs façons de transférer de l'ETH depuis le Mainnet Ethereum vers un réseau Layer 2.
Dans cette démonstration, nous allons utiliser le protocole [Hop](https://docs.hop.exchange/faq) - un moyen simple et fiable de déplacer de l'ETH (et quelques autres pièces) de Layer 1 vers plusieurs réseaux Layer 2, ou entre réseaux Layer 2.

Accédez au site web de l'échange Hop ici :

[https://app.hop.exchange/send?token=ETH](https://app.hop.exchange/send?token=ETH)

L'écran d'accueil devrait ressembler à ceci :

<img src="./images/hop.png" width="100%" height="auto" />

Commencez par cliquer sur le bouton **Connect a Wallet** dans le coin supérieur droit.
Vous serez invité avec un écran qui vous demande quel fournisseur de portefeuille vous voulez utiliser.
Pour cet exemple, sélectionnez **MetaMask**.

::: tip NOTE
Si vous n'utilisez pas MetaMask, l'un des autres fournisseurs comme WalletConnect sera probablement compatible avec votre portefeuille.
:::

En cliquant sur ce bouton, MetaMask apparaîtra avec une invite vous demandant de sélectionner les comptes que vous voulez utiliser.
En supposant que vous n'en ayez qu'un, votre compte devrait déjà être sélectionné.
Cliquez sur **Next**.

Il vous demandera ensuite si vous souhaitez donner à Hop l'accès pour voir les adresses de vos comptes :

<img src="./images/hop_connect.png" width="100%" height="auto" />

Cliquez sur **Connect** et après une brève pause, votre portefeuille sera connecté à Hop.
Vous devriez maintenant voir son solde ETH dans le coin supérieur droit de l'écran.

Maintenant, vous pouvez utiliser les deux menus déroulants dans les cases **From** et **To (estimated)** pour sélectionner vos réseaux, et entrer la quantité d'ETH que vous voulez envoyer dans la case **From**.

Par exemple, voici à quoi cela ressemblerait pour envoyer 0,1 ETH de Layer 1 à Arbitrum :

<img src="./images/hop_send.png" width="100%" height="auto" />

::: warning NOTE
Pour rappel, Uniswap (et donc le staking Rocket Pool) est actuellement **seulement pris en charge sur Optimism et Arbitrum**.
Vous devez sélectionner l'un de ces réseaux.
:::

Quand vous êtes prêt, cliquez sur le bouton **Send**.
Metamask apparaîtra avec une boîte de dialogue de confirmation qui vous montre les frais de gaz associés à la transaction :

<img src="./images/hop_confirm.png" width="100%" height="auto" />

Si vous êtes à l'aise avec ces frais de gaz, cliquez sur **Confirm** pour commencer la transaction.
Après quelques instants, MetaMask apparaîtra avec un message de confirmation de transaction réussie, et votre ETH sera maintenant disponible sur votre réseau Layer 2 de choix !

## Connexion à Uniswap sur Layer 2

Maintenant que votre portefeuille est configuré et financé, rendez-vous sur cette URL qui ouvrira Uniswap et affichera automatiquement l'échange d'ETH contre rETH :

[https://app.uniswap.org/#/swap?inputCurrency=eth](https://app.uniswap.org/#/swap?inputCurrency=eth)

La page ressemblera initialement à ceci :

<img src="./images/uni_connect.png" width="100%" height="auto" />

Cliquez sur l'un des boutons `Connect Wallet` comme celui mis en évidence dans le coin supérieur droit.
Vous serez invité avec un écran qui vous demande quel fournisseur de portefeuille vous voulez utiliser.
Pour cet exemple, sélectionnez **MetaMask**.

::: tip NOTE
Si vous n'utilisez pas MetaMask, l'un des autres fournisseurs comme WalletConnect sera probablement compatible avec votre portefeuille.
:::

En cliquant sur ce bouton, MetaMask apparaîtra avec une autre invite vous demandant de sélectionner les comptes que vous voulez utiliser, tout comme il l'a fait avec Hop.
Laissez votre compte sélectionné, cliquez sur **Next**, puis cliquez sur **Connect** comme vous l'avez fait avec Hop auparavant.
Après une brève pause, votre portefeuille sera connecté à Uniswap.
Vous devriez maintenant voir son solde ETH dans le coin supérieur droit de l'écran.

La première chose à faire est de changer votre réseau du mainnet Ethereum vers le Layer 2 vers lequel vous venez d'échanger.
Cliquez sur le menu déroulant du réseau en haut à droite de l'écran (mis en évidence en rouge ici) :

<img src="./images/uni_network.png" width="100%" height="auto" />

Une fois que vous le faites, MetaMask vous invitera à confirmer que vous voulez ajouter un réseau personnalisé :

<img src="./images/uni_net_confirm.png" width="100%" height="auto" />

Cliquez sur **Approve** puis cliquez sur **Switch Network**.
Cela changera MetaMask pour utiliser le nouveau réseau Layer 2 au lieu du mainnet d'Ethereum pour les transactions.

::: warning NOTE
Avant de faire des transactions avec MetaMask, _vérifiez toujours_ quel réseau il utilise actuellement en ouvrant MetaMask et en regardant le menu déroulant du réseau en haut !
Il est facile de changer accidentellement de réseau et d'oublier !
:::

## Ajout de rETH à MetaMask

L'étape suivante consiste à ajouter le jeton rETH à MetaMask afin que vous puissiez voir votre solde et y accéder pour le trading.
Cliquez sur l'onglet **Assets**, puis cliquez sur **Add Token** :

<img src="./images/mm_add_token.png" width="100%" height="auto" />

Assurez-vous que **Custom Token** est sélectionné dans cette boîte de dialogue, et sélectionnez l'onglet approprié pour le réseau Layer 2 que vous avez choisi ci-dessous :

<div className="p-3">
  <Tabs>
    <Tab label="Optimism">
      Dans la case **Token Contract Address**, mettez la valeur suivante :

      ```shell
      0x9bcef72be871e61ed4fbbc7630889bee758eb81d
      ```

      Le **Token Symbol** devrait automatiquement être rempli avec `rETH`, et les **Decimals of Precision** devraient automatiquement être remplis avec `18`.

      Acceptez le reste des invites, et vous verrez ensuite le jeton rETH apparaître dans votre liste.
    </Tab>
    <Tab label="Arbitrum">
      Dans la case **Token Contract Address**, mettez la valeur suivante :

      ```shell
      0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8
      ```

      Le **Token Symbol** devrait automatiquement être rempli avec `rETH`, et les **Decimals of Precision** devraient automatiquement être remplis avec `18`.

      Acceptez le reste des invites, et vous verrez ensuite le jeton rETH apparaître dans votre liste.
    </Tab>

  </Tabs>
</div>

## Échange d'ETH contre rETH avec Uniswap

La dernière étape du processus est d'effectuer l'échange !

Cliquez sur le menu déroulant **Select a token** et entrez l'adresse de rETH que vous venez d'ajouter à MetaMask (vous pouvez aussi simplement taper rETH, mais **assurez-vous qu'il s'agit du jeton correct et non d'un jeton imposteur ou arnaque** en vérifiant d'abord son adresse).

::: warning NOTE
Vous pourriez initialement être invité avec un avertissement qui ressemble à ceci :

<img src="./images/unknown_token.jpg" width="100%" height="auto" />

Il s'agit simplement d'un avertissement temporaire jusqu'à ce qu'Uniswap ajoute rETH à sa liste de jetons canoniques sur le Layer que vous utilisez.
Tant que l'adresse du jeton est `0x9bcef72be871e61ed4fbbc7630889bee758eb81d` sur Optimism ou `0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8` sur Arbitrum, vous pouvez l'ajouter en toute sécurité.
:::

Ensuite, entrez la quantité d'ETH que vous voulez échanger et l'interface utilisateur d'Uniswap vous montrera la quantité de rETH que vous recevrez en retour :

<img src="./images/arb_swap.png" width="100%" height="auto" />

::: warning NOTE
Notez que la quantité de rETH que vous recevez sera **inférieure** à la quantité d'ETH que vous mettez.
C'est normal, car **rETH vaut plus que l'ETH** et s'apprécie continuellement au fil du temps.
Vous pouvez voir cela dans le taux de change mis en évidence en bas de la capture d'écran.
:::

Maintenant, cliquez sur **Swap** pour voir les détails de l'échange, y compris le montant minimum que vous pourriez recevoir en raison du slippage.
Si vous êtes satisfait, cliquez sur **Confirm Swap**.
Cela enverra la demande à MetaMask, où vous pourrez examiner le coût total de la transaction avant de la confirmer :

<img src="./images/arb_gas.png" width="100%" height="auto" />

::: tip NOTE
Faites **très attention** aux frais de gaz estimés ici.
Vous remarquerez probablement qu'il est **environ 10 fois moins cher** en termes de frais de gaz d'effectuer cet échange sur un réseau Layer 2 que sur le Mainnet Ethereum !
:::

Si vous êtes satisfait des frais de gaz par rapport au montant total de rETH que vous allez recevoir, cliquez sur **Confirm** pour soumettre la transaction.
Après une courte période, vous devriez voir une notification de MetaMask indiquant qu'elle s'est terminée avec succès, et vous verrez maintenant le jeton rETH dans votre portefeuille.

C'est tout ! Vous êtes maintenant en train de staker avec Rocket Pool. Tout ce que vous devez faire est de conserver votre rETH, et vous gagnerez automatiquement vos récompenses de staking à mesure que la valeur du jeton rETH augmente.
