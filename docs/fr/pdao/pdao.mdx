import proposal_diagram from "./images/proposal_diagram.png";
import proposal_checker from "./images/proposal_checker.png";

# La DAO de Protocole (pDAO)

La DAO de Protocole de Rocket Pool (pDAO) est responsable de façonner la direction du protocole et est dirigée par la gouvernance RPL. Ses membres et leur pouvoir de vote sont constitués d'opérateurs de nœuds, grands et petits, qui participent tous directement au protocole. Elle sert la communauté Rocket Pool dans son ensemble, y compris les détenteurs de rETH, les opérateurs de nœuds et les détenteurs de RPL. La pDAO priorise la sécurité du protocole Rocket Pool et la santé du réseau Ethereum. Pour une définition explicite de qui et ce qu'est la pDAO, n'hésitez pas à consulter la [charte de la pDAO](https://rpips.rocketpool.net/RPIPs/RPIP-23).

## Nouvelles fonctionnalités de la pDAO dans Houston

### Exécution on-chain des responsabilités de la pDAO

La mise à niveau Houston introduit un remplacement on-chain pour le processus d'exécution du système de gouvernance de la pDAO. Elle utilise un système de preuve de fraude optimiste qui permet à tout opérateur de nœud de créer des propositions et de voter sur des propositions pour ajuster les "paramètres du protocole pDAO" et dépenser les fonds du trésor. Pour voir une liste complète des paramètres contrôlables par la pDAO, cliquez [ici](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table).
Avant Houston, l'équipe principale était responsable de l'exécution des tâches de la pDAO à la demande du processus de gouvernance communautaire. Par exemple, l'équipe effectue les paiements mensuels IMC et GMC conformément aux calendriers de paiement votés par la gouvernance. Le plan était que ce pouvoir réside temporairement avec l'équipe jusqu'à ce qu'une nouvelle structure de pouvoir soit mise en place pour reprendre ces responsabilités. Houston supprime cette dépendance vis-à-vis de l'équipe, rendant le protocole plus décentralisé et sans confiance.

### Conseil de Sécurité

La mise à niveau Houston inclut également un nouveau conseil de sécurité pour aider à réagir rapidement en cas de problèmes potentiels avec le protocole. Ces membres peuvent être élus par la pDAO et ont la capacité de proposer et d'exécuter des changements sans délai. La pDAO a le pouvoir d'élire et de retirer des membres du conseil de sécurité. C'est un rôle sérieux et la pDAO devrait développer des exigences d'entrée strictes et des processus pour éliminer les membres inactifs. Le gardien de la pDAO sera le seul membre du conseil de sécurité au début de Houston.

### Dépenses récurrentes du trésor

Le RPL a un taux d'inflation de 5%. 22% de cette inflation est dirigée vers la pDAO tel que défini dans [RPIP-25](https://rpips.rocketpool.net/RPIPs/RPIP-25). La pDAO peut utiliser ces fonds à diverses fins. Par exemple, des incitations telles que des bonus pour les fournisseurs de liquidité (LP), des subventions et primes pour des améliorations et projets tiers, et le financement du développement du protocole Rocket Pool. La mise à niveau Houston introduit également une nouvelle fonctionnalité qui permet des paiements récurrents du trésor versés à un bénéficiaire spécifié à chaque période de récompense.

## Propositions de la DAO de Protocole (pDAO)

Tout nœud avec un pouvoir de vote non nul peut créer ou participer à une proposition pDAO à tout moment. Les propositions peuvent être de l'un des types suivants :

- Modification des paramètres de la pDAO
- Dépenses uniques du trésor
- Dépenses récurrentes du trésor (comités de gestion)
- Adhésion au conseil de sécurité

Pour plus de détails et de justification, consultez les [types de propositions](https://rpips.rocketpool.net/RPIPs/RPIP-33#proposal-types). Il est important de comprendre qu'une proposition pDAO est une entité on-chain qui existe pour exécuter des changements au niveau du protocole.

## Cycle de vie d'une proposition pDAO

Une proposition devrait être anticipée par le [processus de gouvernance](./participate#governance-process) avant qu'elle ne se retrouve on-chain. Elle se compose de 4 périodes, toutes étant des [paramètres contrôlables](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table) de la pDAO :

- Période de délai de vote : `proposal.vote.delay.time`
- Phase de vote 1 : `proposal.vote.phase1.time`
- Phase de vote 2 : `proposal.vote.phase2.time`
- Exécution : `proposal.execute.time`

<img src={proposal_diagram} width="100%" height="auto" />

### Période de délai de vote

Pour décider du résultat d'une proposition, le protocole doit connaître le quorum requis. Un proposeur calcule cette valeur off-chain et la soumet avec sa proposition. La valeur est acceptée de manière optimiste, mais en cas de fraude, les vérificateurs peuvent effectuer un processus de contestation/réponse pour prouver que la valeur est incorrecte. Les propositions invalides sont alors rejetées.

Quelques raisons pour lesquelles les proposeurs et contestataires sont tenus de verrouiller du RPL.

- `proposal.bond` incite aux propositions valides et décourage le spam.
- `proposal.challenge.bond` incite à éliminer les propositions invalides/malveillantes.

Les contestataires fournissent un index dans l'arbre Merkle-sum qu'ils allèguent être incorrect. Tout opérateur de nœud peut participer à la contestation de propositions frauduleuses (et gagner une récompense en le faisant). N'hésitez pas à lire sur le [processus de contestation de la pDAO](./pdao#challenge-process) si vous êtes intéressé à y participer. Une proposition non vaincue lors d'une contestation à la fin de la période de délai de vote entrera dans les étapes de vote.

::: tip NOTE
Lorsque `proposal.vote.delay.time` expire, la proposition ne peut plus être contestée ou vaincue.
:::

### Période de vote 1

Durant une période de vote, les opérateurs de nœuds et les délégués peuvent exprimer un vote avec l'une des quatre options :

```
1. Abstention : Le pouvoir de vote du votant contribue au quorum mais n'est ni pour ni contre la proposition.
2. Pour : Le votant vote en faveur de l'exécution de la proposition.
3. Contre : Le votant vote contre l'exécution de la proposition.
4. Veto : Le votant vote contre la proposition tout en indiquant qu'il considère la proposition comme du spam ou malveillante.
```

Leur pouvoir de vote sera inclus dans l'option de leur choix.

Cela peut être fait en utilisant la commande :

```shell
rocketpool pdao proposals vote
```

Si le quorum de veto (tel que défini par le paramètre `proposal.veto.quorum`) est atteint, la proposition est immédiatement vaincue et le proposeur perd sa caution. Ceci est destiné à dissuader le spam, les propositions de mauvaise qualité ou les propositions qui n'ont pas d'abord suivi les processus off-chain. La commande smartnode `rocketpool pdao proposals finalize` est utilisée pour finaliser une proposition véto en brûlant la caution RPL verrouillée du proposeur.

La durée de la période 1 est déterminée par le paramètre `proposal.vote.phase1.time`. La proposition passera à la phase 2 que le `proposal.quorum` soit atteint ou non.

### Période de vote 2

Les délégués peuvent voter durant la période de vote 2, mais leur vote ne vaut que leur **pouvoir de vote local**. Les votants qui n'ont pas voté en période 1 pourront toujours exprimer un vote durant la période 2. Les opérateurs de nœuds qui ne sont pas d'accord avec le choix de leur délégué auront l'opportunité d'annuler le vote de leur délégué.

Le processus d'annulation d'un vote est assez simple, appelez simplement `rocketpool pdao proposals vote` durant la période de vote 2 et suivez les invites. Le pouvoir de vote du délégué sera annulé par le pouvoir de vote du délégant.

Le résultat d'une proposition est conclu lorsque la période de vote 2 est terminée. Pour qu'un résultat soit déterminé (et exécuté), le pouvoir de vote total `proposal.quorum` doit être atteint d'ici la fin de `proposal.vote.phase2.time`. Si le quorum est atteint et qu'un consensus est obtenu, la proposition passera les périodes de vote et sera marquée comme réussie.

::: tip NOTE
Aucune action supplémentaire ne peut être prise dans le cas où `proposal.quorum` n'est pas atteint. Une proposition est considérée comme conclue et finale si le quorum n'est pas atteint.
:::

### Exécution

Une fois que les deux périodes de vote sont passées et que la proposition est réussie, la proposition peut être exécutée et le changement (défini par la charge utile) est appliqué au protocole Rocket Pool. Pour exécuter une proposition, utilisez la commande :

```shell
rocketpool pdao proposals execute
```

Vous serez invité à sélectionner une proposition à exécuter, la proposition sera appliquée au protocole après cette étape !

Après que la proposition ait passé les périodes de vote, le proposeur peut [réclamer](./participate#claiming-bonds-and-rewards) sa caution RPL verrouillée, sauf si la proposition a été vaincue par une contestation ou véto.

::: tip NOTE
Il y a une fenêtre `proposal.execute.time` où une proposition peut être exécutée. Une proposition expirera si ce minuteur atteint sa fin.
:::

Et voilà ! Gardez à l'esprit que toutes les variables mentionnées ci-dessus sont des paramètres contrôlables par la pDAO. Cliquez [ici](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table) pour une liste complète de chaque paramètre que la pDAO a l'autorité de changer en utilisant des propositions on-chain.

## Processus de contestation

L'arbre complet du pouvoir de vote du réseau est stocké off-chain en raison des limites de gaz. Lorsqu'un utilisateur soumet une nouvelle proposition, il est responsable de construire l'arbre de vote du réseau au numéro de bloc cible. Cet arbre est généré off-chain mais vérifiable via les racines Merkle soumises on-chain. Le protocole s'appuie sur des **vérificateurs** pour vérifier les détails soumis par le proposeur.

Tout nœud peut participer au suivi et à la vérification de l'exactitude des propositions. Pour participer à cette responsabilité, utilisez la commande `rocketpool service config`, naviguez vers le menu **Smartnode and TX Fee Settings**, et cochez la case `Enable PDAO Proposal Checker`.

<img src={proposal_checker} width="100%" height="auto" />

Lorsque ce paramètre est activé, le nœud vérifiera les nouvelles propositions, vérifiera leur exactitude et soumettra des contestations aux propositions invalides. Le seul prérequis est que le [verrouillage de RPL](./participate#allowing-rpl-locking) soit activé.

Cette vérification s'exécute toutes les 5 minutes en conjonction avec quelques autres tâches liées au nœud. Nous allons parcourir un exemple de ce à quoi ressemble la contestation d'une proposition frauduleuse. Nous pouvons utiliser la commande smartnode `rocketpool service logs node` pour surveiller la progression :

```
rocketpool_node  | 2024/04/05 02:19:16 Vérification des contestations de propositions de la DAO de Protocole à défendre...
rocketpool_node  | 2024/04/05 02:19:26 Vérification des propositions de la DAO de Protocole à contester...
rocketpool_node  | 2024/04/05 02:19:26 [Arbre réseau] Impossible de charger l'arbre réseau pour le bloc 1283202 depuis le disque, il doit donc être régénéré.
rocketpool_node  | 2024/04/05 02:19:26 [Propositions PDAO] L'arbre réseau pour le bloc 1283202 n'existait pas, en créer un.
rocketpool_node  | 2024/04/05 02:19:26 [Snapshot des infos de vote] Impossible de charger l'arbre réseau pour le bloc 1283202 depuis le disque, il doit donc être régénéré.
rocketpool_node  | 2024/04/05 02:19:26 [Propositions PDAO] Le snapshot des infos de vote pour le bloc 1283202 n'existait pas, en créer un.
rocketpool_node  | 2024/04/05 02:19:26 La proposition 177 ne correspond pas aux artefacts de l'arbre local et doit être contestée.
rocketpool_node  | 2024/04/05 02:19:26 [Snapshot des infos de vote] Fichier chargé [vi-1283202.json.zst].
rocketpool_node  | 2024/04/05 02:19:26 [Arbre réseau] Fichier chargé [network-tree-1283202.json.zst].
rocketpool_node  | 2024/04/05 02:19:26 Soumission de la contestation contre la proposition 177, index 5...
rocketpool_node  | 2024/04/05 02:19:26 Cette transaction utilisera des frais max de 16.067134 Gwei, pour un total de jusqu'à 0.003252 - 0.004878 ETH.
rocketpool_node  | 2024/04/05 02:19:26 La transaction a été soumise avec le hash 0x327e59e398bf2141a0d9273947d1da5c255606c45afaca428ab092186300eac2.
rocketpool_node  | 2024/04/05 02:19:26 Vous pouvez suivre sa progression en visitant :
rocketpool_node  | 2024/04/05 02:19:26 https://holesky.etherscan.io/tx/0x327e59e398bf2141a0d9273947d1da5c255606c45afaca428ab092186300eac2

```

Nous pouvons voir que notre nœud a détecté une proposition frauduleuse et a commencé le processus de contestation. Le bloc `1283202` est le bloc dans lequel la proposition 177 a été créée, ce qui signifie que le pouvoir de vote pour cette proposition sera calculé au bloc `1283202`. Si vous êtes intéressé à voir à quoi ressemblent ces **Snapshots des infos de vote**, vous pouvez les localiser dans ce répertoire : `~/.rocketpool/data/voting`

Parce que le proposeur a été pris en train de soumettre des informations de vote incorrectes, notre nœud effectue un appel de contrat `Function: createChallenge` sur la proposition 177 à l'index 5 et attend que le proposeur réponde à la contestation.

```
rocketpool3_node  | 2024/04/05 02:56:51 Vérification des contestations de propositions de la DAO de Protocole à défendre...
rocketpool3_node  | 2024/04/05 02:57:01 Vérification des propositions de la DAO de Protocole à contester...
rocketpool3_node  | 2024/04/05 02:57:01 [Arbre réseau] Fichier chargé [network-tree-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 La proposition 177 ne correspond pas aux artefacts de l'arbre local et doit être contestée.
rocketpool3_node  | 2024/04/05 02:57:01 [Snapshot des infos de vote] Fichier chargé [vi-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 [Arbre réseau] Fichier chargé [network-tree-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 La proposition 177 a été vaincue avec l'index de nœud 20, soumission de la défaite...
rocketpool3_node  | 2024/04/05 02:57:01 Cette transaction utilisera des frais max de 19.078965 Gwei, pour un total de jusqu'à 0.002061 - 0.003091 ETH.
rocketpool3_node  | 2024/04/05 02:57:01 La transaction a été soumise avec le hash 0x8cc01dff37205dc98e53f4e9fae7f3c802ecc1c69a01f53e734115a73401287e.
rocketpool3_node  | 2024/04/05 02:57:01 Vous pouvez suivre sa progression en visitant :
rocketpool3_node  | 2024/04/05 02:57:01 https://holesky.etherscan.io/tx/0x8cc01dff37205dc98e53f4e9fae7f3c802ecc1c69a01f53e734115a73401287e
rocketpool3_node  |
rocketpool3_node  | 2024/04/05 02:57:01 En attente de la validation de la transaction...
rocketpool3_node  | 2024/04/05 02:57:13 Proposition vaincue avec succès.
```

Comme les informations de vote du proposeur sont incorrectes, il ne pourra pas répondre à la contestation dans les temps (déterminé par `proposal.challenge.period`). La proposition est considérée comme vaincue à ce stade. Lorsque la proposition est vaincue, notre nœud effectue automatiquement l'appel de contrat `defeatProposal` sur la proposition 177 à l'index 5 pour terminer la proposition.

::: tip NOTE
Les contestataires qui participent à vaincre la proposition reçoivent un montant proportionnel de la caution du proposeur s'ils soumettent un index prouvé incorrect. Tous les autres contestataires reçoivent uniquement leur caution en retour.
:::

Maintenant que la proposition est vaincue, notre nœud (le contestataire) peut [réclamer](./participate#claiming-bonds-and-rewards) sa caution RPL originale ainsi que la caution RPL du proposeur en tant que récompense pour avoir vaincu une proposition frauduleuse.

Si vous êtes curieux d'approfondir les détails du système de proposition et de contestation de la pDAO, consultez les [spécifications techniques](https://github.com/rocket-pool/rocketpool-research/blob/houston/Protocol%20DAO/pdao-prop-challenge-spec.md#draft-protocol-dao-proposal-challenge-system-specification). N'hésitez pas à passer à cette section sur le [processus de contestation](https://github.com/rocket-pool/rocketpool-research/blob/houston/Protocol%20DAO/pdao-prop-challenge-spec.md#challenge-process) si vous êtes intéressé à étudier un exemple qui entre dans les détails de bas niveau.
