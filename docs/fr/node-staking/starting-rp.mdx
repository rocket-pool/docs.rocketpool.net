import { Tab, Tabs } from "@rspress/core/theme";

# Démarrage de Rocket Pool

À ce stade, vous devriez avoir l'infrastructure complète de Rocket Pool en cours d'exécution, y compris la pile Smartnode, un client d'exécution et un client de consensus.
Vous devriez également avoir renforcé votre système d'exploitation contre les attaquants extérieurs.
Si vous avez terminé ces deux étapes, vous êtes prêt à créer un nœud Rocket Pool et à commencer le staking.
Sinon, veuillez consulter les sections précédentes et revenir ici une fois que vous aurez terminé ces étapes.

## Démarrage et arrêt des services Rocket Pool

<div className="p-3">
  <Tabs>
    <Tab label="Mode Docker (par défaut)">
      Maintenant que vous avez installé le Smartnode, démarrer la pile est facile.
      Entrez simplement la commande suivante :

      ```shell
      rocketpool service start
      ```

      Cette commande créera toutes les images Docker nécessaires si elles n'existent pas déjà, s'assurera que le réseau Docker et les volumes de stockage Rocket Pool ont été initialisés, et mettra à jour tous les conteneurs s'ils ne correspondent plus aux paramètres de configuration de l'interface utilisateur de `rocketpool service config`.

      La première fois que vous le faites, la sortie devrait ressembler à ceci :

      ```
      $ rocketpool service start

      Creating network "rocketpool_net" with the default driver
      Creating volume "rocketpool_eth1clientdata" with default driver
      Creating volume "rocketpool_eth2clientdata" with default driver
      Creating rocketpool_eth1 ...
      Creating rocketpool_eth1 ... done
      Creating rocketpool_eth2 ...
      Creating rocketpool_api  ...
      Creating rocketpool_api  ... done
      Creating rocketpool_eth2 ... done
      Creating rocketpool_watchtower ...
      Creating rocketpool_mev-boost   ...
      Creating rocketpool_mev-boost   ... done
      Creating rocketpool_node       ...
      Creating rocketpool_validator  ...
      Creating rocketpool_validator  ... done
      Creating rocketpool_node       ... done
      Creating rocketpool_watchtower ... done
      ```

      Si c'est le cas, alors la pile Smartnode a été initialisée avec succès et est maintenant en cours d'exécution.

      Si vous devez arrêter les services (par exemple, lors d'une mise à niveau ou parce que vous devez effectuer une maintenance), vous pouvez utiliser `rocketpool service stop` pour tout arrêter.
      La sortie devrait ressembler à ceci :

      ```
      $ rocketpool service stop

      Are you sure you want to pause the Rocket Pool service? Any staking minipools will be penalized! [y/n]
      y

      Stopping rocketpool_node       ...
      Stopping rocketpool_validator  ...
      Stopping rocketpool_watchtower ...
      Stopping rocketpool_mev-boost  ...
      Stopping rocketpool_eth2       ...
      Stopping rocketpool_api        ...
      Stopping rocketpool_eth1       ...
      Stopping rocketpool_validator  ... done
      Stopping rocketpool_node       ... done
      Stopping rocketpool_watchtower ... done
      Stopping rocketpool_api        ... done
      Stopping rocketpool_mev-boost  ... done
      Stopping rocketpool_eth2       ... done
      Stopping rocketpool_eth1       ... done
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTE</p>
        Une fois que vous appelez cette commande, Rocket Pool ne démarrera **pas** automatiquement après un redémarrage du système.
        Vous devrez appeler `rocketpool service start` pour démarrer tous les conteneurs Docker et réactiver le démarrage automatique au redémarrage.
      </p>
    </Tab>
    <Tab label="Mode hybride">
      Maintenant que vous avez installé le Smartnode, démarrer la pile est facile.
      Entrez simplement la commande suivante :

      ```shell
      rocketpool service start
      ```

      Cette commande créera toutes les images Docker nécessaires si elles n'existent pas déjà, s'assurera que le réseau Docker et les volumes de stockage Rocket Pool ont été initialisés, et mettra à jour tous les conteneurs s'ils ne correspondent plus aux paramètres de configuration de l'interface utilisateur de `rocketpool service config`.

      La première fois que vous le faites, la sortie devrait ressembler à ceci :

      ```
      $ rocketpool service start

      Creating network "rocketpool_net" with the default driver
      Creating rocketpool_api  ...
      Creating rocketpool_api  ... done
      Creating rocketpool_watchtower ...
      Creating rocketpool_node       ...
      Creating rocketpool_validator  ...
      Creating rocketpool_validator  ... done
      Creating rocketpool_node       ... done
      Creating rocketpool_watchtower ... done
      ```

      Si c'est le cas, alors la pile Smartnode a été initialisée avec succès et est maintenant en cours d'exécution.

      Notez que vos clients d'exécution et/ou de consensus externes ne seront pas listés ici, car Rocket Pool ne les gère pas et ne peut donc pas les démarrer.
      Vous devrez vous assurer de les avoir démarrés séparément, en utilisant le mécanisme avec lequel vous les avez créés à l'origine.

      Si vous devez arrêter les services (par exemple, lors d'une mise à niveau ou parce que vous devez effectuer une maintenance), vous pouvez utiliser `rocketpool service stop` pour tout arrêter.
      La sortie devrait ressembler à ceci :

      ```
      $ rocketpool service stop

      Are you sure you want to pause the Rocket Pool service? Any staking minipools will be penalized! [y/n]
      y

      Stopping rocketpool_node       ...
      Stopping rocketpool_validator  ...
      Stopping rocketpool_watchtower ...
      Stopping rocketpool_api        ...
      Stopping rocketpool_validator  ... done
      Stopping rocketpool_node       ... done
      Stopping rocketpool_watchtower ... done
      Stopping rocketpool_api        ... done
      ```

      Encore une fois, vous serez responsable de vous assurer manuellement que vos clients d'exécution et de consensus sont également arrêtés de manière appropriée, si vous souhaitez qu'ils le soient.

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">NOTE</p>
        Une fois que vous appelez cette commande, Rocket Pool ne démarrera pas automatiquement après un redémarrage du système.
        Vous devrez appeler `rocketpool service start` pour démarrer tous les conteneurs Docker et réactiver le démarrage automatique au redémarrage.
      </p>

    </Tab>
    <Tab label="Mode natif">
      En mode natif, vous avez déjà configuré et démarré les services Smartnode dans le cadre de la section [Configuration d'un nœud Rocket Pool natif sans Docker](./native).

      En supposant que vous les ayez configurés en tant que services `systemd`, vous pouvez les démarrer avec `sudo systemctl start ...`.
      Par exemple, si vous utilisez Geth pour l'exécution et Teku pour le consensus :

      ```shell
      sudo systemctl start geth teku-bn teku-vc rp-node rp-watchtower
      ```

      Les arrêter suit le même processus, mais en utilisant `sudo systemctl stop ...`.

      Notez que l'arrêt des services **ne désactive pas le démarrage automatique** ; les processus démarreront automatiquement au redémarrage.

    </Tab>

  </Tabs>
</div>

## Confirmation de la version et du réseau corrects

Une fois que les conteneurs ou services sont opérationnels, une première étape importante consiste à confirmer que vous disposez des versions correctes des clients et que vous êtes sur le réseau attendu.
Vous pouvez le faire avec la commande suivante :

```shell
rocketpool service version
```

La sortie ressemblera à ceci **(notez que vous pouvez avoir une version plus récente que celle affichée ici, ceci n'est qu'un exemple)** :

```
Your Smartnode is currently using the Ethereum Mainnet.

Rocket Pool client version: 1.6.4
Rocket Pool service version: 1.6.4
Selected Eth 1.0 client: Geth (Locally managed)
Image: ethereum/client-go:v1.10.25
Selected Eth 2.0 client: Lighthouse (Locally managed)
Image: sigp/lighthouse:v3.1.0
```

La première ligne vous indiquera si votre Smartnode est configuré pour le réseau principal Ethereum ou pour le réseau de test Hoodi.

::: warning NOTE
**Pour les utilisateurs Docker / Hybride :**
Si vous n'êtes pas sur le réseau que vous attendez, revenez à la section Installation de Rocket Pool et consultez les instructions d'installation - vous avez peut-être manqué la partie qui contient des instructions différentes selon le réseau que vous souhaitez utiliser.

**Pour les utilisateurs natifs :**
Si vous avez accepté les paramètres par défaut lors de votre première exécution de `rp service config`, il est possible que le réseau signalé ici soit incorrect.
Changez-le simplement dans l'interface TUI de `rp service config`, dans la section `Smartnode`, vers le bon réseau et redémarrez vos services `node` et `watchtower`.
:::

Le deuxième ensemble de lignes vous indiquera quels clients vous utilisez et quelles versions sont définies dans la configuration de Rocket Pool.

## Vérification du statut des services et des journaux

Maintenant que les services Smartnode ont été démarrés, c'est une bonne idée de vérifier qu'ils fonctionnent correctement sans erreurs.

<div className="p-3">
  <Tabs>
    <Tab label="Mode Docker (par défaut)">
      La première chose à vérifier est si les conteneurs Docker fonctionnent bien, ou s'ils redémarrent constamment en raison d'une erreur.
      Exécutez la commande suivante :

      ```shell
      docker ps
      ```

      Les résultats devraient ressembler à ceci :

      ```
      CONTAINER ID   IMAGE                         COMMAND                  CREATED       STATUS      PORTS                                                                                                         NAMES
      4c1de08a352b   prom/prometheus:v2.37.0       "/bin/prometheus --w…"   9 days ago    Up 9 days   9090/tcp                                                                                                      rocketpool_prometheus
      56940decdd1f   sigp/lighthouse:v2.5.1        "sh /setup/start-bn.…"   9 days ago    Up 9 days   0.0.0.0:9001->9001/tcp, 0.0.0.0:9001->9001/udp, :::9001->9001/tcp, :::9001->9001/udp                          rocketpool_eth2
      bd061e632535   grafana/grafana:8.5.9         "/run.sh"                9 days ago    Up 9 days   3000/tcp, 0.0.0.0:3100->3100/tcp, :::3100->3100/tcp                                                           rocketpool_grafana
      5c4db92762fb   ethereum/client-go:v1.10.21   "sh /setup/start-ec.…"   9 days ago    Up 9 days   8545-8546/tcp, 0.0.0.0:30303->30303/tcp, 0.0.0.0:30303->30303/udp, :::30303->30303/tcp, :::30303->30303/udp   rocketpool_eth1
      e20c560861fc   rocketpool/smartnode:v1.5.0   "/bin/sleep infinity"    9 days ago    Up 9 days                                                                                                                 rocketpool_api
      4cf8d364fb90   rocketpool/smartnode:v1.5.0   "/go/bin/rocketpool …"   9 days ago    Up 9 days                                                                                                                 rocketpool_watchtower
      9eb944c29997   rocketpool/smartnode:v1.5.0   "/go/bin/rocketpool …"   9 days ago    Up 9 days                                                                                                                 rocketpool_node
      2ca5d3dcb471   sigp/lighthouse:v2.5.1        "sh /setup/start-vc.…"   9 days ago    Up 9 days                                                                                                                 rocketpool_validator
      dedc577fe361   prom/node-exporter:v1.3.1     "/bin/node_exporter …"   2 weeks ago   Up 9 days                                                                                                                 rocketpool_exporter
      ```

      Le point clé à vérifier est la colonne `STATUS`.
      Si aucune des entrées n'indique `Restarting...`, alors les conteneurs devraient fonctionner correctement (voir la note ci-dessous pour une exception concernant le conteneur `rocketpool_validator`).


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTE</p>
        Si vous utilisez Prysm ou Lodestar comme client de consensus, vous remarquerez probablement que le conteneur `rocketpool_validator` redémarre constamment.
        C'est normal !
        Le conteneur de validateur échouera jusqu'à ce qu'un nouveau validateur ait été créé en utilisant la commande `rocketpool node deposit`, que nous aborderons dans la section [Création d'un Minipool (Validateur)](./create-validator).
        Une fois cela fait, le conteneur fonctionnera correctement - en attendant, ignorez-le simplement.
      </p>

      Néanmoins, il peut être utile de vérifier les journaux des différents services.

      Pour vérifier les journaux, utilisez la commande `rocketpool service logs container`, où `container` est l'un de `eth1`, `eth2`, `validator`, `api`, `node` ou `watchtower`.

      Par exemple, pour vérifier les journaux de votre client ETH1 :

      ```
      $ rocketpool service logs eth1

      Attaching to rocketpool_eth1
      eth1_1        | INFO [06-17|05:17:19.052] Imported new block receipts              count=25   elapsed=26.651ms    number=247,000   hash=6583ec..35eb1c age=2y3mo2w  size=15.72KiB
      eth1_1        | INFO [06-17|05:17:19.098] Imported new block headers               count=192  elapsed=18.515ms    number=247,551   hash=b7d5e4..d49faf age=2y3mo2w
      eth1_1        | INFO [06-17|05:17:19.334] Imported new block receipts              count=371  elapsed=46.450ms    number=247,371   hash=dd3240..1ed173 age=2y3mo2w  size=266.59KiB
      eth1_1        | INFO [06-17|05:17:19.354] Imported new state entries               count=1271 elapsed=2.866ms     processed=374,695 pending=3134  trieretry=0   coderetry=0  duplicate=0 unexpected=0
      eth1_1        | INFO [06-17|05:17:19.441] Imported new block headers               count=384  elapsed=35.331ms    number=247,935   hash=4c4dba..5bf8b6 age=2y3mo2w
      eth1_1        | INFO [06-17|05:17:19.460] Imported new block receipts              count=180  elapsed=33.648ms    number=247,551   hash=b7d5e4..d49faf age=2y3mo2w  size=128.73KiB
      eth1_1        | INFO [06-17|05:17:19.480] Imported new block headers               count=192  elapsed=19.122ms    number=248,127   hash=aa70b9..40d139 age=2y3mo1w
      eth1_1        | INFO [06-17|05:17:19.486] Imported new block receipts              count=6    elapsed=26.042ms    number=247,557   hash=fd6656..ca2439 age=2y3mo2w  size=3.77KiB
      ```

      Vous devriez faire cela à la fois pour `eth1` et `eth2` pour vous assurer que les deux clients fonctionnent sans erreurs.
    </Tab>
    <Tab label="Mode hybride">
      La première chose à vérifier est si les conteneurs Docker fonctionnent bien, ou s'ils redémarrent constamment en raison d'une erreur.
      Exécutez la commande suivante :

      ```shell
      docker ps
      ```

      Les résultats devraient ressembler à ceci :

      ```
      CONTAINER ID   IMAGE                               COMMAND                  CREATED       STATUS         NAMES
      a3c22f54eff0   rocketpool/smartnode:v1.0.0-rc3     "/go/bin/rocketpool …"   2 hours ago   Up 2 minutes   rocketpool_node
      0d5818868ef6   sigp/lighthouse:v1.4.0              "sh /setup/start-val…"   2 hours ago   Up 2 minutes   rocketpool_validator
      88bea525fa89   rocketpool/smartnode:v1.0.0-rc3     "/go/bin/rocketpool …"   2 hours ago   Up 2 minutes   rocketpool_watchtower
      62314e5a0ecf   rocketpool/smartnode:v1.0.0-rc3     "/bin/sleep infinity"    2 hours ago   Up 2 minutes   rocketpool_api
      ```

      Le point clé à vérifier est la colonne `STATUS`.
      Si aucune des entrées n'indique `Restarting...`, alors les conteneurs devraient fonctionner correctement (voir la note ci-dessous pour une exception concernant le conteneur `rocketpool_validator`).

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTE</p>
        Si vous utilisez **Lodestar** ou **Prysm** comme client de consensus, vous remarquerez probablement que le conteneur `rocketpool_validator` redémarre constamment.
        C'est normal !
        Le conteneur de validateur échouera jusqu'à ce qu'un nouveau validateur ait été créé en utilisant la commande `rocketpool node deposit`, que nous aborderons dans la section [Création d'un Minipool (Validateur)](./create-validator).
        Une fois cela fait, le conteneur fonctionnera correctement - en attendant, ignorez-le simplement.
      </p>

      Néanmoins, il peut être utile de vérifier les journaux des différents services.

      Pour vérifier les journaux, utilisez la commande `rocketpool service logs container`, où `container` est l'un de `eth1`, `eth2`, `validator`, `api`, `node` ou `watchtower`.

      Vous pouvez ignorer `eth1` et/ou `eth2` en fonction de ceux que vous maintenez en externe, mais si vous laissez Rocket Pool gérer l'un d'entre eux, vous devriez vérifier son état maintenant en utilisant cette commande.
    </Tab>
    <Tab label="Mode natif">
      La façon la plus simple de vérifier le statut et les journaux en mode natif est d'utiliser les scripts de journalisation que vous avez créés lors de la configuration initiale des services Smartnode.

      Par exemple, pour vérifier le journal de Geth, vous exécuteriez simplement :

      ```shell
      /srv/geth/log.sh
      ```

      Vous devriez voir qu'il progresse lentement sans aucune erreur.
      Faites cela pour vos clients d'exécution et de consensus maintenant pour vérifier qu'ils fonctionnent correctement.
    </Tab>

  </Tabs>
</div>

::: tip ASTUCE
Lorsque vous avez fini de consulter les journaux, vous pouvez quitter et revenir à l'invite de commande en utilisant `Ctrl + C`.
:::

## Attendre que vos clients ETH se synchronisent

Maintenant que vos clients ont démarré, vous allez vouloir attendre que vos clients d'exécution et de consensus aient fini de se synchroniser avec le réseau avant de continuer.

Un moyen simple de vérifier leur état est la commande suivante :

```shell
rocketpool node sync
```

Cette commande vous montrera la progression de vos clients d'exécution et de consensus dans le processus de synchronisation, similaire à ceci :

```shell
$ rocketpool node sync

Your Smartnode is currently using the Hoodi Test Network.

Your eth2 client is on the correct network.

Your primary execution client is fully synced.
You do not have a fallback execution client enabled.
Your consensus client is still syncing (99.69%).
```

Vous pouvez appeler ceci occasionnellement pour suivre la progression de vos clients.

Pour obtenir une estimation réelle du temps de synchronisation, il est plus facile de consulter les journaux de vos clients avec `rocketpool service logs eth1` et `rocketpool service logs eth2` respectivement (ou les commandes de script de journal équivalentes si vous utilisez les modes hybride / natif).
Chaque client fournit généralement une estimation de son état de synchronisation dans sa sortie de journal.

::: tip NOTE
Il peut prendre **des jours** pour synchroniser complètement ETH1 et ETH2 en fonction de votre sélection de clients et du profil matériel de votre machine.
**C'est normal**.
Détendez-vous, relaxez-vous et attendez que les deux se terminent.
:::

::: warning NOTE
Si votre nœud ne se synchronise pas du tout ou n'a pas de pairs, cela peut être dû au fait que votre routeur bloque les ports 30303 et 9001. S'ils sont fermés, vous devrez configurer la redirection de port sur votre routeur. De plus, assurez-vous que votre nœud a une adresse IP locale statique afin que la redirection de port ne soit pas interrompue en raison de l'attribution d'une nouvelle adresse à votre nœud.
:::

## Prochaines étapes

Une fois que vos clients sont synchronisés, vous êtes prêt soit à [créer un nouveau portefeuille](./wallet-init) s'il s'agit de votre premier nœud, soit à [récupérer un portefeuille existant](./recovering-rp) si vous restaurez depuis une sauvegarde ou migrez depuis un autre fournisseur comme Allnodes vers votre propre matériel.

Sélectionnez celui que vous souhaitez en savoir plus et suivez les étapes du guide correspondant.
