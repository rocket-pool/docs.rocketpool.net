import { Tab, Tabs } from "@rspress/core/theme";

# Migration du Réseau de Test vers le Réseau Principal

Si vous avez déjà utilisé Rocket Pool sur notre réseau de test Hoodi, que vous êtes à l'aise avec son fonctionnement et que vous êtes prêt à staker de l'ETH ou à exploiter un nœud pour de vrai sur la chaîne Ethereum principale, alors ce guide est pour vous !
Vous trouverez ici des instructions sur la façon de migrer une stack Smartnode existante du réseau de test Hoodi vers une stack connectée au réseau principal Ethereum, prête pour le staking de vos propres ETH et RPL réels.

## Staking de Pool sur le Réseau Principal

Le staking de pool est largement le même processus sur le réseau principal que sur le réseau de test.
L'URL sera différente et l'adresse du token rETH peut être différente, mais il n'y a pas de changements significatifs dans le flux de travail.
Suivez le [Guide de Staking](../../liquid-staking/overview), qui a été mis à jour avec les instructions pour le réseau principal.

### Différences Entre le Réseau de Test et le Réseau Principal

- Le Smartnode du réseau de test dispose d'un robinet pour l'ETH de test. Le Smartnode du réseau principal **n'a pas de robinet**. Vous devrez fournir votre propre ETH pour staker.
- Le réseau principal prend en charge de nombreux portefeuilles Ethereum via WalletConnect, vous pouvez donc utiliser d'autres portefeuilles que vous ne pouviez pas utiliser sur le réseau de test. **Vous n'êtes plus limité à l'utilisation de Metamask pour staker**.

## Exploitation d'un Smartnode sur le Réseau Principal

::: danger NOTE
**Rien** du réseau de test ne peut être migré vers le réseau principal.
Les données de chaîne sont différentes pour l'Exécution et le Consensus, vous devez donc supprimer les anciennes données de chaîne et resynchroniser les chaînes du réseau principal à partir de zéro.
Vos validateurs sur le réseau de test ne sont pas transférés vers le réseau principal.
De plus, pour des raisons de sécurité, de compatibilité et de sécurité, **vous devez créer un nouveau portefeuille sur le réseau principal !**
**N'utilisez pas le portefeuille de votre nœud de test sur le réseau principal !**

**Les étapes suivantes supprimeront toutes vos données de test.**
Si vous souhaitez conserver votre configuration de réseau de test, vous devez sauvegarder votre disque dur ou le déplacer vers une deuxième machine.
:::

### Différences Entre le Réseau de Test et le Réseau Principal

- Le Smartnode du réseau de test dispose d'un robinet pour l'ETH et le RPL. Le Smartnode du réseau principal **n'a pas de robinet**. Vous devrez fournir votre propre ETH et votre propre RPL.
- Si vous utilisez Geth, la charge de travail de votre nœud sera **considérablement plus élevée**. Geth nécessite environ 40 fois l'espace de stockage de Hoodi et nécessite plus de puissance CPU et de RAM pour traiter. Si vous utilisez le tableau de bord Grafana de Rocket Pool, préparez-vous à voir une utilisation beaucoup plus élevée.
  Un nœud Geth complet utilise 1,4 To au 19 septembre 2025. [L'expiration des données de bloc avant la fusion](../maintenance/history-expiry) peut réduire l'utilisation du stockage d'environ 300 à 500 Go.
- Vos pairs de Beacon Chain (et donc votre efficacité d'attestation) seront **plus élevés** que sur le réseau de test. Les pairs sur le réseau principal sont beaucoup plus diversifiés et ont tendance à être de meilleure qualité que sur le réseau de test.
- Le point de contrôle des récompenses RPL se produit tous les **28 jours** au lieu de tous les 2 jours, pour aider à compenser les coûts de gaz élevés.
- Le prix RPL utilisé par le réseau Rocket Pool (et donc votre niveau de collatéral) ainsi que le RPL staké effectif total sur le réseau sont signalés **une fois toutes les 24 heures** au lieu d'une fois par heure.

### Migration Automatique (Mode Docker Uniquement)

Pour les utilisateurs du mode Docker, le Smartnode peut migrer vers le réseau principal pour vous automatiquement.

**Pendant que vous avez encore le réseau de test configuré**, sortez vos validateurs sur Hoodi :

```
rocketpool minipool exit
```

Sélectionnez `1: All available minipools` dans la liste de choix et attendez qu'il se termine.
Cela aidera à nettoyer le réseau en supprimant vos validateurs au lieu de les laisser échouer constamment les attestations et affaiblir la santé de Hoodi (puisqu'ils ne sont plus en ligne).

Une fois cela fait, ouvrez le Gestionnaire de Paramètres :

```
rocketpool service config
```

Ensuite, ouvrez la catégorie **Smartnode and TX Fees** et changez le menu déroulant **Network** de `Hoodi Testnet` à `Ethereum Mainnet` :

<img src="../images/tui-change-network.png" width="100%" height="auto" />

Lorsque vous enregistrez et quittez, vous serez invité avec une notification que tout est sur le point d'être effacé et une boîte de dialogue de confirmation :

```
WARNING: You have requested to change networks.

All of your existing chain data, your node wallet, and your validator keys will be removed.

Please confirm you have backed up everything you want to keep, because it will be deleted if you answer `y` to the prompt below.

Would you like the Smartnode to automatically switch networks for you? This will destroy and rebuild your `data` folder and all of Rocket Pool's Docker containers. [y/n]
```

Sauvegardez tout ce que vous souhaitez conserver (comme votre dossier `data` qui contient votre portefeuille de nœud et vos clés de validateur), puis appuyez sur `y` et `Entrée` lorsque vous êtes prêt.
Le Smartnode gérera le changement automatiquement.

Lorsque c'est terminé, vous aurez une installation fraîche sur le réseau principal.
Tous vos paramètres (comme le choix du client) seront préservés, mais vous devrez créer un nouveau portefeuille. De plus, vous n'aurez probablement pas d'_URL de Synchronisation de Point de Contrôle_ sur le réseau principal et devriez en configurer une comme expliqué [ici](../config-docker#beacon-chain-checkpoint-syncing) ; sinon, il faudra beaucoup de temps pour synchroniser la beacon chain du réseau principal.

### Migration Manuelle

Si pour une raison quelconque vous ne pouvez pas utiliser le processus de migration automatique du Smartnode, vous pouvez le faire manuellement en quelques étapes simples :

<div className="p-3">
  <Tabs>
    <Tab label="Docker">
      1. **Pendant que vous avez encore le réseau de test configuré**, sortez vos validateurs sur Hoodi :

      ```shell
      rocketpool minipool exit
      ```

      Sélectionnez `1: All available minipools` dans la liste de choix et attendez qu'il se termine.
      Cela aidera à nettoyer le réseau en supprimant vos validateurs au lieu de les laisser échouer constamment les attestations et affaiblir la santé de Hoodi (puisqu'ils ne sont plus en ligne).

      2. Arrêtez le réseau de test :

      ```shell
      rocketpool service stop
      ```

      3. Supprimez vos données de chaîne de test et les conteneurs Docker :

      ```shell
      rocketpool service terminate
      ```

      4. Supprimez votre dossier de configuration Rocket Pool :

      ```shell
      sudo rm -rf ~/.rocketpool
      ```

      5. (Optionnel) Supprimez votre CLI Rocket Pool :

      ```shell
      rm ~/bin/rocketpool
      ```
      Vous écraserez cela avec la dernière version de la CLI de toute façon, mais si vous voulez être minutieux, vous pouvez d'abord supprimer l'ancienne.

      À ce stade, votre installation de réseau de test a été purgée, et vous pouvez migrer en toute sécurité vers une nouvelle installation de réseau principal.
      Suivez attentivement le guide [Création d'un Nœud avec Docker](../docker).
    </Tab>
    <Tab label="Native Mode">
      1. **Pendant que vous avez encore le réseau de test configuré**, sortez vos validateurs sur Hoodi :

      ```shell
      rocketpool minipool exit
      ```

      Sélectionnez `1: All available minipools` dans la liste de choix et attendez qu'il se termine.
      Cela aidera à nettoyer le réseau en supprimant vos validateurs au lieu de les laisser échouer constamment les attestations et affaiblir la santé de Hoodi (puisqu'ils ne sont plus en ligne).

      2. Arrêtez tous les services Rocket Pool et Ethereum (en utilisant, par exemple, `geth` et `lighthouse` ; remplacez par les services que vous avez créés lors de l'installation) :

      ```shell
      sudo systemctl stop rp-node rp-watchtower geth lh-bn lh-vc
      ```

      3. Supprimez toutes les données de chaîne du réseau de test (par exemple, en utilisant `geth` et `lighthouse` sur x64 ; remplacez par votre propre configuration) :

      ```shell
      sudo rm -rf /srv/geth/geth_data
      sudo rm -rf /srv/lighthouse/lighthouse_data
      ```

      4. Supprimez le dossier de configuration Rocket Pool :

      ```shell
      sudo rm -rf /srv/rocketpool
      ```

      5. (Optionnel) Supprimez les binaires CLI et Daemon de Rocket Pool :
      ```shell
      sudo rm /usr/local/bin/rocketpool /usr/local/bin/rocketpoold
      ```
      Vous écraserez ceux-ci avec les dernières versions de toute façon, mais si vous voulez être minutieux, vous pouvez d'abord supprimer les anciens.

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTE</p>
        Par souci de simplicité, ces instructions _n'incluent pas_ certaines étapes telles que la suppression des utilisateurs `eth1` et `eth2`, ou la suppression des services que vous avez arrêtés plus tôt.
        Vous pouvez les réutiliser et ignorer les étapes impliquées dans leur configuration dans le guide d'installation.

        Vous devrez refaire certaines des étapes d'installation, notamment :

        - Créer le dossier `/srv/rocketpool` et sa structure squelette, et définir correctement les permissions
        - Obtenir les dernières versions des binaires du client d'Exécution et de Consensus, et du Validateur
        - Définir la **chaîne `ExecStart`** dans les services (**utilisez la configuration du réseau principal définie dans le guide d'installation !**)
        - Obtenir les derniers binaires CLI et Daemon
            - Obtenir les derniers fichiers de configuration de l'archive d'installation, les placer dans `/srv/rocketpool`, et les ajuster pour correspondre à la configuration de votre nœud
      </p>

      À ce stade, vous êtes prêt à migrer en suivant le [guide d'installation native](../native).
    </Tab>

  </Tabs>
</div>
