import claim_rewards_gb from "./images/claim-rewards-gb.png";
import autostake from "./images/autostake.png";

# Réclamer les récompenses du Node Operator

En tant que Node Operator Rocket Pool, vous avez droit à des récompenses régulières qui seront fournies sous forme de jetons RPL et (si vous êtes inscrit au Smoothing Pool) d'ETH également.
Cette section décrira comment fonctionnent ces récompenses et comment vous pouvez les réclamer.

## Récompenses et checkpoints

À intervalles réguliers, Rocket Pool marquera un **checkpoint** sur le réseau.
Actuellement, les checkpoints se produisent **tous les 28 jours**.

Lors d'un nouveau checkpoint, l'Oracle DAO créera collectivement un **véritable instantané** de l'état des Node Operators du réseau Rocket Pool, qu'il utilisera pour déterminer les récompenses RPL et ETH du Smoothing Pool pour chaque nœud pendant cet intervalle. Notez que la "commission bonus" pour les minipools Saturn 0 est distribuée via les récompenses du Smoothing Pool (les minipools Saturn 0 sont ceux créés après le 28/10/2024, qui ont une commission de contrat de 5%).

Ces informations sont compilées dans un [Merkle Tree](https://en.wikipedia.org/wiki/Merkle_tree) - un moyen extrêmement efficace de rendre tous les détails disponibles aux smart contracts.
Le Merkle Tree est construit dans un fichier JSON et hébergé sur l'[InterPlanetary File System (IPFS)](https://en.wikipedia.org/wiki/InterPlanetary_File_System) et dupliqué sur [un dépôt GitHub que nous maintenons](https://github.com/rocket-pool/rewards-trees/).

Une fois l'arbre soumis, les smart contracts Rocket Pool créeront de nouveaux jetons RPL et les déplaceront, avec le solde ETH complet du Smoothing Pool, dans le coffre-fort Rocket Pool pour un stockage sécurisé.
Vous pouvez ensuite voir combien de récompenses RPL et ETH vous avez gagnées pendant cet intervalle et réclamer ces récompenses.

Le système de récompenses présente les caractéristiques suivantes :

- Chaque intervalle est indépendant. Le montant de RPL et d'ETH que vous avez gagné dans un intervalle n'affecte pas les gains des intervalles suivants.
- Vous pouvez **laisser les récompenses s'accumuler** aussi longtemps que vous le souhaitez. Vous n'avez pas besoin de réclamer les récompenses avant un moment précis ; elles seront toujours disponibles pour que vous les réclamiez, et fourniront toujours exactement le même montant de RPL et d'ETH **quel que soit le moment où vous les réclamez**.
- Vous pouvez réclamer un intervalle à la fois, ou **plusieurs intervalles** en une seule fois.
- Votre première transaction de réclamation utilise environ 85k gas. Chaque transaction de réclamation suivante coûte environ 55k gas.
  - Si vous réclamez plusieurs intervalles à la fois, chaque intervalle supplémentaire coûte **6k gas**, il est donc plus rentable de réclamer autant d'intervalles que possible en une seule fois.
- Vous pouvez **restaker une partie (ou la totalité) de vos récompenses RPL** dans le cadre de la transaction de réclamation afin que tout soit fait en une seule transaction (ce qui réduit encore les coûts de gas).
- Actuellement, **toutes vos réclamations doivent être sur le Mainnet** mais nous avons l'infrastructure en place pour construire la capacité de réclamer sur les réseaux de couche 2 à une date ultérieure.

Pour plus d'informations sur la façon dont le Merkle Tree est construit et comment les récompenses sont calculées, [veuillez visiter notre dépôt `research` et consulter les spécifications officielles](https://github.com/rocket-pool/rocketpool-research/tree/master/Merkle%20Rewards%20System).
Nous en avons fourni une brève explication ci-dessous.

### Récompenses RPL

Le taux de récompense actuel de RPL est **une inflation de 5% par an** et les récompenses sont versées toutes les périodes de 28 jours.
Au 21/10/2024, l'inflation de la dernière période était de 77 533. Puisque 70% sont distribués aux Node Operators Rocket Pool, cela représentait 54 273 RPL pour cette période.

Ce montant sera divisé entre tous les Node Operators du réseau, en fonction de leur [poids de nœud](https://rpips.rocketpool.net/RPIPs/RPIP-30#specification).
Les Node Operators gagnent le rendement annuel maximum pour les positions RPL stakées d'une valeur de 0 à 15% de l'ETH emprunté.
Le stake RPL au-delà de 15% de l'ETH emprunté rapporte toujours des récompenses supplémentaires, mais à un rendement annuel marginal réduit.

Si moins de 28 jours se sont écoulés entre le moment où vous avez enregistré votre nœud et le checkpoint, vos récompenses dans ce premier intervalle de récompenses seront **au prorata** pour tenir compte de cela. Par exemple, si vous vous êtes inscrit le jour 14 de l'intervalle, vous recevriez 50% des récompenses normales.

Après ce premier intervalle, votre nœud aura été enregistré suffisamment longtemps lors des intervalles suivants pour que vous receviez des récompenses complètes pour tous.

La commande `rocketpool node status` vous montrera votre ratio de collatéralisation actuel à tout moment. Ce ratio de collatéralisation sera basé sur les prix au moment où vous exécutez la commande. Cependant, si vous voulez connaître votre ratio de collatéralisation lors du prochain tour de récompenses, suivez les étapes suivantes :

- Exécutez la commande `/when` dans le canal "random" du [Discord Rocketpool](https://discord.com/channels/405159462932971535/405503016234385409), et voyez combien d'heures restent avant le début de la prochaine période de récompenses.
- L'oDAO prend un instantané de prix toutes les 19,2 heures (c'est-à-dire environ 5760 blocs \* 12 secondes, excluant les blocs manqués). Par conséquent, vérifier le contrat de soumission de prix de l'oDAO dans Etherscan vous indiquera si un instantané de prix a été pris dans les 19,2 heures précédentes avant l'heure indiquée dans le point précédent. Si c'est le cas, l'instantané de prix a été pris. Sinon, il reste à faire et vous pouvez estimer quand cela se produira en regardant le dernier tour de soumissions de prix de l'oDAO et en ajoutant 19,2 heures.
- Pour vérifier quel ratio de prix RPL/ETH a été pris comme instantané par l'oDAO pour le prochain tour de récompenses, consultez le contrat de soumission de prix de l'oDAO dans Etherscan (que vous pouvez obtenir en exécutant la commande `/get_address_of_contract contract:rocketNetworkPrices` dans le canal "random" du Discord Rocketpool). Ensuite, ouvrez une ou plusieurs des transactions soumises par les membres de l'oDAO. <a href="/images/node/rewards/rewards-1.png" target="_blank"><img src="/images/node/rewards/rewards-1.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Descendez et dans la section "More Details", cliquez sur **"+ Click to show more"**, puis cliquez sur **"Decode Input Data"**. <a href="/images/node/rewards/rewards-2.png" target="_blank"><img src="/images/node/rewards/rewards-2.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Le prix RPL (affiché en unités wei) affiché dans la boîte Input Data, divisé par 10^18 (pour le convertir en unités ETH) multiplié par le nombre de RPL stakés, devrait être >= 1,6 ETH (pour les minipools de 16 ETH) et >= 2,4 ETH (pour les LEB8), fois le nombre de minipools de chaque type que vous exploitez. <a href="/images/node/rewards/rewards-3.png" target="_blank"><img src="/images/node/rewards/rewards-3.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Si votre ratio de collatéralisation est inférieur au montant requis comme expliqué dans le point précédent, vous pouvez staker du RPL supplémentaire dans le temps entre le moment où l'oDAO a pris le dernier instantané de prix (voir point 3 ci-dessus) et le moment où le prochain tour de récompenses commence (voir points 1 et 2 ci-dessus), afin de ramener votre nœud à un ratio de collatéralisation >=10%.
- Une alternative à la vérification des soumissions de prix de l'oDAO dans Etherscan consiste à surveiller le canal "events" du Discord Rocketpool et à rechercher le message **RPL Price Update** du bot Rocket Watch (voir l'exemple ci-dessous) dans les 19,2 dernières heures avant le début de la prochaine période de récompenses. <a href="/images/node/rewards/rewards-4.png" target="_blank"><img src="/images/node/rewards/rewards-4.png" style={{ display: "block", margin: "0 auto" }} /></a>

### Récompenses ETH du Smoothing Pool

Avec les récompenses RPL, l'ensemble du solde ETH du Smoothing Pool est distribué lors des checkpoints de récompenses.
Sur l'ensemble du solde de récompenses du Smoothing Pool, le pourcentage qui correspond aux stakers de pool (50% pour les minipools de 16 ETH, ou 75% pour les LEB8), moins la commission de nœud respective, sera envoyé au contrat rETH. Là, il peut soit 1) être brûlé contre de l'ETH pour les stakers de pool qui veulent sortir, soit 2) être utilisé pour créer plus de minipools.
La portion restante sera distribuée parmi les Node Operators éligibles.

Les nœuds qui sont inscrits au Smoothing Pool pendant l'intervalle, même si ce n'est qu'une partie du temps, sont éligibles pour une portion du solde total du Smoothing Pool.
Le solde est instantané au checkpoint de récompenses, et l'Oracle DAO détermine la portion de chaque nœud éligible.
La portion est déterminée par les facteurs suivants :

- Durée dans le Smoothing Pool pendant cet intervalle
- Performance d'attestation sur la Beacon Chain pour chaque minipool
- La commission de chaque minipool

Si vous souhaitez en savoir plus, veuillez consulter le dépôt `research` lié ci-dessus pour une description complète de la façon dont les récompenses sont calculées.

### (Optionnel) Générer l'arbre de récompenses

Lorsqu'un nouveau checkpoint de récompenses est atteint, l'Oracle DAO commencera à construire l'arbre de récompenses pour cet intervalle.
La construction de cet arbre prend actuellement environ 2 heures, et les récompenses de l'intervalle ne sont disponibles à la réclamation qu'une fois l'arbre construit et soumis.
Une fois disponible, votre nœud téléchargera automatiquement ce fichier et vous pourrez voir et réclamer vos récompenses pour cet intervalle.

Si vous souhaitez générer l'arbre vous-même au lieu de télécharger celui préconstruit par l'Oracle DAO, vous pouvez le faire !

- Entrez dans le TUI `rocketpool service config`.
- Naviguez vers la section `Smartnode and TX Fees`.
- Changez le `Rewards Tree Mode` de `Download` à `Generate`.
- Si votre client Execution principal n'est pas un nœud d'archive, vous pouvez ajouter une URL pour un nœud d'archive séparé dans la boîte `Archive-Mode EC URL`.
  - Ceci est nécessaire pour générer les arbres de récompenses historiques.
  - L'Archive EC ne sera utilisé que pour la génération d'arbres ; il ne sera utilisé pour aucune autre tâche du Smartnode.
  - [Infura](https://infura.io/product/ethereum) et [Alchemy](https://www.alchemy.com/supernode) offrent un accès aux nœuds d'archive. **Notez que les niveaux gratuits ne sont généralement pas suffisants pour gérer la génération d'arbres, vous aurez donc besoin d'un des niveaux payants.**

Maintenant, votre Smartnode construira l'arbre complètement indépendamment de l'Oracle DAO, en utilisant uniquement les données fournies par vos clients Execution et Consensus.
Vous pouvez le surveiller lors d'un checkpoint d'intervalle de récompenses avec `rocketpool service logs watchtower`.

Si vous souhaitez reconstruire les arbres passés des intervalles précédents, vous pouvez le faire avec la commande suivante :

```shell
rocketpool network generate-rewards-tree
```

Suivez les invites, puis utilisez `rocketpool service logs watchtower` pour voir sa progression.

## Réclamer les récompenses

Pour voir vos récompenses non réclamées en attente, exécutez la commande suivante :

```shell
rocketpool node claim-rewards
```

Au fur et à mesure que les intervalles passent et que vous accumulez des récompenses, la sortie ressemblera à ceci :

<img src={claim_rewards_gb} width="100%" height="auto" />

Ici, vous pouvez rapidement voir combien de récompenses vous avez gagnées à chaque intervalle, et pouvez décider lesquelles vous souhaitez réclamer.

Vous pouvez également spécifier un montant que vous souhaitez restaker lors de cette réclamation :

<img src={autostake} width="100%" height="auto" />

Cela vous permettra de composer vos récompenses RPL en une seule transaction, ce qui économise les coûts de gas.

Suivez simplement les invites, assurez-vous que votre portefeuille de nœud dispose de suffisamment d'ETH pour payer les coûts de gas de la réclamation, et c'est terminé !
**Vos récompenses seront envoyées à votre adresse de retrait.**

::: tip ASTUCE
Pour voir les récompenses totales de votre nœud, y compris celles que vous avez déjà réclamées, utilisez la commande suivante :

```shell
rocketpool node rewards
```

Cela fournira une ventilation de la quantité de RPL et d'ETH que vous avez réclamée jusqu'à présent, et de ce qui n'est toujours pas réclamé :

```
=== ETH ===
You have earned 8.1935 ETH from the Beacon Chain (including your commissions) so far.
You have claimed 0.0634 ETH from the Smoothing Pool.
You still have 3.4788 ETH in unclaimed Smoothing Pool rewards.

=== RPL ===
The current rewards cycle started on 27 Sep 22 21:26 EDT.
It will end on 30 Sep 22 21:26 EDT (20h35m17s from now).
You currently have 675.616380 unclaimed RPL from staking rewards.

Your estimated RPL staking rewards for this cycle: 36.851544 RPL (this may change based on network activity).
Based on your current total stake of 6615.797278 RPL, this is approximately 67.77% APR.
Your node has received 208.551820 RPL staking rewards in total.

You may claim these rewards at any time. You no longer need to claim them within this interval.
```

:::

## Récompenses de la couche Execution dans votre Fee Distributor

Si vous n'êtes **pas** inscrit au Smoothing Pool, la portion de la couche Execution de vos récompenses des propositions de blocs (y compris les frais de transaction et MEV) sera envoyée au contrat [Fee Distributor](./fee-distrib-sp#fee-distributors-and-the-smoothing-pool) de votre nœud à la place.

Pour vérifier le solde de votre Fee Distributor, vous pouvez soit utiliser un explorateur de chaîne comme [https://etherscan.io](https://etherscan.io), soit simplement exécuter `rocketpool node status` - il y aura une section appelée **Fee Distributor and Smoothing Pool** qui le montre :

```
=== Fee Distributor and Smoothing Pool ===
The node is not opted into the Smoothing Pool.
To learn more about the Smoothing Pool, please visit /fr/legacy/redstone/whats-new.html#smoothing-pool.
The node's fee distributor 0xA0bfbFC582f5814585f8455Ed6D7B620eA9a9EE4 has a balance of 1.143598 ETH.
```

### Distribuer le solde

Pour accéder au solde du Fee Distributor, vous allez le **distribuer** (d'où le nom, _Fee Distributor_).
Cela calculera votre part des récompenses (en fonction de la commission moyenne de minipool de votre nœud) et l'enverra à l'adresse de retrait de votre nœud ; le reste est envoyé au pool de staking.

La distribution peut être effectuée **à tout moment**.
Vous pouvez laisser le solde s'accumuler si vous le souhaitez, ou le distribuer régulièrement.

Pour distribuer le solde, exécutez la commande suivante :

```shell
rocketpool node distribute-fees
```

Cela montrera combien vous revient et combien va au pool de staking :

```
Your node's average commission is 15.00%.
Your fee distributor's balance of 1.143599 ETH will be distributed as follows:
 Your withdrawal address will receive 0.657569 ETH.
 rETH pool stakers will receive 0.486030 ETH.
```

Confirmez simplement le prix du gas que vous souhaitez et soumettez la transaction.
Une fois terminée, votre part des récompenses sera disponible dans l'adresse de retrait de votre nœud.
