import tui_select_ec from "./images/tui-select-ec.png";
import tui_confirm_ec from "./images/tui-confirm-ec.png";
import tui_select_cc from "./images/tui-select-cc.png";
import tui_checkpoint_sync from "./images/tui-checkpoint-sync.png";
import tui_confirm_cc from "./images/tui-confirm-cc.png";

# Changer de client d'exécution ou de consensus

Dans des circonstances normales, vous sélectionnerez probablement simplement un client d'exécution et de consensus lors de la création initiale de votre nœud Rocket Pool et vous les laisserez fonctionner sans problème pendant toute la durée de vie de votre nœud.
Cependant, il existe quelques situations où vous pourriez vouloir modifier votre sélection de client.
Voici quelques exemples :

- Votre client gagne une part de [supermajorité](https://clientdiversity.org/) sur les chaînes d'exécution ou Beacon, et vous souhaitez changer pour la santé globale du réseau
- Un bug empêche votre client de fonctionner correctement, et vous devez revenir en ligne rapidement pour reprendre vos tâches de validation
- Vous voulez essayer une nouvelle fonctionnalité qu'offre un autre client
- Un autre client est mieux adapté au matériel de votre nœud (par exemple, certains clients sont meilleurs sur les systèmes ARM que d'autres)

Heureusement, la stack Smartnode rend le changement de client extrêmement facile.
Il suffit de quelques modifications dans l'interface TUI de configuration, et quelques commandes supplémentaires optionnelles pour sauvegarder les données de votre client existant avant de changer de client.

## Changer de client d'exécution

Avant de changer de client d'exécution, il est important de noter les points suivants :

- Les données de chaîne **ne sont pas partagées** entre les clients. Votre nouveau client devra resynchroniser les données de la chaîne Mainnet, ce qui peut prendre du temps (bien que chaque client prenne en charge la synchronisation rapide, que le Smartnode utilise pour accélérer la resynchronisation).
- Par défaut, le Smartnode laissera les données de chaîne de votre ancien client sur votre disque au cas où vous voudriez revenir à votre ancien client d'exécution et reprendre là où vous vous étiez arrêté. Vous pouvez **l'exporter vers un emplacement différent** et le supprimer pour libérer de l'espace avant de changer de client, car les clients d'exécution peuvent utiliser des centaines de gigaoctets. Nous avons des étapes ci-dessous sur la façon de procéder.
- Pendant que votre nouveau client se resynchronise, la plupart des fonctions CLI du Smartnode seront hors ligne car elles dépendent du client d'exécution. **Vous devriez avoir un client d'exécution de secours disponible avant de faire cela pour atténuer les temps d'arrêt sur votre Smartnode.**

### (Optionnel) Exporter la base de données de votre client d'exécution

La première étape du processus est optionnelle : si vous le souhaitez, vous pouvez exporter les données de chaîne existantes de votre client d'exécution actuel.
Cela vous permettra de libérer un espace disque précieux sur votre nœud pour votre nouveau client d'exécution, et vous pouvez conserver les anciennes données de chaîne au cas où vous voudriez revenir à l'ancien client et reprendre là où vous vous étiez arrêté.

Veuillez vous référer au guide [Sauvegarder votre nœud](./backups##backing-up-your-execution-chain-data) pour plus de détails.

### Changer votre client d'exécution sélectionné

Pour changer de client sélectionné, exécutez `rocketpool service config` pour entrer dans l'interface de configuration.
Naviguez jusqu'à la section `Execution Client (ETH1)`, et sélectionnez le menu déroulant `Execution Client` :

<img src={tui_select_ec} width="100%" height="auto" />

Ouvrez le menu déroulant avec `Entrée`, utilisez les touches fléchées pour naviguer vers votre client de choix, et appuyez à nouveau sur `Entrée` pour confirmer la sélection.

Notez que chaque client a ses propres options uniques, vous pourriez donc voir des paramètres supplémentaires apparaître dans cet écran après avoir sélectionné un client différent.
N'hésitez pas à les explorer pour voir comment ils affectent les choses.

Lorsque vous êtes satisfait de votre choix, appuyez sur `Échap` pour revenir au menu principal, puis sur `Tab` pour mettre en surbrillance le bouton `Review Changes and Save`.
Vous verrez apparaître l'écran de révision, qui affichera votre changement de sélection de client :

<img src={tui_confirm_ec} width="100%" height="auto" />

Appuyez sur `Entrée` pour accepter les modifications, et vous avez terminé !
Votre nouveau client d'exécution commencera à se synchroniser immédiatement.
Comme d'habitude, vous pouvez le suivre avec `rocketpool service logs eth1`.
**Nous vous recommandons de le faire pour vérifier qu'il n'y a pas d'erreurs, et qu'il fonctionne correctement.**

::: danger NOTE
Maintenant que les couches d'exécution et de consensus ont fusionné, arrêter votre client d'exécution _arrêtera également_ votre client de consensus jusqu'à ce que votre client d'exécution ait fini de se resynchroniser.
Cela signifie que votre nœud **cessera d'attester et de proposer des blocs, et il perdra de l'ETH au lieu d'en gagner !**

Pour éviter cela et continuer à valider pendant que votre client d'exécution se resynchronise, **veuillez configurer un [nœud de secours](./fallback)**.
:::

### (Recommandé) Supprimer vos anciennes données de chaîne

Ce n'est pas une étape obligatoire, mais nous vous **recommandons fortement** de supprimer les données de chaîne de votre ancien client maintenant que vous êtes passé à un nouveau afin de libérer de l'espace disque.

Pour ce faire, exécutez simplement la commande suivante :

```shell
rocketpool service resync-eth1
```

Cela supprimera toutes les données de votre client d'exécution et le redémarrera.

::: tip ASTUCE
Puisque vous venez de sélectionner un nouveau client d'exécution, il ne sera pas affecté par cela - essentiellement, tout ce que cela fera est de supprimer vos anciennes données de chaîne.
Vous devriez le faire dès que possible après avoir changé de client pour éviter une perte inutile de progression sur votre nouveau client.
:::

## Changer de client de consensus

Changer de client de consensus est encore plus facile que changer de client d'exécution, grâce à [Checkpoint Sync](./config-docker#beacon-chain-checkpoint-syncing).
Cette fonctionnalité vous permet de synchroniser immédiatement un nouveau client de consensus avec le réseau, il n'est donc pas nécessaire de conserver vos anciennes données de chaîne.

Commencez par utiliser l'interface `rocketpool service config` et naviguez jusqu'à la section `Consensus Client (ETH2)`.
Ensuite, sélectionnez le menu déroulant `Consensus Client` :

<img src={tui_select_cc} width="100%" height="auto" />

Ouvrez le menu déroulant avec `Entrée`, utilisez les touches fléchées pour naviguer vers votre client de choix, et appuyez à nouveau sur `Entrée` pour confirmer la sélection.

Notez que chaque client a ses propres options uniques, vous pourriez donc voir des paramètres supplémentaires apparaître dans cet écran après avoir sélectionné un client différent.
N'hésitez pas à les explorer pour voir comment ils affectent les choses.

Ensuite, vérifiez que vous utilisez un fournisseur Checkpoint Sync :

<img src={tui_checkpoint_sync} width="100%" height="auto" />

Si vous n'avez pas de fournisseur Checkpoint Sync configuré, [vous pouvez facilement utiliser les instructions ici pour le faire gratuitement](./config-docker#beacon-chain-checkpoint-syncing) !

Lorsque vous êtes satisfait de votre choix, appuyez sur `Échap` pour revenir au menu principal, puis sur `Tab` pour mettre en surbrillance le bouton `Review Changes and Save`.
Vous verrez apparaître l'écran de révision, qui affichera votre changement de sélection de client :

<img src={tui_confirm_cc} width="100%" height="auto" />

Appuyez sur `Entrée` pour accepter les modifications, et vous avez terminé !
Votre nouveau client de consensus commencera à se synchroniser immédiatement.
Comme d'habitude, vous pouvez le suivre avec `rocketpool service logs eth2`.
**Nous vous recommandons de le faire pour vérifier qu'il n'y a pas d'erreurs, et qu'il fonctionne correctement.**
