import nimbus_dashboard from "./images/nimbus-dashboard.png";
import tui_checkbox_checked from "./images/tui-checkbox-checked.png";
import tui_checkbox_unchecked from "./images/tui-checkbox-unchecked.png";
import tui_dropdown_closed from "./images/tui-dropdown-closed.png";
import tui_dropdown_open from "./images/tui-dropdown-open.png";
import tui_native_cc_url from "./images/tui-native-cc-url.png";
import tui_native_cc from "./images/tui-native-cc.png";
import tui_native_ec from "./images/tui-native-ec.png";
import tui_native_finished from "./images/tui-native-finished.png";
import tui_native_metrics from "./images/tui-native-metrics.png";
import tui_native_mev from "./images/tui-native-mev.png";
import tui_native_network from "./images/tui-native-network.png";
import tui_native_welcome from "./images/tui-native-welcome.png";
import tui_native_other from "./images/tui-native-other.png";
import tui_native_review from "./images/tui-native-review.png";
import tui_native_settings_home from "./images/tui-native-settings-home.png";
import tui_native_smartnode from "./images/tui-native-smartnode.png";
import tui_textbox from "./images/tui-textbox.png";

# Configuration de la pile Smartnode (mode natif)

Dans cette section, nous allons passer en revue les différentes méthodes pour configurer le Smartnode si vous utilisez la **configuration native** qui n'utilise pas du tout Docker.

::: warning NOTE
Si vous utilisez une configuration basée sur Docker, veuillez consulter le [guide de configuration Docker](./config-docker) à la place.
:::

Il existe trois façons de le configurer :

- Via l'[interface de l'assistant](#configuration-via-lassistant) - c'est la façon la plus simple. Il ne vous pose que quelques questions de base et utilise des valeurs par défaut bien testées pour le reste. C'est ce qui vous sera présenté lorsque vous exécuterez `rocketpool service config` pour la première fois.
- Via l'[interface du gestionnaire de paramètres](#configuration-via-le-gestionnaire-de-parametres) - cela vous donne accès à tous les paramètres du Smartnode afin que vous puissiez tout personnaliser autant que vous le souhaitez.
- Sans interface via la [ligne de commande](#configuration-via-la-ligne-de-commande) - c'est une option pour les personnes qui exécutent le Smartnode dans un environnement sans interface (non interactif) et doivent le configurer automatiquement.

Choisissez le mode sur lequel vous souhaitez en savoir plus dans la liste ci-dessus, ou parcourez simplement chaque option ci-dessous.

## Configuration via l'assistant

Pour configurer le Smartnode, exécutez la commande de configuration :

```shell
rp service config
```

Cela lancera une interface basée sur le terminal qui vous permettra de configurer rapidement et facilement votre nœud, et fournira également un contrôle optionnel à grain fin sur les paramètres pertinents pour le mode natif.

::: tip NOTE
Si vous avez déjà configuré le Smartnode, vous serez plutôt accueilli par le [gestionnaire de paramètres](#configuration-via-le-gestionnaire-de-parametres).
Vous pouvez choisir de rouvrir l'assistant à partir de là si vous le préférez, et tous vos paramètres existants seront présélectionnés pour vous.
:::

Lorsque vous exécutez l'interface de configuration pour la première fois (ou si vous choisissez de réexécuter l'assistant plus tard), vous verrez un écran qui ressemble à ceci :

<img src={tui_native_welcome} width="100%" height="auto" />

::: tip ASTUCE
Pour utiliser l'assistant, **appuyez sur les `touches fléchées` (haut/bas/gauche/droite) pour naviguer entre les éléments tels que les boutons (choix) ou les zones de texte**.
Vous pouvez également utiliser `Tab` et `Shift+Tab` si vous préférez - cela fera la même chose.

Pour les boutons, **celui qui est actuellement sélectionné sera surligné en vert**.
Ceux en noir ne sont pas sélectionnés.
Dans la capture d'écran ci-dessus, `Next` est actuellement sélectionné et `Quit` ne l'est pas.

**Appuyez sur `Entrée` ou `Espace` pour sélectionner un bouton**, de manière analogue à cliquer dessus avec la souris.

**Appuyez sur `Échap` pour revenir à la boîte de dialogue précédente** si vous avez changé d'avis sur quelque chose.
Cela sera pratique au fur et à mesure que vous progresserez dans les différentes pages de l'assistant.

**Maintenez `Ctrl` et appuyez sur `C` à tout moment pour quitter l'assistant sans rien sauvegarder**.

Par exemple, sur l'écran ci-dessus, vous pouvez appuyer sur les touches fléchées `gauche` et `droite` pour vous déplacer entre les boutons `Next` et `Quit`.

Appuyer sur `Entrée` lorsque `Next` est sélectionné vous fera passer à l'écran suivant.
Appuyer sur `Entrée` lorsque `Quit` est sélectionné quittera l'assistant sans sauvegarder.
:::

Lorsque vous êtes prêt à commencer, appuyez sur `Next`.

### Choix d'un réseau

Sur l'écran suivant, il vous sera demandé de choisir le réseau que vous souhaitez utiliser :

<img src={tui_native_network} width="100%" height="auto" />

Vous pouvez mettre en surbrillance les différents choix avec les touches fléchées `Haut` et `Bas` (ou `Tab` et `Shift+Tab`).
Lorsque vous changez de choix, la zone **Description** à droite vous montrera une brève description de chaque option.
Cela est vrai pour toutes les pages basées sur des choix dans l'assistant, pas seulement pour la sélection du réseau, vous verrez donc souvent ce style de page.

Si vous souhaitez vous entraîner à exécuter un nœud Rocket Pool sur le réseau de test Hoodi avec de faux ETH et RPL que vous pouvez obtenir gratuitement, sélectionnez **Hoodi Testnet**.

Si vous êtes prêt à créer un véritable nœud Rocket Pool sur le réseau principal pour gagner de vraies récompenses, sélectionnez **Mainnet**.

### Configuration du client d'exécution

L'écran suivant vous demandera l'URL de l'API RPC basée sur HTTP de votre client d'exécution :

<img src={tui_native_ec} width="100%" height="auto" />

Entrez `http://127.0.0.1:8545` ici si vous prévoyez d'exécuter un client d'exécution sur la même machine que le Smartnode (dans le reste de ce guide, nous supposerons que c'est ce que vous prévoyez de faire).
Cependant, si vous avez déjà un client d'exécution configuré ailleurs, utilisez plutôt son URL ici.

Notez que vous pouvez toujours modifier cela en exécutant `rp service config` à nouveau plus tard.

### Configuration du client de consensus

Ensuite, il vous sera demandé quel client de consensus vous utilisez (ou prévoyez d'utiliser).
Parce que chaque client de consensus a un comportement légèrement différent, le Smartnode doit savoir lequel vous utilisez afin qu'il puisse adapter son propre comportement en conséquence.
Choisissez votre client dans la liste de l'écran suivant :

<img src={tui_native_cc} width="100%" height="auto" />

Ensuite, vous verrez un écran vous demandant l'URL de l'API de votre client :

<img src={tui_native_cc_url} width="100%" height="auto" />

Entrez `http://127.0.0.1:5052` ici si vous prévoyez d'exécuter le nœud Beacon de votre client de consensus sur la même machine que le Smartnode (dans le reste de ce guide, nous supposerons que c'est ce que vous prévoyez de faire).
Cependant, si vous avez déjà un nœud Beacon configuré ailleurs, utilisez plutôt son URL ici.

### Autres paramètres

L'écran suivant aura quelques autres paramètres divers :

<img src={tui_native_other} width="100%" height="auto" />

Laissez ces options par défaut à moins que vous n'ayez décidé d'utiliser un répertoire autre que `/srv/rocketpool` pour votre installation Smartnode.

### Clients de secours

À partir de la version 1.5.0 de la pile Smartnode, vous pouvez fournir une paire de client d'exécution et de client de consensus de "secours" qui peut prendre le relais de vos clients principaux s'ils se déconnectent (par exemple parce que vous utilisez Geth et devez l'élaguer).
Dans cette situation, votre machine de nœud principale sera toujours responsable de l'attestation et de la proposition de blocs avec les clés de validateur de vos minipools, mais elle se connectera à une machine externe pour interagir avec la couche d'exécution et les chaînes Beacon.

[Pour en savoir plus sur les nœuds de secours, consultez cette section](./fallback) et revenez ici lorsque vous avez terminé.

### Métriques

Rocket Pool a la capacité de s'intégrer à Prometheus et Grafana pour produire des tableaux de bord pratiques basés sur le web qui vous permettent d'observer la santé de votre nœud d'un coup d'œil :

<img src={nimbus_dashboard} width="100%" height="auto" />

La dernière question de l'assistant vous demandera si vous souhaitez activer cela :

<img src={tui_native_metrics} width="100%" height="auto" />

Si vous choisissez de l'activer, vous en apprendrez plus sur sa configuration et son utilisation dans la section [Configuration du tableau de bord Grafana](./grafana.mdx) plus tard dans le processus.

::: warning NOTE
Toutes les données collectées par ce système **restent sur votre machine**.
Rocket Pool ne collecte aucune télémétrie et ne l'envoie pas à un service séparé.
C'est uniquement là pour que vous puissiez surveiller votre propre nœud !
:::

### Configuration MEV

Depuis la fusion des couches d'exécution et de consensus en septembre 2022, les validateurs Ethereum ont maintenant la capacité de gagner des frais prioritaires et de participer à la valeur extractible maximale (ou MEV en abrégé).

À partir de Smartnode v1.7.0, le MEV est maintenant _opt-out_, donc une notification concernant sa configuration est présentée dans le cadre de la configuration initiale, comme vous le voyez sur l'écran suivant :

<img src={tui_native_mev} width="100%" height="auto" />

[Veuillez lire notre guide MEV pour en savoir plus sur le MEV, sa configuration et ce qu'il faut faire dans cette section de l'assistant.](./mev.mdx)
Revenez ici lorsque vous avez terminé.

### Achèvement

Après cette question, vous avez terminé la configuration du Smartnode.
Vous verrez la boîte de dialogue suivante :

<img src={tui_native_finished} width="100%" height="auto" />

Si vous êtes satisfait de votre configuration et êtes prêt à démarrer le Smartnode, cliquez sur `Save and Exit` ici.

Si vous n'avez pas encore fini d'installer Rocket Pool, revenez au guide de configuration native maintenant.
Sinon, l'étape suivante consiste à redémarrer vos services daemon avec :

```shell
sudo systemctl restart rp-node rp-watchtower
```

Si vous souhaitez examiner tous les paramètres et personnaliser de nombreux paramètres supplémentaires qui n'étaient pas inclus dans l'assistant, cliquez sur `Review All Settings` et passez à la [section suivante](#configuration-via-le-gestionnaire-de-parametres).

## Configuration via le gestionnaire de paramètres

Si vous avez déjà exécuté `rp service config`, au lieu d'être accueilli par l'assistant, vous verrez l'écran du **gestionnaire de paramètres** :

<img src={tui_native_settings_home} width="100%" height="auto" />

Il existe trois fonctionnalités principales de cet écran :

1. La **liste des catégories**, qui vous permet d'explorer les paramètres de chaque catégorie de la pile Smartnode pertinente pour le mode natif
2. Le bouton **Review Changes and Save**, que vous pouvez utiliser lorsque vous êtes prêt à voir quels paramètres vous avez modifiés et à enregistrer la configuration mise à jour
3. Le bouton **Open the Config Wizard**, qui vous amènera à l'[assistant de configuration](#configuration-via-lassistant) si vous préférez cette interface

::: tip ASTUCE
Pour utiliser le gestionnaire de paramètres, **appuyez sur les `touches fléchées` (haut/bas/gauche/droite) pour naviguer entre les options de la page d'accueil**.

Appuyez sur `Tab` pour passer **entre la liste des catégories (1) et les boutons (2 et 3)** en bas de l'écran.
Le bouton actuellement sélectionné sera **surligné en vert**.

**Appuyez sur `Entrée` ou `Espace` pour sélectionner un bouton**, de manière analogue à cliquer dessus avec la souris.

**Maintenez `Ctrl` et appuyez sur `C` à tout moment pour quitter le gestionnaire de paramètres sans rien sauvegarder**.
:::

Lorsque vous faites défiler la liste des catégories, chaque option aura une description utile qui apparaîtra dans la **zone de description** à droite de l'écran.
N'hésitez pas à les explorer ; rien de ce que vous faites ne sera sauvegardé tant que vous n'aurez pas passé par la boîte de dialogue de révision via le bouton **Review Changes and Save**, et vous pouvez appuyer sur **Ctrl+C** à tout moment pour quitter sans sauvegarder, donc vous ne risquez pas de gâcher quelque chose accidentellement en jouant avec les paramètres ici.

### Configuration des paramètres

Depuis l'écran d'accueil, sélectionnez l'une des catégories avec la touche `Entrée` pour afficher les paramètres de cette catégorie.
Par exemple, voici l'écran de la catégorie **Smartnode and TX Fees** :

<img src={tui_native_smartnode} width="100%" height="auto" />

Utilisez les `touches fléchées` pour vous déplacer vers le haut et vers le bas entre les paramètres.
Celui actuellement sélectionné aura un carré blanc à la fin (s'il s'agit d'une zone de texte ou d'une case à cocher), ou sera surligné en blanc (s'il s'agit d'un menu déroulant).

Appuyez sur `Échap` pour revenir à l'écran d'accueil du gestionnaire de paramètres lorsque vous avez terminé.

Au fur et à mesure que vous faites défiler les paramètres, chacun affichera une brève description de ce qu'il fait dans la **zone de description** à droite.
Il affichera également la **valeur par défaut** là-bas au cas où vous voudriez la rétablir à son paramètre d'origine.

Dans cet exemple, le paramètre **RPL Claim Gas Threshold** est actuellement sélectionné (mis en surbrillance avec une case verte sur le côté gauche de l'écran).
Il a été changé à `40`, mais vous pouvez voir qu'il a une valeur par défaut de `150` dans le coin supérieur droit (le haut de la **zone de description**).

::: tip ASTUCE
Pour rappel, rien ne sera sauvegardé sur le disque tant que vous n'aurez pas passé par la boîte de dialogue de révision via le bouton **Review Changes and Save**.
Vous êtes encouragé à explorer tous les paramètres pour les découvrir.
:::

### Les types de paramètres et comment les utiliser

Le gestionnaire de paramètres utilise les types de paramètres et éléments d'interface suivants :

#### Zones de texte

Les zones de texte sont utilisées pour entrer des chaînes de texte ou des nombres arbitraires.
Elles ressemblent à ceci :

<img src={tui_textbox} width="100%" height="auto" />

Entrez vos valeurs souhaitées dans celles-ci, puis **appuyez sur `Entrée` ou utilisez les `touches fléchées` pour naviguer vers un paramètre différent afin de préserver vos modifications.**
Si vous ne le faites pas, le gestionnaire de paramètres supposera que vous êtes toujours en train de mettre à jour ce paramètre et ne le marquera pas encore comme modifié.

#### Menus déroulants

Les menus déroulants sont utilisés pour sélectionner une option dans une liste de choix.
Ils ressemblent à ceci (lorsqu'ils sont ouverts) :

<img src={tui_dropdown_open} width="100%" height="auto" />

L'élément **vert** est celui qui est actuellement sélectionné.
Utilisez les `touches fléchées` pour changer d'options - ce faisant, la **zone de description** à droite se mettra à jour pour vous en dire plus sur l'option actuellement sélectionnée.
Lorsque vous êtes satisfait de votre choix, appuyez sur `Entrée` pour choisir l'option sélectionnée et le menu déroulant se fermera, révélant l'option actuellement sélectionnée :

<img src={tui_dropdown_closed} width="100%" height="auto" />

#### Cases à cocher

Les cases à cocher sont utilisées pour les questions simples Oui/Non.
Elles ressemblent à ceci :

<img src={tui_checkbox_checked} width="100%" height="auto" />

Lorsqu'elles sont cochées, elles auront un `X` au milieu comme vous le voyez ci-dessus.
Lorsqu'elles sont _décochées_, elles seront simplement vides comme ceci :

<img src={tui_checkbox_unchecked} width="100%" height="auto" />

Pour modifier le paramètre, il suffit de le sélectionner et d'appuyer sur `Entrée`.

### Sauvegarde des modifications

Lorsque vous êtes satisfait de vos modifications et que vous souhaitez les examiner avant de les sauvegarder, appuyez sur le bouton **Review Changes and Save** sur l'écran d'accueil.
Pour rappel, pour y accéder, appuyez sur la touche `Tab`.

Vous verrez une vue qui ressemble à ceci :

<img src={tui_native_review} width="100%" height="auto" />

La **zone de révision** ici présentera tous les paramètres que vous avez modifiés, montrant les anciennes valeurs et les nouvelles.
Par exemple, la première ligne ici montre que le **RPL Claim Gas Threshold** était de `150`, et il a été changé à `40`.

::: tip NOTE
À ce stade, vos modifications **n'ont toujours pas été sauvegardées**.
Si vous voulez revenir en arrière et modifier quelque chose, appuyez sur `Échap` pour revenir à l'écran d'accueil.
:::

Lorsque vous êtes satisfait des modifications, appuyez sur `Entrée` pour sauvegarder la nouvelle configuration sur le disque.
Vous quitterez ensuite l'interface du terminal et verrez ce message :

```
Your changes have been saved!
Please restart your daemon service for them to take effect.
```

Si vous n'avez pas encore fini d'installer Rocket Pool, revenez au guide de configuration native maintenant.
Sinon, vous pouvez maintenant redémarrer vos services daemon avec :

```shell
sudo systemctl restart rp-node rp-watchtower
```

## Configuration via la ligne de commande

Si vous utilisez le Smartnode dans un environnement sans interface où vous ne pouvez pas interagir avec l'interface du terminal, vous pouvez configurer votre nœud via la ligne de commande à la place.

La commande `rocketpool service config` accepte, en tant qu'arguments, chaque paramètre qui peut normalement être configuré via l'interface du terminal.
Exécutez la commande suivante pour voir une liste de ceux-ci (notez que c'est assez long) :

```
rocketpool service config --help
```

La sortie ressemblera à ceci :

```
NAME:
   rocketpool service config - Configure the Rocket Pool service

USAGE:
   rocketpool service config

OPTIONS:
   --executionClientMode value  Choose which mode to use for your Execution client - locally managed (Docker Mode), or externally managed (Hybrid Mode).
                                Type: choice
                                Options: local, external
 (default: "local")
   --executionClient value  Select which Execution client you would like to run.
                            Type: choice
                            Options: geth, infura, pocket
 (default: "geth")
   --useFallbackExecutionClient         Enable this if you would like to specify a fallback Execution client, which will temporarily be used by the Smartnode and your Consensus client if your primary Execution client ever goes offline.
                                        Type: bool

...
```

Chaque option aura son nom, son type, sa valeur par défaut et (s'il s'agit d'un paramètre de choix) ses options.
En utilisant ce texte, vous pouvez trouver la ou les options que vous souhaitez définir et les spécifier via les arguments appropriés.

::: tip NOTE
Cette commande s'appuie sur votre configuration existante, donc si vous avez déjà des paramètres enregistrés et que vous voulez juste en modifier d'autres, vous n'avez pas besoin de les répéter.
Elle ne mettra à jour que les paramètres que vous incluez en tant qu'arguments de cette commande.
:::

Si vous n'avez pas encore fini d'installer Rocket Pool, revenez au guide de configuration native maintenant.
Sinon, l'étape suivante consiste à redémarrer vos services daemon avec :

```shell
sudo systemctl restart rp-node rp-watchtower
```
