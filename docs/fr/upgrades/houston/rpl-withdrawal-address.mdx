import { Tab, Tabs } from "@rspress/core/theme";
import nodeAddress from "./images/node_address.png";
import rplWithdrawalConfirmation from "./images/rpl_withdrawal_confirmation.png";

# Définir votre adresse de retrait RPL

Il est important de comprendre la différence entre votre [adresse de retrait principale](../../node-staking/prepare-node#setting-your-primary-withdrawal-address) et votre adresse de retrait RPL. Par défaut, votre adresse de retrait RPL n'est pas définie et votre adresse de retrait principale est l'endroit où tous vos récompenses de checkpoint RPL, votre RPL staké et l'ETH de la Beacon Chain seront envoyés.

Vous pouvez définir une [adresse de retrait distincte pour votre RPL](https://rpips.rocketpool.net/RPIPs/RPIP-31) si vous le souhaitez. Votre adresse de retrait RPL, si définie, pourra déclencher et réclamer du RPL à partir des récompenses d'inflation et n'aura aucun effet sur les récompenses de consensus ETH ou quoi que ce soit lié à l'ETH. Dans ce cas, votre adresse de retrait principale n'aura plus aucune autorité sur les actions liées au RPL.

Cela crée des opportunités intéressantes où le RPL peut être fourni par une entité à un opérateur de nœud qui ne souhaite pas être exposé au RPL. Cette entité peut alors réclamer les récompenses RPL pour avoir fourni la garantie d'assurance requise pour le nœud. En d'autres termes, cela permet à différents acteurs de fournir chaque type de garantie.

::: warning NOTE
Lors de la configuration de votre nœud pour la première fois, votre adresse de retrait RPL est par défaut non définie.
Si vous choisissez de définir une adresse de retrait RPL, **il est essentiel de la définir sur une adresse différente contrôlée par un portefeuille froid.**
Un portefeuille froid pourrait être un portefeuille matériel (tel qu'un [Ledger](https://www.ledger.com/), [Trezor](https://trezor.io/), ou [Grid+](https://gridplus.io/)), ou un portefeuille Smart Contract (tel que [Safe](https://app.safe.global/welcome)).

Nous **recommandons fortement** de NE PAS utiliser un portefeuille chaud tel que MetaMask comme adresse de retrait RPL.

De cette façon, si votre portefeuille de nœud est compromis, l'attaquant n'aura pas accès à votre RPL staké en vous forçant à sortir car tous ces fonds seront envoyés à votre portefeuille froid séparé (qu'ils n'ont espérons-le pas).

Les adresses de retrait RPL sont définies au niveau de l'opérateur de nœud.
Si vous créez plusieurs minipools, ils feront tous référence à la même adresse de retrait RPL, vous n'avez donc besoin d'effectuer cette configuration qu'une seule fois.

[Voir ici](https://ethereum.org/en/security/#wallet-security) pour quelques bases sur la sécurité des portefeuilles de l'Ethereum Foundation.
:::

Il existe deux façons différentes de procéder.
Veuillez lire les deux options ci-dessous pour déterminer laquelle s'applique à vous.

<div className="p-3">
  <Tabs>
    <Tab label="Méthode 1">
      *Utilisez cette méthode si votre nouvelle adresse de retrait RPL peut être utilisée pour signer des transactions via MetaMask ou WalletConnect.**

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTE</p>
        Cette méthode nécessitera que vous **soumettiez une transaction** depuis votre nouvelle adresse de retrait RPL, donc **vous devez avoir une petite quantité d'ETH dans cette adresse déjà.**
      </p>

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTE</p>
        Pour les utilisateurs de portefeuilles matériels **Ledger**, notez que Ledger Live ne prend pas encore en charge MetaMask ou WalletConnect nativement.
        Vous devrez utiliser MetaMask et le connecter à votre Ledger à la place.
        Suivez [les instructions officielles de Ledger](https://www.ledger.com/academy/security/the-safest-way-to-use-metamask) pour ce faire.

        Pour travailler avec le site Web Rocket Pool, vous devrez avoir votre Ledger connecté, déverrouillé et l'application ETH ouverte.
        Vous devrez également **activer la "signature aveugle"** pour la session en cours ; vous pouvez trouver cela dans la partie Paramètres de l'application ETH sur l'appareil.
        La signature aveugle sera automatiquement désactivée après la fermeture de la session.

        Si vous utilisez le Hoodi Testnet et souhaitez utiliser votre Ledger comme adresse de retrait RPL, **vous devez créer un nouveau portefeuille Ethereum sur votre Ledger** d'abord pour vous assurer de ne pas connecter votre adresse réelle au réseau de test, ce qui a tendance à créer de la confusion.
        Assurez-vous de sélectionner le **Hoodi Testnet** dans le menu déroulant de sélection de réseau lors de la connexion de votre Ledger à MetaMask.
        Notez que Ledger Live n'affichera pas votre solde sur le réseau de test, mais d'autres applications qui prennent en charge le réseau de test (telles que MetaMask et Etherscan) pourront l'afficher.
      </p>

      1. Exécutez `rocketpool node set-rpl-withdrawal-address 'votre adresse de portefeuille froid ou nom ENS'`. Votre nouvelle adresse de retrait RPL sera marquée comme "en attente". Jusqu'à ce que vous la confirmiez, **votre ancienne adresse de retrait RPL sera toujours utilisée**.
      2. Pour la confirmer, vous devez envoyer une transaction spéciale **depuis votre nouvelle adresse de retrait RPL** au contrat minipool pour vérifier que vous possédez l'adresse de retrait RPL.
      1. Le moyen le plus simple de le faire est de naviguer vers le site d'adresse de retrait RPL de Rocket Pool (pour le [Hoodi Testnet](https://testnet.node.rocketpool.net/rpl-withdrawal-address) ou pour [Mainnet](https://node.rocketpool.net/rpl-withdrawal-address)).
      3. Si vous n'avez pas encore connecté Metamask ou WalletConnect au site Web Rocket Pool, faites-le maintenant. Cliquez sur le bouton **select wallet** au centre de l'écran et choisissez MetaMask ou WalletConnect en fonction du portefeuille que vous souhaitez utiliser. Vous serez ensuite invité à confirmer la connexion. Par exemple, en utilisant MetaMask :

      Cliquez sur **Next**, puis cliquez sur **Confirm** pour permettre au site Web Rocket Pool d'utiliser votre portefeuille. 3. Sélectionnez **RPL Withdrawal Address** dans le menu du haut (ou le menu hamburger sur le côté gauche si vous êtes sur un appareil mobile). 4. Vous verrez cette invite :

      4. Tapez votre **adresse de portefeuille de nœud** ici et cliquez sur le bouton orange **Find** pour continuer.

      <img src={nodeAddress} width="100%" height="auto"/>

      1.  Vous serez invité à confirmer une adresse de retrait RPL en attente. Cela devrait être la même adresse que vous avez utilisée lors de l'exécution de cette commande précédemment : `rocketpool node set-rpl-withdrawal-address` Sélectionnez **Confirm Pending** lorsque vous êtes prêt.
      2.  Maintenant, il devrait y avoir une nouvelle boîte de dialogue de confirmation dans votre portefeuille. Encore une fois, en utilisant MetaMask comme exemple, cliquez sur l'icône MetaMask pour l'ouvrir et vous devriez voir quelque chose comme ceci :

      Cliquez sur **Confirm** pour envoyer la transaction au réseau. Cela prendra un certain temps jusqu'à ce qu'elle soit incluse dans un bloc, mais une fois que c'est fait, vous verrez une boîte de dialogue de confirmation :

      <img src={rplWithdrawalConfirmation} width="100%" height="auto"/>

      5. Votre nouvelle adresse de retrait RPL sera maintenant confirmée et activée. Vous pouvez voir cela avec `rocketpool node status`.
    </Tab>
    <Tab label="Méthode 2">
      **Utilisez cette méthode uniquement si votre adresse de retrait RPL _ne peut pas_ être utilisée pour signer des transactions via MetaMask ou WalletConnect.**

      Dans cette méthode, vous exécuterez :

      ```shell
      rocketpool node set-rpl-withdrawal-address --force `votre adresse de portefeuille froid`
      ```

      Vous aurez la possibilité d'envoyer une transaction de test avant de confirmer cela, pour vous assurer que vous avez la bonne adresse.
      Si vous confirmez cette commande lorsqu'elle vous y invite, votre nouvelle adresse de retrait RPL sera définie immédiatement.


      <p className="rspress-directive danger">
        En faisant cela, vous contournez la mesure de sécurité associée à la méthode 1, qui vous oblige à prouver que vous possédez la nouvelle adresse.
        Si vous faites une faute de frappe ici, il n'y a aucun moyen de l'annuler et **les récompenses de votre minipool seront perdues à jamais**.

        Nous vous **encourageons fortement** à utiliser le mécanisme de transaction de test avant de confirmer cela, et si possible, utilisez plutôt la méthode 1.
      </p>
    </Tab>

  </Tabs>
</div>

Une fois cela fait, vous ne pourrez **plus changer votre adresse de retrait RPL en utilisant la commande `set-rpl-withdrawal-address`**.
Pour la changer, vous devrez envoyer une transaction signée depuis votre adresse de retrait RPL **active** (celle vers laquelle vous venez de basculer).
Le site Web Rocket Pool dispose d'une fonction pour vous aider à faire cela.

Si vous souhaitez désactiver votre adresse de retrait RPL, le processus est assez simple. Tout d'abord, vous voudrez revenir à la page d'adresse de retrait RPL sur le site Web Rocket Pool.

<div className="p-3">
  <Tabs>
    <Tab label="Hoodi Testnet">https://testnet.node.rocketpool.net/rpl-withdrawal-address</Tab>
    <Tab label="Mainnet">https://node.rocketpool.net/rpl-withdrawal-address</Tab>
  </Tabs>
</div>

Si vous êtes connecté avec l'adresse de retrait RPL du nœud, vous devriez pouvoir cliquer sur le bouton **unset** sur la droite ici :

<img src="./images/unset_rpl_withdrawal.png" width="100%" height="auto" />

Cliquer sur **unset** vous amènera à une page où vous pourrez confirmer les détails. Si vous êtes satisfait de ce que vous voyez, cliquez sur le bouton orange **unset** pour envoyer la transaction au réseau.

C'est tout ce qu'il y a à faire pour définir votre adresse de retrait RPL ! Nous espérons que vous avez trouvé le processus rapide et facile.

N'hésitez pas à passer sur [notre serveur Discord](https://discord.gg/G46XgK264a) pour nous faire savoir ce que vous en avez pensé et suivre l'évolution du projet.
