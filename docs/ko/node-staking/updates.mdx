import { Tab, Tabs } from "@rspress/core/theme";
import tuiEcContainerTag from "./images/tui-ec-container-tag.png";
import tuiCcContainerTag from "./images/tui-cc-container-tag.png";

# 업데이트 확인

노드 운영자의 책임 중 하나는 시스템이 최신 보안 패치로 최신 상태인지 확인하는 것입니다.
자동 업데이트는 편리하지만 노드 작동을 방해할 수 있으므로 수동으로 실행하는 것이 바람직할 수 있습니다.
어느 경우든 **머신이 정기적으로 패치되고 있는지 확인해야 합니다!**

::: tip 참고
대부분의 경우 업데이트에는 시스템이 몇 분 이상 다운될 필요가 없습니다.
이러한 다운타임이 Beacon Chain 잔액에 부정적인 영향을 미칠까 걱정할 수 있습니다.
안심하세요. 이렇게 짧은 시간 동안 오프라인 상태인 것에 대한 페널티는 **완전히 무시할 수 있을 정도입니다**.

놓친 각 증명은 성공적인 증명에서 얻을 수 있는 금액보다 약간 적은 금액으로 페널티를 받습니다.
경험상 1시간 동안 오프라인 상태인 경우 1시간 동안 다시 온라인 상태가 되면 모두 되찾을 수 있습니다.

또한 짧은 시간 동안 오프라인 상태가 되어 _슬래싱_될 가능성은 **절대 없습니다**.
슬래싱은 네트워크를 공격하는 경우에만 발생하며 유지 관리를 위해 오프라인 상태가 되는 것은 네트워크 공격으로 간주되지 않습니다.

**시스템을 최신 상태로 유지하세요. 다운타임 페널티에 대해 걱정하지 마세요!**
:::

## 운영 체제 업데이트

운영 체제의 패키지 관리자 또는 업데이트 서비스를 자주 확인하여 새로운 중요한 보안 패치를 신속하게 적용해야 합니다.
정확한 지침은 각 운영 체제마다 다르며 시스템 설명서에서 찾을 수 있지만 다음은 몇 가지 예입니다.

<div className="p-3">
  <Tabs>
    <Tab label="Ubuntu">
      터미널에서 다음을 입력합니다:

      ```shell
      sudo apt update
      ```

      이렇게 하면 패키지 서버에 액세스하고 설치된 패키지 중 새 버전을 사용할 수 있는지 확인합니다.
      업데이트를 사용할 수 있는 경우 출력은 다음과 같습니다:

      ```
      Fetched 3974 kB in 2s (1641 kB/s)
      Reading package lists... Done
      Building dependency tree
      Reading state information... Done
      12 packages can be upgraded. Run 'apt list --upgradable' to see them.
      ```

      다음 명령으로 업데이트를 설치할 수 있습니다:

      ```shell
      sudo apt dist-upgrade
      ```

      업데이트될 패키지 목록이 표시되고 총 설치 크기가 충분히 큰 경우 크기가 표시되고 수락할지 확인하는 메시지가 표시됩니다:

      ```
      12 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
      Need to get 51.3 MB of archives.
      After this operation, 52.2 kB of additional disk space will be used.
      Do you want to continue? [Y/n]
      ```

      이 작업을 수행할 충분한 공간이 있는지 확인한 다음 `y`와 `Enter`를 눌러 업데이트 프로세스를 시작합니다.

      진행률 표시줄이 완료되고 터미널 프롬프트로 돌아가면 다음 명령을 실행하여 방금 교체된 패키지의 이전 버전을 정리합니다:

      ```shell
      sudo apt autoremove
      ```

      다음으로 시스템을 재부팅해야 하는지 확인합니다:

      ```shell
      cat /var/run/reboot-required
      ```

      위 명령이 `No such file or directory`를 출력하면 재부팅이 필요하지 않으며 아래 단계를 건너뛸 수 있습니다.

      그러나 명령이 `*** System restart required ***`를 출력하면 업데이트 적용을 완료하기 위해 가능한 경우 머신을 재시작해야 합니다:

      ```shell
      sudo reboot
      ```

      Rocket Pool은 정상적으로 종료되고 시스템이 재부팅되면 자동으로 다시 시작됩니다.
    </Tab>
    <Tab label="MacOS">
      OS 패키지를 업데이트하려면 UI를 사용하여 `Apple -> Software Update`를 선택합니다.

      패키지 자체를 업데이트하는 가장 쉬운 방법은 터미널에서 `homebrew`를 통하는 것입니다:

      ```shell
      brew update && brew upgrade
      ```
    </Tab>

  </Tabs>
</div>

## Smartnode 스택 업데이트

때때로 Rocket Pool은 Smartnode 스택의 새 버전을 릴리스합니다.
업데이트에는 CLI 또는 Rocket Pool Docker 컨테이너의 새 버전과 Execution 및 Consensus 클라이언트의 새 버전이 포함될 수 있습니다.

새 릴리스에 대해 알아보는 가장 일관된 방법은 Rocket Pool Discord 서버를 구독하는 것입니다. 항상 Releases 채널에 게시되며 알림을 받게 됩니다.

::: warning 참고
`apt update`를 실행해도 노드 소프트웨어가 업데이트되지 않습니다.
아래 단계를 사용하여 수동으로 수행해야 합니다.
:::

::: tip 팁
Smartnode 업그레이드를 완료하면 Grafana 대시보드에 여전히 업데이트를 사용할 수 있다고 표시됩니다.
시스템이 다음에 업데이트를 자동으로 확인할 때 하루 이내에 자동으로 지워집니다.

업데이트 후 즉시 지우려면 다음을 실행하기만 하면 됩니다:
`sudo apt update`
:::

::: tip 팁
CPU 아키텍처를 모르는 경우 다음 명령을 실행하여 확인할 수 있습니다:

```shell
uname -m
```

이 명령의 출력은 아키텍처를 출력합니다.
**`x86_64`는 `x64` 및 `amd64`와 동일합니다.**
**`aarch64`는 `arm64`와 동일합니다.**
:::

업그레이드 단계는 노드가 사용하는 모드에 따라 다릅니다. 아래 옵션에서 선택하세요:

<div className="p-3">
  <Tabs>
    <Tab label="Linux (Docker or Hybrid Mode)">
      Rocket Pool 서비스를 중지합니다:

      ```shell
      rocketpool service stop
      ```

      새 Smartnode CLI를 다운로드합니다:

      `x64` 시스템의 경우(대부분의 일반 머신):

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool
      ```

      `arm64` 시스템의 경우:

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool
      ```

      이제 설치 명령을 실행합니다:

      ```shell
      rocketpool service install -d
      ```

      `-d` 플래그는 이미 Docker와 같은 시스템 종속성이 있으므로 무시하도록 지시합니다.

      변경 사항을 보려면 Settings Manager를 엽니다. Review Page에 새로운 내용이 표시됩니다:

      ```shell
      rocketpool service config
      ```

      완료되면 Rocket Pool을 다시 시작합니다:

      ```shell
      rocketpool service start
      ```

      마지막으로 버전을 확인하여 CLI와 Smartnode 스택이 모두 최신 상태인지 확인합니다:

      ```shell
      rocketpool service version
      ```

      출력은 다음과 같아야 합니다:

      ```
      Your Smartnode is currently using the Hoodi Test Network.

      Rocket Pool client version: 1.5.0
      Rocket Pool service version: 1.5.0
      Selected Eth 1.0 client: Geth (Locally managed)
      Image: ethereum/client-go:v1.10.21
      Selected Eth 2.0 client: Lighthouse (Locally managed)
      Image: rocketpool/lighthouse:mevboost-5ee3bc5
      ```

      클라이언트와 서비스 모두 새 릴리스 버전과 일치해야 합니다.
    </Tab>
    <Tab label="Linux (Native Mode)">
      <p className="rspress-directive warning">
        <p className="rspress-directive-title">참고</p>
        이것은 Smartnode 스택 자체만 업데이트합니다. Execution 또는 Consensus 클라이언트를 업데이트하지 **않습니다**.
        이것은 수동으로 수행해야 합니다(아래 다음 섹션 참조).
      </p>

      Rocket Pool 서비스를 중지합니다:

      ```shell
      sudo systemctl stop rp-node rp-watchtower
      ```

      새 Smartnode CLI를 다운로드하고 필요한 경우 이전 CLI 및 데몬 바이너리를 백업합니다:

      `x64` 시스템의 경우(대부분의 일반 머신):

      ```shell
      sudo mv /usr/local/bin/rocketpool /usr/local/bin/rocketpool_bak

      sudo mv /usr/local/bin/rocketpoold /usr/local/bin/rocketpoold_bak

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-amd64 -O /usr/local/bin/rocketpool

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-daemon-linux-amd64 -O /usr/local/bin/rocketpoold

      sudo chmod +x /usr/local/bin/rocketpool /usr/local/bin/rocketpoold
      ```

      `arm64` 시스템의 경우:

      ```shell
      sudo mv /usr/local/bin/rocketpool /usr/local/bin/rocketpool_bak

      sudo mv /usr/local/bin/rocketpoold /usr/local/bin/rocketpoold_bak

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-arm64 -O /usr/local/bin/rocketpool

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-daemon-linux-arm64 -O /usr/local/bin/rocketpoold

      sudo chmod +x /usr/local/bin/rocketpool /usr/local/bin/rocketpoold
      ```

      변경 사항을 보려면 Settings Manager를 엽니다. Review Page에 새로운 내용이 표시됩니다:

      ```shell
      rp service config
      ```

      완료되면 Rocket Pool을 다시 시작합니다:

      ```shell
      sudo systemctl start rp-node rp-watchtower
      ```

      마지막으로 버전을 확인하여 CLI와 Smartnode 스택이 모두 최신 상태인지 확인합니다:

      ```
      rocketpool service version

      Rocket Pool client version: 1.0.0-rc3
      Rocket Pool service version: 1.0.0-rc3
      Selected Eth 1.0 client: Geth (rocketpool/client-go:v1.10.4)
      Selected Eth 2.0 client: Nimbus (statusim/nimbus:v1.4.0)
      ```

      클라이언트와 서비스 모두 새 릴리스 버전과 일치해야 합니다.
    </Tab>
    <Tab label="macOS (Docker or Hybrid Mode)">
      Rocket Pool 서비스를 중지합니다:

      ```shell
      rocketpool service stop
      ```

      새 Smartnode CLI를 다운로드합니다:

      `x64` 시스템의 경우(대부분의 Mac):

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-amd64 -O /usr/local/bin/rocketpool
      ```

      M1이 탑재된 Mac mini와 같은 `arm64` 시스템의 경우:

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-arm64 -O /opt/homebrew/bin/rocketpool
      ```

      이제 설치 명령을 실행합니다:

      ```shell
      rocketpool service install -d
      ```

      `-d` 플래그는 이미 Docker와 같은 시스템 종속성이 있으므로 무시하도록 지시합니다.

      변경 사항을 보려면 Settings Manager를 엽니다. Review Page에 새로운 내용이 표시됩니다:

      ```shell
      rocketpool service config
      ```

      완료되면 Rocket Pool을 다시 시작합니다:

      ```shell
      rocketpool service start
      ```

      마지막으로 버전을 확인하여 CLI와 Smartnode 스택이 모두 최신 상태인지 확인합니다:

      ```shell
      rocketpool service version

      Rocket Pool client version: 1.0.0-rc3
      Rocket Pool service version: 1.0.0-rc3
      Selected Eth 1.0 client: Geth (rocketpool/client-go:v1.10.4)
      Selected Eth 2.0 client: Nimbus (statusim/nimbus:v1.4.0)
      ```

      클라이언트와 서비스 모두 새 릴리스 버전과 일치해야 합니다.

    </Tab>

  </Tabs>
</div>

## Execution 또는 Consensus 클라이언트 수동 업데이트

Smartnode 스택의 각 새 릴리스에는 Execution 및 Consensus Docker 컨테이너의 최신 호환 버전에 대한 업데이트된 참조가 포함됩니다.
그러나 경우에 따라 새 Smartnode 스택 릴리스를 기다리기 _전에_ 해당 클라이언트 중 하나를 업그레이드하고 싶을 수 있습니다.
이 섹션에서는 바로 그 방법을 보여줍니다.

<div className="p-3">
  <Tabs>
    <Tab label="Docker Mode">
      Docker 모드에서 새 클라이언트 버전으로 업데이트하는 것은 쉽습니다.

      먼저 Settings Manager를 엽니다:

      ```shell
      rocketpool service config
      ```

      Execution 클라이언트 버전을 변경하려면 **Execution Client** 카테고리로 이동합니다.
      **Container Tag** 설정을 수정합니다:

      <img src={tuiEcContainerTag} width="100%" height="auto"/>

      Consensus 클라이언트 버전을 변경하려면 **Consensus Client** 카테고리로 이동합니다.
      **Beacon Node Container Tag** 설정을 수정합니다:

      <img src={tuiCcContainerTag} width="100%" height="auto"/>

      변경 사항에 만족하면 평소대로 저장하고 종료합니다.
      Smartnode는 영향을 받는 모든 컨테이너를 자동으로 재시작할 것을 제안합니다.
    </Tab>
    <Tab label="Native Mode">
      먼저 업데이트하려는 항목에 따라 Execution 클라이언트, Beacon Node 및/또는 Validator 클라이언트 서비스를 종료합니다.
      예를 들어 Geth를 종료하는 경우:

      ```shell
      sudo systemctl stop geth
      ```

      다음으로 클라이언트 공급업체에서 최신 바이너리 릴리스를 다운로드하거나(또는 소스에서 빌드) 이전 바이너리를 새 바이너리로 교체합니다.
      새 클라이언트에 문제가 있는 경우를 대비하여 이전 바이너리를 덮어쓰는 대신 **백업 위치로 이동**하는 것이 좋습니다.

      마지막으로 클라이언트 서비스를 다시 시작합니다. 예를 들어 Geth를 시작하는 경우:

      ```shell
      sudo systemctl start geth
      ```

      업그레이드 후 로그 스크립트를 면밀히 따라 새 클라이언트가 예상대로 작동하는지 확인해야 합니다.
    </Tab>

  </Tabs>
</div>
