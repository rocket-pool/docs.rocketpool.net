import { Tab, Tabs } from "@rspress/core/theme";

# [Modo Docker] Guía para la Actualización Redstone y The Merge

Esta guía cubrirá todo lo que necesita saber para preparar su nodo para la Actualización Redstone y The Merge si está usando **Modo Docker**.

## Cosas que hacer antes de actualizar a v1.5.0

Antes de actualizar a v1.5.0 y versiones superiores del Smartnode, por favor revise la siguiente lista de verificación para asegurarse de que está preparado:

### Cambiar a un Cliente de Ejecución Completo

The Merge requiere que ejecute su propio cliente de Ejecución, por lo que ya no podrá usar proveedores remotos como Infura o Pocket.
v1.5.0 ya no los tendrá, y no le permitirá iniciar el stack hasta que seleccione un cliente de Ejecución completo.

Debido a este cambio, debe cambiar a un cliente completo mientras aún está en v1.4, dejarlo sincronizar hasta completarse, y luego actualizar a v1.5.

El Modo Docker hace que cambiar de clientes sea muy fácil.
[Esta guía](../../node-staking/change-clients#changing-execution-clients) proporciona un tutorial del proceso.

## Actualizar a v1.5.0

Actualizar el stack Smartnode a v1.5.0 no es diferente a cualquier otra actualización.
Simplemente siga [las instrucciones normales aquí](../../node-staking/updates#updating-the-smartnode-stack).

## Cosas que el Smartnode maneja automáticamente

En Modo Docker, el Smartnode se encargará de la mayoría de los cambios necesarios para admitir Redstone y The Merge automáticamente una vez que actualice a v1.5.0.
Aquí hay una breve lista de lo que hará por usted sin ninguna intervención manual:

### La Engine API

The Merge cambia la forma en que su cliente de Ejecución se comunica con su cliente de Consenso.
En lugar de usar el antiguo sistema RPC basado en HTTP o Websocket, The Merge requiere un nuevo sistema expuesto por su cliente de Ejecución llamado Engine API.

Esta es una conexión especial que permite que el cliente de Consenso reemplace el antiguo sistema de minería Proof-of-Work con Proof-of-Stake; es el corazón de The Merge.
También está **autenticada** con un token secreto, por lo que solo su cliente de Consenso puede conectarse a su cliente de Ejecución - nada más puede hacerlo.

El Smartnode manejará la configuración del token de autenticación y la Engine API en sus clientes de Ejecución y Consenso automáticamente.

### Su destinatario de tarifas

El **destinatario de tarifas** es la dirección en la cadena de la capa de Ejecución que recibirá todas las tarifas de prioridad de los bloques que propone.
Es una configuración proporcionada a su cliente Validator cuando se inicia por primera vez.

El Smartnode manejará su configuración a la dirección correcta cuando actualice a v1.5, y constantemente verificará para asegurarse de que está usando la correcta para que no sea [penalizado accidentalmente](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system).

Si optó por el [Smoothing Pool](./whats-new#smoothing-pool), lo hará su destinatario de tarifas.
Si no lo hizo, hará que su [contrato distribuidor de tarifas](./whats-new#fee-recipients-and-your-distributor) sea el destinatario de tarifas.

### MEV-Boost

[MEV-boost](https://boost.flashbots.net/) es el sistema que Flashbots proporciona para dar recompensas MEV a los validadores Proof-of-Stake después de The Merge.
Rocket Pool tiene MEV-Boost integrado en el Smartnode y configura automáticamente su nodo para usarlo, por lo que sus propuestas obtienen la máxima cantidad de recompensas.

## Cosas que debe hacer después de actualizar

Si bien el Smartnode maneja la mayoría de los cambios por usted, hay algunas cosas adicionales que debe hacer manualmente:

### Asegurar una actualización exitosa

Lo primero que debe hacer es asegurarse de que su nodo esté funcionando correctamente.
Considere seguir los siguientes pasos:

- Verifique los registros en busca de errores con `rocketpool service logs eth1`, `rocketpool service logs eth2`, `rocketpool service logs validator`, y `rocketpool service logs node`.
- Confirme con un Block Explorer (como su dashboard de Grafana y [https://beaconcha.in](https://beaconcha.in)) que todavía está atestiguando correctamente
  - ¡Recuerde que si tiene habilitada la protección Doppelganger, perderá algunas atestaciones después del reinicio. Esto es normal!

### Configurar un nodo de respaldo

Debido a que The Merge no es compatible con proveedores remotos como Infura y Pocket, perderá la capacidad de usarlos como clientes de Ejecución de respaldo cuando su principal se desconecte.

El Smartnode todavía tiene la capacidad de proporcionar un cliente de Ejecución de respaldo (y ahora también un cliente de Consenso de respaldo), pero ahora necesitará usar clientes de Ejecución y Consenso que usted controle.

Para obtener más información sobre cómo configurar un nodo de respaldo, consulte la [guía de nodo de respaldo](../../node-staking/fallback).

### Inicializar su distribuidor de tarifas

Si no planea optar por el [Smoothing Pool](./whats-new#smoothing-pool) y reclamar todas sus tarifas de prioridad y recompensas MEV en su [contrato distribuidor de tarifas](./whats-new#fee-recipients-and-your-distributor), eventualmente tendrá que inicializarlo (crear la instancia del contrato en la cadena) para reclamar recompensas desde él a su dirección de retiro.

Esta es una operación bastante económica y solo necesita hacerse una vez.

::: tip CONSEJO
Inicializar su distribuidor de tarifas se puede hacer en **cualquier momento**.
Puede dejar que las recompensas se acumulen en su dirección mucho antes de inicializarlo, y su saldo permanecerá después de la inicialización.

Le recomendamos que lo haga cuando los precios del gas sean bajos para minimizar el costo adicional.

Tenga en cuenta que **debe inicializarse para reclamar sus recompensas.**
:::

### Optar por el Smoothing Pool

Si planea aprovechar el [Smoothing Pool](./whats-new#smoothing-pool) de inmediato, debe optar antes del final del primer período de recompensas de Redstone para maximizar su cantidad de "elegibilidad".

Optar puede hacerse ejecutando el siguiente comando:

```
rocketpool node join-smoothing-pool
```

### Reclamar recompensas

La actualización Redstone reemplaza el costoso y problemático sistema de recompensas antiguo con [uno completamente nuevo](./whats-new#new-rewards-system) que es mucho más económico, admite el re-staking automático de RPL (tanto en cantidades parciales como completas), y - lo más importante - **le permite reclamar sus recompensas cuando quiera**.

Debido a que ya no hay un límite de tiempo para reclamar recompensas, y debido a que es más económico reclamar muchos intervalos de recompensas a la vez, la función de reclamación automática de recompensas del Smartnode **ha sido eliminada**.
Ahora podrá reclamar recompensas a través del siguiente comando:

```
rocketpool node claim-rewards
```

Esto le mostrará todas las recompensas que ha acumulado en todos los intervalos de recompensas comenzando con la actualización Redstone.

## Revertir a v1.4.3

Si, por alguna razón, algo no es de su agrado y desea revertir a la versión anterior del Smartnode, puede hacerlo fácilmente.
El Smartnode hace automáticamente una copia de seguridad de su configuración de la versión anterior cuando lo actualiza, así que simplemente obtenga la versión anterior (aquí estamos demostrando **v1.4.3**) y reemplace la configuración con la copia de seguridad:

1. Detenga el servicio:

```shell
rocketpool service stop
```

1. Descargue el CLI v1.4.3:

<div className="p-3">
  <Tabs>
    <Tab label="Linux x64">```shell wget https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool ```</Tab>
    <Tab label="Linux arm64">```shell wget https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool ```</Tab>
    <Tab label="Mac x64">```shell curl -L https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool ```</Tab>
    <Tab label="Mac arm64">```shell curl -L https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool ```</Tab>
  </Tabs>
</div>

1. Instale el paquete v1.4.3:

```shell
rocketpool service install -d
```

1. Reemplace su configuración antigua con la configuración de respaldo v1.4.3:

```shell
cp ~/.rocketpool/user-settings-backup.yml ~/.rocketpool/user-settings.yml
```

1. Verifique que todas sus configuraciones antiguas ahora se están usando:

```shell
rocketpool service config
```

1. Si se ve bien, inicie el stack Smartnode:

```shell
rocketpool service start
```

¡Todo listo! Ahora está de vuelta en la versión anterior y debería comenzar a atestiguar poco después de iniciar el servicio.

::: danger ADVERTENCIA
v1.4.3 está **obsoleto** y ya no será utilizable después de que se implemente la actualización Redstone.
Si necesita revertir a él, ¡haga planes para actualizar de nuevo a v1.5.0 antes de que se actualicen los contratos!
:::
