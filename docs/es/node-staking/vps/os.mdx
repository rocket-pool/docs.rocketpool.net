# Preparar el Sistema Operativo

Como se describió en la sección anterior, hay muchos proveedores de VPS y nube diferentes.
Escribir guías para todos ellos sería algo impráctico, pero en esta sección repasaremos un flujo de trabajo típico para preparar una máquina virtual alojada en [Amazon Web Services](https://aws.amazon.com/).
Específicamente, cubriremos cómo seleccionar la configuración de hardware virtual apropiada y cómo preparar el sistema operativo para Rocket Pool.
Deberías poder extrapolar cómo aplicar estos pasos a cualquier proveedor una vez que te familiarices con su ecosistema.

## Crear una Máquina Virtual EC2

El primer paso es [crear una cuenta de AWS](https://portal.aws.amazon.com/billing/signup) si aún no tienes una.
Sigue las instrucciones proporcionadas en ese enlace o inicia sesión con una cuenta existente, y eventualmente llegarás al panel de control de tu consola de administración:

<img src="./images/aws-console.png" width="100%" height="auto" />

A continuación, haz clic en el menú desplegable en la parte superior derecha de la pantalla para seleccionar la región geográfica en la que deseas que tu servidor resida físicamente.
Los servidores no se pueden mover entre regiones una vez que se crean, por lo que debes asegurarte de estar satisfecho con la opción actualmente seleccionada antes de crear realmente el servidor.

Ahora, haz clic en **Services** en la barra de herramientas.
Ve a la sección **Compute** y selecciona **EC2**.
Tu panel de control debería cambiar a una vista similar a esta:

<img src="./images/ec2-dashboard.png" width="100%" height="auto" />

Haz clic en el botón naranja **Launch Instance** y selecciona **Launch Instance** de la lista de opciones para crear una nueva máquina.
Se te presentará un mercado de Amazon Machine Images.
Cada una de estas representa una instantánea específica de una máquina con un sistema operativo preinstalado y algunos otros componentes de software útiles.

Para un nodo de Rocket Pool, recomendamos que uses la imagen **Ubuntu Server 24.04 LTS (HVM)**.

A continuación, tendrás que elegir un **Instance Type**.
Esto determina qué recursos de hardware virtual tendrá disponible tu máquina.

Al momento de escribir esto, estas son las opciones que ofrecen las diferentes configuraciones:

| Instance   | vCPU | CPU Credits / hora | Mem (GiB) | Almacenamiento | Rendimiento de Red |
| ---------- | ---- | ------------------ | --------- | -------------- | ------------------ |
| t2.nano    | 1    | 3                  | 0.5       | Solo EBS       | Bajo               |
| t2.micro   | 1    | 6                  | 1         | Solo EBS       | Bajo a Moderado    |
| t2.small   | 1    | 12                 | 2         | Solo EBS       | Bajo a Moderado    |
| t2.medium  | 2    | 24                 | 4         | Solo EBS       | Bajo a Moderado    |
| t2.large   | 2    | 36                 | 8         | Solo EBS       | Bajo a Moderado    |
| t2.xlarge  | 4    | 54                 | 16        | Solo EBS       | Moderado           |
| t2.2xlarge | 8    | 81                 | 32        | Solo EBS       | Moderado           |

Los requisitos de hardware dependen en gran medida de qué cliente de consenso planeas ejecutar - Nimbus, por ejemplo, requiere menos de 1GB de RAM por sí mismo, por lo que es perfectamente razonable ejecutarlo en una instancia **t2.large**.
Para clientes con mayor uso de RAM, es posible que desees optar por una instancia **t2.xlarge** para tener margen adicional.

::: tip
Es posible que desees consultar la sección [Elegir tus Clientes ETH](../eth-clients) antes de decidir sobre un tipo de instancia para que puedas asegurarte de que el cliente que deseas sea compatible con el tipo de instancia que elijas.
:::

Una vez que hayas hecho tu elección, haz clic en el botón **Next**.
La configuración predeterminada está bien para la sección **Instance Details**, así que déjala como está y haz clic en **Next**.

Cuando llegues a la sección **Add Storage**, crearás un nuevo disco duro virtual para tu sistema.
Esto se puede expandir más tarde gracias al poder de la nube, por lo que obtener el número correcto ahora no es absolutamente crítico.
Sin embargo, por el bien de tu propia tranquilidad, debes cambiar el tamaño a una de las siguientes cifras:

- Usa al menos **100 GiB** si solo estás probando Rocket Pool en la [Red de Prueba Hoodi](../../testnet/overview).
- Usa al menos **1 TiB** (preferiblemente **2 TiB**) si vas a usar este nodo en la red principal de Ethereum (**mainnet**).

Deja los valores predeterminados para las otras configuraciones y haz clic en **Next**.

En el paso **Add Tags**, debes hacer clic en el botón **click to add a Name tag** y darle un nombre fácil de recordar que puedas usar para identificar el servidor más tarde; algo como **Rocket Pool Smartnode** funcionará si necesitas inspiración.
Haz clic en **Next** cuando hayas terminado.

En la sección **Security Group**, mantén la opción **Create a new security group** seleccionada.
Ingresa un nombre y descripción como **Smartnode** y **Smartnode Group**.
Elimina todas las reglas existentes en la tabla y agrega las siguientes reglas:

| Tipo       | Rango de Puertos | Origen                            | Descripción |
| ---------- | ---------------- | --------------------------------- | ----------- |
| SSH        | 22               | [Tu dirección IP pública en casa] | Acceso SSH  |
| Custom TCP | 30303            | Cualquier lugar                   | ETH1 P2P    |
| Custom UDP | 30303            | Cualquier lugar                   | ETH1 P2P    |
| Custom TCP | 9001             | Cualquier lugar                   | ETH2 P2P    |
| Custom UDP | 9001             | Cualquier lugar                   | ETH2 P2P    |

Esto te permitirá conectarte de forma remota a tu servidor a través de SSH (la terminal de línea de comandos) desde tu laptop o escritorio.
También permitirá que los clientes de Ejecución y Consenso se conecten a otros nodos en la red Ethereum.

::: warning NOTA
Para el acceso SSH, esto solo funcionará si tienes una **dirección IP pública estática**.
Probablemente necesitarás solicitarla a tu ISP, ya que muchos de ellos usan un sistema de IP dinámica y cambian tu dirección pública ocasionalmente.
Si no puedes conseguir una dirección estática, tendrás que ir a la consola de AWS y actualizar esta configuración con tu nueva dirección IP cada vez que cambie.
:::

La tabla del grupo de seguridad ahora debería parecerse a esto:

<img src="./images/security-group.png" width="100%" height="auto" />

Ahora, revisa todos los detalles de la instancia para asegurarte de estar satisfecho con ellos, y haz clic en **Launch** cuando estés satisfecho.
Cuando aparezca el mensaje de **SSH key pair**, selecciona **Create a new key pair**.
Dale un nombre memorable como **Smartnode Key**, luego haz clic en **Download Key Pair**.
Almacena estos archivos en un lugar seguro, como `~/.ssh/` (o `C:\Users\[tu nombre de usuario]\.ssh\` en Windows) donde normalmente residen tus otras claves.

::: danger
Este par de claves contiene la clave privada que usarás para conectarte por SSH a tu máquina.
Si alguien se hace con esta clave, tendrá acceso completo a tu nodo - **incluida tu billetera de nodo de Rocket Pool** y todas las monedas dentro de ella.
**Debes** mantener este archivo seguro en todo momento.
:::

A continuación, haz clic en **Launch Instance** para crear tu nuevo servidor virtual.
Cuando aparezca un aviso, haz clic en **View Instances** para ir a tu lista de servidores.
Verás tu nodo de Rocket Pool allí con algunos detalles que acompañan sobre su configuración y estado.

Finalmente, asigna una **Elastic IP Address** a tu máquina - puedes pensar en esto como una dirección IP estática que es exclusiva de AWS.
Tu nodo siempre será accesible en esta dirección, por lo que siempre puedes usar el mismo comando SSH para conectarte a él.

Ve a **Network and Security** en el panel de navegación de la izquierda y haz clic en **Elastic IPs**.
Ahora, haz clic en **Allocate Elastic IP Address**.
La configuración predeterminada está bien, así que simplemente haz clic en los mensajes y regresa a la lista cuando hayas terminado.

A continuación, selecciona la nueva dirección en la lista.
Haz clic en el botón **Actions** encima de ella, luego haz clic en **Associate Elastic IP Address**.
Deja el tipo de recurso configurado como **Instance** y selecciona la instancia de Rocket Pool Smartnode que acabas de crear de la lista.
Haz clic en **Associate** para asignar la dirección a tu servidor virtual.
Ahora, si miras bajo la columna \*Associated Instance ID\*\* de la dirección, puedes verificar que tiene tu máquina asignada.

## Acceder a la Máquina

Para acceder a la máquina, abre una nueva terminal en Linux o macOS (usa Powershell en Windows) y escribe el siguiente comando:

```shell
ssh [tu dirección IP elástica]
```

Si almacenaste tus claves en la carpeta `.ssh`, esto usará el par de claves privadas que generaste durante la configuración para autenticarse con la máquina automáticamente - sin nombres de usuario, sin contraseñas.

Una vez aquí, tienes acceso completo de terminal al sistema.

## Configurar el Espacio Swap

En la mayoría de los casos, si eliges tus clientes de Ejecución y Consenso y tu tipo de instancia con cuidado, no deberías quedarte sin RAM.
Por otro lado, nunca está de más agregar un poco más.
Lo que vamos a hacer ahora es agregar lo que se llama **espacio swap**.
Esencialmente, significa que vamos a usar el SSD como "RAM de respaldo" en caso de que algo vaya horriblemente mal y tu servidor se quede sin RAM regular.
El SSD no es ni cerca de tan rápido como la RAM regular, por lo que si llega al espacio swap ralentizará las cosas, pero no fallará por completo y romperá todo.
Piensa en esto como un seguro adicional que (muy probablemente) nunca necesitarás.

### Crear un Archivo Swap

El primer paso es crear un nuevo archivo que actuará como tu espacio swap.
Decide cuánto quieres usar - un inicio razonable sería 8 GB, por lo que tienes 8 GB de RAM normal y 8 GB de "RAM de respaldo" para un total de 16 GB.
Para estar súper seguro, puedes hacerlo de 24 GB para que tu sistema tenga 8 GB de RAM normal y 24 GB de "RAM de respaldo" para un total de 32 GB, pero esto probablemente sea excesivo.
Afortunadamente, dado que tu SSD tiene 1 o 2 TB de espacio, asignar de 8 a 24 GB para un archivo swap es insignificante.

Por el bien de este tutorial, elijamos un buen punto medio - digamos, 16 GB de espacio swap para una RAM total de 24 GB.
Solo sustituye el número que desees a medida que avanzamos.

Ingresa esto, que creará un nuevo archivo llamado `/swapfile` y lo llenará con 16 GB de ceros.
Para cambiar la cantidad, simplemente cambia el número en `count=16` por el que desees. **Ten en cuenta que esto va a tomar mucho tiempo, pero está bien.**

```shell
sudo dd if=/dev/zero of=/swapfile bs=1G count=16 status=progress
```

A continuación, establece los permisos para que solo el usuario root pueda leer o escribir en él (por seguridad):

```shell
sudo chmod 600 /swapfile
```

Ahora, márcalo como un archivo swap:

```shell
sudo mkswap /swapfile
```

A continuación, actívalo:

```shell
sudo swapon /swapfile
```

Finalmente, agrégalo a la tabla de montaje para que se cargue automáticamente cuando tu servidor se reinicie:

```shell
sudo nano /etc/fstab
```

Agrega una nueva línea al final que se vea así:

```
/swapfile                            none            swap    sw              0       0
```

Presiona `Ctrl+O` y `Enter` para guardar, luego `Ctrl+X` y `Enter` para salir.

Para verificar que está activo, ejecuta estos comandos:

```shell
sudo apt install htop
htop
```

Tu salida debería verse así en la parte superior:
![](../local/images/pi/Swap.png)

Si el segundo número en la última fila etiquetada como `Swp` (el que está después de `/`) es distinto de cero, entonces estás listo.
Por ejemplo, si muestra `0K / 16.0G` entonces tu espacio swap se activó correctamente.
Si muestra `0K / 0K` entonces no funcionó y tendrás que confirmar que ingresaste los pasos anteriores correctamente.

Presiona `q` o `F10` para salir de `htop` y volver a la terminal.

### Configurar Swappiness y Cache Pressure

De forma predeterminada, Linux usará ansiosamente mucho espacio swap para quitar algo de presión de la RAM del sistema.
No queremos eso. Queremos que use toda la RAM hasta el último segundo antes de depender del SWAP.
El siguiente paso es cambiar lo que se llama "swappiness" del sistema, que es básicamente qué tan ansioso está de usar el espacio swap.
Hay mucho debate sobre qué valor establecer para esto, pero hemos encontrado que un valor de 6 funciona bastante bien.

También queremos reducir la "cache pressure", que dicta qué tan rápido el servidor eliminará una caché de su sistema de archivos.
Dado que vamos a tener mucha RAM de sobra con nuestra configuración, podemos hacer esto "10", lo que dejará la caché en memoria por un tiempo, reduciendo la E/S del disco.

Para establecer estos, ejecuta estos comandos:

```shell
sudo sysctl vm.swappiness=6
sudo sysctl vm.vfs_cache_pressure=10
```

Ahora, colócalos en el archivo `sysctl.conf` para que se vuelvan a aplicar después de un reinicio:

```shell
sudo nano /etc/sysctl.conf
```

Agrega estas dos líneas al final:

```shell
vm.swappiness=6
vm.vfs_cache_pressure=10
```

Luego guarda y sal como lo has hecho antes (`Ctrl+O`, `Ctrl+X`).

Y con eso, tu servidor está en funcionamiento y listo para ejecutar Rocket Pool.
Continúa a la sección [Elegir tus Clientes ETH](../eth-clients).
