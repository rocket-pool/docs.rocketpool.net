import { Tab, Tabs } from "@rspress/core/theme";
import tuiEcContainerTag from "./images/tui-ec-container-tag.png";
import tuiCcContainerTag from "./images/tui-cc-container-tag.png";

# Verificando Actualizaciones

Una de las responsabilidades de un operador de nodo es asegurarse de que tu sistema esté actualizado con los últimos parches de seguridad.
Las actualizaciones automáticas son convenientes pero pueden interferir con la operación de tu nodo, por lo que puede ser preferible ejecutarlas manualmente.
En cualquier caso, **¡debes asegurarte de que tu máquina esté parcheada regularmente!**

::: tip NOTA
La mayoría de las veces, actualizar no requerirá que tu sistema esté inactivo por más de unos pocos minutos.
Puede que te preocupe que tal tiempo de inactividad afecte negativamente tu saldo de Beacon Chain.
Ten la seguridad de que la penalización por estar desconectado durante un período tan corto es **completamente insignificante**.

Cada atestación que pierdas te penalizará por un poco menos de lo que ganarías de una atestación exitosa.
Como regla general, si estás desconectado durante una hora, ganarás todo de vuelta después de estar en línea durante una hora nuevamente.

También ten en cuenta que **no hay absolutamente ninguna posibilidad** de que seas _slashed_ por desconectarte por un corto tiempo.
El slashing solo ocurre si atacas la red, y desconectarse por mantenimiento no cuenta como atacar la red.

**¡Por favor mantén tus sistemas actualizados - no te preocupes por las penalizaciones por tiempo de inactividad!**
:::

## Actualizando tu Sistema Operativo

Deberías verificar con frecuencia el administrador de paquetes o el servicio de actualización de tu Sistema Operativo para asegurarte de aplicar rápidamente cualquier nuevo parche de seguridad importante.
Las instrucciones exactas varían para cada Sistema Operativo y se pueden encontrar en la documentación de tu sistema, pero aquí hay algunos ejemplos.

<div className="p-3">
  <Tabs>
    <Tab label="Ubuntu">
      En una terminal, escribe lo siguiente:

      ```shell
      sudo apt update
      ```

      Esto accederá a los servidores de paquetes y verificará si alguno de tus paquetes instalados tiene nuevas versiones disponibles.
      Si hay actualizaciones disponibles, la salida se verá así:

      ```
      Fetched 3974 kB in 2s (1641 kB/s)
      Reading package lists... Done
      Building dependency tree
      Reading state information... Done
      12 packages can be upgraded. Run 'apt list --upgradable' to see them.
      ```

      Puedes instalar las actualizaciones con el siguiente comando:

      ```shell
      sudo apt dist-upgrade
      ```

      Esto te mostrará la lista de paquetes que están a punto de ser actualizados, y si el tamaño total de instalación es lo suficientemente grande, te mostrará el tamaño y te pedirá que confirmes que aceptas:

      ```
      12 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
      Need to get 51.3 MB of archives.
      After this operation, 52.2 kB of additional disk space will be used.
      Do you want to continue? [Y/n]
      ```

      Asegúrate de tener suficiente espacio disponible para hacer esto, luego presiona `y` y `Enter` para comenzar el proceso de actualización.

      Una vez que la barra de progreso haya terminado y vuelvas al símbolo del sistema de la terminal, ejecuta el siguiente comando para limpiar cualquier versión antigua de paquetes que acaban de ser reemplazados:

      ```shell
      sudo apt autoremove
      ```

      A continuación, verifica si tu sistema necesita ser reiniciado:

      ```shell
      cat /var/run/reboot-required
      ```

      Si el comando anterior imprime `No such file or directory`, entonces no se requiere reiniciar y puedes omitir el paso a continuación.

      Sin embargo, si el comando imprime `*** System restart required ***`, entonces deberías reiniciar tu máquina para terminar de aplicar las actualizaciones cuando puedas:

      ```shell
      sudo reboot
      ```

      Rocket Pool se apagará correctamente y se reiniciará automáticamente con el sistema una vez que se reinicie.
    </Tab>
    <Tab label="MacOS">
      Para actualizar los paquetes del SO, usa la interfaz de usuario para seleccionar `Apple -> Software Update`.

      Para actualizar los paquetes mismos, la forma más fácil es vía `homebrew` en la terminal:

      ```shell
      brew update && brew upgrade
      ```
    </Tab>

  </Tabs>
</div>

## Actualizando el Stack del Smartnode

Ocasionalmente, Rocket Pool lanzará una nueva versión del stack del Smartnode.
Las actualizaciones pueden contener nuevas versiones de la CLI o los contenedores Docker de Rocket Pool, así como nuevas versiones de los clientes de Ejecución y Consenso.

La forma más consistente de enterarse de nuevos lanzamientos es suscribirte al servidor de Discord de Rocket Pool; siempre se publicarán en el canal de Lanzamientos y recibirás una notificación.

::: warning NOTA
Ten en cuenta que ejecutar `apt update` no actualizará el software del nodo.
Esto debe hacerse manualmente usando los pasos a continuación.
:::

::: tip CONSEJO
Cuando hayas completado la actualización del Smartnode, el panel de Grafana todavía indicará que hay una actualización disponible.
Se borrará automáticamente dentro de un día cuando el sistema verifique automáticamente las actualizaciones nuevamente.

Si deseas borrarlo inmediatamente después de la actualización, simplemente ejecuta:
`sudo apt update`
:::

::: tip CONSEJO
Si no conoces la arquitectura de tu CPU, puedes ejecutar el siguiente comando para averiguarlo:

```shell
uname -m
```

La salida de este comando imprimirá tu arquitectura.
**Ten en cuenta que `x86_64` es lo mismo que `x64` y `amd64`.**
**Ten en cuenta que `aarch64` es lo mismo que `arm64`.**
:::

Los pasos para actualizar dependen del modo que use tu nodo. Selecciona de las opciones a continuación:

<div className="p-3">
  <Tabs>
    <Tab label="Linux (Modo Docker o Híbrido)">
      Detén los servicios de Rocket Pool:

      ```shell
      rocketpool service stop
      ```

      Descarga la nueva CLI del Smartnode:

      Para sistemas `x64` (la mayoría de las máquinas normales):

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool
      ```

      Para sistemas `arm64`:

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool
      ```

      Ahora ejecuta el comando de instalación:

      ```shell
      rocketpool service install -d
      ```

      La bandera `-d` le dice que ignore las dependencias del sistema como Docker, ya que ya las tienes.

      Si deseas ver qué ha cambiado, abre el Administrador de Configuración - la Página de Revisión te mostrará qué hay de nuevo:

      ```shell
      rocketpool service config
      ```

      Cuando hayas terminado, inicia Rocket Pool nuevamente:

      ```shell
      rocketpool service start
      ```

      Finalmente, verifica la versión para asegurarte de que la CLI y el stack del Smartnode estén actualizados:

      ```shell
      rocketpool service version
      ```

      La salida debería verse algo así:

      ```
      Your Smartnode is currently using the Hoodi Test Network.

      Rocket Pool client version: 1.5.0
      Rocket Pool service version: 1.5.0
      Selected Eth 1.0 client: Geth (Locally managed)
      Image: ethereum/client-go:v1.10.21
      Selected Eth 2.0 client: Lighthouse (Locally managed)
      Image: rocketpool/lighthouse:mevboost-5ee3bc5
      ```

      Tanto el cliente como el servicio deberían coincidir con la nueva versión de lanzamiento.
    </Tab>
    <Tab label="Linux (Modo Nativo)">
      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTA</p>
        Esto solo actualizará el stack del Smartnode en sí - **no** actualizará tus clientes de Ejecución o Consenso.
        Tendrás que hacerlo manualmente (ver la siguiente sección a continuación).
      </p>

      Detén los servicios de Rocket Pool:

      ```shell
      sudo systemctl stop rp-node rp-watchtower
      ```

      Descarga la nueva CLI del Smartnode y respalda los binarios antiguos de la CLI y el daemon por si necesitas recuperarlos:

      Para sistemas `x64` (la mayoría de las máquinas normales):

      ```shell
      sudo mv /usr/local/bin/rocketpool /usr/local/bin/rocketpool_bak

      sudo mv /usr/local/bin/rocketpoold /usr/local/bin/rocketpoold_bak

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-amd64 -O /usr/local/bin/rocketpool

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-daemon-linux-amd64 -O /usr/local/bin/rocketpoold

      sudo chmod +x /usr/local/bin/rocketpool /usr/local/bin/rocketpoold
      ```

      Para sistemas `arm64`:

      ```shell
      sudo mv /usr/local/bin/rocketpool /usr/local/bin/rocketpool_bak

      sudo mv /usr/local/bin/rocketpoold /usr/local/bin/rocketpoold_bak

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-linux-arm64 -O /usr/local/bin/rocketpool

      sudo wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-daemon-linux-arm64 -O /usr/local/bin/rocketpoold

      sudo chmod +x /usr/local/bin/rocketpool /usr/local/bin/rocketpoold
      ```

      Si deseas ver qué ha cambiado, abre el Administrador de Configuración - la Página de Revisión te mostrará qué hay de nuevo:

      ```shell
      rp service config
      ```

      Cuando hayas terminado, inicia Rocket Pool nuevamente:

      ```shell
      sudo systemctl start rp-node rp-watchtower
      ```

      Finalmente, verifica la versión para asegurarte de que la CLI y el stack del Smartnode estén actualizados:

      ```
      rocketpool service version

      Rocket Pool client version: 1.0.0-rc3
      Rocket Pool service version: 1.0.0-rc3
      Selected Eth 1.0 client: Geth (rocketpool/client-go:v1.10.4)
      Selected Eth 2.0 client: Nimbus (statusim/nimbus:v1.4.0)
      ```

      Tanto el cliente como el servicio deberían coincidir con la nueva versión de lanzamiento.
    </Tab>
    <Tab label="macOS (Modo Docker o Híbrido)">
      Detén los servicios de Rocket Pool:

      ```shell
      rocketpool service stop
      ```

      Descarga la nueva CLI del Smartnode:

      Para sistemas `x64` (la mayoría de las Macs):

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-amd64 -O /usr/local/bin/rocketpool
      ```

      Para sistemas `arm64`, como el Mac mini con M1:

      ```shell
      wget https://github.com/rocket-pool/smartnode/releases/latest/download/rocketpool-cli-darwin-arm64 -O /opt/homebrew/bin/rocketpool
      ```

      Ahora ejecuta el comando de instalación:

      ```shell
      rocketpool service install -d
      ```

      La bandera `-d` le dice que ignore las dependencias del sistema como Docker, ya que ya las tienes.

      Si deseas ver qué ha cambiado, abre el Administrador de Configuración - la Página de Revisión te mostrará qué hay de nuevo:

      ```shell
      rocketpool service config
      ```

      Cuando hayas terminado, inicia Rocket Pool nuevamente:

      ```shell
      rocketpool service start
      ```

      Finalmente, verifica la versión para asegurarte de que la CLI y el stack del Smartnode estén actualizados:

      ```shell
      rocketpool service version

      Rocket Pool client version: 1.0.0-rc3
      Rocket Pool service version: 1.0.0-rc3
      Selected Eth 1.0 client: Geth (rocketpool/client-go:v1.10.4)
      Selected Eth 2.0 client: Nimbus (statusim/nimbus:v1.4.0)
      ```

      Tanto el cliente como el servicio deberían coincidir con la nueva versión de lanzamiento.

    </Tab>

  </Tabs>
</div>

## Actualizando Manualmente el Cliente de Ejecución o Consenso

Cada nuevo lanzamiento del stack del Smartnode vendrá con referencias actualizadas a las últimas versiones compatibles de los contenedores Docker de Ejecución y Consenso.
Sin embargo, en algunos casos, es posible que desees actualizar uno de esos clientes _antes_ de esperar un nuevo lanzamiento del stack del Smartnode.
Esta sección te mostrará cómo hacer exactamente eso.

<div className="p-3">
  <Tabs>
    <Tab label="Modo Docker">
      Actualizar a nuevas versiones de clientes es fácil en modo Docker.

      Comienza abriendo el Administrador de Configuración:

      ```shell
      rocketpool service config
      ```

      Para cambiar la versión del cliente de Ejecución, ve a la categoría **Execution Client**.
      Modifica la configuración **Container Tag**:

      <img src={tuiEcContainerTag} width="100%" height="auto"/>

      Para cambiar la versión del cliente de Consenso, ve a la categoría **Consensus Client**.
      Modifica la configuración **Beacon Node Container Tag**:

      <img src={tuiCcContainerTag} width="100%" height="auto"/>

      Cuando estés satisfecho con tus cambios, guarda y sal como de costumbre.
      El Smartnode ofrecerá reiniciar todos los contenedores afectados automáticamente.
    </Tab>
    <Tab label="Modo Nativo">
      Primero, apaga tu cliente de Ejecución, Beacon Node y/o servicio de cliente de Validador dependiendo de lo que desees actualizar.
      Por ejemplo, apagando Geth:

      ```shell
      sudo systemctl stop geth
      ```

      A continuación, descarga el último lanzamiento binario del proveedor de tu cliente (o constrúyelo desde la fuente) y reemplaza el binario antiguo con el nuevo.
      Recomendamos que **muevas el binario antiguo a una ubicación de respaldo** en lugar de sobrescribirlo, por si acaso el nuevo cliente tiene problemas.

      Finalmente, inicia el servicio del cliente nuevamente - por ejemplo, iniciando Geth:

      ```shell
      sudo systemctl start geth
      ```

      Deberías seguir los scripts de registro de cerca después de la actualización para asegurarte de que el nuevo cliente funcione como se espera.
    </Tab>

  </Tabs>
</div>
