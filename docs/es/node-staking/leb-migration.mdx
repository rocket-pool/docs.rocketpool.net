import { Tab, Tabs } from "@rspress/core/theme";

::: danger ADVERTENCIA
Los depósitos de minipool están actualmente deshabilitados en preparación para Saturn 1.
:::

# Migrar un Minipool de 16-ETH a 8-ETH

Los operadores de nodo tienen la capacidad de **migrar directamente** sus minipools existentes de 16-ETH a minipools de 8-ETH.
Al hacerlo, se agregarán 8 ETH a sus [saldos de crédito de depósito](./credit) que pueden usarse para **crear minipools adicionales sin requerir ETH de los operadores de nodo**.

En efecto, este proceso permite a un operador de nodo **convertir un minipool de 16-ETH en dos minipools de 8-ETH de forma gratuita** (_aunque todavía requerirá ETH para gas y suficiente colateral RPL para manejar ambos minipools_).

Migrar un minipool existente de 16-ETH a uno de 8-ETH se conoce formalmente como **reducción de fianza**.
Es un proceso de dos pasos e involucra validación por parte del Oracle DAO.
Le guiaremos a través de todo el proceso en las secciones a continuación.

### Reglas de Reducción de Fianza

Una reducción de fianza involucra los siguientes pasos:

1. Iniciar la reducción de fianza, hecho por el operador de nodo.
2. Un período de espera (la "verificación de scrub de reducción de fianza"), permitiendo al Oracle DAO tiempo para verificar que la reducción de fianza es legal y cancelar cualquier reducción de fianza que viole las reglas.
3. Completar la reducción de fianza, hecho por el operador de nodo.

Para realizar una reducción de fianza exitosa sin ser scrubbed, el minipool debe seguir estas reglas:

1. El minipool debe ser actualizado al [delegado Atlas](./minipools/delegates); el antiguo delegado Redstone no puede ser usado.
1. El validador del minipool en la Beacon Chain debe estar **pendiente o activamente staking**. No puede estar slashed, exiting / exited, o withdrawable / withdrawn.
1. El balance del validador del minipool en la Beacon Chain debe ser **al menos 31.99 ETH** (32 ETH con un pequeño margen para complicaciones mal sincronizadas que resulten en attestations perdidas después de un skim de recompensas).

El minipool debe obedecer estas condiciones durante **toda la duración** de la verificación de scrub, durante la cual el Oracle DAO estará observándolo para asegurar el cumplimiento de las condiciones anteriores.

Si, en cualquier momento durante la verificación de scrub, se encuentra que un minipool viola estas condiciones, la reducción de fianza será **scrubbed**.
El minipool en sí no se verá afectado; seguirá viviendo felizmente como un minipool de 16 ETH, validando y actuando como si todo el proceso de reducción de fianza nunca hubiera sucedido.
Sin embargo, **ya no será elegible para reducciones de fianza**.
Una vez que la reducción de fianza de un minipool es scrubbed, nunca podrá intentarse de nuevo.

::: warning NOTA
Tras una reducción de fianza exitosa, el monto de fianza del minipool se reducirá de 16 ETH a 8 ETH y **la comisión del minipool se restablecerá a cualquier valor de red actual**.

Si reduce un minipool de 16-ETH con una comisión del 20%, **no conservará esa comisión del 20%**.
Se reducirá al valor de red (**actualmente establecido en un 14% fijo**).

Tenga en cuenta que, como se demuestra en la sección de [matemática de ejemplo](./create-validator.mdx#rewards), un minipool de 8-ETH al 14% es _aún más rentable_ que un minipool de 16-ETH al 20%, por lo que mantener una tasa de comisión alta no es una razón convincente para retener una fianza de 16 ETH.
:::

### Paso 1: Comenzar la Reducción de Fianza

Para comenzar el proceso de reducción de fianza, ingrese el siguiente comando:

```shell
rocketpool minipool begin-bond-reduction
```

Esto comenzará proporcionando una breve descripción del proceso (aunque, si ha leído esta guía, todo debería ser familiar para usted ya).
Una vez que reconozca que entiende el proceso, le mostrará qué minipools actualmente tienen una fianza que puede reducirse, junto con su fianza y comisión actuales:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)

```

Una vez que haya seleccionado uno o más minipools para reducir, el Smartnode verificará si esos minipools son elegibles para la reducción de fianza.

Para ser elegible, estas condiciones deben satisfacerse:

- El minipool ha sido actualizado para usar el [contrato de delegado de minipool Atlas](./minipools/delegates).
- El validador del minipool debe tener un balance de Beacon Chain de al menos 32 ETH.
- El validador del minipool debe estar pendiente o activo.
- Tiene suficiente RPL staked para soportar el nivel mínimo de colateral RPL que se requeriría _después_ de la reducción de fianza.

Si no, imprimirá un error de advertencia explicando lo que debe hacerse primero; por ejemplo:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)
2

Cannot reduce bond for minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5:
The minipool version is too low. It must be upgraded first using `rocketpool minipool delegate-upgrade`.
You do not have enough RPL staked to support this bond reduction; it would bring you below the minimum RPL staking requirement. You will have to stake more RPL first.
```

Esto muestra que el minipool seleccionado requiere una actualización de delegado y el nodo necesita más RPL staked para reducir la fianza de ese minipool.

Cuando haya satisfecho las precondiciones, seleccionar un minipool en este comando simplemente le pedirá que elija su precio de gas para la transacción y la confirmación de la acción.
Al aceptar la confirmación, la reducción de fianza del minipool comenzará.

### Monitorear el Temporizador de Verificación de Scrub

Una vez que haya iniciado una reducción de fianza, puede ver cuánto tiempo falta hasta que pueda completarse en sus logs del daemon `node`:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Para usuarios de **Docker Mode** y **Hybrid Mode**, esto puede hacerse con el siguiente comando:

      ```shell
      rocketpool service logs node
      ```
    </Tab>
    <Tab label="Native Mode">
      Consulte el script que usa para revisar los logs del sistema de su daemon de nodo.
    </Tab>

  </Tabs>
</div>

Verá una nueva entrada notando cuánto tiempo falta hasta que la verificación de scrub para su reducción de fianza esté completa:

```
rocketpool_node  | 2023/02/25 09:04:21 Checking for minipool bonds to reduce...
rocketpool_node  | 2023/02/25 09:04:21 Minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 has 12m0s left until it can have its bond reduced.
```

Una vez que este temporizador llegue a cero y ya no aparezca en estos logs, puede completar la reducción de fianza.

### Paso 2: Completar la Reducción de Fianza

Cuando el temporizador de scrub haya terminado exitosamente, hay dos formas de completar la reducción de fianza de su minipool:

1. Dejar que el daemon `node` lo maneje por usted; hace esto durante la verificación de rutina que realiza cada cinco minutos (la misma que imprime la línea de tiempo restante en el log anterior). Si nota que tiene una reducción de fianza elegible, **completará la reducción automáticamente** - tal como lo hace con el staking de minipools pendientes y la verificación de su destinatario de comisiones. Verá salida en el log de `node` mostrando cuándo ha detectado, y completado, una reducción de fianza.
2. Completar la reducción de fianza manualmente usando el siguiente comando:
   ```shell
   rocketpool minipool reduce-bond
   ```
   El comando es simple; siga las indicaciones para completar el proceso una vez que su minipool sea elegible para la reducción de fianza.

Durante la reducción de fianza, Rocket Pool **distribuye el balance existente de su minipool** usando la fianza y comisión pre-reducción del minipool para asegurar que tanto usted como los stakers de rETH obtengan su parte justa del balance existente, y la reducción de fianza no cambie las recompensas que cualquiera de las partes _habría_ obtenido en ese balance.

### Los Resultados de una Fianza Reducida

Puede verificar la reducción de fianza exitosa usando `rocketpool minipool status`.

**Antes** de la reducción de fianza, para el minipool de ejemplo que hemos estado siguiendo, ese comando produciría la siguiente salida:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             15.000000%
Node deposit:         16.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            16.000000 ETH
Minipool Balance (EL): 0.150713 ETH
Your portion:          0.086660 ETH
Available refund:      0.000000 ETH
Total EL rewards:      0.086660 ETH
...
Beacon balance (CL):   32.000152 ETH
Your portion:          16.000087 ETH
...
```

**Después** de la reducción de fianza, el comando devolvería esta salida:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             14.000000%
Node deposit:         8.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 0.086769 ETH
Your portion:          0.000000 ETH
Available refund:      0.086769 ETH
Total EL rewards:      0.086769 ETH
...
Beacon balance (CL):   32.000037 ETH
Your portion:          8.000013 ETH
...
```

Note cómo han cambiado las cosas:

- `Node fee` (comisión) pasó de 15% a 14%
- `Node deposit` (su fianza) pasó de 16 ETH a 8 ETH
- `RP deposit` (la cantidad que pidió prestada) pasó de 16 ETH a 24 ETH
- `Minipool Balance (EL)` pasó de 0.150713 ETH a 0.086769 ETH
- `Your portion (EL)` pasó de 0.086660 ETH a 0 ETH
- `Available refund` pasó de 0 ETH a 0.086769 ETH
- `Your portion (CL)` pasó de 16.000087 ETH a 8.000013 ETH

Los cambios en `Node fee`, `Node deposit`, `RP deposit`, y `Your portion (CL)` indican que la fianza fue reducida exitosamente.

Los cambios en `Minipool Balance (EL)`, `Your portion (EL)`, y `Available refund` indican los resultados de la **distribución de balance del minipool** que ocurrió como parte del proceso de reducción de fianza.
Para clarificar cómo interpretar estos resultados:

- Si mira [la transacción](https://zhejiang.beaconcha.in/tx/0xf02f6b1a4ea68f356909e6f1974dc3c24d301ba115b97f3013c3c829ba2ca57c), también verá que envió 0.06413383 ETH del minipool al staking pool.
- En el ejemplo "antes", la parte del staking pool es el balance del minipool menos la porción del operador de nodo, o `0.150713 - 0.086660 = 0.064053` que es la cantidad transferida al staking pool durante la reducción de fianza (más una pequeña cantidad de un skim de recompensas que ocurrió durante la verificación de scrub).
- La parte del _operador de nodo_, por otro lado, no se envía a la dirección de retiro del operador de nodo. En su lugar, se marca como un **refund disponible**, que es por qué el monto de refund aumentó de 0 ETH a lo que anteriormente era el monto de "su porción" del balance del minipool en el EL.
  - Puede reclamar este refund en cualquier momento usando el siguiente comando:
    ```shell
    rocketpool minipool refund
    ```

Hay un resultado más importante de la reducción de fianza, que puede observarse usando `rocketpool node status`:

```
Your Smartnode is currently using the Zhejiang Test Network.

=== Account and Balances ===
The node 0x9BA1401Eb7D779eC51f910B066e9C4351cD28911 has a balance of 347.796908 ETH and 16799.835547 RPL.
The node has 8.000000 ETH in its credit balance, which can be used to make new minipools.
```

El proceso de reducción de fianza ha **aumentado el** [saldo de crédito de depósito](./credit) **del nodo** en 8 ETH.
¡Este crédito puede usarse para [hacer otro minipool de 8-ETH](./create-validator.mdx#depositing-eth-and-creating-a-minipool) gratis (no se requiere ETH de la wallet del nodo, excepto para gas)!
