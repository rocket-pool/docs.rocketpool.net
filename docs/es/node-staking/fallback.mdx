import tui_ec_expose_ports from "./images/tui-ec-expose-ports.png";
import tui_cc_expose_ports from "./images/tui-cc-expose-ports.png";
import tui_fallback_clients from "./images/tui-fallback-clients.png";

# Especificar un Nodo de Respaldo

A partir de **1.5.0** del stack de Smartnode, puede proporcionar un par de cliente de Execution "de respaldo" y cliente de Consensus que puede asumir el control de sus clientes primarios si alguna vez se desconectan (como por ejemplo [si usa Geth y necesita podarlo](./pruning)).
En esta situación, su máquina de nodo primaria seguirá siendo responsable de atestiguar y proponer bloques con las claves de validador de sus minipools, pero se conectará a una máquina externa para interactuar con las cadenas de Execution y Beacon.

Esencialmente, le permite usar _temporalmente_ otro par de clientes para cosas como consultar las cadenas, enviar transacciones y recibir bloques para atestiguar.
Este par puede ser administrado externamente (como en modo Híbrido), o puede ser otro nodo de Rocket Pool (otra máquina en modo Docker que tiene los puertos API expuestos, lo cual cubriremos a continuación).

Una vez que los clientes primarios de su nodo estén de vuelta en línea, el Smartnode y su cliente Validator volverán a ellos automáticamente.

::: warning NOTA
Un nodo de respaldo **no** es lo mismo que un nodo de "backup".
Los nodos de respaldo tienen un par de cliente de Execution y Consensus sincronizados con la cadena y ejecutándose, pero **no** tienen la billetera de su nodo o sus claves de validador cargadas.

Si su nodo principal alguna vez se desconecta, **su respaldo no comenzará a validar por usted.**
:::

## Clientes Compatibles

A partir de v1.9.0, todos nuestros clientes de validador compatibles han agregado soporte de respaldo con solo algunas limitaciones:

| Nombre     | Soporta Respaldo | Clientes de Respaldo Válidos                                                           |
| ---------- | ---------------- | -------------------------------------------------------------------------------------- |
| Lighthouse | Sí               | Cualquiera (protección doppelganger off)<br />Lighthouse (protección doppelganger on) |
| Nimbus     | Sí               | Cualquiera                                                                             |
| Prysm      | Sí               | Prysm                                                                                  |
| Teku       | Sí               | Cualquiera                                                                             |
| Lodestar   | Sí               | Cualquiera                                                                             |

## Configurar un Nuevo Nodo (Modo Docker)

Puede usar una segunda máquina que posea localmente, un nodo remoto alojado en un VPS, o un nodo basado en la nube como un nodo de respaldo.

Este ejemplo le muestra cómo crear un segundo Smartnode en una máquina diferente usando el modo Docker, que puede servir como un nodo de respaldo.

::: tip SUGERENCIA
Si ya tiene un segundo nodo listo y tiene sus puertos RPC expuestos, siéntase libre de omitir esta sección.
:::

1. Siga los pasos en la guía sobre configuración de un nodo ([local](./local/hardware) o [remoto](./vps/providers)).
2. Una vez que la máquina esté lista, [instale el stack de Smartnode](./docker).
3. Ejecute `rocketpool service config` para especificar qué clientes le gustaría usar.
   1. Cuando llegue al final del asistente y le pregunte si desea revisar su configuración, seleccione **Yes**.
   2. Entre a la configuración de `Execution Client`.
   3. Marque la casilla `Expose RPC Ports`:

   <img src={tui_ec_expose_ports} width="100%" height="auto" />
   4. Regrese y entre a la configuración de `Consensus Client`. 5. Marque la casilla `Expose API Port` (y, si está usando **Prysm**, la casilla `Expose RPC Port` también):

   <img src={tui_cc_expose_ports} width="100%" height="auto" />
   6. Guarde la configuración e inicie el Smartnode.

4. Salte a la guía [Asegurando su Nodo](./securing-your-node) para configurar SSH y la postura de seguridad adecuada en él.
   1. Si tiene `ufw` instalado, necesitará agregar reglas para permitir tráfico entrante a los puertos API (`8545`, `8546`, y `5052` por defecto; también `5053` si está usando **Prysm**).

5. ¡Eso es todo! Puede detenerse aquí.

::: danger NOTA
**No** cree una billetera con `rocketpool wallet init` ni recupere su billetera antigua.
Deje este nodo sin una billetera y sin claves de validador.

Su único trabajo es tener un cliente de Execution y cliente de Consensus sincronizados.
:::

## Conectar su Nodo Principal al Nodo de Respaldo

Una vez que tenga un nodo de respaldo preparado, puede conectarlo a su nodo principal.

1. Entre al TUI de `rocketpool service config` y entre a la configuración de `Fallback Clients`.
2. Marque la casilla `Use Fallback Clients`.
3. Ingrese la URL RPC para su cliente de Execution en la casilla `Execution Client URL`. Por ejemplo, si la dirección IP de su nodo de respaldo es `192.168.1.45` y tiene su cliente de Execution en el puerto predeterminado de `8545`, ingresaría `http://192.168.1.45:8545` aquí.
4. Haga lo mismo para la URL RPC de su cliente de Consensus de respaldo. Siguiendo el mismo ejemplo, si lo tiene en el puerto predeterminado de `5052`, ingresaría `http://192.168.1.45:5052` aquí.

La página final debería verse así:

<img src={tui_fallback_clients} width="100%" height="auto" />

::: tip NOTA
Los usuarios de **modo nativo** pueden seguir los mismos pasos, aunque el TUI se verá ligeramente diferente de la captura de pantalla anterior.

Tenga en cuenta que esto solo proporcionará **al Smartnode mismo** (el servicio daemon) con soporte de respaldo; **tendrá que actualizar manualmente los argumentos del servicio de su cliente Validator para darle acceso a los clientes de respaldo.**
:::

Presione `enter` en la casilla final para asegurarse de que esté confirmada, luego guarde la configuración y aplique los cambios.

Una vez que se hayan aplicado, puede confirmar la disponibilidad de su nodo de respaldo usando el comando `rocketpool node sync`:

```
Your Smartnode is currently using the Ethereum Mainnet.

Your eth2 client is on the correct network.

Your primary execution client is fully synced.
Your fallback execution client is fully synced.
Your primary consensus client is fully synced.
Your fallback consensus client is fully synced.
```

Si muestra que tanto el cliente de Execution de respaldo como el cliente de Consensus están sincronizados, ¡entonces está todo listo!

## Probar los Clientes de Respaldo

Si desea estar absolutamente seguro de que su configuración va a funcionar probando los clientes de respaldo, simplemente detenga los clientes de Execution y Consensus en su nodo principal:

```shell
docker stop rocketpool_eth1 rocketpool_eth2
```

Luego ejecute cualquier comando que consulte la cadena, como `rocketpool network stats`.
Verá un mensaje de advertencia en la parte superior indicando que uno (o ambos) de sus clientes primarios están fuera de línea, y que está revirtiendo a los clientes de respaldo:

```
NOTE: primary clients are not ready, using fallback clients...
 Primary EC status: unavailable (Sync progress check failed with [Post "http://eth1:8545": dial tcp: lookup eth1 on 127.0.0.11:53: no such host])
 Primary CC status: unavailable (Sync progress check failed with [Could not get node sync status: Get "http://eth2:5052/eth/v1/node/syncing": dial tcp: lookup eth2 on 127.0.0.11:53: no such host])

========== General Stats ==========
Total Value Locked:      278978.009858 ETH
Staking Pool Balance:    10.587295 ETH
Minipool Queue Demand:   3360.000000 ETH
Staking Pool ETH Used:   99.735490%

============== Nodes ==============
Current Commission Rate: 15.000000%
Node Count:              1325
Active Minipools:        6409
    Initialized:         175
    Prelaunch:           3
    Staking:             6227
    Withdrawable:        0
    Dissolved:           4
Inactive Minipools:      0

========== Smoothing Pool =========
Nodes Opted in:          0
Pending Balance:         0.000000

============== Tokens =============
rETH Price (ETH / rETH): 1.031919 ETH
RPL Price (ETH / RPL):   0.011563 ETH
Total RPL staked:        6098920.170527 RPL
Effective RPL staked:    5751692.043848 RPL
```

Finalmente, inicie sus clientes primarios nuevamente:

```shell
docker start rocketpool_eth1 rocketpool_eth2
```

¡Y listo!
Su configuración de respaldo está funcionando.

## Próximos Pasos

Ya sea que haya optado o no por crear y/o ejecutar un nodo de respaldo para su configuración, el siguiente paso es aprender sobre las **priority fees**.
Haga clic en la siguiente sección de la guía cuando esté listo para continuar.
