import { Tab, Tabs } from "@rspress/core/theme";

# Importar / Recuperar una Billetera Existente

Si ya tienes una billetera que te gustaría usar para tu nodo, o si estás recuperando una billetera que ya creaste con el Smartnode anteriormente, esta guía te ayudará a través del proceso de importación / recuperación.

Selecciona la opción apropiada de las secciones a continuación.

## Recuperar una Billetera Smartnode

Si generaste tu billetera de nodo usando el Smartnode y simplemente la estás recuperando en una máquina nueva, el proceso es bastante simple.
Asegúrate de haber instalado ya el software Smartnode, y luego simplemente ejecuta el siguiente comando una vez que esté instalado:

```shell
rocketpool wallet recover
```

::: warning NOTA
Si, por alguna razón, deseas recuperar la billetera pero _no_ las claves de validador adjuntas a los minipools de tu nodo, puedes especificar el indicador `-k` para omitir el proceso de reconstrucción:

```shell
rocketpool wallet recover -k
```

Si no especificas este indicador, el Smartnode intentará recuperar las claves de validador para tus minipools; sin embargo, ten en cuenta que esto no funcionará hasta que tu cliente de Ejecución haya terminado de sincronizar.
Observa su archivo de registro para ver cuándo ha terminado; una vez que lo haya hecho, puedes ejecutar este paso.
:::

Esto primero te pedirá una contraseña que desees usar para cifrar tu billetera.
Después de eso, te pedirá tu **frase de recuperación mnemónica de 24 palabras**.
Ingrésala con cuidado - no se mostrará en pantalla por seguridad, y es muy fácil cometer un error al escribirla, así que tómate tu tiempo.

Cuando hayas terminado, deberías ver una salida similar a esta:

```shell
$ rocketpool wallet recover

Please enter a password to secure your wallet with:

Please confirm your password:

Please enter your recovery mnemonic phrase:

Recovering node wallet...
The node wallet was successfully recovered.
Node account: <your wallet address>
No validator keys were found.
```

Si no ves ningún error, entonces tu billetera y validadores se habrán recuperado.

Una vez que hayas terminado, asegúrate de reiniciar el cliente Validador con el siguiente comando para usuarios en modo Docker e Híbrido:

```shell
docker restart rocketpool_validator
```

Los usuarios en **modo Nativo** simplemente tendrán que reiniciar su proceso de contenedor Validador.

Esto asegurará que el VC recoja todas las claves de validador recién restauradas.

## Importar una Dirección Existente como Billetera de Nodo

Si tienes una dirección que te gustaría usar para un nodo, pero _no_ la creaste con el Smartnode (por ejemplo, la creaste con MetaMask o una billetera de hardware), entonces esta es la sección a seguir.

::: danger ADVERTENCIA
Al hacer esto, tu dirección se convertirá en una **billetera caliente**.
La clave privada se almacenará en tu máquina de nodo.

Si estás importando una dirección que es una billetera fría, como una billetera de hardware, ten en cuenta que **¡la protección proporcionada por la billetera de hardware ya no existirá!**

Si usas esta billetera para _cualquier otra actividad de criptomonedas_, **debes migrar todos sus fondos a una dirección separada (por ejemplo, otra billetera de hardware) antes de importarla en tu nodo. Solo deja suficiente ETH en esta dirección para los costos de gas de tu nodo (típicamente 0.5 ETH es suficiente).**

Asegúrate de haber asegurado tu máquina tanto como sea posible siguiendo los pasos en la guía [Asegurar tu Nodo](./securing-your-node) antes de importar tu dirección como billetera de nodo.
:::

Esta capacidad solo está disponible con Smartnode **v1.4.3 o superior**.
Si tienes una versión inferior, necesitarás actualizar primero.

Este es un proceso de múltiples pasos, así que sigue las secciones a continuación con cuidado.

### Paso 1: Agregar Claves de Validador Generadas Externamente

**Si no tienes ningún minipool existente adjunto a la dirección que estás importando, puedes omitir este paso.**

Si tu dirección ya ha sido registrada como billetera de nodo de Rocket Pool (como a través de un servicio como **Allnodes**) y ya tiene minipools activos, y te gustaría importarlos en el stack de Smartnode junto con tu dirección, necesitarás proporcionar los archivos de keystore privados para cada uno de sus validadores correspondientes.
Estos archivos estarán cifrados con una contraseña de tu propia elección, por lo que necesitarás esa contraseña para cada archivo también.

Necesitas obtener estos archivos del servicio que actualmente ejecuta tu nodo para poder importarlo.
Algunos proveedores de servicios pueden recuperar estos archivos a pedido.
Si usas Allnodes, puedes obtener estos archivos durante tu proceso de configuración inicial pero **no podrás recuperarlos en el futuro a menos que los hayas guardado durante la creación del minipool.**

Selecciona tu modo de instalación y sigue los pasos a continuación.

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Primero, asegúrate de haber iniciado el Smartnode con `rocketpool service start`.
      Esto creará una carpeta especial que se puede usar para contener los archivos de keystore cifrados para tus validadores.

      Por defecto, la carpeta se encuentra en `~/.rocketpool/data/custom-keys`.
      Si has personalizado tu instalación o directorios de datos, sustitúyelos apropiadamente para encontrar la carpeta `custom-keys`.

      Verifica con un explorador de archivos o el comando `ls` para asegurarte de que esta carpeta exista.
      Si no, no te preocupes - simplemente crea la carpeta con el siguiente comando:

      ```shell
      mkdir ~/.rocketpool/data/custom-keys
      ```
    </Tab>
    <Tab label="Native Mode">
      Crea una carpeta llamada `custom-keys` dentro de la carpeta `data` de tu Smartnode (por ejemplo, `/srv/rocketpool/data/custom-keys`).
    </Tab>

  </Tabs>
</div>

A continuación, coloca cada uno de los archivos de keystore del validador en esta carpeta.
Los nombres de los archivos no importan, pero deben ser archivos JSON que cumplan con el formato [EIP-2335](https://eips.ethereum.org/EIPS/eip-2335#scrypt-test-vector).

El Smartnode buscará en este directorio cualquier archivo de keystore que hayas colocado aquí en los siguientes pasos.

::: warning NOTA
El proceso de importación _solo_ buscará claves de validador que estén adjuntas a minipools registrados en la dirección que estás importando.
**No puedes** usar este proceso para importar otras claves de validador, como las de validadores de staking solo, en el cliente Validador administrado por el stack de Smartnode.

Consulta la documentación para ejecutar en [Modo Híbrido Inverso](./advanced-config#allowing-external-validator-clients-to-connect-to-the-smartnode) si estás interesado en hacer esto.
:::

### Paso 2 (Opcional): Probar la Importación de la Dirección

Si deseas probar el proceso de recuperación para asegurarte de que tienes el mnemónico y las contraseñas correctas **sin regenerar realmente la clave privada de tu billetera de nodo ni importar tus claves de validador**, puedes hacerlo con el siguiente comando:

```shell
rocketpool wallet test-recovery -a 0x1234abcd...
```

Donde `0x1234abcd...` es la dirección que deseas importar, comenzando con el prefijo `0x`.
**Necesitarás tu frase mnemónica para importar la clave privada de tu dirección.**

::: tip TIP
Si, por alguna razón, deseas recuperar la billetera pero _no_ las claves de validador para tus minipools, puedes especificar el indicador `-k` para omitir el proceso de recuperación de claves de validador.
Por ejemplo:

```shell
rocketpool wallet test-recovery -a 0x1234abcd... -k
```

:::

El Smartnode buscará automáticamente a través de las rutas de derivación más populares (por ejemplo, las utilizadas por Ledger Live, MyEtherWallet, Trezor y el stack de Smartnode) e índices de direcciones para encontrar las configuraciones que corresponden a la dirección que proporcionaste.

::: tip TIP
Si tienes una ruta de derivación personalizada, usa el indicador `-d` para especificarla.
Por ejemplo:

```shell
rocketpool wallet test-recovery -d "m/44'/60'/0'/%d"
```

Usa `%d` para la porción de la ruta que puede iterarse para usar diferentes índices.

Si tienes un índice de dirección personalizado, usa el indicador `-i` para especificarlo.
Por ejemplo, si tu dirección fue la sexta en la ruta de derivación estándar, podrías usar:

```shell
rocketpool wallet test-recovery -i 5
```

Puedes usar ambos indicadores `-d` y `-i` al mismo tiempo si lo necesitas.
:::

Primero, se te pedirá tu frase mnemónica de la dirección:

```
Please enter the number of words in your mnemonic phrase (24 by default):
24

Enter Word Number 1 of your mnemonic:
```

Ingrésala con cuidado, y el Smartnode comenzará a buscar a través de todas las opciones estándar para encontrarla (a menos que las hayas especificado explícitamente usando los indicadores `-d` y/o `-i`).

A continuación, si tienes archivos de keystore privados para importar del Paso 1, se te pedirán las contraseñas de cada uno de esos archivos de keystore:

```
It looks like you have some custom keystores for your minipool's validators.
You will be prompted for the passwords each one was encrypted with, so they can be loaded into the Validator Client that Rocket Pool manages for you.

Please enter the password that the keystore for <validator pubkey> was encrypted with:
```

Estarán organizados por la lista de **pubkey**, **no por los nombres de archivo**.
Asegúrate de saber qué archivo corresponde a qué pubkey de validador para que ingreses las contraseñas correctas.

Una vez que hayas hecho esto, el proceso de recuperación de prueba continuará e informará sobre si tuvo éxito o falló:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

Lo anterior indica una recuperación de prueba exitosa.

### Paso 3: Importar la Dirección

::: danger ADVERTENCIA
Si tu dirección es un nodo de Rocket Pool que _no_ está administrado por tu propio Smartnode auto-alojado (por ejemplo, alojado por un servicio externo como **Allnodes**), **ES CRÍTICO** que coordines con el servicio que ejecuta tu nodo **antes de comenzar este proceso de importación** e informarles que te gustaría migrar a tu propio sistema auto-alojado.

**DEBES CONFIRMAR** que han apagado la validación de tu nodo y **NUNCA la reanudarán**, y confirmar manualmente que tus validadores ya no están atestando usando un explorador de Blockchain como [https://beaconcha.in](https://beaconcha.in).
Debes confirmar que cada validador ha perdido **AL MENOS 2 ATESTACIONES** para asegurarte de que puedes migrar de forma segura.
De lo contrario, ambos atestarán al mismo tiempo y **¡TUS MINIPOOLS SERÁN PENALIZADOS!**

El Smartnode requerirá que confirmes que has hecho esto antes de permitirte continuar con el proceso de importación.
:::

Si la recuperación de prueba tuvo éxito, o si la omitiste, a continuación importarás la billetera y regenerarás todos sus archivos de clave asociados.
El proceso es exactamente el mismo que el anterior, pero usa el comando `recover` en lugar del comando `test-recovery`:

```shell
rocketpool wallet recover -a 0x1234abcd...
```

Cuando ejecutes este comando, primero se te pedirá una contraseña para cifrar tu billetera de nodo importada.

```
Please enter a password to secure your wallet with:

Please confirm your password:
```

Después de eso, las solicitudes de contraseña de keystore del validador personalizado y mnemónica procederán como lo hicieron antes.

Una vez que hayas ingresado toda esta información, el Smartnode recuperará tu dirección y (si no está deshabilitado) las claves de validador personalizadas para tus minipools:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

La clave privada de tu dirección ahora se almacenará en el archivo `data/wallet` (por ejemplo, `~/.rocketpool/data/wallet`), y la contraseña para ella se almacenará en el archivo `data/password` (por ejemplo, `~/.rocketpool/data/password`).

Las claves privadas de cada uno de tus validadores se almacenarán en las carpetas `data/validators` para cada uno de los clientes de Consenso que soporta el Smartnode.

::: danger NOTA
Al importar una dirección de esta manera, las claves de validador **no** se derivaron de tu billetera de nodo, y por lo tanto **no pueden** recuperarse más tarde simplemente ejecutando `rocketpool wallet recover` como con una billetera de nodo normal.

Si alguna vez necesitas recuperar o importar esta billetera nuevamente, necesitarás seguir este mismo proceso, lo que significa que **necesitarás tener estos keystores privados de validador y sus contraseñas respaldados en algún lugar seguro.**

Si alguna vez los pierdes, **¡ya no podrás recuperar estas claves de validador!**
:::

### Paso 4: Limpieza

En este punto, ahora puedes eliminar todos los archivos de keystore privados en el directorio `data/custom-keys`.
El Smartnode ya los habrá importado y les habrá asignado contraseñas aleatorizadas, por lo que esos archivos de keystore ya no son necesarios.

Finalmente, asegúrate de que **no** haya un archivo llamado `custom-key-passwords` en tu directorio `data` (por ejemplo, `~/.rocketpool/data/custom-key-passwords`).
El Smartnode construirá este archivo temporal solo durante el proceso de recuperación y lo eliminará automáticamente independientemente de si el proceso de recuperación tuvo éxito o no; si por alguna razón no logró eliminarlo, te alertará en la salida de la consola.
Sin embargo, nunca está de más ser demasiado cuidadoso.

## Próximos Pasos

Una vez que hayas importado o recuperado tu billetera de nodo, sigue los siguientes pasos en la guía [Introducción a la Interfaz de Línea de Comandos](./cli-intro).
