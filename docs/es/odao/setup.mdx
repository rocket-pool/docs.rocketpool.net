import { Tab, Tabs } from "@rspress/core/theme";
import tuiOdao from "./images/tui-odao.png";

# Configurando un Nodo Oracle DAO

Como mínimo, un nodo estándar de Rocket Pool ejecuta lo siguiente:

- El CLI de Smartnode
- El daemon API de Smartnode
- El daemon `node` de Smartnode
- El daemon `watchtower` de Smartnode

Opcionalmente, el nodo también puede ejecutar los siguientes componentes:

- Un Cliente de Ejecución
- Un Nodo Beacon
- Un Cliente Validador
- MEV-Boost
- Prometheus
- El Prometheus Node Exporter
- Grafana

Cada uno de estos componentes puede ejecutarse como contenedores Docker en la configuración estándar, como servicios `systemd` en la configuración de "Modo Nativo", o ejecutarse como entidades gestionadas externamente a las que el Smartnode puede conectarse a través de sus respectivas rutas API.

Convenientemente, los nodos Oracle DAO son iguales a los nodos normales de Rocket Pool, pero el daemon `watchtower` realiza los deberes suplementarios del Oracle DAO y hay más métricas de Prometheus recopiladas para fines de monitoreo de rendimiento.

## Configuración Inicial del Nodo

La mejor manera de comenzar es siguiendo [las instrucciones de configuración estándar](../node-staking/platform) para un nodo normal de Rocket Pool.
Ese proceso te ayudará a determinar cómo te gustaría configurar y ejecutar tu nodo.

Si deseas ejecutar minipools (validadores) en tu nodo, sigue la documentación normal del nodo de principio a fin y regresa aquí cuando hayas terminado.

Si _no_ pretendes ejecutar minipools y en su lugar lo usarás puramente para deberes del Oracle DAO, puedes omitir todos los pasos relacionados con el staking de RPL y la creación de minipools.
Los otros pasos como el registro del nodo, establecer una buena postura de seguridad, monitorear la salud y el rendimiento del nodo, y actualizar el Smartnode después de una actualización aún se aplican a ti y debes revisarlos cuidadosamente antes de continuar.
Regresa aquí cuando hayas terminado.

## Configuración Adicional del Oracle DAO

Hay dos configuraciones adicionales que necesitas proporcionar para satisfacer tus responsabilidades del Oracle DAO.
Selecciona el modo que usas para configurar tu nodo a continuación de las pestañas a continuación.

<div className="p-3">
  <Tabs>
    <Tab label="(service config) UI Interactiva">
      Abre el TUI de `rocketpool service config` y ve a la sección `Smartnode and TX Fees`.
      Aquí, verás dos opciones en la parte inferior:

      <img src={tuiOdao} width="100%" height="auto"/>

      El `Archive-Mode EC URL` debe ser el endpoint HTTP de la API RPC para tu Cliente de Ejecución de Archivo.
      **Ten en cuenta que si ya estás usando tu EC de Archivo como tu cliente principal en modo Gestionado Externamente, puedes ignorar esta configuración.**
    </Tab>
    <Tab label="(service config) Sin cabeza">

      Ejecuta el siguiente comando para configurar tu nodo sin cabeza:

      ```shell
      rocketpool service config --smartnode-archiveECUrl "http://your Archive EC URL"
      ```

      Donde:

      `--smartnode-archiveECUrl` debe ser el endpoint HTTP de la API RPC para tu Cliente de Ejecución de Archivo.
      **Ten en cuenta que si ya estás usando tu EC de Archivo como tu cliente principal en modo Gestionado Externamente, puedes ignorar esta configuración.**

      Finalmente, reinicia tu daemon `watchtower` (es decir, con `docker restart rocketpool_watchtower` en modo Docker o Híbrido, o `sudo systemctl restart rp_watchtower` en modo Nativo) para que la configuración surta efecto.
    </Tab>
    <Tab label="Archivo de Configuración Directo">
      Abre el archivo `user-settings.yml` en tu directorio de Smartnode (`~/.rocketpool` por defecto) en un editor de texto.
      Desplázate hacia abajo a la sección `smartnode`:

      ```
      smartnode:
      archiveECUrl: http://your Archive EC URL
      dataPath: /home/user/.rocketpool/data
      manualMaxFee: "0"
      minipoolStakeGasThreshold: "150"
      network: mainnet
      priorityFee: "2"
      projectName: rocketpool
      rewardsTreeMode: generate
      ```

      Reemplaza los valores en el campo `archiveECUrl`, donde:

      `archiveECUrl` debe ser el endpoint HTTP de la API RPC para tu Cliente de Ejecución de Archivo.
      **Ten en cuenta que si ya estás usando tu EC de Archivo como tu cliente principal en modo Gestionado Externamente, puedes ignorar esta configuración.**

      Finalmente, reinicia tu daemon `watchtower` (es decir, con `docker restart rocketpool_watchtower` en modo Docker o Híbrido, o `sudo systemctl restart rp_watchtower` en modo Nativo) para que la configuración surta efecto.
    </Tab>

  </Tabs>
</div>

## Comandos de Smartnode del Oracle DAO

El grupo de comandos `odao` del CLI de Smartnode se usa para interactuar con los contratos y deberes del Oracle DAO en cadena:

```
NAME:
   rocketpool odao - Manage the Rocket Pool oracle DAO

USAGE:
   rocketpool odao command [command options] [arguments...]

COMMANDS:
   status, s             Get oracle DAO status
   members, m            Get the oracle DAO members
   member-settings, b    Get the oracle DAO settings related to oracle DAO members
   proposal-settings, a  Get the oracle DAO settings related to oracle DAO proposals
   minipool-settings, i  Get the oracle DAO settings related to minipools
   propose, p            Make an oracle DAO proposal
   proposals, o          Manage oracle DAO proposals
   join, j               Join the oracle DAO (requires an executed invite proposal)
   leave, l              Leave the oracle DAO (requires an executed leave proposal)

OPTIONS:
   --help, -h  show help
```

### status

El comando `status` simplemente resume algunos detalles sobre el Oracle DAO como el conteo de miembros y el conteo de propuestas:

```
The node is a member of the oracle DAO - it can create unbonded minipools, vote on DAO proposals and perform watchtower duties.

There are currently 8 member(s) in the oracle DAO.

There are 29 oracle DAO proposal(s) in total:
- 22 proposal(s) have passed and been executed
- 7 proposal(s) were cancelled, defeated, or have expired
```

### members

El comando `members` imprime información detallada sobre cada miembro del Oracle DAO, incluido su identificador, su información de contacto, su dirección de nodo, su vínculo de RPL y la última vez que enviaron una propuesta para votación:

```
The oracle DAO has 8 members:

--------------------

Member ID:            kermit-2
URL:                  https://www.rocketpool.net
Node address:         0x04ddB06D1429578691F630B67A53916445DA38bE
Joined at:            31 Jul 21 23:32 EDT
Last proposal:        27 Sep 22 21:18 EDT
RPL bond amount:      5000.000000
Unbonded minipools:   0
...
```

### member-settings

`member-settings` muestra los valores actuales para cada uno de los parámetros configurables relacionados con la membresía del Oracle DAO:

```
ODAO Voting Quorum Threshold: 51.000000%
Required Member RPL Bond: 1750.000000 RPL
Max Number of Unbonded Minipools: 250
Consecutive Challenge Cooldown: 300 Blocks
Challenge Meeting Window: 900 Blocks
Cost for Non-members to Challenge Members: 1.000000 ETH
```

Este comando se describe con más detalle en la sección [Propuestas del Oracle DAO](./proposals).

### proposal-settings

`proposal-settings` muestra los valores actuales para cada uno de los parámetros configurables relacionados con las propuestas sobre las que el Oracle DAO puede votar:

```
Cooldown Between Proposals: 1h0m0s
Proposal Voting Window: 168h0m0s
Delay Before Voting on a Proposal is Allowed: 15m0s
Window to Execute an Accepted Proposal: 168h0m0s
Window to Act on an Executed Proposal: 168h0m0s
```

Este comando se describe con más detalle en la sección [Propuestas del Oracle DAO](./proposals).

### minipool-settings

`minipool-settings` muestra los valores actuales para cada uno de los parámetros configurables relacionados con minipools en la red de Rocket Pool:

```
Scrub Period: 1h0m0s
```

### propose

El comando `propose` se usa para enviar propuestas de gobernanza sobre las que el resto del Oracle DAO puede votar.
Estas pueden involucrar cambiar una configuración o modificar los miembros del Oracle DAO (es decir, invitar o expulsar a otros miembros).

Este comando se describe con más detalle en la sección [Propuestas del Oracle DAO](./proposals).

### proposals

El comando `proposals` se usa para interactuar con las propuestas de gobernanza existentes del Oracle DAO.
Puede verlas, rescindir propuestas que hayas hecho, votar sobre ellas y ejecutarlas (si corresponde), haciendo que entren en vigencia después de que hayan sido aprobadas por los otros miembros:

```
NAME:
   rocketpool odao proposals - Manage oracle DAO proposals

USAGE:
   rocketpool odao proposals command [command options] [arguments...]

COMMANDS:
   list, l     List the oracle DAO proposals
   details, d  View proposal details
   cancel, c   Cancel a proposal made by the node
   vote, v     Vote on a proposal
   execute, x  Execute a proposal

OPTIONS:
   --help, -h  show help

```

Este comando se describe con más detalle en la sección [Propuestas del Oracle DAO](./proposals).

### join / leave

Los comandos `join` y `leave` se usan para unirse al Oracle DAO una vez que hayas sido invitado, o dejar el Oracle DAO una vez que los otros miembros hayan aprobado tu solicitud de renuncia.

## Uniéndose al Oracle DAO

### El Vínculo de RPL

Para unirte al Oracle DAO, tu billetera de nodo necesitará suficiente RPL para cubrir el vínculo de membresía requerido.
Esto se bloqueará en la bóveda de Rocket Pool como parte del proceso de unión.
La cantidad exacta de RPL requerida para el vínculo se determinará en el momento de tu invitación, y te será comunicada por los otros miembros del Oracle DAO antes de incorporarte.

::: warning NOTA
A diferencia de todas las otras recompensas de ETH y RPL, el vínculo de RPL _no_ se envía a la dirección de retiro de tu nodo al salir del Oracle DAO.
Se envía de vuelta a tu billetera de nodo en sí.
Considera esto como un incentivo adicional para proteger tu billetera de nodo del compromiso.
:::

### Aceptando una Invitación

Una vez que tu nodo esté configurado y hayas sido invitado a unirte al Oracle DAO por los miembros existentes, puedes usar el comando `rocketpool odao join` para aceptar la invitación.
Esto involucrará dos transacciones:

- Una para bloquear el RPL requerido para tu vínculo
- Una para unirte al Oracle DAO cuando el vínculo haya sido recibido

Una vez que te hayas unido, tu daemon `watchtower` comenzará automáticamente a realizar sus deberes requeridos.
Puedes verificar esto mirando sus registros (por ejemplo, `rocketpool service logs watchtower` para instalaciones estándar basadas en Docker); el watchtower realiza su ciclo de deberes cada 4 a 6 minutos, y notarás un cambio distinto en su salida una vez que te hayas unido al Oracle DAO.

### Siguientes Pasos

Ahora que te has unido al Oracle DAO, echa un vistazo a la siguiente sección para aprender cómo probar tu nodo en este rol.
