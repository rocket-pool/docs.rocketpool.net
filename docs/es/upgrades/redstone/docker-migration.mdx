import { Tab, Tabs } from "@rspress/core/theme";

# [Modo Docker] Guía para la Actualización Redstone y The Merge

Esta guía cubrirá todo lo que necesitas saber para preparar tu nodo para la Actualización Redstone y The Merge si estás usando **Modo Docker**.

## Cosas que Hacer Antes de Actualizar a v1.5.0

Antes de actualizar a v1.5.0 y superior del Smartnode, por favor revisa la siguiente lista de verificación para asegurarte de que estás preparado:

### Cambiar a un Cliente de Ejecución Completo

The Merge requiere que ejecutes tu propio cliente de Ejecución, por lo que ya no podrás usar proveedores remotos como Infura o Pocket.
v1.5.0 ya no los tendrá, y no te permitirá iniciar la pila hasta que selecciones un cliente de Ejecución completo.

Debido a este cambio, deberías cambiar a un cliente completo mientras aún estés en v1.4, dejarlo sincronizar completamente, y luego actualizar a v1.5.

El Modo Docker hace que cambiar de clientes sea muy fácil.
[Esta guía](../../node-staking/change-clients#changing-execution-clients) proporciona un tutorial del proceso.

## Actualizando a v1.5.0

Actualizar la pila del Smartnode a v1.5.0 no es diferente a cualquier otra actualización.
Simplemente sigue [las instrucciones normales aquí](../../node-staking/updates#updating-the-smartnode-stack).

## Cosas que el Smartnode Maneja Automáticamente

En modo Docker, el Smartnode se encargará de la mayoría de los cambios necesarios para soportar Redstone y The Merge automáticamente una vez que actualices a v1.5.0.
Aquí hay una breve lista de lo que hará por ti sin intervención manual:

### La Engine API

The Merge cambia la forma en que tu cliente de Ejecución se comunica con tu cliente de Consenso.
En lugar de usar el antiguo sistema RPC basado en HTTP o Websocket, The Merge requiere un nuevo sistema expuesto por tu cliente de Ejecución llamado Engine API.

Esta es una conexión especial que permite que el cliente de Consenso reemplace el antiguo sistema de minería Proof-of-Work con Proof-of-Stake; es el corazón de The Merge.
También está **autenticada** con un token secreto, por lo que solo tu cliente de Consenso puede conectarse a tu cliente de Ejecución - nada más puede hacerlo.

El Smartnode manejará la configuración del token de autenticación y la Engine API en tus clientes de Ejecución y Consenso automáticamente.

### Tu Destinatario de Tarifas

El **destinatario de tarifas** es la dirección en la cadena de la capa de Ejecución que recibirá todas las tarifas de prioridad para los bloques que propongas.
Es una configuración proporcionada a tu cliente Validator cuando se inicia por primera vez.

El Smartnode se encargará de configurarla a la dirección correcta cuando actualices a v1.5, y verificará constantemente para asegurarse de que estés usando la correcta para que no seas [penalizado accidentalmente](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system).

Si optaste por el [Smoothing Pool](./whats-new#smoothing-pool), lo hará tu destinatario de tarifas.
Si no lo hiciste, hará que tu [contrato distribuidor de tarifas](./whats-new#fee-recipients-and-your-distributor) sea el destinatario de tarifas.

### MEV-Boost

[MEV-boost](https://boost.flashbots.net/) es el sistema que Flashbots proporciona para dar recompensas MEV a los validadores Proof-of-Stake después de The Merge.
Rocket Pool tiene MEV-Boost integrado en el Smartnode y configura automáticamente tu nodo para usarlo, por lo que tus propuestas obtienen la máxima cantidad de recompensas.

## Cosas que Deberías Hacer Después de Actualizar

Aunque el Smartnode maneja la mayoría de los cambios por ti, hay algunas cosas adicionales que deberías hacer manualmente:

### Asegurar una Actualización Exitosa

Lo primero que hacer es asegurarse de que tu nodo esté funcionando correctamente.
Considera tomar los siguientes pasos:

- Verifica los registros en busca de errores con `rocketpool service logs eth1`, `rocketpool service logs eth2`, `rocketpool service logs validator`, y `rocketpool service logs node`.
- Confirma con un Explorador de Bloques (como tu panel de Grafana y [https://beaconcha.in](https://beaconcha.in)) que aún estés atestiguando correctamente
  - Recuerda que si tienes habilitada la protección Doppelganger, perderás algunas atestaciones después del reinicio. Esto es normal.

### Configurar un Nodo de Respaldo

Como The Merge no es compatible con proveedores remotos como Infura y Pocket, perderás la capacidad de usarlos como clientes de Ejecución de respaldo cuando tu principal se desconecte.

El Smartnode aún tiene la capacidad de proporcionar un cliente de Ejecución de respaldo (y ahora también un cliente de Consenso de respaldo), pero ahora necesitarás usar clientes de Ejecución y Consenso que controles tú.

Para más información sobre cómo configurar un nodo de respaldo, consulta la [guía de nodo de respaldo](../../node-staking/fallback).

### Inicializar tu Distribuidor de Tarifas

Si no planeas optar por el [Smoothing Pool](./whats-new#smoothing-pool) y reclamar todas tus tarifas de prioridad y recompensas MEV a tu [contrato distribuidor de tarifas](./whats-new#fee-recipients-and-your-distributor), eventualmente tendrás que inicializarlo (crear la instancia del contrato en la cadena) para poder reclamar recompensas de él a tu dirección de retiro.

Esta es una operación bastante económica y solo necesita hacerse una vez.

::: tip CONSEJO
Inicializar tu distribuidor de tarifas se puede hacer en **cualquier momento**.
Puedes dejar que las recompensas se acumulen en su dirección mucho antes de inicializarlo, y tu saldo permanecerá después de la inicialización.

Recomendamos que lo hagas cuando los precios del gas sean bajos para minimizar el costo adicional.

Ten en cuenta que **debe estar inicializado para reclamar tus recompensas.**
:::

### Optar por el Smoothing Pool

Si planeas aprovechar el [Smoothing Pool](./whats-new#smoothing-pool) de inmediato, deberías optar antes del final del primer período de recompensas de Redstone para maximizar tu cantidad de "elegibilidad".

Optar se puede hacer ejecutando el siguiente comando:

```
rocketpool node join-smoothing-pool
```

### Reclamar Recompensas

La actualización Redstone reemplaza el costoso y problemático sistema de recompensas antiguo con [uno completamente nuevo](./whats-new#new-rewards-system) que es mucho más económico, soporta el restaking automático de RPL (tanto cantidades parciales como completas), y - lo más importante - **te permite reclamar tus recompensas cuando quieras**.

Como ya no hay un límite de tiempo para reclamar recompensas, y como es más económico reclamar muchos intervalos de recompensas a la vez, la función de reclamación automática de recompensas del Smartnode **ha sido eliminada**.
Ahora podrás reclamar recompensas a través del siguiente comando:

```
rocketpool node claim-rewards
```

Esto te mostrará todas las recompensas que has acumulado a través de todos los intervalos de recompensas comenzando con la actualización Redstone.

## Revertir a v1.4.3

Si, por alguna razón, algo no es de tu agrado y quieres revertir a la versión anterior del Smartnode, puedes hacerlo fácilmente.
El Smartnode automáticamente hace una copia de seguridad de tu configuración de la versión anterior cuando lo actualizas, así que simplemente obtén la versión anterior (aquí estamos demostrando **v1.4.3**) y reemplaza la configuración con la copia de seguridad:

1. Detén el servicio:

```shell
rocketpool service stop
```

1. Descarga el CLI v1.4.3:

<div className="p-3">
  <Tabs>
    <Tab label="Linux x64">```shell wget https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool ```</Tab>
    <Tab label="Linux arm64">```shell wget https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool ```</Tab>
    <Tab label="Mac x64">```shell curl -L https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool ```</Tab>
    <Tab label="Mac arm64">```shell curl -L https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool ```</Tab>
  </Tabs>
</div>

1. Instala el paquete v1.4.3:

```shell
rocketpool service install -d
```

1. Reemplaza tu configuración antigua con la configuración de respaldo v1.4.3:

```shell
cp ~/.rocketpool/user-settings-backup.yml ~/.rocketpool/user-settings.yml
```

1. Verifica que todas tus configuraciones antiguas estén ahora siendo usadas:

```shell
rocketpool service config
```

1. Si se ve bien, inicia la pila del Smartnode:

```shell
rocketpool service start
```

Todo listo. Ahora estás de vuelta en la versión antigua y deberías comenzar a atestiguar poco después de iniciar el servicio.

::: danger ADVERTENCIA
v1.4.3 está **obsoleto** y ya no será utilizable después de que se implemente la actualización Redstone.
Si necesitas revertir a él, por favor haz planes para actualizar de nuevo a v1.5.0 antes de que se actualicen los contratos.
:::
