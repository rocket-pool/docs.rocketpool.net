import { Tab, Tabs } from "@rspress/core/theme";

# Staking a través de un Exchange Descentralizado en Capa 2

Como recordatorio, no tienes que intercambiar ETH por rETH directamente a través de Rocket Pool para disfrutar de los beneficios del staking descentralizado.
Todo lo que necesitas hacer es mantener rETH, ya que inherentemente crece en valor: ¡no importa cómo lo obtengas!

Dicho esto, una de las principales preocupaciones (especialmente en tiempos recientes) es el costo del gas asociado con hacer staking o intercambiar ETH por rETH.

Para ayudar a reducir esto, la red de Ethereum ha comenzado a adoptar el uso de [rollups](https://www.youtube.com/watch?v=7pWxCklcNsU), también conocidos como **Capa 2**.

La Capa 2 comprende varias redes separadas que viven debajo de Ethereum, ejecutando muchas transacciones como Ethereum normalmente lo haría, pero agrupando todas ellas en una sola "mega" transacción y publicando _eso_ en la cadena principal de Ethereum en su lugar.
Idealmente, esto significa que obtendrías todos los beneficios de seguridad asociados con la naturaleza descentralizada de Ethereum, pero disfrutarías de **tarifas de gas mucho más bajas** para tus transacciones, ya que los costos de ejecución y almacenamiento en las Capas 2 pueden ser mucho más bajos y solo una porción de tus transacciones debe almacenarse en la Capa 1 donde el estado es mucho más costoso.

Rocket Pool actualmente soporta dos redes de Capa 2: [Optimism](https://www.optimism.io/) y [Arbitrum](https://arbitrum.io/).
Ambas tienen versiones en funcionamiento de [Uniswap](https://docs.uniswap.org/protocol/introduction), el protocolo de exchange descentralizado más ampliamente usado.
Con Uniswap, puedes intercambiar rápida y fácilmente ETH por rETH.

La ventaja de usar este enfoque es que **las tarifas de gas serán sustancialmente más bajas** que con otros métodos.
Si esto es importante para ti porque quieres hacer staking de una pequeña cantidad de ETH, entonces usar una red de Capa 2 probablemente será tu opción de elección.

La desventaja es que podrías no obtener el mejor trato en rETH.
Uniswap requiere una pequeña tarifa que se da a sus proveedores de liquidez, y las transacciones grandes requerirán grandes pools de liquidez para obtener buenos tratos sin demasiado impacto en el precio.
Las redes de Capa 2 tienden a tener menor liquidez de rETH que la red principal de Ethereum.

Por lo tanto, te recomendamos que compares el total de rETH que obtendrías en una red de Capa 2 con lo que obtendrías a través de los otros métodos para determinar si tiene sentido que sigas este camino.

Puedes ver los saldos actuales de ETH y rETH del [pool de Optimism](https://info.uniswap.org/#/optimism/pools/0xaefc1edaede6adadcdf3bb344577d45a80b19582) y del [pool de Arbitrum](https://info.uniswap.org/#/arbitrum/pools/0xaac7de2b91293ba1791503d9127d2bdf2159db65) para determinar si tienen suficiente rETH para cubrir tu intercambio.

En el siguiente ejemplo, demostraremos cómo interactuar con redes de Capa 2 y usar Uniswap para intercambiar ETH por rETH.

::: warning NOTA
Actualmente este método solo está disponible en Mainnet.
Si quieres practicar en la Hoodi Testnet, debes [intercambiar con Rocket Pool directamente](./via-rp).

**El resto de esta guía asumirá que estás en Mainnet.**
:::

Este proceso se puede completar con cualquier billetera compatible con web3.
Con fines de demostración, vamos a usar [MetaMask](https://metamask.io/) ya que es una de las opciones de billetera más populares.

**Deberías poder seguir pasos similares con una billetera diferente si eliges: solo encuentra la función comparable en tu billetera para cada paso.**

## Configuración de MetaMask en Mainnet

Comienza instalando [MetaMask](https://metamask.io/) si aún no lo has hecho.
Sigue las instrucciones en su sitio para instalar la extensión, crear una cuenta e iniciar sesión.

Luego, abre el panel de MetaMask usando su ícono en la barra de herramientas de tu navegador.
Haz clic en el **menú desplegable de red** en la barra de herramientas en la parte superior y asegúrate de que **Ethereum Mainnet** esté seleccionado:

<img src="./images/mm_network_main.png" width="100%" height="auto" />

La dirección directamente debajo de eso es tu **dirección de billetera de Ethereum**.

Antes de continuar, necesitarás proveer esta billetera con ETH.
Si aún no tienes ETH en la cuenta por uso previo, puedes hacer esto transfiriendo ETH desde una cuenta existente a esta dirección de billetera.

## Transferencia de ETH de Capa 1 a Capa 2 a través de Hop

Hay varias formas de puentear ETH desde la Mainnet de Ethereum a una red de Capa 2.
En esta demostración, vamos a usar el protocolo [Hop](https://docs.hop.exchange/faq): una forma simple y confiable de mover ETH (y algunas otras monedas) desde la Capa 1 a varias redes de Capa 2, o entre redes de Capa 2.

Navega al sitio web del exchange Hop aquí:

[https://app.hop.exchange/send?token=ETH](https://app.hop.exchange/send?token=ETH)

La pantalla de inicio debería verse así:

<img src="./images/hop.png" width="100%" height="auto" />

Comienza haciendo clic en el botón **Connect a Wallet** en la esquina superior derecha.
Se te mostrará una pantalla que te pregunta qué proveedor de billetera quieres usar.
Para este ejemplo, selecciona **MetaMask**.

::: tip NOTA
Si no estás usando MetaMask, uno de los otros proveedores como WalletConnect probablemente será compatible con tu billetera.
:::

Al hacer clic en ese botón, MetaMask aparecerá con un aviso preguntándote qué cuentas quieres usar.
Asumiendo que solo tienes una, tu cuenta ya debería estar seleccionada.
Haz clic en **Next**.

Luego te preguntará si te gustaría darle a Hop acceso para ver las direcciones de tus cuentas:

<img src="./images/hop_connect.png" width="100%" height="auto" />

Haz clic en **Connect** y después de una breve pausa, tu billetera estará conectada a Hop.
Ahora deberías ver su saldo de ETH en la esquina superior derecha de la pantalla.

Ahora, puedes usar los dos menús desplegables en los cuadros **From** y **To (estimated)** para seleccionar tus redes, e ingresar la cantidad de ETH que quieres enviar en el cuadro **From**.

Por ejemplo, esto es lo que se vería al enviar 0.1 ETH de Capa 1 a Arbitrum:

<img src="./images/hop_send.png" width="100%" height="auto" />

::: warning NOTA
Como recordatorio, Uniswap (y por lo tanto el staking de Rocket Pool) actualmente **solo está soportado en Optimism y Arbitrum**.
Debes seleccionar una de esas redes.
:::

Cuando estés listo, haz clic en el botón **Send**.
Metamask aparecerá con un diálogo de confirmación que te muestra la tarifa de gas asociada con la transacción:

<img src="./images/hop_confirm.png" width="100%" height="auto" />

Si te sientes cómodo con esas tarifas de gas, haz clic en **Confirm** para comenzar la transacción.
Después de unos momentos, MetaMask aparecerá con un mensaje de confirmación de transacción exitosa, y tu ETH ahora estará disponible en tu red de Capa 2 elegida.

## Conexión a Uniswap en Capa 2

Ahora que tu billetera está configurada y financiada, dirígete a esta URL que abrirá Uniswap y mostrará automáticamente el intercambio de ETH por rETH:

[https://app.uniswap.org/#/swap?inputCurrency=eth](https://app.uniswap.org/#/swap?inputCurrency=eth)

La página se verá así inicialmente:

<img src="./images/uni_connect.png" width="100%" height="auto" />

Haz clic en uno de los botones `Connect Wallet` como el resaltado en la esquina superior derecha.
Se te mostrará una pantalla que te pregunta qué proveedor de billetera quieres usar.
Para este ejemplo, selecciona **MetaMask**.

::: tip NOTA
Si no estás usando MetaMask, uno de los otros proveedores como WalletConnect probablemente será compatible con tu billetera.
:::

Al hacer clic en ese botón, MetaMask aparecerá con otro aviso preguntándote qué cuentas quieres usar, tal como lo hizo con Hop.
Deja tu cuenta seleccionada, haz clic en **Next**, y luego haz clic en **Connect** como lo hiciste con Hop antes.
Después de una breve pausa, tu billetera estará conectada a Uniswap.
Ahora deberías ver su saldo de ETH en la esquina superior derecha de la pantalla.

Lo primero que debes hacer es cambiar tu red desde la mainnet de Ethereum a la Capa 2 a la que acabas de intercambiar.
Haz clic en el menú desplegable de red en la parte superior derecha de la pantalla (resaltado en rojo aquí):

<img src="./images/uni_network.png" width="100%" height="auto" />

Una vez que lo hagas, MetaMask te pedirá que confirmes que quieres agregar una red personalizada:

<img src="./images/uni_net_confirm.png" width="100%" height="auto" />

Haz clic en **Approve** y luego haz clic en **Switch Network**.
Esto cambiará MetaMask para usar la nueva red de Capa 2 en lugar de la mainnet de Ethereum para las transacciones.

::: warning NOTA
Antes de hacer cualquier transacción con MetaMask, _siempre_ verifica qué red está usando actualmente abriendo MetaMask y mirando el menú desplegable de red en la parte superior.
¡Es fácil cambiar accidentalmente a una red diferente y olvidarlo!
:::

## Agregar rETH a MetaMask

El siguiente paso es agregar el token rETH a MetaMask para que puedas ver tu saldo y acceder a él para intercambiar.
Haz clic en la pestaña **Assets**, luego haz clic en **Add Token**:

<img src="./images/mm_add_token.png" width="100%" height="auto" />

Asegúrate de que **Custom Token** esté seleccionado en este diálogo, y selecciona la pestaña apropiada para la red de Capa 2 que elegiste a continuación:

<div className="p-3">
  <Tabs>
    <Tab label="Optimism">
      En el cuadro **Token Contract Address**, pon el siguiente valor:

      ```shell
      0x9bcef72be871e61ed4fbbc7630889bee758eb81d
      ```

      El **Token Symbol** debería poblarse automáticamente con `rETH`, y los **Decimals of Precision** deberían poblarse automáticamente con `18`.

      Acepta el resto de los avisos, y luego verás aparecer el token rETH en tu lista.
    </Tab>
    <Tab label="Arbitrum">
      En el cuadro **Token Contract Address**, pon el siguiente valor:

      ```shell
      0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8
      ```

      El **Token Symbol** debería poblarse automáticamente con `rETH`, y los **Decimals of Precision** deberían poblarse automáticamente con `18`.

      Acepta el resto de los avisos, y luego verás aparecer el token rETH en tu lista.
    </Tab>

  </Tabs>
</div>

## Intercambio de ETH por rETH con Uniswap

¡El paso final del proceso es hacer el intercambio!

Haz clic en el menú desplegable **Select a token** e ingresa la dirección para rETH que acabas de agregar a MetaMask (también puedes simplemente escribir rETH, pero **asegúrate de que sea el token correcto y no un token impostor o de estafa** verificando primero su dirección).

::: warning NOTA
Inicialmente puedes ver un aviso que se ve así:

<img src="./images/unknown_token.jpg" width="100%" height="auto" />

Este es solo un aviso temporal hasta que Uniswap agregue rETH a su lista de tokens canónicos en la Capa que estás usando.
Siempre que la dirección del token sea `0x9bcef72be871e61ed4fbbc7630889bee758eb81d` en Optimism o `0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8` en Arbitrum, puedes agregarlo de forma segura.
:::

Luego, ingresa la cantidad de ETH que quieres intercambiar y la interfaz de Uniswap te mostrará la cantidad de rETH que recibirás a cambio:

<img src="./images/arb_swap.png" width="100%" height="auto" />

::: warning NOTA
Observa que la cantidad de rETH que recibes será **menor que** la cantidad de ETH que pones.
Esto es normal, porque **rETH vale más que ETH** y se aprecia continuamente con el tiempo.
Puedes ver esto en la tasa de cambio resaltada en la parte inferior de la captura de pantalla.
:::

Ahora haz clic en **Swap** para ver los detalles del intercambio, incluyendo la cantidad mínima que podrías recibir debido al deslizamiento.
Si estás satisfecho, haz clic en **Confirm Swap**.
Esto enviará la solicitud a MetaMask, donde puedes revisar el costo total de la transacción antes de confirmarla:

<img src="./images/arb_gas.png" width="100%" height="auto" />

::: tip NOTA
Presta **mucha atención** a la tarifa de gas estimada aquí.
Probablemente notarás que es **aproximadamente 10 veces más barato** en términos de tarifas de gas hacer este intercambio en una red de Capa 2 que en la Mainnet de Ethereum.
:::

Si estás satisfecho con las tarifas de gas en relación con la cantidad total de rETH que recibirás, haz clic en **Confirm** para enviar la transacción.
Después de un breve período, deberías ver una notificación de MetaMask de que se completó con éxito, y ahora verás el token rETH en tu billetera.

¡Eso es todo! Ahora estás haciendo staking con Rocket Pool. Todo lo que necesitas hacer es mantener tu rETH, y automáticamente ganarás tus recompensas de staking a medida que aumenta el valor del token rETH.
