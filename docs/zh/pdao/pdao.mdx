import proposal_diagram from "./images/proposal_diagram.png";
import proposal_checker from "./images/proposal_checker.png";

# The Protocol DAO (pDAO)

Rocket Pool Protocol DAO（pDAO）负责塑造协议的方向，由 RPL 治理运行。其成员及其投票权由大小节点运营商组成，所有这些运营商都直接参与协议。它为整个 Rocket Pool 社区服务，包括 rETH 持有者、节点运营商和 RPL 持有者。pDAO 优先考虑 Rocket Pool 协议的安全性和以太坊网络的健康。有关 pDAO 是谁和是什么的明确定义，请随时查看 [pDAO 章程](https://rpips.rocketpool.net/RPIPs/RPIP-23)。

## Houston 中的新 pDAO 功能

### pDAO 职责的链上执行

Houston 升级为 pDAO 治理系统的执行流程引入了链上替代方案。它使用乐观欺诈证明系统，允许任何节点运营商提出提案并对提案进行投票，以调整"pDAO 协议参数"并支出国库资金。要查看 pDAO 可控参数的完整列表，请单击[此处](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table)。在 Houston 之前，核心团队负责按照社区治理流程的要求执行 pDAO 职责。例如，团队根据治理投票的付款时间表执行每月的 IMC 和 GMC 付款。该计划是让这种权力暂时驻留在团队中，直到建立新的权力结构来接管这些责任。Houston 消除了对团队的这种依赖，使协议更加去中心化和无需信任。

### 安全委员会

Houston 升级还包括一个新的安全委员会，以帮助在协议出现任何潜在问题时快速做出反应。这些成员可以由 pDAO 选举产生，并有能力提出和执行更改而无需延迟。pDAO 有权从安全委员会中选举和罢免成员。这是一个严肃的角色，pDAO 应该制定强有力的准入要求和清除陈旧成员的流程。pDAO 监护人将在 Houston 开始时成为安全委员会的唯一成员。

### 定期国库支出

RPL 的通货膨胀率为 5%。根据 [RPIP-25](https://rpips.rocketpool.net/RPIPs/RPIP-25) 的定义，这种通货膨胀的 22% 流向 pDAO。pDAO 可以将这些资金用于各种目的。例如，流动性提供者 (LP) 奖金等激励措施、第三方改进和项目的赠款和赏金，以及资助 Rocket Pool 协议的开发。Houston 升级还引入了一项新功能，可以在每个奖励期向指定受益人进行定期国库付款。

## Protocol DAO (pDAO) 提案

任何具有非零投票权的节点都可以随时提出或参与 pDAO 提案。提案可以是以下类型之一：

- 更改 pDAO 设置
- 一次性国库支出
- 重复国库支出（管理委员会）
- 安全委员会成员资格

有关更多详细信息和理由，请参阅[提案类型](https://rpips.rocketpool.net/RPIPs/RPIP-33#proposal-types)。重要的是要理解，pDAO 提案是一个链上实体，旨在在协议层面执行变更。

## pDAO 提案的生命周期

提案应在进入链上之前通过[治理流程](./participate#governance-process)进行预告。它由 4 个期间组成，所有这些都是 pDAO [可控参数](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table)：

- 投票延迟期：`proposal.vote.delay.time`
- 投票第 1 阶段：`proposal.vote.phase1.time`
- 投票第 2 阶段：`proposal.vote.phase2.time`
- 执行：`proposal.execute.time	`

<img src={proposal_diagram} width="100%" height="auto" />

### 投票延迟期

为了决定提案的结果，协议必须知道所需的法定人数。提案者在链外计算此值，并将其与提案一起提交。该值被乐观地接受，但在欺诈的情况下，验证者可以执行挑战/响应过程来证明该值不正确。然后丢弃无效提案。

提案者和挑战者需要锁定 RPL 的几个原因。

- `proposal.bond` 激励有效提案并抑制垃圾邮件。
- `proposal.challenge.bond` 激励撤销无效/恶意提案。

挑战者提供他们声称不正确的 Merkle-sum 树的索引。任何节点运营商都可以参与挑战欺诈性提案（并因此获得奖励）。如果您有兴趣选择加入，请随时阅读 [pDAO 挑战流程](./pdao#challenge-process)。在投票延迟期结束时未在挑战中被击败的提案将进入投票阶段。

::: tip 注意
当 `proposal.vote.delay.time` 到期时，提案不再能够被挑战或击败。
:::

### 投票期 1

在投票期间，节点运营商和委托人可以使用四个选项之一进行投票：

```
1. Abstain: 投票者的投票权计入法定人数，但既不赞成也不反对提案。
2. For: 投票者投票赞成执行提案。
3. Against: 投票者投票反对执行提案。
4. Veto: 投票者投票反对提案，并表明他们认为该提案是垃圾邮件或恶意的。
```

他们的投票权将包含在他们选择的选项中。

可以使用以下命令执行此操作：

```shell
rocketpool pdao proposals vote
```

如果达到否决法定人数（由 `proposal.veto.quorum` 参数定义），提案将立即被击败，提案者将失去其保证金。这是为了阻止垃圾邮件、低质量提案或尚未经过链外流程的提案。smartnode 命令 `rocketpool pdao proposals finalize` 用于通过燃烧提案者的锁定 RPL 保证金来最终确定被否决的提案。

期间 1 的持续时间由 `proposal.vote.phase1.time` 参数决定。无论是否达到 `proposal.quorum`，提案都会过渡到第 2 阶段。

### 投票期 2

委托人可以在投票期 2 期间投票，但他们的投票仅价值他们的**本地投票权**。在期间 1 中未投票的投票者仍然能够在期间 2 期间进行投票。与委托人的选择不同意的节点运营商将有机会推翻其委托人的投票。

推翻投票的过程非常简单，只需在投票期 2 期间调用 `rocketpool pdao proposals vote` 并按照提示操作即可。委托人的投票权将被委托人的投票权推翻。

当投票期 2 结束时，提案的结果即告结束。为了确定（并执行）结果，必须在 `proposal.vote.phase2.time` 结束时达到 `proposal.quorum` 总投票权。如果达到法定人数并达成共识，提案将通过投票期并被标记为成功。

::: tip 注意
如果未达到 `proposal.quorum`，则无法采取进一步行动。如果未达到法定人数，则提案被视为已结束和最终。
:::

### 执行

一旦两个投票期都过去并且提案成功，就可以执行提案，并将更改（由有效负载定义）应用于 Rocket Pool 协议。要执行提案，请使用以下命令：

```shell
rocketpool pdao proposals execute
```

您将被提示选择要执行的提案，在此步骤后提案将应用于协议！

在提案通过投票期后，提案者可以[领取](./participate#claiming-bonds-and-rewards)其锁定的 RPL 保证金，除非提案被挑战击败或被否决。

::: tip 注意
有一个窗口 `proposal.execute.time`，可以在其中执行提案。如果此计时器达到其结束时间，提案将过期。
:::

就是这样！请记住，上面提到的所有变量都是 pDAO 可控参数。单击[此处](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table)获取 pDAO 有权使用链上提案更改的每个参数的完整列表。

## 挑战流程

由于 gas 限制，完整的网络投票权树存储在链外。当用户提交新提案时，他们负责在目标区块号构建网络投票树。此树在链外生成，但可通过提交到链上的 Merkle 根进行验证。协议依赖**验证者**来检查提案者提交的详细信息。

任何节点都可以参与跟踪和验证提案的正确性。要选择加入此责任，请使用命令 `rocketpool service config`，导航到 **Smartnode and TX Fee Settings** 菜单，并选中 `Enable PDAO Proposal Checker` 框。

<img src={proposal_checker} width="100%" height="auto" />

启用此设置后，节点将检查新提案，验证其正确性，并向无效提案提交挑战。唯一的先决条件是启用 [RPL 锁定](./participate#allowing-rpl-locking)。

此检查每 5 分钟运行一次，与其他一些与节点相关的任务一起运行。我们将通过一个挑战欺诈性提案的示例来进行说明。我们可以使用 smartnode 命令 `rocketpool service logs node` 监控进度：

```
rocketpool_node  | 2024/04/05 02:19:16 Checking for Protocol DAO proposal challenges to defend...
rocketpool_node  | 2024/04/05 02:19:26 Checking for Protocol DAO proposals to challenge...
rocketpool_node  | 2024/04/05 02:19:26 [Network Tree] Couldn't load network tree for block 1283202 from disk, so it must be regenerated.
rocketpool_node  | 2024/04/05 02:19:26 [PDAO Proposals] Network tree for block 1283202 didn't exist, creating one.
rocketpool_node  | 2024/04/05 02:19:26 [Voting Info Snapshot] Couldn't load network tree for block 1283202 from disk, so it must be regenerated.
rocketpool_node  | 2024/04/05 02:19:26 [PDAO Proposals] Voting info snapshot for block 1283202 didn't exist, creating one.
rocketpool_node  | 2024/04/05 02:19:26 Proposal 177 does not match the local tree artifacts and must be challenged.
rocketpool_node  | 2024/04/05 02:19:26 [Voting Info Snapshot] Loaded file [vi-1283202.json.zst].
rocketpool_node  | 2024/04/05 02:19:26 [Network Tree] Loaded file [network-tree-1283202.json.zst].
rocketpool_node  | 2024/04/05 02:19:26 Submitting challenge against proposal 177, index 5...
rocketpool_node  | 2024/04/05 02:19:26 This transaction will use a max fee of 16.067134 Gwei, for a total of up to 0.003252 - 0.004878 ETH.
rocketpool_node  | 2024/04/05 02:19:26 Transaction has been submitted with hash 0x327e59e398bf2141a0d9273947d1da5c255606c45afaca428ab092186300eac2.
rocketpool_node  | 2024/04/05 02:19:26 You may follow its progress by visiting:
rocketpool_node  | 2024/04/05 02:19:26 https://holesky.etherscan.io/tx/0x327e59e398bf2141a0d9273947d1da5c255606c45afaca428ab092186300eac2

```

我们可以看到我们的节点捕获了一个欺诈性提案并开始挑战它的过程。区块 `1283202` 是提出提案 177 的区块，这意味着该提案的投票权将在区块 `1283202` 计算。如果您有兴趣查看这些**投票信息快照**的样子，可以在此目录中找到它们：`~/.rocketpool/data/voting`

由于提案者被抓住提交了不正确的投票信息，我们的节点在提案 177 的索引 5 处进行合约调用 `Function: createChallenge`，并等待提案者响应挑战。

```
rocketpool3_node  | 2024/04/05 02:56:51 Checking for Protocol DAO proposal challenges to defend...
rocketpool3_node  | 2024/04/05 02:57:01 Checking for Protocol DAO proposals to challenge...
rocketpool3_node  | 2024/04/05 02:57:01 [Network Tree] Loaded file [network-tree-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 Proposal 177 does not match the local tree artifacts and must be challenged.
rocketpool3_node  | 2024/04/05 02:57:01 [Voting Info Snapshot] Loaded file [vi-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 [Network Tree] Loaded file [network-tree-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 Proposal 177 has been defeated with node index 20, submitting defeat...
rocketpool3_node  | 2024/04/05 02:57:01 This transaction will use a max fee of 19.078965 Gwei, for a total of up to 0.002061 - 0.003091 ETH.
rocketpool3_node  | 2024/04/05 02:57:01 Transaction has been submitted with hash 0x8cc01dff37205dc98e53f4e9fae7f3c802ecc1c69a01f53e734115a73401287e.
rocketpool3_node  | 2024/04/05 02:57:01 You may follow its progress by visiting:
rocketpool3_node  | 2024/04/05 02:57:01 https://holesky.etherscan.io/tx/0x8cc01dff37205dc98e53f4e9fae7f3c802ecc1c69a01f53e734115a73401287e
rocketpool3_node  |
rocketpool3_node  | 2024/04/05 02:57:01 Waiting for the transaction to be validated...
rocketpool3_node  | 2024/04/05 02:57:13 Successfully defeated proposal.
```

由于提案者的投票信息不正确，它将无法及时响应挑战（由 `proposal.challenge.period` 确定）。此时提案被视为已被击败。当提案被击败时，我们的节点会自动在提案 177 的索引 5 处进行合约调用 `defeatProposal` 以结束提案。

::: tip 注意
参与击败提案的挑战者如果提交了被证明不正确的索引，将获得提案者保证金的比例金额。所有其他挑战者仅收回其保证金。
:::

现在提案被击败了，我们的节点（挑战者）可以[领取](./participate#claiming-bonds-and-rewards)其原始 RPL 保证金以及提案者的 RPL 保证金作为击败欺诈性提案的奖励。

如果您想深入了解 pDAO 提案和挑战系统的详细信息，请查看[技术规范](https://github.com/rocket-pool/rocketpool-research/blob/houston/Protocol%20DAO/pdao-prop-challenge-spec.md#draft-protocol-dao-proposal-challenge-system-specification)。如果您有兴趣研究深入低级细节的示例，请随时跳到[挑战流程](https://github.com/rocket-pool/rocketpool-research/blob/houston/Protocol%20DAO/pdao-prop-challenge-spec.md#challenge-process)这一节。
