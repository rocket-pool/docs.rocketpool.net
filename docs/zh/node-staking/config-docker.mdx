import { Tab, Tabs } from "@rspress/core/theme";
import ECSelection from "./images/tui-ec-selection.png";
import tuiExternalEC from "./images/tui-external-ec.png";
import tuiLocalCC from "./images/tui-local-cc.png";
import tuiLocalGraffiti from "./images/tui-local-graffiti.png";
import tuiLocalCheckpoint from "./images/tui-local-checkpoint.png";
import tuiLocalDD from "./images/tui-local-dd.png";
import tuiExternalLH from "./images/tui-external-lh.png";
import tuiExternalGraffiti from "./images/tui-external-graffiti.png";
import tuiExternalDD from "./images/tui-external-dd.png";
import tuiExternalPrysm from "./images/tui-external-prysm.png";
import tuiExternalTeku from "./images/tui-external-teku.png";

# 配置 Smartnode 堆栈(Docker / 混合模式)

运行完整的执行层和共识层客户端可能令人生畏;有多个选项可供选择,每个选项都有大量不同的设置。
幸运的是,Smartnode 的设计旨在隐藏所有这些复杂性,使配置快速简单,同时如果您愿意,仍然可以自由地自定义一切。

在本节中,我们将介绍配置 Smartnode 的各种方法,如果您使用的是**基于 Docker 的设置**或**混合设置**,其中您连接到外部管理的执行或共识客户端(例如,您在 Smartnode 之外为单独质押管理的客户端)。

::: warning 注意
如果您使用的是不带 Docker 的原生模式,请访问[原生配置指南](./config-native)。
:::

有三种配置方式:

- 通过[向导界面](#通过向导配置) - 这是最简单的方式。它只会问您几个基本问题,并使用经过充分测试的默认值。当您第一次运行 `rocketpool service config` 时,将会看到此界面。
- 通过[设置管理器界面](#通过设置管理器配置) - 这使您可以访问 Smartnode 的所有设置,因此您可以根据需要自定义一切。
- 通过[命令行](#通过命令行配置)无头配置 - 这是为在无头(非交互式)环境中运行 Smartnode 并需要自动配置的用户提供的选项。

从上面的列表中选择您想了解更多的模式,或者简单地向下滚动浏览下面的每个选项。

## 通过向导配置

要启动配置过程,请运行以下命令:

```shell
rocketpool service config
```

这将启动一个基于终端的界面,让您快速轻松地配置节点,并为高级自定义提供可选的细粒度控制。

::: tip 注意
如果您已经配置过 Smartnode,您将看到[设置管理器](#通过设置管理器配置)。
如果您更喜欢向导,可以选择从那里重新打开向导,所有现有设置都将为您预先选择。
:::

当您第一次运行配置界面时(或者如果您选择稍后再次运行向导),您将看到如下所示的屏幕:

<img src="./images/tui-first-time.png" width="100%" height="auto" />

::: tip 提示
要使用向导,**按`箭头键`(上/下/左/右)在按钮(选项)或文本框等内容之间导航**。
如果您愿意,也可以使用 `Tab` 和 `Shift+Tab` - 效果相同。

对于按钮,**当前选中的按钮将以绿色突出显示**。
黑色的按钮未被选中。
在上面的截图中,`Next` 当前被选中,而 `Quit` 未被选中。

**按 `Enter` 或 `Space` 选择按钮**,类似于用鼠标点击它。

**按 `Escape` 返回上一个对话框**,如果您改变主意了。
当您浏览各个向导页面时,这会很方便。

**随时按住 `Ctrl` 并按 `C` 退出向导而不保存任何内容**。

例如,在上面的屏幕上,您可以按 `左` 和 `右` 箭头键在 `Next` 和 `Quit` 按钮之间移动。

当 `Next` 被选中时按 `Enter` 将继续到下一个屏幕。
当 `Quit` 被选中时按 `Enter` 将退出向导而不保存。
:::

当您准备好开始时,按 `Next`。

### 选择网络

在下一个屏幕中,您将被要求选择要使用的网络:

<img src="./images/tui-network.png" width="100%" height="auto" />

您可以使用 `上` 和 `下` 箭头键(或 `Tab` 和 `Shift+Tab`)突出显示不同的选项。
当您更改选项时,右侧的**描述**框将显示每个选项的简要描述。
这对于向导中所有基于选择的页面都是如此,而不仅仅是网络选择,因此您会经常看到这种样式的页面。

如果您想练习在 Hoodi 测试网络上运行 Rocket Pool 节点,使用可以免费获得的假 ETH 和 RPL,请选择 **Hoodi Testnet**。

如果您准备在主网上创建真正的 Rocket Pool 节点以赚取真实奖励,请选择 **Mainnet**。

### 客户端模式

您将看到两个客户端模式选项:

<img src="./images/tui-client-mode.png" width="100%" height="auto" />

**本地管理**(也称为 **"Docker 模式"**)是默认选项。
如果您还没有客户端对,并且希望 Smartnode 为您管理一个,请使用此选项。
通过选择此选项,Smartnode 将创建、配置和管理执行和共识客户端对作为 Docker 容器。
不用担心,您将在下一步选择_要运行哪个_客户端。

**外部管理**(也称为 **"混合模式"**)是已经在其他地方运行并手动管理执行和共识客户端对的用户的便捷选择。
通过选择此选项,Smartnode 将简单地连接到您现有的客户端,而不会运行自己的客户端。
例如,用户可以使用此选项连接到他们目前用于单独质押的客户端;这样,他们就不需要有两个独立的客户端副本。

:::warning 注意
自从执行层-共识层合并以来,您_不能_混合和匹配这些模式(例如,您不能有本地执行客户端但外部管理的共识客户端)。
您必须选择全部本地管理或全部外部管理。
:::

### 执行客户端设置

选择您要用于管理执行客户端的模式,并按照下面相应选项卡中的步骤操作:

<div className="p-3">
  <Tabs>
    <Tab label="本地管理">
      如果您希望 Smartnode 为您管理执行客户端,下一个屏幕将要求您选择一个客户端:

      <img src={ECSelection} width="100%" height="auto"/>

      请参阅[选择您的 ETH 客户端](/zh/node-staking/eth-clients#execution-clients)部分以获取每个选项的描述。
      一旦您做出选择,请单击下面的相应选项卡以了解如何配置它:

      如果您选择 **Geth**、**Besu** 或 **Nethermind**,向导将为您处理所有配置。
      您可以在此过程结束时手动调整其某些参数,但它使用的默认值完全适合节点操作。
      您可以继续下一节。


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        **在路由器的端口转发设置中打开 P2P 端口**。将其配置为将 TCP 和 UDP 的**端口 30303** 转发到您机器的本地 IP 地址。
        这样,其他共识客户端可以从外部发现它并与之通信。这将帮助您的共识客户端快速同步并提高性能(从而提高奖励)。

        每个路由器的操作方式不同,因此**您需要查看路由器的手册以了解如何设置端口转发**。
      </p>

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        因为 Smartnode 将在自己的 Docker 容器中运行,它将使用 Docker 的内部网络。
        您将无法在此处使用 `localhost` 或 `127.0.0.1` 等主机名;如果您的执行客户端在与 Smartnode 相同的机器上运行,您需要提供机器的局域网 IP 地址。
      </p>

      就这样,您的执行客户端已经设置好了!
    </Tab>
    <Tab label="外部管理">
      对于外部管理的执行客户端,下一个屏幕将提示您输入其基于 HTTP 的 RPC (web3) API 和基于 Websocket 的 RPC API 的 URL:

      <img src={tuiExternalEC} width="100%" height="auto"/>

      Smartnode 将使用 HTTP URL 与其通信并执行区块链活动,例如查询链状态和提交交易。
      **如果您还没有启用客户端的 API 端口并使其可从 Smartnode 机器访问,您需要现在设置它。**
      有关此操作的说明因客户端而异;请查阅客户端的文档以了解如何设置 HTTP RPC 端点。

      Websocket URL 仅在您需要自己使用时才相关;Smartnode 不使用它。
      如果您不需要它,可以将其留空。

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        因为 Smartnode 将在自己的 Docker 容器中运行,它将使用 Docker 的内部网络。
        您将无法在此处使用 `localhost` 或 `127.0.0.1` 等主机名;如果您的回退执行客户端在与 Smartnode 相同的机器上运行,您需要提供机器的局域网 IP 地址。
      </p>

      当您对回退执行客户端选择感到满意时,继续下一步。
    </Tab>

  </Tabs>
</div>

### 共识客户端设置

现在您已经准备好了执行客户端,下一个任务是设置共识客户端。
"模式"(本地或外部)将继承您之前为执行客户端使用的选择。

从下面的选项卡中选择您之前选择的模式:

<div className="p-3">
  <Tabs>
    <Tab label="本地管理">
      如果您希望 Smartnode 为您管理共识客户端,下一个屏幕将要求您选择一个客户端:

      <img src={tuiLocalCC} width="100%" height="auto"/>

      对于网络整体健康和多样性的**首选选择**是 **Random (Recommended)** 选择,它将为您从四个支持的共识客户端中随机选择一个。

      如果您更喜欢选择明确的客户端,请参阅[选择您的 ETH 客户端](./eth-clients#eth2-clients)部分以获取每个选项的描述,以便您可以做出明智的决定。


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        根据客户端选择,有两种情况会提示您警告:

        - 所选客户端当前是[超多数客户端](https://clientdiversity.org/),这意味着信标链上不健康的大多数验证者使用它,这威胁到网络的稳定性

        - 所选客户端对于您当前使用的硬件来说**资源过重**

        如果您选择的客户端符合这两种情况中的任何一种,您将收到警告并被要求选择不同的客户端。
        您可以选择继续使用您选择的客户端,但您必须了解这样做的风险。
      </p>

      一旦您做出选择或被分配了随机客户端,请单击下面的相应选项卡以了解如何配置它:

      <div className="p-3">
        <Tabs>
          <Tab label="Lighthouse">
            Lighthouse 配置中的第一个选项将询问您的验证者的 **graffiti** 消息:

            <img src={tuiLocalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。

            接下来是启用或禁用 **Checkpoint Sync** 的选项:

            <img src={tuiLocalCheckpoint} width="100%" height="auto"/>

            Lighthouse 能够通过连接到您信任的现有信标节点来即时同步到信标链网络上的最新区块。
            这优于传统同步,因为它不需要任何时间(而传统同步可能需要数天),并且具有一些安全优势。
            如果您感兴趣,请查看[他们关于检查点同步的文档](https://lighthouse-book.sigmaprime.io/checkpoint-sync.html)以获取更多信息。

            您可以在此处输入提供对其 REST API 访问的任何信标节点的 URL。

            如果您想使用它,请参阅[下面关于检查点同步的部分](#信标链检查点同步)。

            最后一个问题将询问您是否要启用 Doppelgänger 保护:

            <img src={tuiLocalDD} width="100%" height="auto"/>

            Lighthouse 支持一个称为 [Doppelgänger Detection](https://lighthouse-book.sigmaprime.io/validator-doppelganger.html) 的功能。
            简而言之,该功能将在 Lighthouse 的验证者客户端重启后**故意**错过一些证明;在此期间,它将监听是否仍有使用您的验证者密钥向网络发送证明。

            理想情况下,不会有任何证明(这意味着没有其他机器使用您的验证者密钥运行)。
            在短暂的等待期后,Lighthouse 将正常开始验证。

            _但是_,如果_确实有_另一台机器使用您的验证者密钥运行,那么 Lighthouse 将立即关闭并在其日志文件中发出错误消息。
            这样做的原因是,如果它也开始证明,那么您将开始**双重证明**,这是一种**可罚没的违规行为**。
            当被罚没时,您的验证者将被强制退出信标链,您将被处罚大量 ETH。

            大多数时候,doppelgänger 检测只会导致客户端重启后错过一些证明。
            但是,在您将验证者迁移到新机器或更改为新信标客户端的情况下,**doppelgänger 检测可以防止您因意外双重证明而被罚没**。

            将其视为您的 minipool 的廉价保险;每次重启时您都会错过微不足道的利润,但您可以相当确信您不会意外地在两个地方运行您的密钥并因此被罚没。

            从 4.5.0 版本开始,Lighthouse 可以选择使用 [QUIC 协议](https://en.wikipedia.org/wiki/QUIC)以更有效的方式建立 P2P 连接。如果您愿意使用此功能,您需要在 ETH2 设置中定义一个额外的端口"P2P QUIC 端口"字段,并在路由器的端口转发设置中将其转发到您的节点。默认的 P2P QUIC 端口是 8001 (UDP)。确保避免与节点已经使用的端口(或回退/测试网节点)发生冲突。如果您在节点上使用防火墙,还要确保打开相同的端口(检查 `ufw status`)。
            要检查 QUIC 配置是否工作,您应该在运行 `docker run --network rocketpool_net curlimages/curl http://eth2:9100/metrics | grep libp2p_peers_multi` 时在 `libp2p_quic_peers` 后面看到一个两位数的数字。

          </Tab>
          <Tab label="Nimbus">
            Nimbus 配置中的第一个选项将询问您的验证者的 **graffiti** 消息:

            <img src={tuiLocalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。

            接下来是启用或禁用 **Checkpoint Sync** 的选项:

            <img src={tuiLocalCheckpoint} width="100%" height="auto"/>

            Nimbus 能够通过连接到您信任的现有信标节点来即时同步到信标链网络上的最新区块。
            这优于传统同步,因为它不需要任何时间(而传统同步可能需要数天),并且具有一些安全优势。
            如果您感兴趣,请查看[他们关于检查点同步的文档](https://nimbus.guide/trusted-node-sync.html)以获取更多信息。

            您可以在此处输入提供对其 REST API 访问的任何信标节点的 URL。

            如果您想使用它,请参阅[下面关于检查点同步的部分](#信标链检查点同步)。

            最后一个问题将询问您是否要启用 Doppelgänger 保护:

            <img src={tuiLocalDD} width="100%" height="auto"/>

            Nimbus 支持一个称为 [Doppelgänger Protection](https://nimbus.guide/faq.html#why-does-my-validator-miss-two-epochs-of-attestations-after-restarting) 的功能。
            简而言之,该功能将在 Nimbus 重启后**故意**错过一些证明;在此期间,它将监听是否仍有使用您的验证者密钥向网络发送证明。

            理想情况下,不会有任何证明(这意味着没有其他机器使用您的验证者密钥运行)。
            在短暂的等待期后,Nimbus 将正常开始验证。

            _但是_,如果_确实有_另一台机器使用您的验证者密钥运行,那么 Nimbus 将立即关闭并在其日志文件中发出错误消息。
            这样做的原因是,如果它也开始证明,那么您将开始**双重证明**,这是一种**可罚没的违规行为**。
            当被罚没时,您的验证者将被强制退出信标链,您将被处罚大量 ETH。

            大多数时候,doppelgänger 检测只会导致客户端重启后错过一些证明。
            但是,在您将验证者迁移到新机器或更改为新信标客户端的情况下,**doppelgänger 检测可以防止您因意外双重证明而被罚没**。

            将其视为您的 minipool 的廉价保险;每次重启时您都会错过微不足道的利润,但您可以相当确信您不会意外地在两个地方运行您的密钥并因此被罚没。

          </Tab>
          <Tab label="Prysm">
            Prysm 配置中的第一个选项将询问您的验证者的 **graffiti** 消息:

            <img src={tuiLocalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。

            接下来是启用或禁用 **Checkpoint Sync** 的选项:

            <img src={tuiLocalCheckpoint} width="100%" height="auto"/>

            Prysm 能够通过连接到您信任的现有信标节点来即时同步到信标链网络上的最新区块。
            这优于传统同步,因为它不需要任何时间(而传统同步可能需要数天),并且具有一些安全优势。
            如果您感兴趣,请查看[他们关于检查点同步的文档](https://docs.prylabs.network/docs/prysm-usage/checkpoint-sync)以获取更多信息。

            您可以在此处输入提供对其 REST API 访问的任何信标节点的 URL。

            如果您想使用它,请参阅[下面关于检查点同步的部分](#信标链检查点同步)。

            最后一个问题将询问您是否要启用 Doppelgänger 保护:

            <img src={tuiLocalDD} width="100%" height="auto"/>

            Prysm 支持一个称为 Doppelgänger Protection 的功能。
            简而言之,该功能将在 Prysm 的验证者客户端重启后**故意**错过一些证明;在此期间,它将监听是否仍有使用您的验证者密钥向网络发送证明。

            理想情况下,不会有任何证明(这意味着没有其他机器使用您的验证者密钥运行)。
            在短暂的等待期后,Prysm 将正常开始验证。

            _但是_,如果_确实有_另一台机器使用您的验证者密钥运行,那么 Prysm 将立即关闭并在其日志文件中发出错误消息。
            这样做的原因是,如果它也开始证明,那么您将开始**双重证明**,这是一种**可罚没的违规行为**。
            当被罚没时,您的验证者将被强制退出信标链,您将被处罚大量 ETH。

            大多数时候,doppelgänger 检测只会导致客户端重启后错过一些证明。
            但是,在您将验证者迁移到新机器或更改为新信标客户端的情况下,**doppelgänger 检测可以防止您因意外双重证明而被罚没**。

            将其视为您的 minipool 的廉价保险;每次重启时您都会错过微不足道的利润,但您可以相当确信您不会意外地在两个地方运行您的密钥并因此被罚没。

          </Tab>
          <Tab label="Teku">
            Teku 配置中的第一个选项将询问您的验证者的 **graffiti** 消息:

            <img src={tuiLocalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。

            最后一个问题是启用或禁用 **Checkpoint Sync** 的选项:

            <img src={tuiLocalCheckpoint} width="100%" height="auto"/>

            Teku 能够通过连接到您信任的现有信标节点来即时同步到信标链网络上的最新区块。
            这优于传统同步,因为它不需要任何时间(而传统同步可能需要数天),并且具有一些安全优势。
            如果您感兴趣,请查看[他们关于检查点同步的文档](https://docs.teku.consensys.net/en/latest/HowTo/Get-Started/Checkpoint-Start/)以获取更多信息。

            您可以在此处输入提供对其 REST API 访问的任何信标节点的 URL。

            如果您想使用它,请参阅[下面关于检查点同步的部分](#信标链检查点同步)。
          </Tab>
          <Tab label="Lodestar">
            Lodestar 配置中的第一个选项将询问您的验证者的 **graffiti** 消息:

            <img src={tuiLocalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。

            接下来是启用或禁用 **Checkpoint Sync** 的选项:

            <img src={tuiLocalCheckpoint} width="100%" height="auto"/>

            Lodestar 能够通过连接到您信任的现有信标节点来即时同步到信标链网络上的最新区块。
            这优于传统同步,因为它不需要任何时间(而传统同步可能需要数天),并且具有一些安全优势。
            如果您感兴趣,请查看[他们关于检查点同步的文档](https://chainsafe.github.io/lodestar/run/beacon-management/starting-a-node#checkpoint-sync)以获取更多信息。

            您可以在此处输入提供对其 REST API 访问的任何信标节点的 URL。

            如果您想使用它,请参阅[下面关于检查点同步的部分](#信标链检查点同步)。

            最后一个问题将询问您是否要启用 Doppelgänger 保护:

            <img src={tuiLocalDD} width="100%" height="auto"/>

            Lodestar 支持一个称为 Doppelgänger Detection 的功能。
            简而言之,该功能将在 Lodestar 的验证者客户端重启后**故意**错过一些证明;在此期间,它将监听是否仍有使用您的验证者密钥向网络发送证明。

            理想情况下,不会有任何证明(这意味着没有其他机器使用您的验证者密钥运行)。
            在短暂的等待期后,Lodestar 将正常开始验证。

            _但是_,如果_确实有_另一台机器使用您的验证者密钥运行,那么 Lodestar 将立即关闭并在其日志文件中发出错误消息。
            这样做的原因是,如果它也开始证明,那么您将开始**双重证明**,这是一种**可罚没的违规行为**。
            当被罚没时,您的验证者将被强制退出信标链,您将被处罚大量 ETH。

            大多数时候,doppelgänger 检测只会导致客户端重启后错过一些证明。
            但是,在您将验证者迁移到新机器或更改为新信标客户端的情况下,**doppelgänger 检测可以防止您因意外双重证明而被罚没**。

            将其视为您的 minipool 的廉价保险;每次重启时您都会错过微不足道的利润,但您可以相当确信您不会意外地在两个地方运行您的密钥并因此被罚没。

          </Tab>
        </Tabs>
      </div>

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        **在路由器的端口转发设置中打开 P2P 端口**。将其配置为将 TCP 和 UDP 的**端口 9001** 转发到您机器的本地 IP 地址。
        这样,其他共识客户端可以从外部发现它并与之通信。这将帮助您的共识客户端快速同步并提高性能(从而提高奖励)。

        每个路由器的操作方式不同,因此**您需要查看路由器的手册以了解如何设置端口转发**
      </p>
    </Tab>
    <Tab label="外部管理">
      因为每个共识客户端的行为略有不同,Smartnode 需要知道您在外部使用的是哪一个,以便它可以相应地调整自己的行为。
      首先从下一个屏幕的列表中选择您拥有的客户端:

      <img src="./images/tui-external-cc.png" width="100%" height="auto"/>


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        目前,**Nimbus** 与外部模式不兼容,因为它还不能作为独立的验证者容器 (VC) 运行。
        当客户端支持此功能时,它将被添加到此处的列表中。
      </p>

      从下面的选项卡中选择您的客户端以了解如何完成配置。

      <div className="p-3">
        <Tabs>
          <Tab label="Lighthouse">
            首先指定您的 Lighthouse 信标节点 API 的 URL:

            <img src={tuiExternalLH} width="100%" height="auto"/>

            Smartnode 将使用 HTTP URL 与其通信并执行区块链活动,例如查询链状态和提交消息。
            **如果您还没有启用 API 端口并使其可从 Smartnode 机器访问,您需要现在设置它。**
            有关如何执行此操作的说明,请参阅 [Lighthouse 的文档](https://lighthouse-book.sigmaprime.io/api-bn.html)。

            <p className="rspress-directive warning">
              <p className="rspress-directive-title">注意</p>
              因为 Smartnode 将在自己的 Docker 容器中运行,它将使用 Docker 的内部网络。
              您将无法在此处使用 `localhost` 或 `127.0.0.1` 等主机名;如果您的客户端在与 Smartnode 相同的机器上运行,您需要提供机器的局域网 IP 地址。
            </p>


            接下来,它将询问您的验证者的 **graffiti** 消息:

            <img src={tuiExternalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。

            最后一个问题将询问您是否要启用 Doppelgänger 保护:

            <img src={tuiExternalDD} width="100%" height="auto"/>

            Lighthouse 支持一个称为 [Doppelgänger Detection](https://lighthouse-book.sigmaprime.io/validator-doppelganger.html) 的功能。
            简而言之,该功能将在 Lighthouse 的验证者客户端重启后**故意**错过一些证明;在此期间,它将监听是否仍有使用您的验证者密钥向网络发送证明。

            理想情况下,不会有任何证明(这意味着没有其他机器使用您的验证者密钥运行)。
            在短暂的等待期后,Lighthouse 将正常开始验证。

            _但是_,如果_确实有_另一台机器使用您的验证者密钥运行,那么 Lighthouse 将立即关闭并在其日志文件中发出错误消息。
            这样做的原因是,如果它也开始证明,那么您将开始**双重证明**,这是一种**可罚没的违规行为**。
            当被罚没时,您的验证者将被强制退出信标链,您将被处罚大量 ETH。

            大多数时候,doppelgänger 检测只会导致客户端重启后错过一些证明。
            但是,在您将验证者迁移到新机器或更改为新信标客户端的情况下,**doppelgänger 检测可以防止您因意外双重证明而被罚没**。

            将其视为您的 minipool 的廉价保险;每次重启时您都会错过微不足道的利润,但您可以相当确信您不会意外地在两个地方运行您的密钥并因此被罚没。

          </Tab>
          <Tab label="Prysm">
            首先指定您的 Prysm 信标节点 API 的 URL 以及其 JSON-RPC API 的 URL:

            <img src={tuiExternalPrysm} width="100%" height="auto"/>

            Smartnode 将使用 HTTP URL 与其通信并执行区块链活动,例如查询链状态和提交消息。
            它将使用 JSON-RPC URL 准备其 Prysm 验证者客户端,以便它可以与您的信标节点通信,因为 _Prysm 的验证者客户端目前无法通过 HTTP API 工作。_

            **如果您还没有启用 API 端口并使其可从 Smartnode 机器访问,您需要现在设置它们。**
            有关如何执行此操作的说明,请参阅 [Prysm 的文档](https://docs.prylabs.network/docs/prysm-usage/parameters)。
            **您需要启用 `grpc-gateway` _和_ `rpc-host`。**

            <p className="rspress-directive warning">
              <p className="rspress-directive-title">注意</p>
              因为 Smartnode 将在自己的 Docker 容器中运行,它将使用 Docker 的内部网络。
              您将无法在此处使用 `localhost` 或 `127.0.0.1` 等主机名;如果您的客户端在与 Smartnode 相同的机器上运行,您需要提供机器的局域网 IP 地址。
            </p>


            接下来,它将询问您的验证者的 **graffiti** 消息:

            <img src={tuiExternalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。

            最后一个问题将询问您是否要启用 Doppelgänger 保护:

            <img src={tuiExternalDD} width="100%" height="auto"/>

            Prysm 支持一个称为 Doppelgänger Protection 的功能。
            简而言之,该功能将在 Prysm 的验证者客户端重启后**故意**错过一些证明;在此期间,它将监听是否仍有使用您的验证者密钥向网络发送证明。

            理想情况下,不会有任何证明(这意味着没有其他机器使用您的验证者密钥运行)。
            在短暂的等待期后,Prysm 将正常开始验证。

            _但是_,如果_确实有_另一台机器使用您的验证者密钥运行,那么 Prysm 将立即关闭并在其日志文件中发出错误消息。
            这样做的原因是,如果它也开始证明,那么您将开始**双重证明**,这是一种**可罚没的违规行为**。
            当被罚没时,您的验证者将被强制退出信标链,您将被处罚大量 ETH。

            大多数时候,doppelgänger 检测只会导致客户端重启后错过一些证明。
            但是,在您将验证者迁移到新机器或更改为新信标客户端的情况下,**doppelgänger 检测可以防止您因意外双重证明而被罚没**。

            将其视为您的 minipool 的廉价保险;每次重启时您都会错过微不足道的利润,但您可以相当确信您不会意外地在两个地方运行您的密钥并因此被罚没。

          </Tab>
          <Tab label="Teku">
            首先指定您的 Teku 信标节点 API 的 URL:

            <img src={tuiExternalTeku} width="100%" height="auto"/>

            Smartnode 将使用 HTTP URL 与其通信并执行区块链活动,例如查询链状态和提交消息。
            **如果您还没有启用 API 端口并使其可从 Smartnode 机器访问,您需要现在设置它。**
            有关如何执行此操作的说明,请参阅 [Teku 的文档](https://docs.teku.consensys.net/en/latest/Reference/CLI/CLI-Syntax/#rest-api-enabled)。


            <p className="rspress-directive warning">
              <p className="rspress-directive-title">注意</p>
              因为 Smartnode 将在自己的 Docker 容器中运行,它将使用 Docker 的内部网络。
              您将无法在此处使用 `localhost` 或 `127.0.0.1` 等主机名;如果您的客户端在与 Smartnode 相同的机器上运行,您需要提供机器的局域网 IP 地址。
            </p>

            接下来,它将询问您的验证者的 **graffiti** 消息:

            <img src={tuiExternalGraffiti} width="100%" height="auto"/>

            这是一条可选的自定义消息,您可以将其附加到您在信标链上提议的任何区块。
            该消息将永久保存,因此将其视为留下您印记的有趣小方式!

            **请注意,graffiti 的最大长度为 16 个字符。**

            如果您想查看今天验证者使用的 Graffiti 示例,[请看这里](https://beaconcha.in/blocks)。
          </Tab>

        </Tabs>
      </div>
    </Tab>

  </Tabs>
</div>

#### 信标链检查点同步

**检查点同步**是某些信标链客户端支持的非常有用的技术。
它允许您的信标客户端即时同步整个信标链,而无需从头开始并赶上每个区块。
这意味着您的信标客户端可以在几**分钟**内准备就绪,而不是需要**数天**。
它所需要的只是访问您信任的现有信标客户端。

您可以使用任何提供对其 HTTP API 访问的信标节点。
目前,许多节点运营者正在使用 checkpoint-sync-endpoints - 一项允许 Rocket Pool 节点运营者轻松进行检查点同步的服务。
支持 Hoodi 测试网和主网。
可以通过以下链接找到检查点同步 URL 列表:

- [检查点同步 URL](https://eth-clients.github.io/checkpoint-sync-endpoints/)

选择相关的检查点同步 URL,并在 `rocketpool service config` 期间提示您输入检查点同步提供商时粘贴到终端中。

之后,您的信标节点将在首次启动时自动连接到检查点同步节点并立即拉取链的最新状态!

::: warning 注意
检查点同步仅在您_还没有任何信标链数据_时才会发生。
换句话说,如果您开始正常同步并决定稍后进行检查点同步,您将必须首先删除链数据才能使检查点同步工作。
这可以通过以下命令轻松完成:

```shell
rocketpool service resync-eth2
```

:::

### 回退节点

从 Smartnode 堆栈 1.5.0 开始,您可以提供"回退"执行客户端和共识客户端对,如果您的主客户端离线(例如因为您使用 Geth 并需要修剪它),它们可以接管。
在这种情况下,您的主节点机器仍将负责使用 minipool 的验证者密钥进行证明和提议区块,但它将连接到外部机器以与执行层和信标链交互。

[要了解有关回退节点的更多信息,请参阅本节](./fallback),完成后返回此处。

### 指标配置

Rocket Pool 能够显示详细的仪表板,显示有关节点硬件健康状况、系统更新、验证者性能、奖励、整体 Rocket Pool 网络信息等的指标:

<img src="./images/nimbus-dashboard.png" width="100%" height="auto" />

向导中的下一个问题将询问您是否要启用它:

<img src="./images/tui-metrics.png" width="100%" height="auto" />

如果您选择启用它,您将在稍后的过程中在[设置 Grafana 仪表板](./grafana)部分了解有关设置和使用它的更多信息。

::: warning 注意
此系统收集的所有数据**都保留在您的机器上**。
Rocket Pool 不收集任何遥测数据或将其发送到单独的服务。
它纯粹是为您提供的,以便您可以监控自己的节点!
:::

### MEV 配置

自 2022 年 9 月执行层和共识层合并以来,Ethereum 验证者现在能够赚取优先费并参与最大可提取价值(简称 MEV)。

从 Smartnode v1.7.0 开始,MEV 现在是_选择退出_,因此其配置作为初始设置的一部分呈现,如您在下一个屏幕中看到的:

<img src="./images/tui-mev-mode.png" width="100%" height="auto" />

[请阅读我们的 MEV 指南以了解有关 MEV、其配置以及在向导的本节中要做什么的更多信息。](./mev)
完成后返回此处。

### 完成

在回答这个问题之后,您已经完成了 Smartnode 的设置!
您将看到以下对话框:

<img src="./images/tui-finished.png" width="100%" height="auto" />

如果您对设置感到满意并准备启动 Smartnode,请单击 `Save and Exit`,然后转到[保护您的节点](./securing-your-node)部分。

如果您想查看所有设置并自定义向导中未包含的许多其他设置,请单击 `Review All Settings` 并转到[下一节](#通过设置管理器配置)。

## 通过设置管理器配置

如果您已经运行过 `rocketpool service config`,您将看到**设置管理器**屏幕,而不是向导:

<img src="./images/tui-settings-manager.png" width="100%" height="auto" />

此屏幕有三个主要功能:

1. **类别列表**,让您深入了解 Smartnode 堆栈每个类别的设置
2. **审查更改并保存**按钮,当您准备好查看已更改的设置并保存更新的配置时可以使用
3. **打开配置向导**按钮,如果您更喜欢该界面,它将带您进入[设置向导](#通过向导配置)

::: tip 提示
要使用设置管理器,**按`箭头键`(上/下/左/右)在主页中的选项之间导航**。

按 `Tab` 在屏幕底部的**类别列表 (1) 和按钮 (2 和 3) 之间**切换。
当前选中的按钮将**以绿色突出显示**。

**按 `Enter` 或 `Space` 选择按钮**,类似于用鼠标点击它。

**随时按住 `Ctrl` 并按 `C` 退出设置管理器而不保存任何内容**。
:::

当您滚动浏览类别列表时,每个选项都会在屏幕右侧的**描述框**中显示有用的描述。
随意探索;在您通过**审查更改并保存**按钮进入审查对话框之前,不会保存任何内容,并且您可以随时按 **Ctrl+C** 退出而不保存,因此您不会意外弄乱设置。

### 配置设置

从主屏幕,使用 `Enter` 键选择任何一个类别以查看该类别的设置。
例如,这是 **Smartnode and TX Fees** 类别的屏幕:

<img src="./images/tui-smartnode.png" width="100%" height="auto" />

使用 `箭头键` 在设置之间上下移动。
当前选中的设置末尾将有一个白色方块(如果是文本框或复选框),或将以白色突出显示(如果是下拉菜单)。

完成后按 `Escape` 返回设置管理器的主屏幕。

当您滚动浏览设置时,每个设置都会在右侧的**描述框**中显示其功能的简要描述。
它还会在那里显示**默认值**,以防您想将其恢复为默认设置。

在此示例中,**RPL Claim Gas Threshold** 设置当前被选中(在屏幕左侧用绿色框突出显示)。
它已更改为 `40`,但您可以在右上角(**描述框**顶部)看到它的默认值为 `150`。

::: tip 提示
提醒一下,在您通过**审查更改并保存**按钮进入审查对话框之前,不会将任何内容保存到磁盘。
我们鼓励您探索所有设置以了解它们并查看您的 Smartnode 可以做什么!
:::

### 设置类型及其使用方法

设置管理器使用以下设置类型和 UI 元素:

#### 文本框

文本框用于输入任意文本字符串或数字。
它们看起来像这样:

<img src="./images/tui-textbox.png" width="100%" height="auto" />

在其中输入所需的值,然后**按 `Enter` 或使用 `箭头键` 导航到不同的设置以保留您的更改。**
如果不这样做,设置管理器将假定您仍在更新该设置,并且不会将其标记为已更改。

#### 下拉菜单

下拉菜单用于从选项列表中选择一个选项。
它们看起来像这样(打开时):

<img src="./images/tui-dropdown-open.png" width="100%" height="auto" />

**绿色**项目是当前选中的项目。
使用 `箭头键` 更改选项 - 当您这样做时,右侧的**描述框**将更新以告诉您有关当前选定选项的更多信息。
当您对选择感到满意时,按 `Enter` 选择所选选项,下拉菜单将关闭,显示当前选中的选项:

<img src="./images/tui-dropdown-closed.png" width="100%" height="auto" />

#### 复选框

复选框用于简单的是/否问题。
它们看起来像这样:

<img src="./images/tui-checkbox-checked.png" width="100%" height="auto" />

当它们被选中时,中间会有一个 `X`,如上所示。
当它们_未选中_时,它们将简单地是空白的,如下所示:

<img src="./images/tui-checkbox-unchecked.png" width="100%" height="auto" />

要更改设置,只需选择它并按 `Enter`。

### 保存更改

当您对更改感到满意并想在保存之前查看它们时,请按主屏幕上的**审查更改并保存**按钮。
提醒一下,要到达它,请按 `Tab` 键。

您将看到如下所示的视图:

<img src="./images/tui-review.png" width="100%" height="auto" />

这里的**审查框**将显示您已更改的所有设置,显示旧值和新值。
例如,这里的第一行显示 **RPL Claim Gas Threshold** 过去是 `150`,已更改为 `40`。

它还会显示哪些容器受您修改的设置影响,并会在您保存更改后为您重启它们。

::: tip 注意
此时,您的更改**仍未保存**。
如果您想返回并修改某些内容,请按 `Escape` 返回主屏幕。
:::

当您对更改感到满意时,按 `Enter` 将新配置保存到磁盘。
然后,您将退出终端界面并看到如下消息:

```
Your changes have been saved!
The following containers must be restarted for the changes to take effect:
	rocketpool_watchtower
	rocketpool_validator
	rocketpool_eth2
	rocketpool_node
Would you like to restart them automatically now? [y/n]
```

如果您想自动应用新配置更改并重启受影响的容器,请按 `y` 和 `Enter`。

如果您还有其他事情要做,稍后再手动重启它们,请按 `n` 和 `Enter`。

无论哪种情况,您的配置都已完成!

::: tip 注意
您可能会看到如下错误消息:

```
2022/08/13 13:49:41 Error piping stdout: read |0: file already closed
```

这实际上不是错误,只是一个外观上的小问题。
您可以安全地忽略它。
:::

::: tip 注意
如果您运行的是 Mac OS,您可能会看到关于 node_exporter 的问题。
您需要运行这些命令来修复。

```shell
rocketpool service stop
nano ~/.rocketpool/override/exporter.yml
```

将文件的全部内容替换为:

```
# Enter your own customizations for the node exporter container here. These changes will persist after upgrades, so you only need to do them once.
#
# See https://docs.docker.com/compose/extends/#adding-and-overriding-configuration
# for more information on overriding specific parameters of docker-compose files.

version: "3.7"
services:
  node-exporter:
    x-rp-comment: Add your customizations below this line
    volumes:   ["/proc:/host/proc:ro","/sys:/host/sys:ro"]
```

最后运行 `rocketpool service start`。
:::

## 通过命令行配置

如果您在无法与终端界面交互的无头环境中使用 Smartnode,则可以通过命令行配置节点。

`rocketpool service config` 命令接受作为参数的每个通常可以通过终端界面配置的设置。
运行以下命令以查看它们的列表(请注意,它非常长):

```shell
rocketpool service config --help
```

输出将如下所示:

```
NAME:
   rocketpool service config - Configure the Rocket Pool service

USAGE:
   rocketpool service config

OPTIONS:
   --executionClientMode value  Choose which mode to use for your Execution client - locally managed (Docker Mode), or externally managed (Hybrid Mode).
                                Type: choice
                                Options: local, external
 (default: "local")
   --executionClient value  Select which Execution client you would like to run.
                            Type: choice
                            Options: geth, infura, pocket
 (default: "geth")
   --useFallbackExecutionClient         Enable this if you would like to specify a fallback Execution client, which will temporarily be used by the Smartnode and your Consensus client if your primary Execution client ever goes offline.
                                        Type: bool

...
```

每个选项都将有其名称、类型、默认值以及(如果是选择参数)其选项。
使用此文本,您可以找到要设置的选项并通过适当的参数指定它们。

::: tip 注意
此命令基于您现有的配置构建,因此如果您已经保存了一些设置并且只想修改其他设置,则不需要重复它们。
它只会更新您作为此命令参数包含的设置。
:::

## 下一步

一旦您按照自己的方式配置了节点,就可以保护操作系统以保护节点了。
接下来转到[保护您的节点](./securing-your-node)部分。
