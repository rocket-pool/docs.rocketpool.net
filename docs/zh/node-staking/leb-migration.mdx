import { Tab, Tabs } from "@rspress/core/theme";

::: danger 警告
为准备 Saturn 1,Minipool 存款目前已禁用。
:::

# 将 16-ETH Minipool 迁移至 8-ETH

节点运营者能够将其现有的 16-ETH minipool **直接迁移**为 8-ETH minipool。
这样做将在其[存款信用余额](./credit)中增加 8 ETH,可用于**在节点运营者无需提供任何 ETH 的情况下创建额外的 minipool**。

实际上,此过程允许节点运营者**免费将一个 16-ETH minipool 转换为两个 8-ETH minipool**(_尽管仍需要 ETH 用于支付 gas,并需要足够的 RPL 抵押品来处理两个 minipool_)。

将现有的 16-ETH minipool 迁移到 8-ETH 正式称为**债券减少**。
这是一个两步过程,涉及 Oracle DAO 的验证。
我们将在下面的章节中引导您完成整个过程。

### 债券减少规则

债券减少涉及以下步骤:

1. 由节点运营者启动债券减少。
2. 等待期("债券减少审查检查"),允许 Oracle DAO 有时间验证债券减少是否合法,并取消任何违反规则的债券减少。
3. 由节点运营者完成债券减少。

要成功执行债券减少而不被审查,minipool 必须遵循以下规则:

1. Minipool 必须升级到 [Atlas 委托](./minipools/delegates);旧的 Redstone 委托无法使用。
1. Minipool 在 Beacon Chain 上的 validator 必须**处于待定或活跃 staking 状态**。它不能被罚没、正在退出/已退出,或可提取/已提取。
1. Minipool 在 Beacon Chain 上的 validator 余额必须**至少为 31.99 ETH**(32 ETH 加上一个小缓冲,以应对在奖励撇脂后因时机不当的复杂情况导致的错过证明)。

Minipool 必须在审查检查的**整个持续时间内**遵守这些条件,在此期间 Oracle DAO 将监控它以确保符合上述条件。

如果在审查检查期间的任何时候,发现 minipool 违反了这些条件,债券减少将被**审查**。
Minipool 本身不会受到影响;它仍将作为 16 ETH minipool 愉快地继续存在,进行验证并像整个债券减少过程从未发生过一样运行。
但是,**它将不再有资格进行债券减少**。
一旦 minipool 的债券减少被审查,就永远无法再次尝试。

::: warning 注意
成功减少债券后,minipool 的债券金额将从 16 ETH 减少到 8 ETH,并且**minipool 的佣金将重置为当前网络值**。

如果您减少一个佣金为 20% 的 16-ETH minipool,**您将不会保留那 20% 的佣金**。
它将被减少到网络值(**目前设置为固定的 14%**)。

请注意,正如[示例数学](./create-validator.mdx#rewards)部分所示,14% 的 8-ETH minipool _仍然比_ 20% 的 16-ETH minipool 更有利可图,因此保持高佣金率并不是保留 16 ETH 债券的充分理由。
:::

### 步骤 1:开始债券减少

要开始债券减少过程,请输入以下命令:

```shell
rocketpool minipool begin-bond-reduction
```

这将首先提供有关该过程的简要介绍(不过,如果您已经阅读了本指南,这些对您来说应该都很熟悉了)。
一旦您确认理解了该过程,它将显示哪些 minipool 当前的债券可以减少,以及它们当前的债券和佣金:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)

```

一旦您选择了一个或多个要减少的 minipool,Smartnode 将检查这些 minipool 是否符合债券减少的资格。

要符合资格,必须满足以下条件:

- Minipool 已升级为使用 [Atlas minipool 委托合约](./minipools/delegates)。
- Minipool 的 validator 在 Beacon Chain 上的余额必须至少为 32 ETH。
- Minipool 的 validator 必须处于待定或活跃状态。
- 您已质押足够的 RPL 来支持债券减少*后*所需的最低 RPL 抵押水平。

如果不满足,它将打印一条警告错误,说明需要首先完成什么;例如:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)
2

Cannot reduce bond for minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5:
The minipool version is too low. It must be upgraded first using `rocketpool minipool delegate-upgrade`.
You do not have enough RPL staked to support this bond reduction; it would bring you below the minimum RPL staking requirement. You will have to stake more RPL first.
```

这表明所选的 minipool 需要委托升级,并且节点需要质押更多 RPL 才能减少该 minipool 的债券。

当您满足前提条件时,在此命令中选择 minipool 只会提示您选择交易的 gas 价格并确认操作。
接受确认后,minipool 的债券减少将开始。

### 监控审查检查计时器

一旦您开始了债券减少,您可以在 `node` 守护进程日志中查看还有多长时间才能完成:

<div className="p-3">
  <Tabs>
    <Tab label="Docker 和混合模式">
      对于 **Docker 模式**和**混合模式**用户,可以使用以下命令完成:

      ```shell
      rocketpool service logs node
      ```
    </Tab>
    <Tab label="原生模式">
      请参考您用于查看节点守护进程系统日志的脚本。
    </Tab>

  </Tabs>
</div>

您将看到一个新条目,注明债券减少的审查检查还剩多少时间:

```
rocketpool_node  | 2023/02/25 09:04:21 Checking for minipool bonds to reduce...
rocketpool_node  | 2023/02/25 09:04:21 Minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 has 12m0s left until it can have its bond reduced.
```

一旦此计时器达到零并且不再出现在这些日志中,您就可以完成债券减少。

### 步骤 2:完成债券减少

当审查计时器成功结束后,有两种方法可以完成您的 minipool 的债券减少:

1. 让 `node` 守护进程为您处理;它在每五分钟执行的例行检查中执行此操作(与上面日志中打印剩余时间行的检查相同)。如果它注意到您有符合条件的债券减少,**它将自动完成减少** - 就像它对 staking 待定的 minipool 和检查您的费用接收者所做的那样。您将在 `node` 日志中看到显示它何时检测到并完成债券减少的输出。
2. 使用以下命令手动完成债券减少:
   ```shell
   rocketpool minipool reduce-bond
   ```
   该命令很简单;当您的 minipool 符合债券减少资格时,按照提示完成该过程。

在债券减少期间,Rocket Pool **分配您的 minipool 的现有余额**,使用 minipool 债券减少前的债券和佣金,以确保您和 rETH staker 都能获得现有余额的公平份额,并且债券减少不会改变任何一方*本应*从该余额中获得的奖励。

### 债券减少的结果

您可以使用 `rocketpool minipool status` 验证债券减少是否成功。

在债券减少**之前**,对于我们一直关注的示例 minipool,该命令将产生以下输出:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             15.000000%
Node deposit:         16.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            16.000000 ETH
Minipool Balance (EL): 0.150713 ETH
Your portion:          0.086660 ETH
Available refund:      0.000000 ETH
Total EL rewards:      0.086660 ETH
...
Beacon balance (CL):   32.000152 ETH
Your portion:          16.000087 ETH
...
```

在债券减少**之后**,该命令将返回以下输出:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             14.000000%
Node deposit:         8.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 0.086769 ETH
Your portion:          0.000000 ETH
Available refund:      0.086769 ETH
Total EL rewards:      0.086769 ETH
...
Beacon balance (CL):   32.000037 ETH
Your portion:          8.000013 ETH
...
```

注意事情是如何变化的:

- `Node fee`(佣金)从 15% 变为 14%
- `Node deposit`(您的债券)从 16 ETH 变为 8 ETH
- `RP deposit`(您借入的金额)从 16 ETH 变为 24 ETH
- `Minipool Balance (EL)` 从 0.150713 ETH 变为 0.086769 ETH
- `Your portion (EL)` 从 0.086660 ETH 变为 0 ETH
- `Available refund` 从 0 ETH 变为 0.086769 ETH
- `Your portion (CL)` 从 16.000087 ETH 变为 8.000013 ETH

`Node fee`、`Node deposit`、`RP deposit` 和 `Your portion (CL)` 的变化表明债券已成功减少。

`Minipool Balance (EL)`、`Your portion (EL)` 和 `Available refund` 的变化表明作为债券减少过程一部分发生的 **minipool 余额分配**的结果。
为了阐明如何解释这些结果:

- 如果您查看[交易](https://zhejiang.beaconcha.in/tx/0xf02f6b1a4ea68f356909e6f1974dc3c24d301ba115b97f3013c3c829ba2ca57c),您还会看到它从 minipool 向 staking 池发送了 0.06413383 ETH。
- 在"之前"示例中,staking 池的份额是 minipool 的余额减去节点运营者的份额,即 `0.150713 - 0.086660 = 0.064053`,这是在债券减少期间转移到 staking 池的金额(加上审查检查期间发生的奖励撇脂的少量金额)。
- 另一方面,*节点运营者*的份额不会被发送到节点运营者的提款地址。它被标记为**可用退款**,这就是为什么退款金额从 0 ETH 增加到之前 minipool 在 EL 上余额的"您的份额"金额。
  - 您可以随时使用以下命令领取此退款:
    ```shell
    rocketpool minipool refund
    ```

债券减少还有一个重要结果,可以使用 `rocketpool node status` 观察到:

```
Your Smartnode is currently using the Zhejiang Test Network.

=== Account and Balances ===
The node 0x9BA1401Eb7D779eC51f910B066e9C4351cD28911 has a balance of 347.796908 ETH and 16799.835547 RPL.
The node has 8.000000 ETH in its credit balance, which can be used to make new minipools.
```

债券减少过程已**增加了节点的**[存款信用余额](./credit) 8 ETH。
此信用可用于免费[创建另一个 8-ETH minipool](./create-validator.mdx#depositing-eth-and-creating-a-minipool)(除 gas 外,无需节点钱包提供 ETH)!
