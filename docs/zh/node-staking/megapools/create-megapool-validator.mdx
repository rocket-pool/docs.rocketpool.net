

# 创建 Megapool（验证者）

欢迎来到 Saturn 1！Rocket Pool megapool 是执行层上的一个智能合约实例。
您的节点将管理一个 megapool，作为一个或多个验证者的以太坊提款地址。
每个验证者由您的部分 ETH（称为质押金额）和来自 rETH 质押池的部分 ETH（称为借入金额）组成。
您的 megapool 负责将质押金额和借入金额的 ETH 合并形成 32 ETH，然后发送到信标链存款合约以创建新的验证者。

您的 megapool 会在您第一次验证者存款时自动部署。之后，您可以使用同一个 megapool 管理任意数量的验证者！您无需每次创建新验证者时都部署新的 megapool。


::: tip 注意
信标链验证者队列的激活（和退出）时间可能因网络当前状态而有很大差异。

这超出了 Rocket Pool 的控制范围，是信标链本身的功能。

以下工具可以很好地估计您预计需要等待的时间：
[https://www.validatorqueue.com/](https://www.validatorqueue.com/)

请查阅此工具，了解您的验证者激活需要等待的时间。
:::

::: tip 注意

验证者创建受两个队列管控。

1. 第一个是 Rocket Pool 存款队列。我们将在另一个章节详细介绍，但本质上该队列由 Rocket Pool 协议管理，决定您的验证者何时收到其借入的 ETH。
存款池中需要有可用的 ETH，才能将您的 4 ETH 与存款池中的 28 ETH 匹配并创建验证者。

2. 第二个是信标链队列，由以太坊信标链管理，决定您的验证者何时激活。
请注意，您的验证者激活所需时间可能因您在每个队列中的位置和网络当前状态而有很大差异。

Rocket Pool 存款队列提供了快速队列系统，帮助现有节点运营者将其 minipool 验证者 ETH 迁移到 megapool 验证者 ETH。

:::

## Rocket Pool 存款队列和快速队列

Rocket Pool 存款队列中有两种类型的队列：快速队列和标准队列。

存款队列提供了快速队列系统，帮助现有节点运营者将其 minipool 验证者 ETH 迁移到 megapool 验证者 ETH。它还为使用快速队列的存款创建了更可预测的存款时间线。

快速队列以 4:1 的比例处理，这意味着每匹配 1 个标准队列的验证者，就匹配 4 个快速队列的验证者。换句话说：先匹配快速队列的 4 个验证者，然后匹配标准队列的 1 个，再匹配快速队列的 4 个，以此类推。

现有节点运营者根据其在旧版 minipool 中质押的 ETH 获得快速队列票据：每质押 4 ETH 获得一张票据。
例如，拥有 8 ETH 旧版 minipool 的节点运营者获得 2 张快速队列票据。这足以使用快速队列完全迁移到两个 4 ETH 的 megapool 验证者。
[RPIP-59: 存款机制](https://rpips.rocketpool.net/RPIPs/RPIP-59#deposit-queue) 详细介绍了存款处理的细节。

如果您选择[将验证者从 Rocket Pool 存款队列中退出](/zh/node-staking/megapools/create-megapool-validator#exit-a-validator-from-the-rocket-pool-deposit-queue)，您的节点将获得退还的快速队列票据。

## 存入 ETH 并创建验证者

如果这是您节点的第一个 megapool 验证者，您节点的 megapool 也将同时自动部署。请记住，您节点的 Megapool 可以管理一个或多个验证者，因此每个节点只需部署一次 megapool！

准备好将 ETH 存入 megapool 并创建信标链验证者后，您可以使用以下命令：

```
rocketpool megapool deposit
```
::: danger 警告

虽然 CLI 会自动完成许多后续步骤，但我们<strong>强烈建议</strong>监控您的节点和交易，以确保从 `prelaunch` 到 `staking` 的成功过渡。

失败的交易（由于调整的 gas 设置、ETH gas 不足，或节点在初始存款后 28 天内离线）可能会使您的 megapool 验证者过渡到 `dissolved` 状态，这是您希望避免的。

如果预启动验证者在 28 天内未能质押，该验证者将被解散。在预启动过程中发送到信标链的 1 ETH（4 ETH 质押金的一部分）**无法恢复**。
节点运营者将获得[信用额度](/zh/node-staking/megapools/credit)，退还其质押中剩余的 3 ETH，并扣除 0.05 ETH 的解散罚款作为债务。解散验证者的净信用额度为 2.95 ETH。

[了解如何确认质押成功](/zh/node-staking/megapools/create-megapool-validator#confirming-a-successful-stake)

:::

第一个提示将询问您希望创建多少个验证者。您最多可以在同一次存款中创建 35 个，但我们在本示例中选择 1 个验证者。输入 `1` 然后按 `enter` 开始创建 1 个验证者。
```
Your eth2 client is on the correct network.

How many validators would you like to create? (max: 35)
1
```

第二个提示将显示您的节点当前质押的 ETH 数量，以及您所选验证者数量的总质押要求。我们示例中的节点没有 megapool 验证者，因此显示 `0.00 ETH bonded`。当前质押要求为 `4 ETH`。
阅读并理解显示的信息后，输入 `y` 然后按 `enter` 继续下一个提示。


```
The node is currently bonded with 0.00 ETH.
The total bond requirement is 4.00 ETH.

NOTE: You are about to create 1 new megapool validator(s), requiring a total of: 4.00 ETH.
Would you like to continue? [y/n]
y
```
下一个提示将显示 [Rocket Pool 存款队列](/zh/node-staking/megapools/create-megapool-validator#rocket-pool-deposit-queue-and-express-queue) 的状态。
这显示在您之前等待与 ETH 匹配的验证者数量。快速队列主要面向已有节点运营者，新节点不会有任何快速队列票据。`The express queue rate is 4` 表示每 1 个标准队列的验证者匹配 4 个快速队列的验证者。
```
There are 1 validator(s) on the express queue.
There are 12 validator(s) on the standard queue.
The express queue rate is 4 (4 express validators assigned per 1 standard).
A new express validator would be at queue position 3.
A new standard validator would be at queue position 14.
```
::: tip 注意
如果您是回归节点运营者，并且此次存款有可用的快速队列票据，系统将在此时提示您使用它们。
输入 `1` 然后按 `enter` 继续，为这次单个 megapool 验证者存款使用一张快速队列票据。
```
How many express tickets would you like to use? (max: 7)
1
```
如果您希望保留快速队列票据并在标准队列中继续，只需输入 `0` 然后按 `enter` 进入下一个提示。
:::

如果您有任何[存款信用额度](/zh/node-staking/megapools/credit)可在验证者上兑换，系统将在此处提示您兑换。否则，此步骤将提示您当前网络的 gas 价格建议。
```
Your credit balance is 0.00 ETH. (Credit in addition to ETH staked on your behalf).
Your consensus client is synced, you may safely create a megapool validator.
+================ Suggested Gas Prices ================+
| Avg Wait Time |   Max Fee    |     Total Gas Cost     |
| 15 Seconds    | 2.13120 gwei | 0.00160 to 0.00240 ETH |
| 1 Minute      | 1.96787 gwei | 0.00148 to 0.00222 ETH |
| 3 Minutes     | 1.00871 gwei | 0.00075 to 0.00113 ETH |
| >10 Minutes   | 1.00871 gwei | 0.00075 to 0.00113 ETH |
+======================================================+

These prices include a maximum priority fee of 0.010 gwei.
Please enter your max fee (including the priority fee) or leave blank for the default of 1.96787 gwei:

```
确认 gas 价格后，我们将进行最后一次最终确认以创建 megapool 验证者。
```
Using a max fee of 1.968 gwei and a priority fee of 0.010 gwei.
You are about to deposit 4.000000 ETH to create 1 new megapool validator(s).
ARE YOU SURE YOU WANT TO DO THIS?
 [y/n]
y

Creating 1 megapool validator(s) ...
Transaction has been submitted with hash <tx-hash>.
You may follow its progress by visiting:
https://hoodi.etherscan.io/tx/<tx-hash>

Waiting for the transaction to be included in a block... you may wait here for it, or press CTRL+C to exit and return to the terminal.

The node deposit of 4.000000 ETH total was made successfully!
Validator pubkeys:
  1. <beacon-pubkey>

The 1 new megapool validators have been created.
Once your validators progress through the queue, ETH will be assigned and a 1 ETH prestake submitted for each.
After the prestake, your node will automatically perform a stake transaction for each validator, to complete the progress.
To check the status of your validators use `rocketpool megapool validators`
To monitor the stake transactions use `rocketpool service logs node`

```
交易完成后，您将收到存款确认，包括 etherscan 交易哈希以及您的 megapool 验证者上线后预期的信标链公钥。您可以使用 `rocketpool megapool status` 命令检查 megapool 的状态，或使用 `rocketpool megapool validators` 检查特定验证者的状态。您的验证者将处于 `initialized` 状态，在 Rocket Pool 存款队列中排队推进。请注意，您的 megapool 验证者公钥直到被 Rocket Pool 存款队列处理并分配 ETH 后，才会在信标链上注册。

到此为止，您已经完成了！恭喜您拥有了 megapool 验证者。您肯定会想查看我们指南的[监控和维护](/zh/node-staking/maintenance/overview)部分，了解如何让您的节点保持最佳状态。同时请继续阅读下一节关于确认成功质押的内容，以确保您的 `initialized` 验证者顺利过渡到 `staking` 状态而不产生任何罚款。

## 确认质押成功

::: danger 警告

虽然 CLI 会自动完成许多后续步骤，但我们<strong>强烈建议</strong>监控您的节点和交易，以确保从 `prelaunch` 到 `staking` 的成功过渡。

失败的交易（由于调整的 gas 设置、ETH gas 不足，或节点在初始存款后 28 天内离线）可能会使您的 megapool 验证者过渡到 `dissolved` 状态，这是您希望避免的。

如果预启动验证者在 28 天内未能质押，该验证者将被解散。在预启动过程中发送到信标链的 1 ETH（4 ETH 质押金的一部分）**无法恢复**。
节点运营者将获得[信用额度](/zh/node-staking/megapools/credit)，退还其质押中剩余的 3 ETH，并扣除 0.05 ETH 的解散罚款作为债务。解散验证者的净信用额度为 2.95 ETH。

:::


确保您的节点在整个过程中保持在线！它将自动执行几个步骤，以确保您的验证者顺利在以下各阶段之间推进：

您的新 megapool 验证者将处于 `initialized` 状态。它将保持此状态，直到通过 Rocket Pool 存款队列并从存款池获得 28 ETH。使用 `rocketpool megapool validators` 命令检查验证者的状态。它应该如下所示：

```
1 Initialized validator(s):

--------------------

Megapool Validator ID:        7
Expected pubkey:              <expected-pubkey>
Validator active:             no
Validator Queue Position:     14
Express Ticket Used:          no
```
一旦您的验证者从 [Rocket Pool 存款队列](/zh/node-staking/megapools/create-megapool-validator#rocket-pool-deposit-queue-and-express-queue) 获得 ETH 分配，它将进入 `Prelaunch` 状态。此时，您 megapool 余额中的 1 ETH 将存入信标链。您的验证者公钥也将在信标链上注册，这意味着您可以在 https://beaconcha.in/（如果您使用测试网，则访问 https://hoodi.beaconcha.in/）等浏览器上查看 `Prelaunch` 验证者的状态。
您可以通过在 https://beaconcha.in/ 上搜索公钥，或访问格式为 `https://beaconcha.in/validator/<your-validator-pubkey>` 的链接来观察您的验证者。
```
1 Prelaunch validator(s):

--------------------

Megapool Validator ID:        7
Validator pubkey:             <pubkey>
Validator active:             no
Express Ticket Used:          no

```
<img src="../images/prestaking.png" width="100%" height="auto" />
在您的 `Prelaunch` 验证者被信标链处理并且初始 1 ETH 存款被记入后，您的节点将自动执行 `stake` 交易以完成完整的 32 ETH 信标链存款。`stake` 交易将把您的 `Prelaunch` 验证者推进为 `Staking` 验证者。此时您的 `Staking` 验证者已：
- 向信标链存入 32 ETH
- 分配了验证者索引号
- 在信标链上等待激活

```
1 Staking validator(s):

Megapool Validator ID:        1
Validator pubkey:             <pubkey>
Validator active:             no
Validator index:              <index>
Beacon status:                pending_queued
Express Ticket Used:          no

```
<img src="../images/pending-activation.png" width="100%" height="auto" />

信标链验证者队列的当前状态可以在这里找到：https://www.validatorqueue.com/。一旦您的 `Staking` 验证者在信标链上激活，您将在 `rocketpool megapool validators` 菜单中看到 `Beacon status:                active_ongoing`，确认它已激活并准备好进行验证。

```
1 Staking validator(s):

--------------------

Megapool Validator ID:        0
Validator pubkey:             <pubkey>
Validator active:             yes
Validator index:              <index>
Beacon status:                active_ongoing
Express Ticket Used:          no
```
<img src="../images/activated.png" width="100%" height="auto" />

到这一步您已经完成了！恭喜！您已正式通过 Rocket Pool 创建了一个 megapool 验证者！请查看[监控和维护](/zh/node-staking/maintenance/overview)指南，了解如何监控您的节点并使其保持最佳状态。

## 从 Rocket Pool 存款队列中退出验证者

如果您的验证者一直在队列中等待（快速队列或标准队列）并希望退出队列，您可以这样做！您的 4 ETH 存款将以可兑换等额 rETH 的信用额度退还。步骤相当简单：

首先，检查 `rocketpool megapool validators` 以确定要退出队列的验证者。您需要确保要退出队列的验证者处于 `Initialized` 状态。记下其公钥。在您的验证者被分配 ETH 后，您将无法将其退出队列。
```
1 Initialized validator(s):

--------------------

Megapool Validator ID:        6
Expected pubkey:              <beacon-pubkey>
Validator active:             no
Validator Queue Position:     14
Express Ticket Used:          no
```


使用以下命令从队列中退出验证者，然后进行选择：
```
staker@node:~$ rocketpool megapool exit-queue

Please select a validator to exit the queue:
1: Pubkey: <beacon-pubkey>
```
完成选择并确认您的验证者已退出 Rocket Pool 存款队列后，您可以使用以下命令将信用额度兑换为 rETH：

```
staker@node:~$ rocketpool node withdraw-credit

You have 4.000000 ETH of credit that you can withdraw, receiving the equivalent amount in rETH. Would you like to withdraw the maximum amount of credit? [y/n]
```
就是这样！如果您想存入另一个验证者，这个信用额度除了可以兑换为 rETH 外，还可以兑换为验证者存款。
如果您恰好在已退出（退出队列）的验证者上使用了快速队列票据，您的节点将获得该快速队列票据的退款。

## 创建多个 Megapool 验证者

您节点的 megapool 可以管理任意数量的验证者。如果您想创建额外的验证者（或在同一笔交易中创建多个验证者以节省交易费），您可以使用 `rocketpool megapool deposit` 命令。根据当前区块 gas 限制，一次交易中最多可以创建 35 个验证者。

## 后续步骤

现在您的 megapool 验证者已启动运行，接下来的步骤将引导您了解如何监控节点健康状况、检查和应用更新，以及在整个生命周期内进行维护。

请接下来阅读[监控和维护](/zh/node-staking/maintenance/overview)部分，了解更多相关内容。
