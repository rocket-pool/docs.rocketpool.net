import nimbus_dashboard from "./images/nimbus-dashboard.png";
import tui_checkbox_checked from "./images/tui-checkbox-checked.png";
import tui_checkbox_unchecked from "./images/tui-checkbox-unchecked.png";
import tui_dropdown_closed from "./images/tui-dropdown-closed.png";
import tui_dropdown_open from "./images/tui-dropdown-open.png";
import tui_native_cc_url from "./images/tui-native-cc-url.png";
import tui_native_cc from "./images/tui-native-cc.png";
import tui_native_ec from "./images/tui-native-ec.png";
import tui_native_finished from "./images/tui-native-finished.png";
import tui_native_metrics from "./images/tui-native-metrics.png";
import tui_native_mev from "./images/tui-native-mev.png";
import tui_native_network from "./images/tui-native-network.png";
import tui_native_welcome from "./images/tui-native-welcome.png";
import tui_native_other from "./images/tui-native-other.png";
import tui_native_review from "./images/tui-native-review.png";
import tui_native_settings_home from "./images/tui-native-settings-home.png";
import tui_native_smartnode from "./images/tui-native-smartnode.png";
import tui_textbox from "./images/tui-textbox.png";

# 配置 Smartnode 堆栈(Native 模式)

在本节中,我们将介绍如果您使用完全不使用 Docker 的 **Native 设置**来配置 Smartnode 的各种方法。

::: warning 注意
如果您使用基于 Docker 的设置,请访问 [Docker 配置指南](./config-docker)。
:::

有三种配置方法:

- 通过[向导 UI](#通过向导配置) - 这是最简单的方法。它只会问您几个基本问题,并对其余部分使用经过充分测试的默认值。这是您首次运行 `rocketpool service config` 时看到的内容。
- 通过[设置管理器 UI](#通过设置管理器配置) - 这使您可以访问 Smartnode 的所有设置,因此您可以根据需要自定义所有内容。
- 通过[命令行](#通过命令行配置)无头配置 - 这是为在无头(非交互式)环境中运行 Smartnode 并需要自动配置的用户提供的选项。

从上面的列表中选择您想了解更多的模式,或者简单地向下滚动浏览下面的每个选项。

## 通过向导配置

要配置 Smartnode,运行配置命令:

```shell
rp service config
```

这将启动一个基于终端的 UI,让您快速轻松地配置节点,并提供对 Native 模式相关设置的可选细粒度控制。

::: tip 注意
如果您已经配置过 Smartnode,您将看到[设置管理器](#通过设置管理器配置)。
如果您愿意,可以从那里选择重新打开向导,您所有现有的设置都将为您预选。
:::

当您首次运行配置 UI 时(或者如果您稍后选择再次运行向导),您将看到如下所示的屏幕:

<img src={tui_native_welcome} width="100%" height="auto" />

::: tip 提示
要使用向导,**按`箭头键`(上/下/左/右)在按钮(选项)或文本框等内容之间导航**。
如果您愿意,也可以使用`Tab`和`Shift+Tab` - 它会做同样的事情。

对于按钮,**当前选择的按钮将以绿色突出显示**。
黑色的按钮未被选择。
在上面的截图中,`Next`当前被选中,`Quit`未被选中。

**按`Enter`或`Space`选择按钮**,类似于用鼠标点击它。

如果您改变主意,**按`Escape`返回上一个对话框**。
当您在各个向导页面中前进时,这会派上用场。

**随时按住`Ctrl`并按`C`退出向导而不保存任何内容**。

例如,在上面的屏幕上,您可以按`左`和`右`箭头键在`Next`和`Quit`按钮之间移动。

在选择`Next`时按`Enter`将进入下一个屏幕。
在选择`Quit`时按`Enter`将退出向导而不保存。
:::

准备好开始时,按`Next`。

### 选择网络

在下一个屏幕中,您将被要求选择要使用的网络:

<img src={tui_native_network} width="100%" height="auto" />

您可以使用`上`和`下`箭头键(或`Tab`和`Shift+Tab`)突出显示不同的选项。
当您更改选项时,右侧的**描述**框将显示每个选项的简要描述。
这对向导中所有基于选择的页面都是如此,而不仅仅是网络选择,因此您会经常看到这种风格的页面。

如果您想在 Hoodi 测试网络上练习运行 Rocket Pool 节点,使用可以免费获得的假 ETH 和 RPL,请选择 **Hoodi Testnet**。

如果您准备在主网上创建真正的 Rocket Pool 节点以赚取真正的奖励,请选择 **Mainnet**。

### 执行客户端设置

下一个屏幕将提示您输入执行客户端的基于 HTTP 的 RPC API 的 URL:

<img src={tui_native_ec} width="100%" height="auto" />

如果您计划在与 Smartnode 相同的机器上运行执行客户端,请在此处输入 `http://127.0.0.1:8545`(在本指南的其余部分中,我们将假设这是您计划做的)。
但是,如果您已经在其他地方设置了执行客户端,请改用其 URL。

请注意,您随时可以通过再次运行 `rp service config` 来更改此设置。

### 共识客户端设置

接下来,您将被问到您正在使用(或计划使用)哪个共识客户端。
因为每个共识客户端的行为略有不同,Smartnode 需要知道您使用的是哪一个,以便相应地调整其自身行为。
从以下屏幕的列表中选择您的客户端:

<img src={tui_native_cc} width="100%" height="auto" />

接下来,您将看到一个屏幕,提示您输入客户端的 API URL:

<img src={tui_native_cc_url} width="100%" height="auto" />

如果您计划在与 Smartnode 相同的机器上运行共识客户端的 Beacon Node,请在此处输入 `http://127.0.0.1:5052`(在本指南的其余部分中,我们将假设这是您计划做的)。
但是,如果您已经在其他地方设置了 Beacon Node,请改用其 URL。

### 其他设置

下一个屏幕将有一些其他杂项设置:

<img src={tui_native_other} width="100%" height="auto" />

除非您决定为 Smartnode 安装使用 `/srv/rocketpool` 以外的目录,否则将这些保留为默认选项。

### 回退客户端

从 Smartnode 堆栈的 1.5.0 版本开始,您可以提供一个"回退"执行客户端和共识客户端对,如果您的主要客户端离线(例如因为您使用 Geth 并需要修剪它),它们可以接管。
在这种情况下,您的主节点机器仍将负责使用您的 minipool 的验证器密钥进行证明和提议区块,但它将连接到外部机器以与执行层和 Beacon 链交互。

[要了解有关回退节点的更多信息,请参阅本节](./fallback)并在完成后返回这里。

### 指标

Rocket Pool 能够与 Prometheus 和 Grafana 集成,生成方便的基于 Web 的仪表板,让您一目了然地观察节点的健康状况:

<img src={nimbus_dashboard} width="100%" height="auto" />

向导中的最后一个问题将询问您是否要启用此功能:

<img src={tui_native_metrics} width="100%" height="auto" />

如果选择启用它,您将在稍后的过程中的[设置 Grafana 仪表板](./grafana.mdx)部分了解有关如何设置和使用它的更多信息。

::: warning 注意
此系统收集的所有数据**都保留在您的机器上**。
Rocket Pool 不会收集任何遥测数据或将其发送到单独的服务。
它纯粹是为您提供的,以便您可以监控自己的节点!
:::

### MEV 配置

自 2022 年 9 月执行层和共识层合并以来,Ethereum 验证者现在能够赚取优先费并参与最大可提取价值(简称 MEV)。

从 Smartnode v1.7.0 开始,MEV 现在是_选择退出_,因此在初始设置过程中会显示有关配置它的通知,如您在下一个屏幕中所见:

<img src={tui_native_mev} width="100%" height="auto" />

[请阅读我们的 MEV 指南,了解有关 MEV、其配置以及在向导的此部分中应该做什么的更多信息。](./mev.mdx)
完成后返回这里。

### 完成

在这个问题之后,您已经完成了 Smartnode 配置的设置。
您将看到以下对话框:

<img src={tui_native_finished} width="100%" height="auto" />

如果您对设置满意并准备启动 Smartnode,请单击此处的`Save and Exit`。

如果您还没有完成安装 Rocket Pool,现在返回 Native 设置指南。
否则,下一步是使用以下命令重新启动守护进程服务:

```shell
sudo systemctl restart rp-node rp-watchtower
```

如果您想查看所有设置并自定义向导中未包含的许多其他设置,请单击`Review All Settings`并转到[下一节](#通过设置管理器配置)。

## 通过设置管理器配置

如果您已经运行过 `rp service config`,您将看到**设置管理器**屏幕,而不是向导:

<img src={tui_native_settings_home} width="100%" height="auto" />

此屏幕有三个主要功能:

1. **类别列表**,让您深入了解与 Native 模式相关的 Smartnode 堆栈的每个类别的设置
2. **查看更改并保存**按钮,当您准备查看已更改的设置并保存更新的配置时可以使用
3. **打开配置向导**按钮,如果您更喜欢该界面,它将带您进入[设置向导](#通过向导配置)

::: tip 提示
要使用设置管理器,**按`箭头键`(上/下/左/右)在主页中的选项之间导航**。

按`Tab`在屏幕底部的类别列表(1)和按钮(2 和 3)**之间切换**。
当前选择的按钮将**以绿色突出显示**。

**按`Enter`或`Space`选择按钮**,类似于用鼠标点击它。

**随时按住`Ctrl`并按`C`退出设置管理器而不保存任何内容**。
:::

当您在类别列表中滚动时,每个选项都会在屏幕右侧的**描述框**中显示有用的描述。
随意探索它们;在您通过**查看更改并保存**按钮进入查看对话框之前,您所做的任何操作都不会被保存,并且您可以随时按**Ctrl+C**退出而不保存,因此您不会因为在这里使用设置而意外搞砸什么。

### 配置设置

从主屏幕,使用`Enter`键选择任何类别以查看该类别的设置。
例如,这是**Smartnode 和 TX 费用**类别的屏幕:

<img src={tui_native_smartnode} width="100%" height="auto" />

使用`箭头键`在设置之间上下移动。
当前选择的设置在末尾会有一个白色方块(如果是文本框或复选框),或者以白色突出显示(如果是下拉菜单)。

完成后按`Escape`返回设置管理器的主屏幕。

当您在设置中滚动时,每个设置都会在右侧的**描述框**中显示其功能的简要描述。
它还会在那里显示**默认值**,以防您想将其恢复为出厂设置。

在此示例中,**RPL Claim Gas Threshold**设置当前被选中(在屏幕左侧用绿色框突出显示)。
它已更改为`40`,但您可以在右上角(描述框的顶部)看到它的默认值为`150`。

::: tip 提示
提醒一下,在您通过**查看更改并保存**按钮进入查看对话框之前,不会将任何内容保存到磁盘。
鼓励您探索所有设置以了解它们。
:::

### 设置类型及其使用方法

设置管理器使用以下设置类型和 UI 元素:

#### 文本框

文本框用于输入任意文本字符串或数字。
它们看起来像这样:

<img src={tui_textbox} width="100%" height="auto" />

在其中输入您想要的值,然后**按`Enter`或使用`箭头键`导航到其他设置以保存您的更改。**
如果不这样做,设置管理器将假定您仍在更新该设置,并且还不会将其标记为已更改。

#### 下拉菜单

下拉菜单用于从选项列表中选择一个选项。
它们看起来像这样(当它们打开时):

<img src={tui_dropdown_open} width="100%" height="auto" />

**绿色**项是当前选择的项。
使用`箭头键`更改选项 - 当您这样做时,右侧的**描述框**将更新以告诉您有关当前选定选项的更多信息。
当您对选择满意时,按`Enter`选择所选选项,下拉菜单将关闭,显示当前选择的选项:

<img src={tui_dropdown_closed} width="100%" height="auto" />

#### 复选框

复选框用于简单的是/否问题。
它们看起来像这样:

<img src={tui_checkbox_checked} width="100%" height="auto" />

当它们被选中时,如您在上面看到的,中间会有一个`X`。
当它们_未选中_时,它们只是空白的,如下所示:

<img src={tui_checkbox_unchecked} width="100%" height="auto" />

要更改设置,只需选择它并按`Enter`。

### 保存更改

当您对更改满意并想在保存之前查看它们时,按主屏幕上的**查看更改并保存**按钮。
提醒一下,要访问它,请按`Tab`键。

您将看到如下所示的视图:

<img src={tui_native_review} width="100%" height="auto" />

这里的**查看框**将显示您更改的所有设置,显示旧值和新值。
例如,这里的第一行显示**RPL Claim Gas Threshold**过去是`150`,现在已更改为`40`。

::: tip 注意
此时,您的更改**仍未保存**。
如果您想返回并修改某些内容,请按`Escape`返回主屏幕。
:::

当您对更改满意时,按`Enter`将新配置保存到磁盘。
然后您将退出终端 UI 并看到此消息:

```
Your changes have been saved!
Please restart your daemon service for them to take effect.
```

如果您还没有完成安装 Rocket Pool,现在返回 Native 设置指南。
否则,现在您可以使用以下命令重新启动守护进程服务:

```shell
sudo systemctl restart rp-node rp-watchtower
```

## 通过命令行配置

如果您在无法与终端 UI 交互的无头环境中使用 Smartnode,您可以通过命令行配置节点。

`rocketpool service config` 命令接受作为参数的每个设置,这些设置通常可以通过终端 UI 进行配置。
运行以下命令查看它们的列表(请注意,它相当长):

```
rocketpool service config --help
```

输出将如下所示:

```
NAME:
   rocketpool service config - Configure the Rocket Pool service

USAGE:
   rocketpool service config

OPTIONS:
   --executionClientMode value  Choose which mode to use for your Execution client - locally managed (Docker Mode), or externally managed (Hybrid Mode).
                                Type: choice
                                Options: local, external
 (default: "local")
   --executionClient value  Select which Execution client you would like to run.
                            Type: choice
                            Options: geth, infura, pocket
 (default: "geth")
   --useFallbackExecutionClient         Enable this if you would like to specify a fallback Execution client, which will temporarily be used by the Smartnode and your Consensus client if your primary Execution client ever goes offline.
                                        Type: bool

...
```

每个选项都将有其名称、类型、默认值以及(如果是选择参数)其选项。
使用此文本,您可以找到要设置的选项,并通过适当的参数指定它们。

::: tip 注意
此命令建立在您现有配置的基础上,因此如果您已经保存了一些设置并且只想修改其他设置,则无需重复它们。
它只会更新您作为此命令的参数包含的设置。
:::

如果您还没有完成安装 Rocket Pool,现在返回 Native 设置指南。
否则,下一步是使用以下命令重新启动守护进程服务:

```shell
sudo systemctl restart rp-node rp-watchtower
```
