import { Tab, Tabs } from "@rspress/core/theme";
import mm_add_hoodi from "./images/mm_add_hoodi.png";
import mm_network from "./images/mm_network.png";
import mm_network_main from "./images/mm_network_main.png";
import mm_add_token from "./images/mm_add_token.png";
import rp_test_site from "./images/rp_test_site.png";

# 直接通过 Rocket Pool 质押

## 概述

Rocket Pool 的质押界面现在提供两种不同的 ETH 和 rETH 转换路线：

1. **协议路线** - 直接与 Rocket Pool 智能合约交互
2. **CoW Swap 路线** - 具有 MEV 保护的去中心化交易所聚合器（仅限主网）

界面会根据当前市场状况和流动性可用性自动推荐最佳路线。

<video controls="controls" src="https://cdn-rocketpool.s3.us-west-2.amazonaws.com/stake_options.mp4" />

## 路线选项说明

### 协议路线

**工作原理：** 直接与 Rocket Pool 的存款池和链上智能合约交互。

**优点：**

- 即时执行
- 基于当前 rETH/ETH 比率的可预测汇率
- 不需要中间代币（直接 ETH ↔ rETH 转换）
- 复杂度较低
- 始终获得与您的 ETH 价值完全相符的 rETH（减去 0.05% 存款费）
- 无滑点、无流动性问题、无夹心攻击或抢跑

**限制：**

- 质押时受存款池限制
- 取消质押时受流动性可用性限制
- 交易需要 gas 费用
- 对于小额交易，gas 费用可能很昂贵

### CoW Swap 路线（仅限主网）

**工作原理：** 使用 CoW 协议的批量拍卖系统在多个 DEX 中找到最佳价格。

**优点：**

- MEV（最大可提取价值）保护，防止夹心攻击
- 无 gas 执行 - 您只需签署订单
- 通过 DEX 聚合通常提供更好的汇率
- 无论协议存款池限制如何，始终可用
- 交易本身无 gas 费用

**限制：**

- 需要 WETH 包装/解包步骤（自动处理）
- 订单可能需要 2-5 分钟执行
- 如果在时间限制内未匹配，订单可能会过期
- 需要一次性代币批准

## 关键概念

### WETH（包装 ETH）

使用 CoW Swap 时，界面会自动处理 WETH 转换：

- WETH 是以标准化格式表示 ETH 的 ERC-20 代币
- 1 WETH 始终等于 1 ETH
- 界面在交易前将 ETH 包装为 WETH，之后解包
- 您只需为初始包装支付 gas（一次性）

### 滑点容差

对于 CoW Swap 订单：

- 默认值：0.5%
- 可根据您的偏好调整
- 滑点越高 = 越有可能执行
- 滑点越低 = 更好的价格保护

### 订单到期

CoW Swap 订单有时间限制：

- 默认值：30 分钟
- 可从 5 分钟调整到 24 小时
- 如果未执行，订单会自动取消

### 更好汇率指示器

界面显示哪条路线提供更好的价值：

- 绿色徽章显示"好 X%"表示最佳路线
- 自动预选最佳选项
- 随着市场状况的变化实时更新

### 协议流动性

取消质押 rETH 时：

- 协议路线需要存款池中有可用的 ETH
- 当池为空时显示"流动性不足"
- 当协议流动性不可用时，自动通过 CoW Swap 路由

## 入门

<div className="p-3">
  <Tabs>
    <Tab label="在 Hoodi 测试网上准备">
      <p className="rspress-directive danger">
        <p className="rspress-directive-title">警告</p>
        在测试网络上练习质押时，您**无需在此过程中提供任何真实的 ETH**。
        您将获得**假的测试 ETH** 来使用。

        **不要尝试将您在主网上的真实 ETH 移至测试网，否则您将永久失去它！**
      </p>

      如果您还没有安装 [MetaMask](https://metamask.io/)，请先安装。
      按照他们网站上的说明安装扩展程序、创建账户并登录。

      接下来，使用浏览器工具栏中的图标打开 MetaMask 面板。

      您需要将 Hoodi 测试网添加到 MetaMask。

      点击左上角的下拉菜单并点击"添加网络"按钮。

      您将看到一个网络列表，Hoodi 不在此列表中，因此点击"手动添加网络"按钮。

      填写以下详细信息：

      ```
      Network Name: Hoodi
      New RPC Url: https://rpc.hoodi.ethpandaops.io
      Chain ID: 560048
      Currency Symbol: ETH
      Block Explorer Url: https://hoodi.etherscan.io
      ```

      然后点击保存。您现在应该在左上角的下拉菜单中看到 Hoodi 网络。

      点击 Metamask 扩展程序左上角的**网络下拉菜单**并选择 **Hoodi Test Network**。

      最后，将 rETH 代币添加到 MetaMask，以便您可以查看余额并访问它进行交易。
      点击 **Assets** 标签，然后点击 **Add Token**：

      <img src={mm_add_token} width="100%" height="auto" />

      确保在此对话框中选择了 **Custom Token**。
      在 **Token Contract Address** 框中，输入以下值：

      ```
      0x7322c24752f79c05ffd1e2a6fcb97020c1c264f1
      ```

      **Token Symbol** 应该自动填充为 `rETH`，**Decimals of Precision** 应该自动填充为 `18`。

      接受其余的提示，然后您将看到 rETH 代币出现在您的列表中。

      现在您在 MetaMask 中有了钱包地址，您需要用一些测试 ETH 填充它。
      前往[使用测试网络进行练习](../node-staking/testnet/overview#getting-test-eth-on-hoodi)页面，快速了解如何使用测试网水龙头在 Hoodi 上获取一些测试 ETH。

      一旦您有一些 Hoodi ETH 可以测试，请前往 [https://testnet.rocketpool.net/](https://testnet.rocketpool.net/)。

      **注意：** 测试网仅支持协议路由。CoW Swap 仅在主网上可用。
    </Tab>
    <Tab label="在以太坊主网上准备">
      如果您还没有安装 [MetaMask](https://metamask.io/)，请先安装。
      按照他们网站上的说明安装扩展程序、创建账户并登录。

      接下来，使用浏览器工具栏中的图标打开 MetaMask 面板。
      点击顶部的**网络下拉菜单**，确保选择了 **Ethereum Mainnet**：

      <img src={mm_network_main} width="100%" height="auto" />

      最后，将 rETH 代币添加到 MetaMask，以便您可以查看余额并访问它进行交易。
      点击 **Assets** 标签，然后点击 **Add Token**：

      <img src={mm_add_token} width="100%" height="auto" />

      确保在此对话框中选择了 **Custom Token**。
      在 **Token Contract Address** 框中，输入以下值：

      ```
      0xae78736Cd615f374D3085123A210448E74Fc6393
      ```

      **Token Symbol** 应该自动填充为 `rETH`，**Decimals of Precision** 应该自动填充为 `18`。

      接受其余的提示，然后您将看到 rETH 代币出现在您的列表中。

      现在您在 MetaMask 中有了钱包地址，您需要向其中转入一些 ETH。
      您需要从现有钱包提供此资金或在交易所购买 ETH。

      一旦您有一些 ETH 可以质押，请前往 [https://stake.rocketpool.net/](https://stake.rocketpool.net/)。
    </Tab>

  </Tabs>
</div>

## 质押 ETH 换取 rETH

到达质押网站后，点击 **connect wallet** 按钮。请仔细阅读并接受服务条款和隐私政策，这将启用不同的连接方式，然后点击 **connect metamask**。

MetaMask 将提示您选择要连接到网站的账户。选择一个，确认一些权限，您将看到您的余额在 UI 中更新。

### 步骤 1：输入金额

在 **Stake ETH** 输入字段中输入您想要质押的 ETH 金额。

[图片占位符：输入正在输入金额的字段]

### 步骤 2：查看路线选项

界面将显示两个路线选项（仅限主网）：

- **协议卡片：** 显示存款池是可用还是已满
- **CoW Swap 卡片：** 显示预估输出和汇率比较

更好的选项将用绿色"好 X%"徽章突出显示并自动选择。

[图片占位符：显示比较的路线卡片]

### 步骤 3：配置设置（仅限 CoW Swap）

如果使用 CoW Swap，您可以选择：

- 调整滑点容差（默认 0.5%）
- 设置订单到期时间（默认 30 分钟）

### 步骤 4：执行交易

<div className="p-3">
  <Tabs>
    <Tab label="通过协议">
      点击 **Stake via Protocol** 按钮。

      MetaMask 将提示您：
      1. **批准交易**，显示 gas 费用
      2. **确认交易**

      ::: danger 重要
      在批准之前检查总 gas 成本 - 如果相对于您的质押金额非常昂贵，请考虑使用 CoW Swap！
      :::

      确认后，交易将被挖掘，您将立即收到 rETH。

      <video controls="controls" src="https://cdn-rocketpool.s3.us-west-2.amazonaws.com/protocol_stake.mp4" />
    </Tab>
    <Tab label="通过 CoW Swap">
      点击 **Stake via CoW Swap** 按钮。

      该过程涉及几个自动化步骤：

      1. **WETH 包装**（如果需要）
      - 批准 ETH 到 WETH 的转换
      - 需要一次性 gas 费用

      2. **WETH 批准**（仅限第一次）
      - 批准 CoW 协议使用您的 WETH
      - 需要一次性 gas 费用

      3. **签署订单**
      - 查看订单详情
      - 使用 MetaMask 签署（无 gas）
      - 无 gas 费用

      4. **订单执行**
      - 在模态窗口中监控进度
      - 典型等待时间：2-5 分钟
      - 可以关闭模态窗口并继续浏览

      5. **完成**
      - rETH 自动出现在钱包中
      - 如果需要，可以在 Etherscan 上查看

      <video controls="controls" src="https://cdn-rocketpool.s3.us-west-2.amazonaws.com/cowswap_stake.mp4" preload="auto"/>
    </Tab>

  </Tabs>
</div>

::: tip 注意
收到的 rETH 少于您投入的 ETH 是**完全正常的**。rETH 和 ETH 有一个**动态汇率**：随着 Rocket Pool 网络赚取奖励，1 rETH 的价值会超过 1 ETH。
:::

## 取消质押 rETH 换取 ETH

当您准备取消质押并将 rETH 交易回 ETH 时，请返回质押网站并点击**交换方向按钮**以切换到取消质押模式：

### 步骤 1：输入金额

在 **Unstake rETH** 字段中输入您想要取消质押的 rETH 金额。

### 步骤 2：检查路线可用性

界面将显示：

- 存款池中可用的**协议流动性**
- **协议卡片**状态（可用或"流动性不足"）
- **CoW Swap 卡片**，显示预估的 ETH 输出

### 步骤 3：执行取消质押

<div className="p-3">
  <Tabs>
    <Tab label="通过协议">
      如果协议流动性可用：

      1. 点击 **Unstake via Protocol**
      2. 在 MetaMask 中确认交易
      3. 支付 gas 费用
      4. 立即收到 ETH

      ::: warning 注意
      仅当存款池有足够的 ETH 时，才能进行协议取消质押。如果您看到"流动性不足"，请改用 CoW Swap。
      :::

      <video controls="controls" src="https://cdn-rocketpool.s3.us-west-2.amazonaws.com/unstake_mainnet.mp4" preload="auto"/>
    </Tab>
    <Tab label="通过 CoW Swap">
      CoW Swap 始终可用于取消质押：

      1. **rETH 批准**（仅限第一次）
      - 为 CoW 协议批准 rETH
      - 一次性 gas 费用

      2. **签署订单**
      - 查看详情
      - 签署订单（无 gas）

      3. **订单执行**
      - 在模态窗口中监控
      - 2-5 分钟等待

      4. **WETH 解包**（自动）
      - 从交换中接收 WETH
      - 自动解包为 ETH
      - ETH 出现在钱包中

      <video controls="controls" src="https://cdn-rocketpool.s3.us-west-2.amazonaws.com/cowswap_unstake.mp4" preload="auto"/>
    </Tab>

  </Tabs>
</div>

## 故障排除

### 常见问题

#### 订单过期（CoW Swap）

您的订单未在时间限制内执行。

**解决方案：**

- 增加订单到期时间（最多 24 小时）
- 将滑点容差调高
- 使用当前市场价格重试
- 如果可用，使用协议路线

#### 余额不足

没有足够的 ETH/rETH 进行交易。

**解决方案：**

- 检查钱包余额
- 考虑 gas 费用（协议路线）
- 减少质押/取消质押金额

#### 池已满（协议质押）

存款池已达到其限制。

**解决方案：**

- 使用 CoW Swap 路线（自动选择）
- 等待节点运营商从池中提取 ETH
- 稍后再检查可用性

#### 流动性不足（协议取消质押）

存款池中没有足够的 ETH 用于取消质押。

**解决方案：**

- 使用 CoW Swap 路线（自动选择）
- 无论池状态如何，始终可用

### 手动 WETH 转换

如果您有未自动解包的 WETH：

1. 访问 [swap.cow.fi](https://swap.cow.fi)
2. 连接您的钱包
3. 交换 WETH → ETH（1:1 比率，无 gas）

或使用 Etherscan：

1. 转到 WETH 合约：`0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2`
2. 将钱包连接到"Write Contract"
3. 使用 `withdraw` 函数
4. 以 Wei 输入金额
5. 执行交易

## 最佳实践

### 获得最佳汇率

- 让界面自动选择最佳路线
- 在网络活动较少时检查，以获得更好的协议可用性
- 对于大额交易，CoW Swap 通常提供更好的汇率
- 仔细调整滑点以平衡执行可能性与价格

### 安全性

- 验证您在正确的网站上：[https://stake.rocketpool.net](https://stake.rocketpool.net)
- 从小额测试金额开始
- 在确认之前查看所有交易详情
- 保留一些 ETH 用于 gas 费用
- 仅批准受信任的合约

### Gas 优化

- 比较路线之间的 gas 成本
- 尽可能批量处理交易
- 对于小额交易使用 CoW Swap 以避免高额 gas 费用
- 在 [etherscan.io/gastracker](https://etherscan.io/gastracker) 监控 gas 价格

## 税务影响

::: warning 重要
本节仅提供一般教育信息。税法因司法管辖区和个人情况而异。**始终咨询合格的税务专业人士**以获取针对您情况的建议。
:::

### 了解 rETH 和税务

在 Rocket Pool 质押时，了解潜在的税务影响至关重要：

#### 质押交易（ETH → rETH）

**潜在税务事件：**

- **代币交换：** 在许多司法管辖区，将 ETH 转换为 rETH 可能被视为应税事件
- **资本利得/损失：** 如果您的 ETH 自获取以来升值，您可能需要缴纳资本利得税
- **成本基础：** 收到的 rETH 的价值成为您未来交易的新成本基础

**示例场景：**

```
以 $1,000 购买 1 ETH
当 ETH 价值 $2,000 时质押
潜在应税收益：$1,000
您的 rETH 成本基础：$2,000
```

#### 持有 rETH（赚取奖励）

**rETH 如何升值：**

- rETH 相对于 ETH 的价值自动增加
- 不会收到新代币 - 代币本身升值
- 这种升值代表您的质押奖励

**税务处理各不相同：**

- **某些司法管辖区：** 仅在实现时（出售/交换时）对升值征税
- **其他司法管辖区：** 可能每年对未实现收益征税
- **收入与资本利得：** 分类影响税率

#### 取消质押交易（rETH → ETH）

**税务考虑：**

- 将 rETH 转换回 ETH 通常是应税事件
- 根据以下内容计算收益/损失：
- **成本基础：** 您获得 rETH 时的价值
- **处置价值：** 转换回 ETH 时的价值
- 差额是您的资本利得或损失

### 路由方法税务影响

#### 协议路线

- 每笔交易一个应税事件
- 清晰的时间戳和税务记录价值
- 链上交易提供永久记录

#### CoW Swap 路线

- WETH 包装/解包通常不应税（1:1 转换）
- 主要交换（ETH/WETH ↔ rETH）是应税事件
- 订单执行提供清晰的税务文档

### 记录保存最佳实践

**必须维护的重要记录：**

1. **每次质押：**

- 交易日期和时间
- 质押的 ETH 金额
- 收到的 rETH 金额
- 质押时的 ETH 价格
- 交易哈希
- 支付的 gas 费用

2. **持有期间：**

- rETH/ETH 汇率的定期快照
- 您的 rETH 余额随时间变化
- 关键日期的市场价值（年末等）

3. **每次取消质押：**

- 交易日期和时间
- 取消质押的 rETH 金额
- 收到的 ETH 金额
- 取消质押时的 ETH 价格
- 交易哈希
- 支付的 gas 费用

**跟踪工具：**

- 从 Etherscan 导出交易
- 使用支持 rETH 的投资组合跟踪应用
- 维护包含所有交易的电子表格
- 考虑使用加密税务软件

### 税务优化策略

**时机考虑：**

- **税务损失收获：** 如果您有损失可以抵消收益，请在市场下跌期间取消质押
- **长期与短期：** 许多司法管辖区青睐长期持有（通常 >1 年）
- **年末规划：** 考虑围绕纳税年度边界的交易时机

**成本基础方法：**

- **先进先出（FIFO）：** 许多司法管辖区的默认方法
- **后进先出（LIFO）：** 在某些地区可能可用
- **特定识别：** 如果允许，跟踪特定的 rETH 部分

### 常见税务场景

#### 场景 1：常规质押

```
操作：质押 10 ETH 换取 9.5 rETH
税务事件：处置 ETH，获取 rETH
报告：ETH 处置的资本利得/损失
跟踪：9.5 rETH 具有新的成本基础
```

#### 场景 2：部分取消质押

```
操作：取消质押 5 rETH 换取 5.3 ETH
税务事件：处置 rETH，获取 ETH
报告：rETH 处置的资本利得/损失
跟踪：剩余 rETH 余额和成本基础
```

#### 场景 3：DeFi 集成

```
操作：在 DeFi 协议中使用 rETH
税务事件：每次协议交互可能应税
报告：跟踪所有移动和价值变化
跟踪：收益、交换和流动性提供
```

### 特定司法管辖区的考虑因素

**美国：**

- IRS 将加密货币到加密货币的交换视为应税
- 质押奖励在收到时或出售时可能应税（指导不断发展）
- 使用 8949 表格和附表 D 进行报告

**欧盟：**

- 税务处理因成员国而异
- 一些国家在实现时征税，其他国家每年征税
- 考虑当地的加密货币税收法规

**英国：**

- HMRC 根据情况将质押奖励视为收入或资本利得
- 需要详细的记录保存
- 考虑"床和早餐"规则

**其他司法管辖区：**

- 研究您当地税务机关的加密货币指南
- 许多国家仍在制定框架
- 强烈建议寻求专业建议

### 使用税务软件

**流行的加密税务工具：**

- 大多数支持 rETH 跟踪
- 可以从 Etherscan 导入
- 自动计算收益/损失
- 为您的司法管辖区生成税务报告

**集成提示：**

1. 导入所有钱包地址
2. 验证 rETH/ETH 交易是否正确分类
3. 确保汇率准确
4. 查看计算的收益/损失
5. 导出报告用于报税

### 要避免的危险信号

**常见错误：**

- 不跟踪成本基础
- 忘记报告质押交易
- 忽略小额交易
- 遗漏 DeFi 交互
- 不正确的汇率数据

**审计准备：**

- 保留所有交易记录
- 记录您的计算方法
- 保存汇率来源
- 维护钱包所有权证明
- 在要求的保留期内存储记录

## 常见问题

**问：我应该选择哪条路线？**
答：界面会自动推荐带有绿色"更好汇率"徽章的最佳路线。通常，使用推荐的选项。

**问：为什么 CoW Swap 有时提供更好的汇率？**
答：CoW Swap 聚合来自多个 DEX 的流动性，并使用批量拍卖来找到最优价格，通常可以击败固定的协议汇率。

**问：CoW Swap 真的无 gas 吗？**
答：订单创建和签署无 gas。您只需为初始 WETH 包装和代币批准支付 gas（一次性设置）。

**问：CoW Swap 订单需要多长时间？**
答：通常为 2-5 分钟，但可能因市场状况而异。

**问：如果我的 CoW Swap 订单过期会发生什么？**
答：不会损失任何东西。您的代币仍在您的钱包中。您可以使用调整后的参数下新订单。

**问：为什么协议路线有时不可用？**
答：**质押时：** 存款池已满。**取消质押时：** ETH 流动性不足。这些是临时状态，随着用户与协议的交互而变化。

**问：质押交易应税吗？**
答：在大多数司法管辖区，是的。将 ETH 转换为 rETH 以及反向转换通常是应税事件。请咨询税务专业人士以了解您的具体情况。

**问：我如何跟踪我的 rETH 成本基础？**
答：记录您质押时 ETH 的价值 - 这成为您的 rETH 成本基础。使用交易哈希、时间戳和价格进行准确记录。

**问：在协议和 CoW Swap 路线之间移动对税务有影响吗？**
答：税务处理通常相同 - 两者都涉及将 ETH 交换为 rETH。选择的路线通常不会影响税务义务，尽管记录保存可能略有不同。

## 其他资源

- [Rocket Pool 文档](https://docs.rocketpool.net)
- [CoW Swap 文档](https://docs.cow.fi)
- [Rocket Pool Discord](https://discord.gg/rocketpool)
- [Etherscan Gas 跟踪器](https://etherscan.io/gastracker)

## 合约地址

### 主网

- **rETH Token:** `0xae78736Cd615f374D3085123A210448E74Fc6393`
- **WETH Token:** `0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2`
- **Rocket Storage:** `0x1d8f8f00cfa6758d7bE78336684788Fb0ee0Fa46`
- **CoW Protocol VaultRelayer:** `0xC92E8bdf79f0507f65a392b0ab4667716BFE0110`

### Hoodi 测试网

- **rETH Token:** `0x7322c24752f79c05ffd1e2a6fcb97020c1c264f1`
- 查看 [Rocket Pool 文档](https://docs.rocketpool.net)了解其他 Hoodi 测试网地址。

---

这就是使用 Rocket Pool 质押的全部内容！我们希望您觉得新的路由选项有助于为您的质押获得最佳价值。

欢迎访问[我们的 Discord 服务器](https://discord.gg/rocketpool)，让我们知道您的想法，并随时了解项目的演变。
