# Rocket Pool Redstone 更新

Rocket Pool 的下一个主要更新，名为 **Redstone**，已在 Ropsten 和 Holesky 测试网上发布进行 beta 测试。
本页面描述了 Redstone 带来的主要变化，包括对 Smartnode 堆栈和 Rocket Pool 协议的更新。

请仔细阅读本页面，以了解 Rocket Pool 之前版本与 Redstone 之间的所有差异。

::: tip 注意
有关如何为升级准备节点以及升级后需要做什么的详细信息，请查看以下指南:

- [Docker 模式指南](./docker-migration.mdx)
- [混合模式指南](./hybrid-migration.mdx)
- [原生模式指南](./native-migration.mdx)

:::

## 客户端变化与合并

Ropsten（以及即将到来的 Holesky）已经成功完成了**执行层与共识层的合并**。
它不再使用工作量证明；相反，Ropsten 上的验证者现在负责在两条链上创建和提议区块。
虽然这带来了一些令人兴奋的财务收益（稍后将讨论），但它也对验证者的运作方式带来了一些重要变化。

以下是合并带来的客户端行为变化的简要总结:

- 您的执行客户端现在使用三个 API 端口:
  - 一个用于 HTTP 访问其 API（**默认 8545**）
  - 一个用于 Websocket 访问其 API（**默认 8546**）
  - 一个用于合并后共识客户端使用的新 **Engine API**（**默认 8551**）

- 执行客户端现在需要共识客户端才能运行，共识客户端现在需要执行客户端才能运行。
  - **两者都不能再单独运行。**

- 一个执行客户端必须链接到一个且仅一个共识客户端（反之亦然）。
  - 您将无法将多个执行客户端链接到单个共识客户端，或将多个共识客户端链接到单个执行客户端。
  - 因此，**Rocket Pool 节点运营者不再提供备用执行客户端**。

- 需要**完整的执行客户端**。
  - 任何验证者（无论是 Rocket Pool 还是其他）都不能再使用远程提供商（如 Infura 和 Pocket）。

## 费用接收者和您的分配器

由于验证者现在负责创建区块，这意味着他们会收到附加到每笔交易的**优先费用**（也称为**小费**）。
这些费用以 ETH 支付，每次您的 minipool 验证者提议区块时都会直接提供给您。
与锁定在信标链上的 ETH 不同，**您不必等待提款就能获得优先费用**！
它们只是在区块提议过程中奖励给您。

为了知道将费用发送到哪里，您的验证客户端需要一个额外的参数，称为 `fee recipient`（费用接收者）。
这是执行层（ETH1）上的地址，您的节点在区块提议期间赚取的所有优先费用都将发送到此地址。

Rocket Pool 旨在公平分配这些奖励，就像它公平分配您的信标链奖励一样: 您的 minipool 验证者赚取的任何优先费用的一半将归您（加上您所有 minipool 的平均佣金），另一半将归池质押者（减去您的平均佣金）。

为此，Smartnode 将自动将您的验证客户端的 `fee recipient` 设置为一个特殊地址，称为您节点的**费用分配器**。
您的费用分配器是执行层上的一个独特合约，**专属于您的节点**。
它将持有您随时间赚取的所有优先费用，并包含公平分割和分配它们所需的逻辑。
此分配过程由您（节点运营者）控制，可以随时进行。
它没有时间限制。

您节点的费用分配器地址**基于您的节点地址确定性生成**。
这意味着它是提前知道的，甚至在费用分配器创建之前。
**Smartnode 将使用此地址作为您的费用接收者。**

::: tip 注意
默认情况下，当您安装 Smartnode v1.5.0 时（如果 Redstone 合约更新尚未部署），您的费用接收者将设置为 **rETH 地址**。
一旦部署 Redstone 更新，Smartnode 将自动将其更新为您节点的费用分配器地址。

此规则的一个例外是如果您选择加入 **Smoothing Pool** - 有关它的更多信息，请参阅本页面末尾的部分。
:::

新的 Rocket Pool 节点将在注册时自动初始化其节点的分配器合约。
现有节点需要手动执行此过程。
这只需要运行一次。

这带来的一个有趣后果是，您的分配器地址可能会在**初始化**节点分配器合约之前开始累积余额。
这没关系，因为您的分配器一旦初始化，就会获得所有这些现有余额的访问权限。

您可以查看费用分配器的余额，作为以下命令的一部分:

```shell
rocketpool node status
```

输出将如下所示:

![](../../node-staking/images/status-fee-distributor.png)

要初始化节点的分配器，只需运行此新命令:

```shell
rocketpool node initialize-fee-distributor
```

::: warning 注意
在 Redstone 更新后，您必须先调用此函数，然后才能使用 `rocketpool node deposit` 创建任何新的 minipool。
:::

初始化分配器后，您可以使用以下命令领取并分配其全部余额:

```shell
rocketpool node distribute-fees
```

这将把您那份奖励发送到您的**提款地址**。

## Rocket Pool 协议变化

除了执行和共识客户端的变化以及新的优先费用外，Rocket Pool 协议本身也经历了一些您应该了解的重要变化。

### 新的奖励系统

Redstone 更新引入的最重要变化之一是**新的奖励系统**。
这是对节点运营者接收 RPL 奖励（以及来自 Smoothing Pool 的 ETH - 稍后讨论）方式的全面改革。

*旧*奖励系统存在以下缺点:

- 领取成本约 400k gas，这相当昂贵。
- 节点运营者必须在每个间隔（每 28 天）领取奖励，否则将失去它们。这意味着对于拥有少量 RPL 的节点运营者来说，gas 成本可能变得高得令人望而却步。
- 奖励是在*领取*时确定的，而不是在检查点时。如果用户在检查点和您的领取之间质押了大量 RPL，您的奖励可能会被稀释，您收到的 RPL 会少于预期。

*新*的领取系统解决了所有这些问题。

在每个间隔，Oracle DAO 将共同创建 Rocket Pool 网络中节点运营者状态的**真实快照**，包括他们所有的有效质押金额。
此信息被编译成[默克尔树](https://en.wikipedia.org/wiki/Merkle_tree) - 一种将所有细节提供给智能合约的极其高效的方式。
默克尔树被构建成 JSON 文件并托管在[星际文件系统（IPFS）](https://en.wikipedia.org/wiki/InterPlanetary_File_System)上，默克尔树的根被提交到合约。

这个新系统具有以下特点:

- 您现在可以**让奖励累积**任意长时间。不再有何时需要领取的时间限制。
- 您可以一次领取**多个间隔**。
- 您的第一笔领取交易使用约 85k gas。后续每笔领取交易成本约 55k gas。
  - 如果您一次领取多个间隔，每个额外间隔成本**6k gas**，因此一次领取尽可能多的间隔最具成本效益。
- 您的 RPL 奖励**不再被稀释** - 您的 RPL 奖励在快照时固定，您始终有资格获得该数量。
- 您可以**重新质押部分（或全部）RPL 奖励**作为领取交易的一部分，这进一步减少了与今天相比的 gas 需求。
- 目前，**您的所有领取都必须在主网上进行**，但我们已经建立了基础设施，以便日后能够在第二层网络上进行领取。

当您的节点检测到新的奖励检查点时，它将自动下载该间隔的 JSON 文件。
然后您可以使用以下命令查看您的奖励:

```shell
rocketpool node claim-rewards
```

随着间隔的进行和奖励的累积，输出将如下所示:

![](../../node-staking/images/claim-rewards-gb.png)

在这里，您可以快速查看每个间隔赚取了多少奖励，并可以决定要领取哪些奖励。
请注意，**Ropsten 的间隔时间设置为 1 天以便于测试。**

您还可以指定在此领取期间要重新质押的金额:

![](../../node-staking/images/autostake.png)

这将让您在一次交易中复合您的 RPL 奖励，使用的 gas 远少于您今天需要使用的 gas。

::: tip 注意
如果您更喜欢手动构建奖励检查点而不是下载 Oracle DAO 创建的检查点，您可以在 TUI 中将此设置从 `Download` 更改为 `Generate`:

![](../../node-staking/images/tui-generate-tree.png)

如提示所述，您需要访问归档节点才能执行此操作。
如果您的本地执行客户端不是归档节点，您可以在下面的 `Archive-Mode EC URL` 框中指定一个单独的节点（如 Infura 或 Alchemy）。
此 URL 仅在生成默克尔树时使用；它不会用于验证职责。
:::

::: danger 警告
如果您*在快照时*低于 10% 的 RPL 抵押品，您将没有资格获得该快照的奖励。
与当前系统不同，在当前系统中您可以在领取前简单地"充值"以再次获得资格，这将在该快照中永久锁定，**您将永远不会获得该期间的奖励**。
您**必须**在快照时高于 10% 的抵押品才能获得该期间的奖励。
:::

### Smoothing Pool

Redstone 更新的最后一个令人兴奋的新功能是 **Smoothing Pool**。
Smoothing Pool 是一个**可选功能**，将汇集选择加入其中的每个成员的优先费用。
在奖励检查点期间，池的总 ETH 余额被分为池质押者部分和节点运营者部分。
节点运营者部分的所有奖励都**公平分配给池的每个成员**。

本质上，Smoothing Pool 是一种有效消除与信标链上区块提议相关的随机性的方法。
如果您曾经经历过一连串的坏运气，几个月都没有提议，您可能会发现 Smoothing Pool 非常令人兴奋。

::: tip 注意
Smoothing Pool 奖励被构建到用于 RPL 奖励的默克尔树中，因此您在使用 `rocketpool node claim-rewards` 领取 RPL 的同时领取它们。
:::

为了帮助澄清细节，Smoothing Pool 使用以下规则:

- 选择加入 Smoothing Pool 是在**节点级别**完成的。如果您选择加入，您的所有 minipool 都会选择加入。

- 节点运营者的总份额由选择加入 Smoothing Pool 的每个节点中每个 minipool 的平均佣金确定。

- 任何人都可以随时选择加入。他们必须等待完整的奖励间隔（Ropsten 上 1 天，主网上 28 天）才能选择退出，以防止操纵系统。
  - 一旦退出，您必须再等待一个完整间隔才能重新加入。

- Smoothing Pool 计算选择加入的每个节点拥有的每个 minipool 的"份额"（间隔内池 ETH 的部分）。
  - 份额是您 minipool 在间隔期间的表现（通过查看您在信标链上发送了多少认证以及错过了多少）以及您 minipool 的佣金率的函数。

- 您节点的总份额是您 minipool 份额的总和。

- 您节点的总份额按您选择加入的时间量缩放。
  - 如果您选择加入了整个间隔，您将获得完整份额。
  - 如果您选择加入了 30% 的间隔，您将获得完整份额的 30%。

要选择加入 Smoothing Pool，请运行以下命令:

```shell
rocketpool node join-smoothing-pool
```

这将在 Rocket Pool 合约中记录您已选择加入，并自动将您的验证客户端的 `fee recipient` 从您节点的分配器合约更改为 Smoothing Pool 合约。

要离开池，请运行此命令:

```shell
rocketpool node leave-smoothing-pool
```

### 惩罚系统

为了确保节点运营者不会通过手动修改验证客户端中使用的费用接收者来"作弊"，Rocket Pool 采用了惩罚系统。

Oracle DAO 持续监控 Rocket Pool 节点运营者产生的每个区块。
任何费用接收者不是以下地址之一的区块都被视为**无效**:

- rETH 地址
- Smoothing Pool 地址
- 节点的费用分配器合约（如果退出 Smoothing Pool）

提议了具有**无效**费用接收者的区块的 minipool 将被发出**警告**。
在第三次警告时，minipool 将开始收到**违规** - 每次违规将扣除**其总信标链余额的 10%，包括 ETH 收益**，并在从 minipool 提取资金时将它们发送给 rETH 池质押者。

违规是在 **minipool** 级别，而不是**节点**级别。

Smartnode 软件旨在确保诚实的用户永远不会受到惩罚，即使它必须使验证客户端离线才能做到这一点。
如果发生这种情况，您将停止认证，并且会在日志文件中看到错误消息，说明 Smartnode 无法正确设置您的费用接收者。

## 升级前后指南

有关如何为升级准备节点以及升级后需要做什么的详细信息，请查看以下指南:

- [Docker 模式指南](./docker-migration.mdx)
- [混合模式指南](./hybrid-migration.mdx)
- [原生模式指南](./native-migration.mdx)
