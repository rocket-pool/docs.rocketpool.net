import tailscale_dashboard_client from "./images/tailscale-dashboard-client.png";
import tailscale_dashboard_servers from "./images/tailscale-dashboard-servers.png";

# Tailscale VPN Sunucusu Yapılandırma

::: tip NOT
Bu **isteğe bağlıdır.**
Bu bölümü yalnızca evde bir düğüm çalıştırıyorsanız ve ev ağınızın dışından bağlanmak istiyorsanız dikkate almanız gerekir.
:::

Tatildeyken veya iş gezisindeyken olduğu gibi ev ağınıza uzaktan giriş yapmak istiyorsanız, en yaygın yol bir **Sanal Özel Ağ** sunucusu kullanmaktır.
Bu, SSH portunu internete açmadan, dünyanın her yerinden SSH aracılığıyla düğümünüze giriş yapmanıza **ve** Grafana panonuzu izlemenize olanak tanır.

Birçok Rocket Pool düğüm operatörü bunun için tercih ettikleri VPN sunucusu olarak [Tailscale](https://tailscale.com/blog/how-tailscale-works/) kullanır.
Tailscale, açık kaynaklı bir P2P VPN tüneli ve barındırılan uç nokta keşif hizmetidir.
Makineniz ile düğümünüz arasında uçtan uca şifrelenmiş bir yol oluşturmak için gereken kimlik doğrulama, yayınlama ve NAT geçişini merkezi bir sunucuya hassas trafik göndermeden halleder.
Çok güçlü bir araçtır.

Temel bir yapılandırmasını kısaca ele alacağız, ancak daha fazla ayrıntı için [belgelerini incelemekten](https://tailscale.com/kb/start/) çekinmeyin.

## Tailscale'i Kurma

İlk olarak, ücretsiz bir [Tailscale hesabı](https://tailscale.com/) oluşturun.
Tailscale, Google, GitHub, Okta, Microsoft gibi bir SSO kimlik sağlayıcısının kullanılmasını gerektirir.
Ayrıntılar için [SSO Sayfalarını](https://tailscale.com/kb/1013/sso-providers/) ziyaret edin.

Ek güvenlik için seçtiğiniz kimlik sağlayıcıda 2FA (İki Faktörlü Kimlik Doğrulama) etkinleştirmeniz önerilir.

Ardından, Tailscale'i **istemcinize** - ağınıza bağlanmak istediğiniz makineye - kurmak için [başlangıç kılavuzlarını](https://tailscale.com/kb/1017/install/) izleyin.
Örneğin, bu bir dizüstü bilgisayar veya telefonunuz olabilir.
**Bunun Rocket Pool düğümünüz _olmadığını_ unutmayın!**

Tamamlandığında bilgisayarınızı [Tailscale panosunda](https://login.tailscale.com/admin/machines) 'bağlı' olarak görmelisiniz.

<img src={tailscale_dashboard_client} width="100%" height="auto" />

Şimdi, Tailscale'i **Rocket Pool düğümünüze** kurun.
Bunun için talimatları web sitelerinde bulabilirsiniz; örneğin, işte [Ubuntu için kurulum talimatları](https://tailscale.com/kb/1039/install-ubuntu-2004/).

::: warning NOT
UFW yapılandırılmışsa, ayrıca [UFW Yapılandırma Talimatlarını](https://tailscale.com/kb/1077/secure-server-ubuntu-18-04/) da izlemek isteyeceksiniz.
:::

İlk olarak, Tailscale'in paket imzalama anahtarını ve deposunu **Rocket Pool düğümünüze** ekleyin:

```shell
curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/focal.noarmor.gpg | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg >/dev/null
curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/focal.tailscale-keyring.list | sudo tee /etc/apt/sources.list.d/tailscale.list
```

Şimdi, Tailscale'i **Rocket Pool düğümünüze** kurun:

```shell
sudo apt-get update
sudo apt-get install tailscale
```

Son olarak, makinenizi Tailscale ağınıza kimlik doğrulayın ve bağlayın **Rocket Pool düğümünüzde**:

```shell
sudo tailscale up
```

Bağlandınız!
Tailscale IPv4 adresinizi şunu çalıştırarak bulabilirsiniz:

```shell
tailscale ip -4
```

Artık düğüm makinenizi [Tailscale panosunda](https://login.tailscale.com/admin/machines) eklenmiş olarak görmelisiniz.
Ayrıca pano üzerinden **düğüm makinesinin** adını, örneğin `rocketnode` olarak değiştirebilirsiniz.

<img src={tailscale_dashboard_servers} width="100%" height="auto" />

Düzenli olarak yeniden kimlik doğrulama ihtiyacını önlemek için düğüm makinesi için [anahtar süresini devre dışı bırakmanız](https://tailscale.com/kb/1028/key-expiry) önerilir.

::: tip Not
Düğümünüze rocketnode gibi akılda kalıcı bir ana makine adı kullanarak erişmek istiyorsanız, Tailscale ayarlarında MagicDNS'i etkinleştirerek bunu yapabilirsiniz.
:::

Artık istemcinizde düğümünüze olan SSH oturumundan `exit` yapabilmeli ve Tailscale üzerinden `ssh your.user@rocketnode` kullanarak düğümünüze tekrar SSH yapabilmelisiniz.

::: warning NOT
**Düğüm makinesinde** `/etc/ssh/sshd_config` dosyasında SSH portunu ilk yapılandırdığınızda değiştirdiyseniz, bunun yerine `ssh your.user@rocketnode -p <port numaranız>` kullanın.

Örneğin, SSH'yi 1234 portuna atadıysanız, şunu yaparsınız:

```shell
ssh your.user@rocketnode -p 1234
```

:::

Artık **istemcinizden** Grafana panonuza erişmek için web tarayıcınızda `http://rocketnode:3100` adresini de ziyaret edebilirsiniz.

UFW yapılandırılmışsa, şimdi Tailscale üzerinden gelen tüm SSH bağlantılarını kabul etmek için bir kural ekleyebilirsiniz.

::: danger UYARI
Aşağıdaki adımlar güvenlik duvarı kurallarınızı değiştirecektir.
\*\*Devam etmeden önce düğüm makinesine en az 2 açık SSH oturumunuz olmalıdır - biri yapılandırmayı değiştirmek ve sonrasında test etmek için, diğeri ise değişiklikleriniz SSH'yi bozarsa geri alabilmeniz için yedek olarak oturum açık kalacak!
:::

**Bu komutları düğüm makinesinde çalıştırın.**

Tailscale üzerinden gelen tüm ssh bağlantılarına erişime izin verin.

```shell
sudo ufw allow in on tailscale0
```

Düğümünüzü tamamen kilitlemek için [güvenlik duvarını etkinleştirme](/tr/node-staking/securing-your-node#essential-enable-a-firewall) adımlarından SSH portuna eklenen erişimi de kaldırabilirsiniz.
Tailscale giriş yapmanın tek yolu olacağından yerel ağdan giriş yapamayacağınızı **unutmayın**.
Bununla sorun yoksa yalnızca aşağıdaki komutu çalıştırın.

```shell
sudo ufw delete "22/tcp"
```

Tüm Tailscale olmayan bağlantıları kısıtlamak için güvenlik duvarı kurallarını ayarladıktan sonra UFW ve SSH'yi yeniden başlatın:

```shell
sudo ufw reload
sudo service ssh restart
```

Şimdi, her şeyin beklendiği gibi çalıştığını doğrulayın.
Mevcut SSH oturumlarınızdan birinden `exit` yapın (**ancak ikincisini yedek olarak açık tutmayı unutmayın**).

Ardından, Tailscale IP adresini kullanarak **düğüm makinesine** SSH ile bağlanın:

```shell
ssh your.user@rocketnode
```

Çalışıyorsa, her şeyi doğru yaptınız ve artık yurt dışındayken ev ağınıza güvenle giriş yapabilirsiniz!

::: tip İPUCU
Daha önce yönlendiricinizde düğümünüzün SSH portunu yönlendirdiyseniz, artık kaldırabilirsiniz.
:::
