import { Tab, Tabs } from "@rspress/core/theme";

# Grafana Kontrol Panelini Kurma

Artık node'unuz çalışır durumda olduğuna göre, muhtemelen doğru çalıştığından (ve sizin için ne tür kazançlar ürettiğinden) emin olmak için her şeyi bir bakışta izlemek için kullanışlı bir yönteme sahip olmak isteyeceksiniz.

Bunu yapan birçok araç bulunmaktadır.
En popülerlerinden biri [Grafana](https://grafana.com/) - bir tarayıcı ile erişebileceğiniz, kullanımı kolay, genel amaçlı bir kontrol paneli sistemi.

Rocket Pool, Grafana ve bağımlılıkları için hazır destek ile birlikte gelir; hatta her Consensus client için önceden oluşturulmuş bir kontrol paneli ile birlikte gelir.
Örneğin, işte Hoodi test ağında kontrol panelinin nasıl göründüğünün bir görüntüsü:

![](./images/grafana-1.3.jpg)

Standart kontrol paneli, aşağıdaki bilgileri kullanışlı bir formatta içerir:

- **Sol üst:** makinenizin sağlığı ve performansı hakkında bazı önemli istatistikler ve bekleyen sistem güncellemeleri
- **Sağ üst:** Beacon Chain'deki validator'larınızın etkinliği ve performansı, bazı Execution ve Consensus client istatistikleri ile birlikte
- **Sol alt:** referans için tüm Rocket Pool ağı hakkında detaylar
- **Sağ alt:** hem ETH hem de RPL staking ödülleriniz hakkında detaylar

Bu kılavuzda, bu kontrol panelini kullanabilmeniz için Rocket Pool'un metrik sistemini nasıl etkinleştireceğinizi göstereceğiz - hatta kendinizinkini bile oluşturabilirsiniz!

## Rocket Pool Metrik Yığınına Genel Bakış

Smartnode yapılandırma sürecinde metrikleri etkinleştirmeyi seçerseniz, node'unuz aşağıdaki işlemleri ekleyecektir:

- [Prometheus](https://prometheus.io/) - yukarıda gördüğünüz tüm metrikleri (ve çok daha fazlasını) yakalayan ve saklayan, böylece zaman içinde incelenebilmeleri için bir veri toplama, depolama ve raporlama sistemi
- Prometheus [Node Exporter](https://github.com/prometheus/node_exporter) - makinenizin sağlığı hakkında bilgi toplayan (CPU kullanımı, RAM kullanımı, boş disk alanı ve swap alanı vb.) ve bunu Prometheus'a raporlayan bir servis
- Grafana, Prometheus'un verilerini node'unuzda barındırılan kullanışlı bir web sitesi aracılığıyla sunan araç
- Mevcut İşletim Sistemi güncellemelerini Prometheus'a raporlayacak isteğe bağlı özel bir script seti, böylece sisteminizin yamalanması gerekip gerekmediğini bilirsiniz

Varsayılan yapılandırma, Smartnode'un Docker container'larının geri kalanıyla birlikte yaşayan tüm bu servislere sahip Docker container'ları oluşturacaktır.
Grafana için node makinenizde bir port açacaktır, böylece yerel ağınızdaki herhangi bir makineden bir tarayıcı ile kontrol paneline erişebilirsiniz.

## Metrik Sunucusunu Etkinleştirme

<div className="p-3">
  <Tabs>
    <Tab label="Docker">
      Docker modunda metrikleri etkinleştirmek en kolayıdır.

      Smartnode yapılandırma komutunu tekrar çalıştırarak başlayın:

      ```shell
      rocketpool service config
      ```

      `Monitoring / Metrics` bölümüne gidin ve `Enable Metrics` onay kutusunu işaretleyin.

      Port ayarlarında ince ayar yapmayı tercih edenler için bunu burada yapabilirsiniz.
      Bu portların hepsinin, Grafana portu hariç Docker'ın dahili ağıyla sınırlı olduğunu unutmayın - bu port makinenizde açılacaktır (böylece masaüstünüz veya telefonunuz gibi diğer makinelerden bir tarayıcı ile erişebilirsiniz), bu nedenle varsayılan port zaten sahip olduğunuz bir şeyle çakışıyorsa bunu değiştirmek isteyebilirsiniz.

      Kaydedin ve çıkın, smartnode sizin için Prometheus, Node Exporter ve Grafana Docker container'larını başlatacaktır.

      Ayrıca kendi metriklerini Prometheus'a sunmaları için Consensus ve Validator client'larınızı değiştirecektir.

      İşletim Sistemi ve Rocket Pool güncelleme takipçisi **varsayılan olarak yüklenmez**, maksimum esneklik için, ancak işlem basittir.
      Kontrol panelinizin sisteminiz için kaç güncellemenin mevcut olduğunu göstermesi için yüklemek istiyorsanız, bunu şu komutla yapabilirsiniz:

      ```shell
      rocketpool service install-update-tracker
      ```

      Perde arkasında, bu, İşletim Sisteminizin paket yöneticisine bağlanan, periyodik olarak güncellemeleri kontrol eden ve bu bilgiyi Prometheus'a gönderen bir servis yükleyecektir.
      Bu servis her İşletim Sistemi için farklıdır, ancak aşağıdakilerde çalıştığı onaylanmıştır:

      - Ubuntu 20.04+
      - Debian 9 ve 10
      - CentOS 7 ve 8
      - Fedora 34


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Servisi otomatik olarak etkinleştirmek SELinux ile uyumsuzdur.
        Sisteminizde SELinux varsayılan olarak etkinse (CentOS ve Fedora'da olduğu gibi), yükleme komutu sizi _işin büyük kısmını tamamlayacak_ ancak sonunda süreci manuel olarak nasıl tamamlayacağınız konusunda size talimatlar da verecektir.
      </p>


      Bu kontrol sırasında, ayrıca yüklü Rocket Pool Smartnode sürümünüzü en son sürümle karşılaştıracak ve yeni bir sürüm mevcutsa sizi bilgilendirecektir.

      Güncelleme takipçisini etkinleştirdiyseniz, son adım Node Exporter'ı aşağıdaki komutla yeniden başlatmaktır:

      ```shell
      docker restart rocketpool_exporter
      ```

      Bundan sonra, hazır olmalısınız.
    </Tab>
    <Tab label="Hybrid">
      Hybrid Modu, Docker Moduna benzer şekilde çalışır; tek fark, Execution ve Consensus Client servis tanımınıza metrikleri etkinleştirmek için uygun komut satırı bayraklarını manuel olarak eklemeniz gerektiğidir.

      İlk olarak, Execution Client'ınızı güncelleyeceğiz.
      Execution Client'ınızı yüklediğinizde oluşturduğunuz `systemd` birim dosyasını açın ve hangi client'ı çalıştırdığınıza bağlı olarak doğru bayraklara sahip olduğundan emin olun:

      <div className="p-3">
        <Tabs>
          <Tab label="Geth">
            ```
            --metrics --metrics.addr 0.0.0.0 --metrics.port 9105
            ```
          </Tab>
          <Tab label="Nethermind">
            ```
            --Metrics.Enabled true --Metrics.ExposePort 9105
            ```
          </Tab>
          <Tab label="Besu">
            ```
            --metrics-enabled --metrics-host=0.0.0.0 --metrics-port=9105
            ```
          </Tab>
        </Tabs>
      </div>

      Ardından, Consensus Client'ınızı güncelleyeceğiz.
      Consensus Client'ınızı yüklediğinizde oluşturduğunuz `systemd` birim dosyasını açın ve hangi client'ı çalıştırdığınıza bağlı olarak doğru bayraklara sahip olduğundan emin olun:

      <div className="p-3">
        <Tabs>
          <Tab label="Lighthouse">
            ```
            --metrics --metrics-address 0.0.0.0 --metrics-port 9100 --validator-monitor-auto
            ```
          </Tab>
          <Tab label="Lodestar">
            ```
            --metrics --metrics.address 0.0.0.0 --metrics.port 9100
            ```
          </Tab>
          <Tab label="Nimbus">
            ```
            --metrics --metrics-address=0.0.0.0 --metrics-port=9100
            ```
          </Tab>
          <Tab label="Prysm">
            ```
            --monitoring-host 0.0.0.0 --monitoring-port 9100
            ```

            `--disable-monitoring` bayrağını görürseniz, kaldırın.
          </Tab>
          <Tab label="Teku">
            ```
            --metrics-enabled=true --metrics-interface=0.0.0.0 --metrics-port=9100 --metrics-host-allowlist=*
            ```
          </Tab>

        </Tabs>
      </div>

      Bu bayraklara zaten sahipseniz ve solo validator izleme için farklı portlar kullanıyorsanız, bunları olduğu gibi bırakın ve hangi portları kullandığınızı not edin.

      Şimdi, yukarı kaydırın ve süreci tamamlamak için bu bölümün `Docker` sekmesindeki talimatları izleyin - `rocketpool service config` komutunu çalıştırdığınızda orada listelenen portları kullandığınız özel portlarla değiştirmeniz gerektiğini unutmayın.

    </Tab>
    <Tab label="Native">
      Grafana ve Prometheus'un native kurulumu yalnızca ileri düzey kullanıcılar için önerilir. `systemd`, dosya izinleri, kullanıcılar ve ağ yönetimi gibi Linux yönetim becerileri gerektirir.

      İlk olarak, Execution Client ve Consensus Client'ınızın metriklerinin etkinleştirildiğinden emin olun. Detaylar için 'Hybrid' sekmesine bakın.

      Ardından, [resmi indirme sayfasında](https://prometheus.io/download/) önceden oluşturulmuş prometheus ve node_exporter paketlerini kontrol edin.
      Platformunuz için uygun mimariye sahip paketleri seçin (amd64 veya arm64).
      Prometheus'un en son LTS (Uzun Süreli Destek) sürümü önerilir.

      Örneğin, Linux amd64 için prometheus v2.45.3 LTS ve node_exporter v1.7.0'ı `wget` ile indirmek için:

      ```shell
      wget https://github.com/prometheus/prometheus/releases/download/v2.45.3/prometheus-2.45.3.linux-amd64.tar.gz
      wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz
      wget https://github.com/prometheus/alertmanager/releases/download/v0.26.0/alertmanager-0.26.0.linux-amd64.tar.gz
      ```

      İndirilen arşivlerden prometheus ve node_exporter yürütülebilir dosyalarını çıkarın.

      ```shell
      sudo tar -zxvf prometheus-2.45.3.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/prometheus' --strip-components=1
      sudo tar -zxvf node_exporter-1.7.0.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/node_exporter' --strip-components=1
      sudo tar -zxvf alertmanager-0.26.0.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/alertmanager' --strip-components=1
      ```

      Prometheus ve alertmanager yapılandırmaları için dizinler oluşturun.

      ```shell
      sudo mkdir /etc/prometheus
      sudo mkdir /etc/alertmanager
      sudo mkdir /var/lib/prometheus
      sudo mkdir /var/lib/alertmanager
      ```

      Aşağıdaki içerikle `/etc/prometheus/prometheus.yml` dosyasını oluşturun:

      ```yaml
      global:
      scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
      scrape_timeout: 12s # Timeout must be shorter than the interval
      evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.

      scrape_configs:
      - job_name: "prometheus"
      static_configs:
      - targets: ["localhost:9091"]

      - job_name: "node"
      static_configs:
      - targets: ["localhost:9103"]
      #     - targets: ['localhost:9103', 'node_hostname:9103']
      - job_name: "eth1"
      static_configs:
      - targets: ["localhost:9105"]
      # Uncomment the line below if you are using geth as Execution Client
      #metrics_path: /debug/metrics/prometheus

      - job_name: "eth2"
      static_configs:
      - targets: ["localhost:9100"]

      - job_name: "validator"
      static_configs:
      - targets: ["validator:9101"]

      - job_name: "rocketpool"
      scrape_interval: 5m
      scrape_timeout: 5m
      static_configs:
      - targets: ["node:9102"]

      - job_name: "watchtower"
      scrape_interval: 5m
      scrape_timeout: 5m
      static_configs:
      - targets: ["watchtower:9104"]

      alerting:
      alertmanagers:
      - static_configs:
      - targets: ["localhost:9093"]
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Gerekirse Execution Client ve Consensus Client için port numaralarını değiştirin.

        Node'unuzu prometheus'u çalıştıran host'tan farklı bir host'ta çalıştırıyor olabilirsiniz. Bu durumda
        rocketpool node host'unuzda node_exporter'ı yükleyin ve izlemek istediğiniz tüm makineleri içerecek şekilde `node` job'ının `targets` değerini güncelleyin.
        Ayrıca Execution Client'ınız geth ise `metrics_path` değerini ayarlayın - standart olmayan bir metrik endpoint'i sunar.
      </p>

      Aşağıdaki içerikle `/etc/alertmanager/alertmanager.yml` dosyasını oluşturun:

      ```yaml
      global:
      # ResolveTimeout is the default value used by alertmanager if the alert does
      # not include EndsAt, after this time passes it can declare the alert as resolved if it has not been updated.
      # This has no impact on alerts from Prometheus, as they always include EndsAt.
      # default = 5m
      resolve_timeout: 5m

      route:
      # The labels by which incoming alerts are grouped together.
      group_by: ["alertname"]
      # How long to initially wait to send a notification for a group
      # of alerts. Allows to wait for an inhibiting alert to arrive or collect
      # more initial alerts for the same group.
      group_wait: 30s
      # How long to wait before sending a notification about new alerts that
      # are added to a group of alerts for which an initial notification has
      # already been sent. (Usually ~5m or more.)
      group_interval: 5m
      # How long to wait before sending a notification again if it has already been sent successfully for an alert.
      repeat_interval: 4h
      routes:
      # severity=info: Don't send the follow-up resolved notification.
      - match:
      severity: info
      continue: false
      # The notification destination
      receiver: "node_operator_no_resolved"
      # all other alerts get sent notifications for the initial firing _and_ resolved notifications.
      - receiver: "node_operator_default"
      #match: We want this to match all alerts (severity=info is first though so it will stop)

      # The notification destination
      receiver: "node_operator_default"

      receivers:
      - name: "node_operator_default"
      discord_configs:
      - webhook_url: "https://discord.com/api/webhooks/1206697259694170212/_Pk1eVVgXFLdwU1k0rfwehSvNLiAQJytVV_Ze8QYOhupHnhiB5c8awPBTfuw41lN9GJk"

      - name: "node_operator_no_resolved"
      discord_configs:
      - webhook_url: "https://discord.com/api/webhooks/1206697259694170212/_Pk1eVVgXFLdwU1k0rfwehSvNLiAQJytVV_Ze8QYOhupHnhiB5c8awPBTfuw41lN9GJk"
      send_resolved: false

      inhibit_rules:
      # Inhibit rules mute a new alert (target) that matches an existing alert (source).
      - source_match:
      # if the existing alert (source) is severity=critical
      severity: "critical"
      target_match:
      # and the new alert (target) is severity=warning
      severity: "warning"
      # and the alertname, job, and instance labels have the same value
      equal: ["alertname", "job", "instance"]
      ```

      Prometheus ve alertmanager için sistem kullanıcısı oluşturun.

      ```shell
      sudo useradd -r -s /sbin/nologin prometheus
      sudo useradd -r -s /sbin/nologin alertmanager
      ```

      Prometheus/alertmanager dosya sahipliğini ve izinlerini değiştirin.

      ```shell
      sudo chown prometheus:prometheus /usr/local/bin/prometheus
      sudo chown alertmanager:alertmanager /usr/local/bin/alertmanager
      sudo chown prometheus:prometheus /usr/local/bin/node_exporter
      sudo chown -R prometheus:prometheus /etc/prometheus
      sudo chown -R alertmanager:alertmanager /etc/alertmanager
      sudo chown -R prometheus:prometheus /var/lib/prometheus
      sudo chown -R alertmanager:alertmanager /var/lib/alertmanager
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/prometheus
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/alertmanager
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/node_exporter
      ```

      Node_exporter servis yapılandırması için `/lib/systemd/system/node-exporter.service` dosyasını oluşturun.

      ```
      [Unit]
      Description=Node metrics exporter for Prometheus
      Documentation=https://prometheus.io/docs/introduction/overview
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=prometheus
      Group=prometheus
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/prometheus
      RuntimeDirectory=node-exporter
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/node_exporter --web.listen-address=:9103

      [Install]
      WantedBy=multi-user.target
      ```


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Node_exporter'ın çalıştığı portu değiştirmek istiyorsanız, `ExecStart` parametresindeki komutu değiştirin. Varsayılan port 9100'dür.
      </p>

      Prometheus servis yapılandırması için `/lib/systemd/system/prometheus.service` dosyasını oluşturun.

      ```
      [Unit]
      Description=Prometheus instance
      Documentation=https://prometheus.io/docs/introduction/overview
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=prometheus
      Group=prometheus
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/prometheus
      RuntimeDirectory=prometheus
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/prometheus --config.file /etc/prometheus/prometheus.yml --web.listen-address=:9091

      [Install]
      WantedBy=multi-user.target
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Prometheus'un çalıştığı portu değiştirmek istiyorsanız, `ExecStart` parametresindeki komutu değiştirin. Varsayılan port 9090'dır.
      </p>

      Alertmanager servis yapılandırması için `/lib/systemd/system/alertmanager.service` dosyasını oluşturun.

      ```
      [Unit]
      Description=Alertmanager instance
      Documentation=https://prometheus.io/docs/alerting/latest/alertmanager/
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=alertmanager
      Group=alertmanager
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/alertmanager
      RuntimeDirectory=alertmanager
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/alertmanager --config.file /etc/alertmanager/alertmanager.yml --web.listen-address=:9093

      [Install]
      WantedBy=multi-user.target
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Alertmanager'ın çalıştığı portu değiştirmek istiyorsanız, `ExecStart` parametresindeki komutu değiştirin. Varsayılan port 9093'tür.
      </p>

      `systemd`'ye yeni servislerden haberdar olmasını sağlayın.

      ```shell
      sudo systemctl daemon-reload
      ```

      Node-exporter servisini etkinleştirin ve başlatın.

      ```shell
      sudo systemctl enable node-exporter
      sudo systemctl start node-exporter
      ```

      Servisin çalıştığından emin olmak için servis durumunu kontrol edin.

      ```shell
      sudo systemctl status node-exporter
      ```

      Prometheus servisini etkinleştirin ve başlatın.

      ```shell
      sudo systemctl enable prometheus
      sudo systemctl start prometheus
      ```

      Alertmanager servisini etkinleştirin ve başlatın.

      ```shell
      sudo systemctl enable alertmanager
      sudo systemctl start alertmanager
      ```

      Servislerin çalıştığından emin olmak için servis durumunu kontrol edin.

      ```shell
      sudo systemctl status prometheus
      sudo systemctl status alertmanager
      ```

      Grafana için paket deposunu kurun.

      ```shell
      sudo apt-get update
      sudo apt-get install -y apt-transport-https software-properties-common
      sudo mkdir -p /etc/apt/keyrings/
      wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null
      echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
      ```

      Grafana'yı yükleyin.

      ```shell
      sudo apt-get update
      sudo apt-get install grafana
      ```

      `/etc/grafana/grafana.ini` içindeki ayarları doğrulayın. Bu belgede sağlanan diğer bölümlerle uyumlu olmak için `http_port`'u 3100 olarak değiştirin.

      Prometheus'tan metrikleri Grafana'da görselleştirmek için veri kaynağını yapılandırın. `/etc/grafana/provisioning/datasources/prometheus.yml` dosyasını oluşturun.

      ```yaml
      apiVersion: 1

      deleteDatasources:
      - name: Prometheus
      orgId: 1

      datasources:
      - name: Prometheus
      type: prometheus
      access: proxy
      orgId: 1
      url: http://localhost:9091
      basicAuth: false
      isDefault: true
      version: 1
      editable: true
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Prometheus dinleme portunu değiştirdiyseniz `url`'yi düzenleyin.
      </p>

      Grafana için servisi etkinleştirin ve başlatın.

      ```shell
      sudo systemctl daemon-reload
      sudo systemctl enable grafana-server
      sudo systemctl start grafana-server
      ```

      Grafana'nın çalışır durumda olup olmadığını kontrol edin.

      ```shell
      sudo systemctl status grafana-server
      ```

      Bu kadar.
    </Tab>

  </Tabs>
</div>

## İzleme için bağlantılara izin vermek üzere güvenlik duvarını yapılandırın

::: warning NOT
[Node'unuzu Güvence Altına Alma](./securing-your-node) bölümünde belirtildiği gibi UFW etkinleştirilmişse, Prometheus ile Execution/Consensus Client'larınız arasında yerel bağlantılara izin vermek için birkaç portu açmanız gerekecektir. Aşağıdaki adımları izleyin.
:::

<div className="p-3">
  <Tabs>
    <Tab label="Docker">
      Aşağıdakini çalıştırın ve gerektiğinde portları değiştirin:

      ```shell
      RP_NET=$(docker inspect rocketpool_net | grep -Po "(?<=\"Subnet\": \")[0-9./]+")
      sudo ufw allow from $RP_NET to any port 9105 comment "Allow Prometheus access to Execution Client"
      sudo ufw allow from $RP_NET to any port 9100 comment "Allow Prometheus access to Consensus Client"
      sudo ufw allow from $RP_NET to any port 9103 comment "Allow Prometheus access to Exporter"
      ```
    </Tab>
    <Tab label="Native">
      RocketPool node'unuz ve Prometheus farklı host'larda bulunuyorsa, node host'unuzda güvenlik duvarını Prometheus host IP'sinden node izleme portlarına gelen trafiğe izin verecek şekilde yapılandırmanız gerekir.
      Ayrıca Prometheus makinesinde UFW'yi Prometheus host'undan RocketPool node host'una giden trafik için yapılandırmanız gerekir.

      Node host IP'si `192.168.1.5` ve Prometheus host IP'si `192.168.1.6` olan durumda, node için UFW kuralları şöyle olacaktır:

      ```shell
      sudo ufw allow from 192.168.1.6 to any port 9100:9105 proto tcp comment 'Allow Prometheus host to scrape metrics of this host'
      ```

      Prometheus host'u için:

      ```shell
      sudo ufw allow out from any to 192.168.1.5 port 9100:9105 proto tcp comment 'Allow this host to scrape node metrics'
      ```

      Grafana dinleme portunuzun 3100 olduğunu varsayarak, Grafana'yı ağınızda nasıl açığa çıkaracağınızı öğrenmek için okumaya devam edin.
    </Tab>

  </Tabs>
</div>

Ardından güvenlik duvarını dış cihazların Grafana kontrol panelinize erişmesine izin verecek şekilde açabilirsiniz.

<div className="p-3">
  <Tabs>
    <Tab label="Network">
      Grafana'ya yerel ağınızdaki herhangi bir makineden erişmek istiyorsanız ancak başka her yerden erişimi reddetmek istiyorsanız bunu kullanın.
      Bu en yaygın kullanım durumu olacaktır.

      Lütfen önce yerel ağınızın `192.168.1.xxx` yapısını kullanıp kullanmadığını kontrol edin.
      Farklı bir adres yapısı kullanıyorsa (örn. `192.168.99.xxx`), yerel ağınızın yapılandırmasına uyacak şekilde aşağıdaki komutu değiştirmeniz gerekebilir.

      ```shell
      # This assumes your local IP structure is 192.168.1.xxx
      sudo ufw allow from 192.168.1.0/24 proto tcp to any port 3100 comment 'Allow grafana from local network'
      ```

    </Tab>
    <Tab label="Subnet">
      Rocket Pool node'unuz, Grafana'yı görüntülediğiniz cihazla aynı alt ağa bağlı değilse bunu kullanın. Bu durum, node'unuz doğrudan ISP'nizin modemine bağlıyken ve Grafana'yı görüntülemek için kullandığınız cihaz ikincil bir yönlendiriciye bağlıysa gerçekleşebilir.

      Lütfen önce yerel ağınızın `192.168.1.xxx` yapısını kullanıp kullanmadığını kontrol edin.
      Farklı bir adres yapısı kullanıyorsa (örn. `192.168.99.xxx`), yerel ağınızın yapılandırmasına uyacak şekilde aşağıdaki komutu değiştirmeniz gerekebilir.

      ```shell
      # To allow any devices in the broader subnet
      # for example allowing 192.168.2.20 to access
      # grafana on 192.168.1.20
      sudo ufw allow from 192.168.1.0/16 proto tcp to any port 3100 comment 'Allow grafana from local subnets'
      ```
    </Tab>
    <Tab label="Anywhere">
      Bu, Grafana'ya her yerden erişmenize izin verecektir.
      Yerel ağınızın dışından erişmek istiyorsanız, yönlendirici ayarlarınızda Grafana portunu (varsayılan 3100) yönlendirmeniz gerekecektir.

      ```shell
      # Allow any IP to connect to Grafana
      sudo ufw allow 3100/tcp comment 'Allow grafana from anywhere'
      ```
    </Tab>

  </Tabs>
</div>

## Grafana'yı Kurma

Artık metrik sunucusu hazır olduğuna göre, yerel ağınızdaki herhangi bir tarayıcı ile erişebilirsiniz.

Smartnode kurulum modunuz için aşağıdaki sekmelere bakın.

Gerektiğinde değişkenleri kurulumunuzla değiştirerek aşağıdaki URL'ye gidin:

```
http://<node IP'niz>:<grafana portu>
```

Örneğin, node'unuzun IP'si `192.168.1.5` ise ve varsayılan Grafana portu olan `3100`'ü kullandıysanız, tarayıcınızda şu URL'ye gidersiniz:

```
http://192.168.1.5:3100
```

Bunun gibi bir giriş ekranı göreceksiniz:

<img src="./images/grafana-login.png" width="100%" height="auto" />

Varsayılan Grafana bilgileri:

```
Username: admin
Password: admin
```

Ardından `admin` hesabı için varsayılan parolayı değiştirmeniz istenecektir.
Güçlü bir şey seçin ve unutmayın!

::: tip İpucu
Admin parolasını kaybederseniz, node'unuzda aşağıdaki komutu kullanarak sıfırlayabilirsiniz:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      ```shell
      docker exec -it rocketpool_grafana grafana-cli admin reset-admin-password admin
      ```

    </Tab>
    <Tab label="Native">
      ```shell
      sudo grafana-cli admin reset-admin-password admin
      ```
    </Tab>

  </Tabs>
</div>

Varsayılan `admin` kimlik bilgilerini kullanarak Grafana'ya tekrar giriş yapabilecek ve ardından `admin` hesabı için parolayı değiştirmeniz istenecektir.
:::

Topluluk üyesi **tedsteen**'in çalışması sayesinde, Grafana otomatik olarak Prometheus örneğinize bağlanacak, böylece topladığı metriklere erişimi olacaktır.
Tek yapmanız gereken kontrol panelini almak!

## Rocket Pool Kontrol Panelini İçe Aktarma

Artık Grafana'yı Prometheus'a bağladığınıza göre, standart kontrol panelini içe aktarabilirsiniz (veya bu süreçle aşina iseniz, sağladığı metrikleri kullanarak kendinizinkini oluşturabilirsiniz).

**Oluştur** menüsüne (sağ taraftaki artı simgesi) giderek ve **İçe Aktar**'a tıklayarak başlayın:

<img src="./images/grafana-import.png" width="100%" height="auto" />

**Import via grafana.com** kutusunda kontrol paneli ID'si istendiğinde, `21863` girin veya tam URL'yi kullanın ([(https://grafana.com/grafana/dashboards/24900-rocket-pool-dashboard-v1-4-0/](https://grafana.com/grafana/dashboards/24900-rocket-pool-dashboard-v1-4-0/)) ve **Yükle** düğmesine basın.

Burada kontrol paneli hakkında adı ve nerede saklamak istediğiniz gibi bazı bilgiler gösterilecektir (çok sayıda kontrol paneli kullanmıyorsanız ve bunları organize etmek istemiyorsanız varsayılan **Genel** klasörü iyidir).

Alttaki **Prometheus** açılır menüsü altında, **Prometheus (varsayılan)** etiketli tek bir seçeneğiniz olmalıdır.
Bu seçeneği seçin.

Ekranınız şöyle görünmelidir:

<img src="./images/grafana-import2.png" width="100%" height="auto" />

Sizinki eşleşiyorsa, **İçe Aktar** düğmesine tıklayın ve hemen yeni kontrol panelinize götürüleceksiniz.

İlk bakışta, node'unuz ve validator'larınız hakkında birçok bilgi görmelisiniz.
Her kutu, hakkında daha fazla bilgi edinmek için üzerine gelinebilen sol üst köşede kullanışlı bir araç ipucu (ü simgesi) ile birlikte gelir.
Örneğin, işte **Validator Payınız** kutusu için araç ipucu:

<img src="./images/tooltip.png" width="100%" height="auto" />

Ancak, işleri kurmayı henüz bitirmedik - hala yapılacak biraz daha yapılandırma var.

::: warning NOT
Bazı kutular (özellikle APR olanlar), Shapella'nın skimmed ödülleri sağlama şekli nedeniyle geçici olarak devre dışı bırakılmıştır.

Geçmiş ödülleri düzgün bir şekilde takip edebilen Smartnode'un gelecekteki bir sürümünde tekrar etkinleştirileceklerdir.
:::

## Donanım İzleyicisini Sisteminize Uyarlama

Artık kontrol paneli hazır olduğuna göre, **SSD Gecikme Süresi** ve **Ağ Kullanımı** gibi birkaç kutunun boş olduğunu fark edebilirsiniz.
Bu şeyleri nasıl yakalayacağını bilmesi için kontrol panelini özel donanımınıza uyarlamalıyız.

### CPU Sıcaklığı

CPU sıcaklık göstergenizi güncellemek için, **CPU Sıcaklığı** kutusunun başlığına tıklayın ve açılır menüden **Düzenle**'yi seçin.
Ekranınız şimdi şuna benzer bir şey görünecektir:

<img src="./images/cpu-temp.png" width="100%" height="auto" />

Bu Grafana'nın düzenleme modu, neyin görüntüleneceğini ve nasıl göründüğünü değiştirebileceğiniz yerdir.
**Metrics browser** düğmesinin sağındaki, kırmızıyla vurgulanan sorgu kutusunu arıyoruz.

Varsayılan olarak, o kutuda şu vardır:

```
node_hwmon_temp_celsius{job="node", chip="", sensor=""}
```

Bu metinde şu anda boş olan iki alan vardır: `chip` ve `sensor`.
Bunlar her makineye özgüdür, bu nedenle bunları makinenizin sağladığına göre doldurmanız gerekecektir.

Bunu yapmak için şu adımları izleyin:

1. `, sensor=""` kısmını kaldırın, böylece `chip=""}` ile bitsin. Açıklık için, tüm şey şimdi `node_hwmon_temp_celsius{job="node", chip=""}` olmalıdır.
2. İmlecinizi `chip=""` tırnak işaretlerinin arasına yerleştirin ve `Ctrl+Boşluk` tuşuna basın. Bu, şunun gibi görünen mevcut seçenekleri içeren bir otomatik tamamlama kutusu getirecektir:

<img src="./images/grafana-autocomplete.png" width="100%" height="auto" />

3. Sisteminizin CPU'suna karşılık gelen seçeneği seçin.
4. Bu seçildikten sonra, `, sensor=""` kısmını dizeye geri ekleyin. İmlecinizi `sensor=""` tırnak işaretlerinin arasına yerleştirin ve başka bir otomatik tamamlama menüsü almak için `Ctrl+Boşluk` tuşuna basın. İzlemek istediğiniz sensörü seçin.

::: tip İpucu
Hangi `chip` veya `sensor`'ün doğru olduğunu bilmiyorsanız, doğru olanı bulana kadar hepsini denemeniz gerekecektir. Buna yardımcı olmak için `lm-sensors` paketini yükleyin (örneğin, Debian / Ubuntu'da `sudo apt install lm-sensors`) ve bilgisayarınızın hangi sensörlere sahip olduğunu sağlamak için `sensors -u` komutunu çalıştırın. Grafana'nın listesinden bir chip ID'sini burada gördüklerinizle adlarına ve ID'lerine göre ilişkilendirmeye çalışabilirsiniz.

Örneğin, bu `sensors -u` komutumuzun çıktılarından biridir:

```
k10temp-pci-00c3
Tctl:
  temp1_input: 33.500
Tdie:
  temp2_input: 33.500
```

Bizim durumumuzda, Grafana'daki karşılık gelen chip `pci0000:00_0000:00:18_3` ve karşılık gelen sensör `temp1`'dir.
:::

Seçimlerinizden memnun olduğunuzda, ayarları kaydetmek için ekranın sağ üst köşesindeki mavi **Uygula** düğmesine tıklayın.

::: warning NOT
Tüm sistemler CPU sıcaklık bilgisini açığa çıkarmaz - özellikle sanal makineler veya bulut tabanlı sistemler.
Sizinki `chip` için otomatik tamamlama alanında herhangi bir şey yoksa, muhtemelen durum budur ve CPU sıcaklığınızı izleyemeyeceksiniz.
:::

### SSD Gecikme Süresi

**SSD Gecikme Süresi** grafiği, okuma/yazma işlemlerinin ne kadar sürdüğünü takip eder.
Bu, SSD'nizin ne kadar hızlı olduğunu ölçmede yardımcı olur, böylece validator'ınız zayıf performanstan muzdaripse bir darboğaz haline gelip gelmediğini bilirsiniz.
Grafikte izlemek istediğiniz SSD'yi güncellemek için, **SSD Gecikme Süresi** başlığına tıklayın ve **Düzenle**'yi seçin.

Bu grafik toplam sekiz `device=""` kısmı olan dört sorgu alanına (dört metin kutusu) sahiptir.
Bu kısımların ilk dördünü izlemek istediğiniz cihazla güncellemeniz gerekecektir.

Sadece imlecinizi tırnak işaretlerinin arasına yerleştirin ve Grafana'nın otomatik tamamlama listesini almak için `Ctrl+Boşluk` tuşuna basın ve `device=""` kısımlarının her biri için oradan doğru seçeneği seçin.
**En soldaki boş ayardan başlamak istiyorsunuz, aksi takdirde otomatik tamamlama listesi görünmeyebilir.**

::: tip İpucu
Hangi cihazı izleyeceğinizi bilmiyorsanız, aşağıdaki komutu çalıştırın:

```
lsblk
```

Bu, cihaz ve bölüm listenizi gösteren bir ağaç çıktısı verecektir, örneğin:

```
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
...
loop25        7:25   0   132K  1 loop /snap/gtk2-common-themes/9
loop26        7:26   0  65,1M  1 loop /snap/gtk-common-themes/1515
nvme0n1     259:0    0 238,5G  0 disk
├─nvme0n1p1 259:1    0   512M  0 part /boot/efi
├─nvme0n1p2 259:2    0 150,1G  0 part /
├─nvme0n1p3 259:3    0  87,4G  0 part
└─nvme0n1p4 259:4    0   527M  0 part
```

Smartnode kurulumunuz sırasında Docker'ın varsayılan konumunu farklı bir sürücüye değiştirmediyseniz, izlemek istediğiniz disk, İşletim Sisteminizin yüklü olduğu disk olacaktır.
`MOUNTPOINT` sütununda sadece `/` etiketli bir giriş arayın, ardından bunu üst cihazına kadar takip edin (`TYPE` sütununda `disk` olan).

Tipik olarak bu, SATA sürücüler için `sda` veya NVMe sürücüler için `nvme0n1` olacaktır.

Docker'ın varsayılan konumunu farklı bir sürücüye değiştirdiyseniz veya hibrit / native bir kurulum çalıştırıyorsanız, zincir verilerinizin hangi cihazda bulunduğunu belirlemek için aynı "bağlantı noktasını takip etme" tekniğini kullanabilmelisiniz.
:::

İsteğe bağlı olarak, sisteminizdeki ikinci bir diskin gecikmesini de izleyebilirsiniz.
Bu, İşletim Sisteminizi ve zincir verilerini ayrı sürücülerde tutan kişiler için tasarlanmıştır.
Bunu kurmak için, son iki sorgu alanı için yukarıdaki talimatları takip edin, `device=""` kısım değerlerini izlemek istediğiniz diskin değerleriyle değiştirin.

Seçimlerinizden memnun olduğunuzda, ayarları kaydetmek için ekranın sağ üst köşesindeki mavi **Uygula** düğmesine tıklayın.

### Ağ Kullanımı

Bu grafik, belirli bir ağ bağlantısı üzerinden ne kadar veri gönderip aldığınızı takip eder.
Tahmin edebileceğiniz gibi, kontrol panelinin hangi ağı izlemesi gerektiğini bilmesi gerekir.

Bunu değiştirmek için, **Ağ Kullanımı** başlığına tıklayın ve **Düzenle**'yi seçin.

Bu grafik toplam iki `device=""` kısmı olan iki sorgu alanına sahiptir.
Bunları izlemek istediğiniz ağla güncellemeniz gerekecektir.

İmlecinizi tırnak işaretlerinin arasına yerleştirin ve Grafana'nın otomatik tamamlama listesini almak için `Ctrl+Boşluk` tuşuna basın ve `device=""` kısımlarının her biri için oradan doğru seçeneği seçin.

::: tip İpucu
Hangi cihazı izleyeceğinizi bilmiyorsanız, aşağıdaki komutu çalıştırın:

```shell
sudo route
```

Çıktı şuna benzer bir şey görünecektir:

```
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.1.1     0.0.0.0         UG    100    0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.1.1     0.0.0.0         255.255.255.255 UH    100    0        0 eth0
```

`Destination` sütununda `default` değerine sahip satıra bakın.
O satırı `Iface` sütununa kadar takip edin.
Orada listelenen cihaz, kullanmak istediğiniz cihazdır - bu örnekte, `eth0`.
:::

Seçimlerinizden memnun olduğunuzda, ayarları kaydetmek için ekranın sağ üst köşesindeki mavi **Uygula** düğmesine tıklayın.

### Toplam Net I/O

Bu, gönderdiğiniz ve aldığınız toplam veri miktarını takip eder.
Örneğin, ISP'niz ayda belirli bir veri miktarıyla sınırlıyorsa bunu izlemeyi faydalı bulabilirsiniz.

Kurulum yukarıdaki **Ağ Kullanımı** kutusuyla aynıdır, bu nedenle bu kutu için de bu talimatları takip edin.

### Kullanılan Disk Alanı

Bu, İşletim Sistemi diskinizin ne kadar dolduğunu takip eder, böylece ne zaman temizlemeniz gerektiğini (ve zincir verileriniz aynı sürücüde yaşıyorsa, [Geth veya Nethermind'i budama](./pruning) zamanının geldiğini) bilirsiniz.

Adımlar yukarıdaki **SSD Gecikme Süresi** kutusuyla aynıdır, bu nedenle bu kutu için de bu talimatları takip edin.
Hatırlatma olarak, bu için `MOUNTPOINT` sütununda `/` olan bölümü barındıran sürücüyü istiyorsunuz çünkü bu İşletim Sistemi sürücünüz olacaktır.
Bunu ilk sorgu alanına doldurun.

İsteğe bağlı olarak, sisteminizdeki ikinci bir diskin boş alanını da izleyebilirsiniz.
Bu, İşletim Sisteminizi ve zincir verilerini ayrı sürücülerde tutan kişiler için tasarlanmıştır.
Aynı süreci izleyerek bunu kurun, ancak `MOUNTPOINT` sütununda `/` olan bölüme bakmak yerine, ikinci sürücünüzün bağlantı noktası her neyse ona sahip olana bakmak istiyorsunuz.
İkinci sorgu alanını bu bölümle ilişkili diskle güncelleyin.

### Disk Sıcaklığı

Bu, İşletim Sistemi diskinizin mevcut sıcaklığını takip eder. Adımlar yukarıdaki **CPU Sıcaklığı** kutusuyla aynıdır, bu nedenle bu kutu için de bu talimatları takip edin, CPU chip ve sensör değerlerini İşletim Sistemi diskinizinkilerle değiştirin. Bu değerleri ilk sorgu alanına doldurun.

İsteğe bağlı olarak, sisteminizdeki ikinci bir diskin mevcut sıcaklığını da izleyebilirsiniz. Aynı süreci izleyerek bunu kurun, chip ve sensör değerlerini ikinci sürücünüzünkilerle değiştirin. Bu değerleri ikinci sorgu alanına doldurun.

## Kontrol Panelini Özelleştirme

Standart kontrol paneli bir bakışta görmek isteyeceğiniz her şeyi yakalamada iyi bir iş çıkarmaya çalışsa da, bir Grafana kontrol panelini istediğiniz gibi özelleştirmek oldukça kolaydır.
Yeni grafikler ekleyebilir, grafiklerin görünümünü değiştirebilir, şeyleri hareket ettirebilir ve çok daha fazlasını yapabilirsiniz!

Nasıl oynayacağınızı ve beğeninize göre nasıl kuracağınızı öğrenmek için [Grafana'nın Öğreticiler](https://grafana.com/tutorials/) sayfasına göz atın.

## Metrik Yığınını Özelleştirme

Rocket Pool Metrik Yığınında kullanılan araçlar, varsayılan Rocket Pool kurulumunda yer alanların ötesinde geniş bir yapılandırma seçeneği yelpazesi sunar. Bu bölüm, farklı kullanım durumları için yapılandırma örnekleri içerir.

Genel olarak, [Grafana yapılandırma seçenekleri](https://grafana.com/docs/grafana/latest/administration/configuration/) `override/grafana.yml` içinde ortam değişkenleri kullanılarak geçirilmelidir. Herhangi bir yapılandırma seçeneği aşağıdaki sözdizimi kullanılarak bir ortam değişkenine dönüştürülebilir:

```
GF_<SectionName>_<KeyName>
```

### E-posta Göndermek için Grafana SMTP Ayarları

Grafana'dan e-posta göndermek için, örn. uyarılar için veya diğer kullanıcıları davet etmek için, SMTP ayarlarının Rocket Pool Metrik Yığınında yapılandırılması gerekir.
Referans için [Grafana SMTP yapılandırması](https://grafana.com/docs/grafana/latest/administration/configuration/#smtp) sayfasına bakın.

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Bir metin düzenleyicide `~/.rocketpool/override/grafana.yml` dosyasını açın.
      `x-rp-comment: Add your customizations below this line` satırının altına bir `environment` bölümü ekleyin, aşağıdaki değerleri SMTP sağlayıcınızınkilerle değiştirin.

      ```yaml
      version: "3.7"
      services:
      grafana:
      x-rp-comment: Add your customizations below this line
      environment:
      ## SMTP settings start, replace values with those of your SMTP provider
      - GF_SMTP_ENABLED=true
      - GF_SMTP_HOST=mail.example.com:`port` # Gmail users should use smtp.gmail.com:587
      - GF_SMTP_USER=admin@example.com
      - GF_SMTP_PASSWORD=password
      - GF_SMTP_FROM_ADDRESS=admin@example.com
      - GF_SMTP_FROM_NAME="Rocketpool Grafana Admin"
      ## SMTP server settings end
      ```
    </Tab>
    <Tab label="Native">
      Bir metin düzenleyicide `/etc/grafana/grafana.ini` dosyasını açın. `[smtp]` bölümünü arayın ve güncelleyin, aşağıdaki değerleri SMTP sağlayıcınızınkilerle değiştirin.

      ```
      [smtp]
      enabled = true
      host = mail.example.com:`port` # Gmail users should use smtp.gmail.com:587
      user = admin@example.com
      # If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;"""
      password = """passw0rd"""
      from_address = admin@example.com
      from_name = "Rocketpool Grafana Admin"
      ```
    </Tab>

  </Tabs>
</div>

::: tip İpucu
Gmail kullanıyorsanız ve [2 Adımlı Doğrulama](https://support.google.com/accounts/answer/185839) etkinse, bu servis için bir [Uygulama Şifresi](https://support.google.com/mail/answer/185833?hl=en) oluşturun.
:::

Bu değişiklikleri yaptıktan sonra, **değişiklikleri uygulamak için aşağıdakini çalıştırın**:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      ```shell
      docker stop rocketpool_grafana

      rocketpool service start
      ```
    </Tab>
    <Tab label="Native">
      ```shell
      sudo systemctl restart grafana-server
      ```
    </Tab>

  </Tabs>
</div>

SMTP ayarlarını test etmek için, **Uyarı** menüsüne gidin ve **İletişim noktaları**'na tıklayın.

<img src="./images/grafana-contact-points.png" width="100%" height="auto" />

**Yeni iletişim noktası**'na tıklayın ve İletişim noktası türü olarak **E-posta**'yı seçin.
**Adresler** bölümüne bir e-posta adresi girin ve **Test**'e tıklayın.

<img src="./images/grafana-new-contact-point.png" width="100%" height="auto" />

Test e-postasının alındığını kontrol edin.
Bitirdiğinizde **İletişim noktasını kaydet\*** düğmesine tıklayın.
