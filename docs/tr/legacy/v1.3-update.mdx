import { Tab, Tabs } from "@rspress/core/theme";

# Smartnode v1.3.x'e Yükseltme

Smartnode stack'inin 1.3.0 sürümü, kullanıcıların bilmesi gereken bazı önemli değişiklikler getiriyor.
Bu değişiklikler, node operatörü deneyiminizi önemli ölçüde geliştirmek ve Rocket Pool'un lansmanından bu yana kullanıcılarımızın talep ettiği birçok özelliği ele almak için tasarlanmıştır.

Bu kılavuzda, Smartnode'un eski bir sürümünden v1.3.x ve sonraki sürümlere geçiş sürecinde size yol göstereceğiz.

## Yapılandırma Dosyası Değişiklikleri

v1.3.0, Smartnode'un yapılandırmasının yönetilme şeklinde bazı önemli değişiklikler sunar.
Daha önce Smartnode yapılandırmasını manuel olarak değiştirdiyseniz, aşağıdaki değişikliklerden haberdar olmalısınız:

- `config.yml` dosyası kaldırılmıştır. Tüm bilgileri artık doğrudan Smartnode stack'ine yerleştirilmiştir, böylece kullanıcılar artık dosyayı Smartnode'un düzgün çalışmasını engelleyecek şekilde yanlışlıkla değiştiremezler.
  - Daha önce bunun bir parçası olan tüm kullanıcı tarafından yapılandırılabilir parametreler artık yeni `service config` Terminal UI'da ayarlardır.

- `settings.yml` dosyası, `user-settings.yml` adlı yeni bir dosya ile değiştirilmiştir. Bu, Smartnode'un her kullanıcı tarafından yapılandırılabilir bölümü için tüm ayarlarınızı içerir.
  - Bu dosyanın **doğrudan değiştirilmesi amaçlanmamıştır**. Değişiklik, bunun yerine yeni `service config` Terminal UI aracılığıyla yapılmalıdır.

- `chains` klasörü kaldırılmıştır. Execution Client (ETH1), Beacon Node ve Validator Client'ı başlatmak için kullanılan scriptler artık `scripts` klasöründe bulunuyor.

- `docker-compose` YAML dosyaları kaldırılmıştır. Her container artık `templates` klasöründe kendi dosyasını alır. `rocketpool service start` çalıştırıldığında, bu şablonlar ayarlarınızla doldurulur ve otomatik olarak `runtime` klasörüne yerleştirilir.
  - Şablonları veya runtime dosyalarını değiştirmek önerilmez. Bunun yerine, `override` klasöründeki her container için **override** dosyalarını kullanarak container özelleştirmelerinizi doldurun. Bu dosyalar `runtime`'daki Docker dosyalarının üzerine yazacaktır, bu nedenle bunları istediğiniz gibi özelleştirmekte özgürsünüz.
  - `override` içindeki dosyalar **Smartnode yükseltmeleri ve yeniden kurulumlar sırasında korunacaktır**, bu yüzden onları yalnızca bir kez oluşturmanız gerekir.
  - Bu override mekanizması aracılığıyla `docker-compose` dosyalarını değiştirmekle ilgileniyorsanız, lütfen [bu bölüme](../node-staking/advanced-config#customizing-the-docker-compose-definition-files) bakın

## Yeni Sürümü Yükleme

Yeni sürümü yüklemek çok tanıdık hissettirmelidir.

Hizmetleri durdurup yeni CLI'yı her zamanki gibi indirerek başlayın:

<div className="p-3">
  <Tabs>
    <Tab label="Docker veya Hybrid Mode">
      Rocket Pool hizmetlerini durdurun:

      ```
      rocketpool service stop
      ```

      Sisteminiz için yeni Smartnode CLI'yı indirin (aşağıdaki sekmelerden birini seçin):

      <div className="p-3">
        <Tabs>
          <Tab label="Linux x64">
            `x64` sistemler için (çoğu normal makine):

            ```shell
            wget https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool
            ```
          </Tab>
          <Tab label="Linux arm64">
            `arm64` sistemler için:

            ```shell
            wget https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool
            ```
          </Tab>
          <Tab label="macOS x64">
            `x64` sistemler için (çoğu Mac):

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool
            ```
          </Tab>
          <Tab label="macOS arm64">
            `arm64` sistemler için, örneğin M1'li Mac mini:

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool
            ```
          </Tab>
        </Tabs>
      </div>

      Şimdi kurulum komutunu çalıştırın:

      ```
      rocketpool service install -d
      ```

      `-d` bayrağı, Docker gibi sistem bağımlılıklarını görmezden gelmesini söyler, çünkü zaten onlara sahipsiniz.

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">NOT</p>
        v1.3.0 itibarıyla, **artık hangi ağ için kurulum yapmak istediğinizi belirtmeniz gerekmiyor!**
        Yeni Smartnode hangi ağı zaten kullandığınızı bilecek ve yeni Terminal UI'yi kullanarak ağınızı dinamik olarak değiştirmenize izin verecektir.
      </p>
    </Tab>
    <Tab label="Native Mode">
      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Bu yalnızca Smartnode stack'inin kendisini güncelleyecektir - Execution ve Consensus client'larınızı **güncellemeyecektir**.
        Bunu manuel olarak yapmanız gerekecektir (bunu nasıl yapacağınızı öğrenmek için [manuel güncelleme kılavuzuna](../node-staking/updates#manually-updating-the-eth1-or-eth2-client) bakın).
      </p>

      Rocket Pool hizmetlerini durdurun:

      ```shell
      sudo systemctl stop rp-node rp-watchtower
      ```

      Yeni Smartnode CLI ve daemon binary'lerini indirin:

      <div className="p-3">
        <Tabs>
          <Tab label="Linux x64">
            `x64` sistemler için (çoğu normal makine):

            ```shell
            sudo wget https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-linux-amd64 -O /usr/local/bin/rocketpool

            sudo wget https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-daemon-linux-amd64 -O /usr/local/bin/rocketpoold
            ```
          </Tab>
          <Tab label="Linux arm64">
            `arm64` sistemler için:

            ```shell
            sudo wget https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-linux-arm64 -O /usr/local/bin/rocketpool

            sudo wget https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-daemon-linux-arm64 -O /usr/local/bin/rocketpoold
            ```
          </Tab>
          <Tab label="macOS x64">
            `x64` sistemler için (çoğu Mac):

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool

            curl -L https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-daemon-darwin-amd64 > /usr/local/bin/rocketpoold
            ```
          </Tab>
          <Tab label="macOS arm64">
            `arm64` sistemler için, örneğin M1'li Mac mini:

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool

            curl -L https://github.com/rocket-pool/smartnode-install/releases/latest/download/rocketpool-daemon-darwin-arm64 > /usr/local/bin/rocketpoold
            ```
          </Tab>
        </Tabs>
      </div>

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">NOT</p>
        v1.3.0 itibarıyla, `config.yml` kaldırılmıştır.
        **Artık yükleyici paketini indirip çıkarmanız gerekmiyor.**
      </p>
      Ardından, Smartnode dizininizde `old_config_backup` adlı bir yedekleme klasörü oluşturun ve eski yapılandırma dosyalarınızı (`config.yml` ve `settings.yml`) buraya taşıyın.
      Smartnode, ayarlarınızı yeni sisteme taşımak için bunları kullanacaktır.

      Örneğin, Native kurulum kılavuzunu takip ettiyseniz ve Smartnode dizininiz `/srv/rocketpool` ise:

      ```shell
      cd /srv/rocketpool
      mkdir old_config_backup
      mv config.yml old_config_backup
      mv settings.yml old_config_backup
      ```

      Şimdi, `rp-node` için servis tanım dosyalarını değiştirin:

      ```shell
      sudo nano /etc/systemd/system/rp-node.service
      ```

      `ExecStart` satırını aşağıdakiyle değiştirin:

      ```
      ExecStart=/home/ubuntu20/bin/rocketpoold --settings /srv/rocketpool/user-settings.yml node
      ```

      `--config` bayrağının kaldırıldığını ve `--settings`'in artık `user-settings.yml`'yi işaret ettiğini unutmayın.
      **Bu dosyanın henüz mevcut olmadığı için endişelenmeyin; bir sonraki adımda otomatik olarak oluşturulacaktır.**

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Oracle DAO üyesiyseniz, yukarıdaki işlemi `rp-watchtower` servisi için de tekrarlamanız _gerekmektedir_.
      </p>

      Son olarak, servis tanımlarını yeniden yükleyin:

      ```shell
      sudo systemctl daemon-reload
      ```
    </Tab>

  </Tabs>
</div>

Kurulumdan sonra, tüm eski yapılandırma dosyalarınız Smartnode dizininizdeki `old_config_backup` adlı bir klasöre taşınacaktır (varsayılan olarak `~/.rocketpool/old_config_backup`).
Herhangi bir nedenle onlara başvurmanız gerekirse bunları orada bulabilirsiniz.

**Bu yedekten v1.2.4'e geri dönme talimatlarını arıyorsanız, lütfen bu sayfanın sonundaki [Önceki Yapılandırmanıza Geri Dönme](#önceki-yapılandırmanıza-geri-dönme) bölümüne gidin.**

## Terminal UI ile Smartnode'u Yapılandırma

Artık yeni CLI ve pakete sahip olduğunuza göre, tüm önceki ayarlarınız korunmuş ve yeni sisteme taşınmıştır.
Bir sonraki adımda, `rocketpool service config` komutunu çalıştırmalısınız.
Bu, bu fonksiyonun önceki sürümlerine kıyasla oldukça farklı görünecektir; v1.3.0, Smartnode'unuzu yapılandırmak için terminal tabanlı dinamik bir kullanıcı arayüzü olan **Terminal UI**'yi sunar.

Geçiş işleminden sonra Docker container'larını başlatmadan önce yapılandırmayı görüntülemek, tüm değişikliklerinizin başarıyla taşındığını doğrulamak ve istediğiniz diğer ayarları güncellemek için çalıştırmalısınız.

İlk çalıştırdığınızda, bu karşılama ekranıyla karşılaşacaksınız (**Docker veya Hybrid mode** kullanıyorsanız):

<img src="../node-staking/images/tui-migrate.png" width="100%" height="auto" />

:::tip NOT
**Native Mode kullanıcıları** bu ekranı, Smartnode'un Native mode'da çalıştığını belirten biraz farklı bir ifadeyle görecektir.
:::

TUI, Smartnode'un en önemli parametrelerini (client modu ve seçimi gibi) hızlı ve kolay bir şekilde değiştirmenize olanak tanıyan **Sihirbaz** ile başlayacaktır.

**Sihirbazın her sayfasında gezinirken tüm önceki ayarlarınız zaten vurgulanmış olmalıdır, böylece önceki yapılandırmanızın ne olduğunu aklınızdan hatırlamak zorunda kalmazsınız.**

:::warning NOT
**Bu Sihirbaz'ın ayrıntılı bir açıklaması için lütfen aşağıdaki sayfalara bakın:**

- **Docker Mode** için, lütfen [yeni Docker yapılandırma kılavuzunu](../node-staking/config-docker) ziyaret edin.

- **Hybrid Mode** kullanıcıları: Hybrid Mode artık Smartnode'un **birinci sınıf bir özelliğidir** ve yapılandırması eskisinden _çok daha kolaydır_. Lütfen [yeni Docker yapılandırma kılavuzunu](../node-staking/config-docker) ziyaret edin ve takip edin. Bir Execution client modu ve Consensus client modu seçmeniz istendiğinde, bunlar için uygun şekilde **Externally Managed**'ı seçin.

- **Native Mode** için, lütfen [yeni Native yapılandırma kılavuzunu](../node-staking/config-native) ziyaret edin.

:::

Bu sihirbazda gezinin ve tüm ayarlarınızın doğru olduğunu onaylayın.

İşiniz bittiğinde, isterseniz **kaydetmeden önce tüm ayarları gözden geçirme** seçeneğine sahip olacaksınız.
Bu, Sihirbaz'ın kapsamadığı ayarları içerir, örneğin **RPL talep gas eşiği** veya **maksimum Geth peer sayınız**.

**Ana ayarlar ekranı**, önceki ayarlarınızı onaylamak için de bakmanız gereken, şöyle görünecektir (Docker ve Hybrid mode kullanıcıları için):

<img src="../node-staking/images/tui-settings-home.png" width="100%" height="auto" />

:::tip NOT
**Native Mode kullanıcıları**, Native mode'a özgü ve yalnızca onunla ilgili ayarları sunan biraz farklı bir ekran görecektir.
:::

Bu yeni UI'yi keşfetmekten ve uygun gördüğünüz ayarları ayarlamaktan çekinmeyin.
Gezinmek için `Ok Tuşlarını` kullanın ve bir kategori girmek veya yaptığınız bir ayardaki değişiklikleri onaylamak için `Enter`'a basın.

Bir kategoriyi düzenlemeyi bitirdiğinizde bu ana ekrana dönmek için `Esc`'ye basın.

Değişikliklerinizi kaydetmeye ve Smartnode stack'ini başlatmaya hazır olduğunuzda, ekranın altındaki düğmelere gitmek için `Tab`'a basın, `Review Changes and Save`'i seçin (ok tuşlarıyla yeşil yaparak).
**İnceleme Sayfası**'na getirilmek için `Enter`'a basın, burada son `rocketpool service config` çalıştırdığınızdan beri değiştirdiğiniz her şeyi görebilirsiniz.

Tüm değişikliklerinizin mevcut olduğunu onaylayın ve ardından bunları kaydetmek için tekrar `Enter`'a basın.
Ekran, değişikliklerin uygulanması için hangi container'ların yeniden başlatılması gerektiğini gösterecektir, ancak geçiş yaptığınız için zaten container'ları kapattınız ve hepsi yine de yeniden başlatılacaktır.

## Smartnode Stack'ini Başlatma

Yapılandırmanızı kaydettikten sonra, terminal container'ların otomatik olarak yeniden başlatılmasını isteyip istemediğinizi soracaktır (Native mode kullanmıyorsanız).
Otomatik olarak başlamalarına izin vermiyorsanız / veremiyorsanız, aşağıdaki komutlarla manuel olarak başlatabilirsiniz:

<div className="p-3">
  <Tabs>
    <Tab label="Docker veya Hybrid Mode">```shell rocketpool service start ```</Tab>
    <Tab label="Native Mode">```shell sudo systemctl start rp-node rp-watchtower ```</Tab>
  </Tabs>
</div>

Başlatıldıktan sonra, her şeyin amaçlandığı gibi çalıştığını doğrulayabilirsiniz.

Smartnode ve client container'larının doğru sürümüne sahip olduğunuzu kontrol etmek için `rocketpool service version` komutunu kullanın:

```
$ rocketpool service version

Your Smartnode is currently using the Hoodi Test Network.

Rocket Pool client version: 1.3.0-rc1
Rocket Pool service version: 1.3.0-rc1
Selected Eth 1.0 client: Geth (Locally managed)
	Image: ethereum/client-go:v1.10.16
Selected Eth 2.0 client: Nimbus (Locally managed)
	Image: statusim/nimbus-eth2:multiarch-v22.3.0
```

Execution client'ınız (eski ETH1 client) ve Consensus client'ınız (eski ETH2 client) için logları izlemek için `rocketpool service logs eth1` ve `rocketpool service logs eth2` komutlarını kullanın.
Herhangi bir hata olup olmadığına dikkat edin ve karşılaşırsanız [lütfen yardım için Discord sunucumuzu ziyaret edin](https://discord.com/invite/rocketpool).

## Önceki Yapılandırmanıza Geri Dönme

Herhangi bir nedenle Smartnode stack'inin v1.2.4 sürümüne geri dönmeniz gerekirse, endişelenmeyin!
Tüm eski yapılandırma dosyalarınız bir yedekleme dizininde korunmuştur ve önceki kurulumunuzu geri yüklemek için kolayca alınabilir.

Aşağıdaki sekmelerden hangi modu kullandığınızı seçin ve talimatları izleyin.

<div className="p-3">
  <Tabs>
    <Tab label="Docker veya Hybrid Mode">
      CLI'yi sisteminiz için v1.2.4 CLI ile değiştirerek başlayın:
      <div className="p-3">
        <Tabs>
          <Tab label="Linux x64">
            `x64` sistemler için (çoğu normal makine):

            ```shell
            wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool
            ```
          </Tab>
          <Tab label="Linux arm64">
            `arm64` sistemler için:

            ```shell
            wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool
            ```
          </Tab>
          <Tab label="macOS x64">
            `x64` sistemler için (çoğu Mac):

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool
            ```
          </Tab>
          <Tab label="macOS arm64">
            `arm64` sistemler için, örneğin M1'li Mac mini:

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool
            ```
          </Tab>
        </Tabs>
      </div>

      Ardından, tüm eski yapılandırma dosyalarınızı `old_config_backup` klasöründen Smartnode klasörüne kopyalayın:

      ```shell
      cd ~/.rocketpool
      cp -r old_config_backup/*
      ```

      Şimdi, tek yapmanız gereken Docker container'ları yeniden başlatmak:

      ```shell
      rocketpool service start
      ```

      Bitti! Eski yapılandırmanız geri döndü.

    </Tab>
    <Tab label="Native Mode">
      Rocket Pool hizmetlerini durdurun:

      <div className="p-3">
        <Tabs>
          <Tab label="Linux x64">
            `x64` sistemler için (çoğu normal makine):

            ```shell
            sudo wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-linux-amd64 -O /usr/local/bin/rocketpool

            sudo wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-daemon-linux-amd64 -O /usr/local/bin/rocketpoold
            ```
          </Tab>
          <Tab label="Linux arm64">
            `arm64` sistemler için:

            ```shell
            sudo wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-linux-arm64 -O /usr/local/bin/rocketpool

            sudo wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4rocketpool-daemon-linux-arm64 -O /usr/local/bin/rocketpoold
            ```
          </Tab>
          <Tab label="macOS x64">
            `x64` sistemler için (çoğu Mac):

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool

            curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-daemon-darwin-amd64 > /usr/local/bin/rocketpoold
            ```
          </Tab>
          <Tab label="macOS arm64">
            `arm64` sistemler için, örneğin M1'li Mac mini:

            ```shell
            curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool

            curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.2.4/rocketpool-daemon-darwin-arm64 > /usr/local/bin/rocketpoold
            ```
          </Tab>
        </Tabs>
      </div>
      Önceki ayar dosyalarını Smartnode dizininize kopyalayın:

      ```shell
      cd /srv/rocketpool
      cp old_config_backup *
      ```

      Şimdi, `rp-node` için servis tanım dosyalarını geri alın:

      ```shell
      sudo nano /etc/systemd/system/rp-node.service
      ```

      `ExecStart` satırını aşağıdakiyle değiştirin:

      ```
      ExecStart=/usr/local/bin/rocketpoold --config /srv/rocketpool/config.yml --settings /srv/rocketpool/settings.yml node
      ```


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOT</p>
        Oracle DAO üyesiyseniz, yukarıdaki işlemi `rp-watchtower` servisi için de tekrarlamanız _gerekmektedir_.
      </p>

      Son olarak, servis tanımlarını yeniden yükleyin ve servisleri yeniden başlatın:

      ```shell
      sudo systemctl daemon-reload

      sudo systemctl start rp-node rp-watchtower
      ```

      Bitti! Eski yapılandırmanız geri döndü.
    </Tab>

  </Tabs>
</div>
