import { Tab, Tabs } from "@rspress/core/theme";
import tuiOdao from "./images/tui-odao.png";

# Configurando um Nó do Oracle DAO

No mínimo, um nó Rocket Pool padrão executa o seguinte:

- O Smartnode CLI
- O daemon da API do Smartnode
- O daemon `node` do Smartnode
- O daemon `watchtower` do Smartnode

Opcionalmente, o nó também pode executar os seguintes componentes:

- Um Cliente de Execução
- Um Beacon Node
- Um Cliente Validador
- MEV-Boost
- Prometheus
- O Prometheus Node Exporter
- Grafana

Cada um desses componentes pode ser executado como contêineres Docker na configuração padrão, como serviços `systemd` na configuração "Modo Nativo", ou executados como entidades gerenciadas externamente às quais o Smartnode pode se conectar através de suas respectivas rotas de API.

Convenientemente, os nós do Oracle DAO são iguais aos nós Rocket Pool normais, mas o daemon `watchtower` desempenha as funções suplementares do Oracle DAO e mais métricas do Prometheus são coletadas para fins de monitoramento de desempenho.

## Configuração Inicial do Nó

A melhor maneira de começar é seguindo [as instruções de configuração padrão](../node-staking/platform) para um nó Rocket Pool normal.
Esse processo ajudará você a determinar como você gostaria de configurar e executar seu nó.

Se você quiser executar minipools (validators) em seu nó, siga a documentação normal do nó do início ao fim e retorne aqui quando terminar.

Se você _não_ pretende executar minipools e, em vez disso, o usará puramente para funções do Oracle DAO, você pode pular todas as etapas relacionadas ao staking de RPL e criação de minipool.
As outras etapas, como registro do nó, estabelecimento de uma boa postura de segurança, monitoramento da saúde e desempenho do nó e atualização do Smartnode após uma atualização, ainda se aplicam a você e devem ser revisadas cuidadosamente antes de prosseguir.
Retorne aqui quando terminar.

## Configuração Adicional do Oracle DAO

Existem duas configurações adicionais que você precisa provisionar para satisfazer suas responsabilidades do Oracle DAO.
Por favor, selecione o modo que você usa para configurar seu nó abaixo nas guias abaixo.

<div className="p-3">
  <Tabs>
    <Tab label="(service config) Interface Interativa">
      Abra a TUI `rocketpool service config` e vá para a seção `Smartnode and TX Fees`.
      Aqui, você verá duas opções na parte inferior:

      <img src={tuiOdao} width="100%" height="auto"/>

      O `Archive-Mode EC URL` deve ser o endpoint HTTP da API RPC do seu Cliente de Execução em Modo de Arquivo.
      **Observe que se você já estiver usando seu EC em modo de arquivo como seu cliente principal no modo Gerenciado Externamente, você pode ignorar esta configuração.**
    </Tab>
    <Tab label="(service config) Sem Interface">

      Execute o seguinte comando para configurar seu nó sem interface:

      ```shell
      rocketpool service config --smartnode-archiveECUrl "http://your Archive EC URL"
      ```

      Onde:

      `--smartnode-archiveECUrl` deve ser o endpoint HTTP da API RPC do seu Cliente de Execução em Modo de Arquivo.
      **Observe que se você já estiver usando seu EC em modo de arquivo como seu cliente principal no modo Gerenciado Externamente, você pode ignorar esta configuração.**

      Por fim, reinicie seu daemon `watchtower` (ou seja, com `docker restart rocketpool_watchtower` no modo Docker ou Híbrido, ou `sudo systemctl restart rp_watchtower` no modo Nativo) para que as configurações entrem em vigor.
    </Tab>
    <Tab label="Arquivo de Configuração Direto">
      Abra o arquivo `user-settings.yml` no diretório do seu Smartnode (`~/.rocketpool` por padrão) em um editor de texto.
      Role para baixo até a seção `smartnode`:

      ```
      smartnode:
      archiveECUrl: http://your Archive EC URL
      dataPath: /home/user/.rocketpool/data
      manualMaxFee: "0"
      minipoolStakeGasThreshold: "150"
      network: mainnet
      priorityFee: "2"
      projectName: rocketpool
      rewardsTreeMode: generate
      ```

      Substitua os valores no campo `archiveECUrl`, onde:

      `archiveECUrl` deve ser o endpoint HTTP da API RPC do seu Cliente de Execução em Modo de Arquivo.
      **Observe que se você já estiver usando seu EC em modo de arquivo como seu cliente principal no modo Gerenciado Externamente, você pode ignorar esta configuração.**

      Por fim, reinicie seu daemon `watchtower` (ou seja, com `docker restart rocketpool_watchtower` no modo Docker ou Híbrido, ou `sudo systemctl restart rp_watchtower` no modo Nativo) para que as configurações entrem em vigor.
    </Tab>

  </Tabs>
</div>

## Comandos do Smartnode do Oracle DAO

O grupo de comandos `odao` do Smartnode CLI é usado para interagir com os contratos e funções do Oracle DAO on-chain:

```
NAME:
   rocketpool odao - Manage the Rocket Pool oracle DAO

USAGE:
   rocketpool odao command [command options] [arguments...]

COMMANDS:
   status, s             Get oracle DAO status
   members, m            Get the oracle DAO members
   member-settings, b    Get the oracle DAO settings related to oracle DAO members
   proposal-settings, a  Get the oracle DAO settings related to oracle DAO proposals
   minipool-settings, i  Get the oracle DAO settings related to minipools
   propose, p            Make an oracle DAO proposal
   proposals, o          Manage oracle DAO proposals
   join, j               Join the oracle DAO (requires an executed invite proposal)
   leave, l              Leave the oracle DAO (requires an executed leave proposal)

OPTIONS:
   --help, -h  show help
```

### status

O comando `status` simplesmente resume alguns detalhes sobre o Oracle DAO, como contagem de membros e contagem de propostas:

```
The node is a member of the oracle DAO - it can create unbonded minipools, vote on DAO proposals and perform watchtower duties.

There are currently 8 member(s) in the oracle DAO.

There are 29 oracle DAO proposal(s) in total:
- 22 proposal(s) have passed and been executed
- 7 proposal(s) were cancelled, defeated, or have expired
```

### members

O comando `members` imprime informações detalhadas sobre cada membro do Oracle DAO, incluindo seu identificador, suas informações de contato, seu endereço de nó, seu vínculo RPL e a última vez que enviaram uma proposta para votação:

```
The oracle DAO has 8 members:

--------------------

Member ID:            kermit-2
URL:                  https://www.rocketpool.net
Node address:         0x04ddB06D1429578691F630B67A53916445DA38bE
Joined at:            31 Jul 21 23:32 EDT
Last proposal:        27 Sep 22 21:18 EDT
RPL bond amount:      5000.000000
Unbonded minipools:   0
...
```

### member-settings

`member-settings` mostra os valores atuais para cada um dos parâmetros configuráveis relacionados à associação ao Oracle DAO:

```
ODAO Voting Quorum Threshold: 51.000000%
Required Member RPL Bond: 1750.000000 RPL
Max Number of Unbonded Minipools: 250
Consecutive Challenge Cooldown: 300 Blocks
Challenge Meeting Window: 900 Blocks
Cost for Non-members to Challenge Members: 1.000000 ETH
```

Este comando é descrito em mais detalhes na seção [Propostas do Oracle DAO](./proposals).

### proposal-settings

`proposal-settings` mostra os valores atuais para cada um dos parâmetros configuráveis relacionados às propostas que o Oracle DAO pode votar:

```
Cooldown Between Proposals: 1h0m0s
Proposal Voting Window: 168h0m0s
Delay Before Voting on a Proposal is Allowed: 15m0s
Window to Execute an Accepted Proposal: 168h0m0s
Window to Act on an Executed Proposal: 168h0m0s
```

Este comando é descrito em mais detalhes na seção [Propostas do Oracle DAO](./proposals).

### minipool-settings

`minipool-settings` mostra os valores atuais para cada um dos parâmetros configuráveis relacionados aos minipools na rede Rocket Pool:

```
Scrub Period: 1h0m0s
```

### propose

O comando `propose` é usado para enviar propostas de governança nas quais o resto do Oracle DAO pode votar.
Estas podem envolver a alteração de uma configuração ou a modificação dos membros do Oracle DAO (ou seja, convidar ou expulsar outros membros).

Este comando é descrito em mais detalhes na seção [Propostas do Oracle DAO](./proposals).

### proposals

O comando `proposals` é usado para interagir com propostas de governança existentes do Oracle DAO.
Ele pode visualizá-las, rescindir propostas que você fez, votar nelas e executá-las (se aplicável), fazendo com que entrem em vigor após terem sido aprovadas pelos outros membros:

```
NAME:
   rocketpool odao proposals - Manage oracle DAO proposals

USAGE:
   rocketpool odao proposals command [command options] [arguments...]

COMMANDS:
   list, l     List the oracle DAO proposals
   details, d  View proposal details
   cancel, c   Cancel a proposal made by the node
   vote, v     Vote on a proposal
   execute, x  Execute a proposal

OPTIONS:
   --help, -h  show help

```

Este comando é descrito em mais detalhes na seção [Propostas do Oracle DAO](./proposals).

### join / leave

Os comandos `join` e `leave` são usados para ingressar no Oracle DAO depois de ter sido convidado, ou sair do Oracle DAO depois que os outros membros aprovaram sua solicitação de renúncia.

## Ingressando no Oracle DAO

### O Vínculo RPL

Para ingressar no Oracle DAO, sua carteira de nó precisará ter RPL suficiente para cobrir o vínculo de associação necessário.
Isso será bloqueado no cofre da Rocket Pool como parte do processo de ingresso.
A quantidade exata de RPL necessária para o vínculo será determinada no momento do seu convite e será comunicada a você pelos outros membros do Oracle DAO antes de integrá-lo.

::: warning NOTA
Ao contrário de todas as outras recompensas de ETH e RPL, o vínculo RPL _não_ é enviado para o endereço de retirada do seu nó ao sair do Oracle DAO.
Ele é enviado de volta para a própria carteira do seu nó.
Considere isso como um incentivo extra para proteger sua carteira de nó contra comprometimento.
:::

### Aceitando um Convite

Depois que seu nó estiver configurado e você tiver sido convidado para ingressar no Oracle DAO pelos membros existentes, você pode usar o comando `rocketpool odao join` para aceitar o convite.
Isso envolverá duas transações:

- Uma para bloquear o RPL necessário para o seu vínculo
- Uma para ingressar no Oracle DAO quando o vínculo for recebido

Depois de ingressar, seu daemon `watchtower` começará automaticamente a executar suas funções necessárias.
Você pode verificar isso observando seus logs (por exemplo, `rocketpool service logs watchtower` para instalações padrão baseadas em Docker); o watchtower executa seu ciclo de funções a cada 4 a 6 minutos, e você notará uma mudança distinta em sua saída depois de ingressar no Oracle DAO.

### Próximas Etapas

Agora que você ingressou no Oracle DAO, dê uma olhada na próxima seção para aprender como testar seu nó nesta função.
