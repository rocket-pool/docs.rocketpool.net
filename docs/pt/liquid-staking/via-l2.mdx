import { Tab, Tabs } from "@rspress/core/theme";

# Staking via uma Exchange Descentralizada na Layer 2

Como lembrete, você não precisa trocar ETH por rETH diretamente via Rocket Pool para desfrutar dos benefícios do staking descentralizado.
Tudo o que você precisa fazer é manter rETH, pois ele inerentemente cresce em valor - como você o obtém não importa!

Dito isso, uma das principais preocupações (especialmente nos últimos tempos) é o custo de gas associado ao staking ou troca de ETH por rETH.

Para ajudar a reduzir isso, a rede Ethereum começou a adotar o uso de [rollups](https://www.youtube.com/watch?v=7pWxCklcNsU) - também conhecidos como **Layer 2**.

Layer 2 compreende várias redes separadas que vivem abaixo do Ethereum, executando muitas transações como o Ethereum normalmente faria, mas agrupando todas elas em uma única "mega" transação e postando _isso_ na cadeia principal do Ethereum.
Idealmente, isso significa que você obteria todos os benefícios de segurança associados à natureza descentralizada do Ethereum, mas desfrutaria de **taxas de gas muito menores** para suas transações, já que os custos de execução e armazenamento nas Layer 2s podem ser muito menores e apenas uma porção de suas transações deve ser armazenada na Layer 1, onde o estado é muito mais caro.

Rocket Pool atualmente suporta duas redes Layer 2: [Optimism](https://www.optimism.io/) e [Arbitrum](https://arbitrum.io/).
Ambas têm versões funcionais do [Uniswap](https://docs.uniswap.org/protocol/introduction), o protocolo de exchange descentralizada mais amplamente usado.
Com o Uniswap, você pode trocar ETH por rETH de forma rápida e fácil.

A vantagem de usar esta abordagem é que **as taxas de gas serão substancialmente menores** do que com outros métodos.
Se isso é importante para você porque deseja fazer staking de uma pequena quantidade de ETH, então usar uma rede Layer 2 provavelmente será sua opção de escolha.

A desvantagem é que você pode não obter o melhor negócio em rETH.
Uniswap requer uma pequena taxa que é dada aos seus provedores de liquidez, e transações grandes exigirão grandes pools de liquidez para obter bons negócios sem muito impacto no preço.
Redes Layer 2 tendem a ter menor liquidez de rETH do que a rede principal do Ethereum.

Portanto, recomendamos que você compare o total de rETH que obteria em uma rede Layer 2 com o que obteria através dos outros métodos para determinar se faz sentido para você seguir este caminho.

Você pode visualizar os saldos atuais de ETH e rETH do [pool Optimism](https://info.uniswap.org/#/optimism/pools/0xaefc1edaede6adadcdf3bb344577d45a80b19582) e do [pool Arbitrum](https://info.uniswap.org/#/arbitrum/pools/0xaac7de2b91293ba1791503d9127d2bdf2159db65) para determinar se eles têm rETH suficiente para cobrir sua troca.

No exemplo a seguir, demonstraremos como interagir com redes Layer 2 e usar o Uniswap para trocar ETH por rETH.

::: warning NOTA
Atualmente este método está disponível apenas na Mainnet.
Se você quiser praticar na Hoodi Testnet, você deve [trocar diretamente com o Rocket Pool](./via-rp).

**O restante deste guia assumirá que você está na Mainnet.**
:::

Este processo pode ser concluído com qualquer carteira compatível com web3.
Para fins de demonstração, vamos usar [MetaMask](https://metamask.io/) por ser uma das escolhas de carteira mais populares.

**Você deve conseguir acompanhar usando passos similares com uma carteira diferente se escolher - apenas encontre a função comparável em sua carteira para cada passo.**

## Configurando a MetaMask na Mainnet

Comece instalando [MetaMask](https://metamask.io/) se você ainda não o fez.
Siga as instruções em seu site para instalar a extensão, criar uma conta e fazer login.

Em seguida, abra o painel MetaMask usando seu ícone na barra de ferramentas do navegador.
Clique no **dropdown de rede** na barra de ferramentas no topo e certifique-se de que **Ethereum Mainnet** esteja selecionada:

<img src="./images/mm_network_main.png" width="100%" height="auto" />

O endereço diretamente abaixo disso é seu **endereço de carteira Ethereum**.

Antes de prosseguir, você precisará fornecer ETH a esta carteira.
Se você ainda não tem ETH na conta de uso anterior, você pode fazer isso transferindo ETH de uma conta existente para este endereço de carteira.

## Transferindo ETH da Layer 1 para Layer 2 via Hop

Existem várias maneiras de fazer bridge de ETH da Ethereum Mainnet para uma rede Layer 2.
Nesta demonstração, vamos usar o protocolo [Hop](https://docs.hop.exchange/faq) - uma maneira simples e confiável de mover ETH (e algumas outras moedas) da Layer 1 para várias redes Layer 2, ou entre redes Layer 2.

Navegue até o site da exchange Hop aqui:

[https://app.hop.exchange/send?token=ETH](https://app.hop.exchange/send?token=ETH)

A tela inicial deve se parecer com isto:

<img src="./images/hop.png" width="100%" height="auto" />

Comece clicando no botão **Connect a Wallet** no canto superior direito.
Você será solicitado com uma tela que pergunta qual provedor de carteira você deseja usar.
Para este exemplo, selecione **MetaMask**.

::: tip NOTA
Se você não estiver usando MetaMask, um dos outros provedores como WalletConnect provavelmente será compatível com sua carteira.
:::

Ao clicar nesse botão, a MetaMask aparecerá com um prompt pedindo que você selecione quais contas deseja usar.
Assumindo que você tenha apenas uma, sua conta já deve estar selecionada.
Clique em **Next**.

Em seguida, perguntará se você gostaria de dar ao Hop acesso para visualizar os endereços de suas contas:

<img src="./images/hop_connect.png" width="100%" height="auto" />

Clique em **Connect** e após uma breve pausa, sua carteira será conectada ao Hop.
Você agora deve ver seu saldo de ETH no canto superior direito da tela.

Agora, você pode usar os dois dropdowns nas caixas **From** e **To (estimated)** para selecionar suas redes, e digitar a quantidade de ETH que deseja enviar na caixa **From**.

Por exemplo, é assim que ficaria para enviar 0,1 ETH da Layer 1 para Arbitrum:

<img src="./images/hop_send.png" width="100%" height="auto" />

::: warning NOTA
Como lembrete, Uniswap (e portanto staking do Rocket Pool) atualmente é **suportado apenas em Optimism e Arbitrum**.
Você deve selecionar uma dessas redes.
:::

Quando estiver pronto, clique no botão **Send**.
MetaMask aparecerá com um diálogo de confirmação que mostra a taxa de gas associada à transação:

<img src="./images/hop_confirm.png" width="100%" height="auto" />

Se você estiver confortável com essas taxas de gas, clique em **Confirm** para iniciar a transação.
Após alguns momentos, MetaMask aparecerá com uma mensagem de confirmação de transação bem-sucedida, e seu ETH agora estará disponível em sua rede Layer 2 de escolha!

## Conectando ao Uniswap na Layer 2

Agora que sua carteira está configurada e financiada, acesse esta URL que abrirá o Uniswap e mostrará automaticamente a troca de ETH por rETH:

[https://app.uniswap.org/#/swap?inputCurrency=eth](https://app.uniswap.org/#/swap?inputCurrency=eth)

A página ficará assim inicialmente:

<img src="./images/uni_connect.png" width="100%" height="auto" />

Clique em um dos botões `Connect Wallet` como o destacado no canto superior direito.
Você será solicitado com uma tela que pergunta qual provedor de carteira você deseja usar.
Para este exemplo, selecione **MetaMask**.

::: tip NOTA
Se você não estiver usando MetaMask, um dos outros provedores como WalletConnect provavelmente será compatível com sua carteira.
:::

Ao clicar nesse botão, a MetaMask aparecerá com outro prompt pedindo que você selecione quais contas deseja usar, assim como fez com o Hop.
Deixe sua conta selecionada, clique em **Next**, e depois clique em **Connect** como fez com o Hop anteriormente.
Após uma breve pausa, sua carteira será conectada ao Uniswap.
Você agora deve ver seu saldo de ETH no canto superior direito da tela.

A primeira coisa a fazer é mudar sua rede da mainnet Ethereum para a Layer 2 para a qual você acabou de trocar.
Clique no dropdown de rede no canto superior direito da tela (destacado em vermelho aqui):

<img src="./images/uni_network.png" width="100%" height="auto" />

Uma vez que você fizer isso, MetaMask pedirá que você confirme que deseja adicionar uma rede personalizada:

<img src="./images/uni_net_confirm.png" width="100%" height="auto" />

Clique em **Approve** e depois clique em **Switch Network**.
Isso mudará a MetaMask para usar a nova rede Layer 2 em vez da mainnet do Ethereum para transações.

::: warning NOTA
Antes de fazer qualquer transação com MetaMask, _sempre_ verifique qual rede ela está usando atualmente abrindo MetaMask e olhando o dropdown de rede no topo!
É fácil acidentalmente mudar para uma rede diferente e esquecer!
:::

## Adicionando rETH à MetaMask

O próximo passo é adicionar o token rETH à MetaMask para que você possa ver seu saldo e acessá-lo para negociação.
Clique na aba **Assets**, depois clique em **Add Token**:

<img src="./images/mm_add_token.png" width="100%" height="auto" />

Certifique-se de que **Custom Token** esteja selecionado neste diálogo, e selecione a aba apropriada para a rede Layer 2 que você escolheu abaixo:

<div className="p-3">
  <Tabs>
    <Tab label="Optimism">
      Na caixa **Token Contract Address**, coloque o seguinte valor:

      ```shell
      0x9bcef72be871e61ed4fbbc7630889bee758eb81d
      ```

      O **Token Symbol** deve ser preenchido automaticamente com `rETH`, e o **Decimals of Precision** deve ser preenchido automaticamente com `18`.

      Aceite o restante dos prompts, e então você verá o token rETH aparecer em sua lista.
    </Tab>
    <Tab label="Arbitrum">
      Na caixa **Token Contract Address**, coloque o seguinte valor:

      ```shell
      0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8
      ```

      O **Token Symbol** deve ser preenchido automaticamente com `rETH`, e o **Decimals of Precision** deve ser preenchido automaticamente com `18`.

      Aceite o restante dos prompts, e então você verá o token rETH aparecer em sua lista.
    </Tab>

  </Tabs>
</div>

## Trocando ETH por rETH com Uniswap

O passo final do processo é fazer a troca!

Clique no dropdown **Select a token** e digite o endereço para rETH que você acabou de adicionar à MetaMask (você também pode apenas digitar rETH, mas **certifique-se de que é o token correto e não um impostor ou token de golpe** verificando seu endereço primeiro).

::: warning NOTA
Você pode inicialmente ser solicitado com um aviso que se parece com isto:

<img src="./images/unknown_token.jpg" width="100%" height="auto" />

Este é apenas um aviso temporário até que o Uniswap adicione rETH à sua lista de tokens canônicos na Layer que você está usando.
Desde que o endereço do token seja `0x9bcef72be871e61ed4fbbc7630889bee758eb81d` no Optimism ou `0xec70dcb4a1efa46b8f2d97c310c9c4790ba5ffa8` no Arbitrum, você pode adicioná-lo com segurança.
:::

Em seguida, digite a quantidade de ETH que você deseja trocar e a interface do Uniswap mostrará a quantidade de rETH que você receberá em troca:

<img src="./images/arb_swap.png" width="100%" height="auto" />

::: warning NOTA
Observe que a quantidade de rETH que você recebe será **menor que** a quantidade de ETH que você colocou.
Isso é normal, porque **rETH vale mais que ETH** e se valoriza continuamente ao longo do tempo.
Você pode ver isso na taxa de câmbio destacada na parte inferior da captura de tela.
:::

Agora clique em **Swap** para ver os detalhes da negociação, incluindo a quantidade mínima que você poderia receber devido ao slippage.
Se você estiver satisfeito, clique em **Confirm Swap**.
Isso enviará a solicitação para a MetaMask, onde você pode revisar o custo total da transação antes de confirmá-la:

<img src="./images/arb_gas.png" width="100%" height="auto" />

::: tip NOTA
Preste **muita atenção** à taxa de gas estimada aqui.
Você provavelmente notará que é **aproximadamente 10x mais barato** em termos de taxas de gas fazer esta troca em uma rede Layer 2 do que na Ethereum Mainnet!
:::

Se você estiver satisfeito com as taxas de gas em relação à quantidade total de rETH que receberá, clique em **Confirm** para enviar a transação.
Após um curto período, você deve ver uma notificação da MetaMask de que foi concluída com sucesso, e agora você verá o token rETH em sua carteira.

É isso! Você está agora fazendo staking com o Rocket Pool. Tudo o que você precisa fazer é manter seu rETH, e você ganhará automaticamente suas recompensas de staking à medida que o valor do token rETH aumenta.
