import { Tab, Tabs } from "@rspress/core/theme";

# [Modo Docker] Guia para a Atualização Redstone e o Merge

Este guia cobrirá tudo o que você precisa saber para preparar seu nó para a Atualização Redstone e o Merge se você estiver usando **Modo Docker**.

## Coisas a Fazer Antes de Atualizar para v1.5.0

Antes de atualizar para v1.5.0 e superior do Smartnode, por favor passe pela seguinte checklist para garantir que você está preparado:

### Mudar para um Cliente de Execução Completo

O Merge requer que você execute seu próprio cliente de Execução, então você não poderá mais usar provedores remotos como Infura ou Pocket.
v1.5.0 não os terá mais, e não permitirá que você inicie a stack até que você selecione um cliente de Execução completo.

Por causa dessa mudança, você deve mudar para um cliente completo enquanto ainda estiver na v1.4, deixá-lo sincronizar até completar, e então atualizar para v1.5.

O Modo Docker torna a mudança de clientes muito fácil.
[Este guia](../../node-staking/change-clients#changing-execution-clients) fornece um passo a passo do processo.

## Atualizando para v1.5.0

Atualizar a stack do Smartnode para v1.5.0 não é diferente de qualquer outra atualização.
Simplesmente siga [as direções normais aqui](../../node-staking/updates#updating-the-smartnode-stack).

## Coisas que o Smartnode Lida Automaticamente

No modo Docker, o Smartnode cuidará da maioria das mudanças necessárias para suportar Redstone e o Merge automaticamente uma vez que você atualizar para v1.5.0.
Aqui está uma breve lista do que ele fará por você sem qualquer intervenção manual:

### A Engine API

O Merge muda a forma como seu cliente de Execução conversa com seu cliente de Consenso.
Em vez de usar o antigo sistema RPC baseado em HTTP ou Websocket, o Merge requer um novo sistema exposto pelo seu cliente de Execução chamado Engine API.

Esta é uma conexão especial que permite ao cliente de Consenso substituir o antigo sistema de mineração Proof-of-Work por Proof-of-Stake; é o coração do Merge.
Também é **autenticada** com um token secreto, então apenas seu cliente de Consenso pode conectar ao seu cliente de Execução - nada mais pode.

O Smartnode cuidará da configuração do token de autenticação e da Engine API em ambos seus clientes de Execução e Consenso automaticamente.

### Seu Fee Recipient

O **fee recipient** é o endereço na camada de Execução que receberá todas as taxas de prioridade para blocos que você propuser.
É uma configuração fornecida ao seu cliente Validator quando ele inicia pela primeira vez.

O Smartnode cuidará de configurá-lo para o endereço correto quando você atualizar para v1.5, e verificará constantemente para garantir que você está usando o correto para que você não seja [penalizado acidentalmente](https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system).

Se você optou pelo [Smoothing Pool](./whats-new#smoothing-pool), ele fará dele seu fee recipient.
Se você não optou, ele fará seu [contrato distribuidor de taxas](./whats-new#fee-recipients-and-your-distributor) o fee recipient.

### MEV-Boost

[MEV-boost](https://boost.flashbots.net/) é o sistema que a Flashbots fornece para dar recompensas MEV aos validadores Proof-of-Stake após o Merge.
O Rocket Pool tem MEV-Boost integrado no Smartnode e configura automaticamente seu nó para usá-lo, então suas propostas obtêm a quantidade máxima de recompensas.

## Coisas que Você Deve Fazer Após Atualizar

Embora o Smartnode lide com a maioria das mudanças para você, há algumas coisas adicionais que você deve fazer manualmente:

### Garantir uma Atualização Bem-Sucedida

A primeira coisa a fazer é garantir que seu nó está funcionando corretamente.
Considere tomar os seguintes passos:

- Verifique os logs em busca de erros com `rocketpool service logs eth1`, `rocketpool service logs eth2`, `rocketpool service logs validator`, e `rocketpool service logs node`.
- Confirme com um Block Explorer (como seu painel Grafana e [https://beaconcha.in](https://beaconcha.in)) que você ainda está atestando corretamente
  - Lembre-se de que se você tiver proteção Doppelganger habilitada, você perderá alguns atestados após a reinicialização. Isso é normal!

### Configurar um Nó de Fallback

Como o Merge não é compatível com provedores remotos como Infura e Pocket, você perderá a capacidade de usá-los como clientes de Execução de fallback quando seu primário ficar offline.

O Smartnode ainda tem a capacidade de fornecer um cliente de Execução de fallback (e agora um cliente de Consenso de fallback também), mas agora você precisará usar clientes de Execução e Consenso que você controla.

Para mais informações sobre configurar um nó de fallback, veja o [guia de nó de Fallback](../../node-staking/fallback).

### Inicializar seu Distribuidor de Taxas

Se você não planeja optar pelo [Smoothing Pool](./whats-new#smoothing-pool) e reivindicar todas as suas taxas de prioridade e recompensas MEV para seu [contrato distribuidor de taxas](./whats-new#fee-recipients-and-your-distributor), você eventualmente terá que inicializá-lo (criar a instância do contrato na cadeia) para reivindicar recompensas dele para seu endereço de retirada.

Esta é uma operação razoavelmente barata e só precisa ser feita uma vez.

::: tip DICA
Inicializar seu distribuidor de taxas pode ser feito a **qualquer momento**.
Você pode deixar recompensas acumularem em seu endereço muito antes de inicializá-lo, e seu saldo permanecerá após a inicialização.

Recomendamos que você faça isso quando os preços do gas estiverem baixos para minimizar o custo adicional.

Note que ele **deve ser inicializado para reivindicar suas recompensas.**
:::

### Optar pelo Smoothing Pool

Se você planeja aproveitar o [Smoothing Pool](./whats-new#smoothing-pool) imediatamente, você deve optar antes do final do primeiro período de recompensas Redstone para maximizar sua quantidade de "elegibilidade".

Optar pode ser feito executando o seguinte comando:

```
rocketpool node join-smoothing-pool
```

### Reivindicar Recompensas

A atualização Redstone substitui o antigo sistema de recompensas caro e problemático por um [totalmente novo](./whats-new#new-rewards-system) que é muito mais barato, suporta restaking automático de RPL (tanto quantidades parciais quanto completas), e - mais importante - **permite que você reivindique suas recompensas quando quiser**.

Como não há mais um limite de tempo para reivindicar recompensas, e porque é mais barato reivindicar muitos intervalos de recompensas de uma vez, a funcionalidade de reivindicação automática de recompensas do Smartnode **foi removida**.
Agora você poderá reivindicar recompensas através do seguinte comando:

```
rocketpool node claim-rewards
```

Isso mostrará todas as recompensas que você acumulou em todos os intervalos de recompensas começando com a atualização Redstone.

## Revertendo para v1.4.3

Se, por qualquer motivo, algo não for do seu agrado e você quiser reverter para a versão anterior do Smartnode, você pode fazer isso facilmente.
O Smartnode faz backup automático de suas configurações da versão anterior quando você o atualiza, então simplesmente obtenha a versão anterior (aqui estamos demonstrando **v1.4.3**) e substitua as configurações pelo backup:

1. Pare o serviço:

```shell
rocketpool service stop
```

1. Baixe o CLI v1.4.3:

<div className="p-3">
  <Tabs>
    <Tab label="Linux x64">```shell wget https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool ```</Tab>
    <Tab label="Linux arm64">```shell wget https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool ```</Tab>
    <Tab label="Mac x64">```shell curl -L https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool ```</Tab>
    <Tab label="Mac arm64">```shell curl -L https://github.com/rocket-pool/smartnode/releases/download/v1.4.3/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool ```</Tab>
  </Tabs>
</div>

1. Instale o pacote v1.4.3:

```shell
rocketpool service install -d
```

1. Substitua sua configuração antiga pela configuração de backup v1.4.3:

```shell
cp ~/.rocketpool/user-settings-backup.yml ~/.rocketpool/user-settings.yml
```

1. Verifique se todas as suas configurações antigas estão sendo usadas agora:

```shell
rocketpool service config
```

1. Se parecer bom, inicie a stack do Smartnode:

```shell
rocketpool service start
```

Tudo pronto! Você agora está de volta na versão antiga e deve começar a atestar logo após iniciar o serviço.

::: danger AVISO
v1.4.3 está **descontinuada** e não será mais utilizável após a implantação da atualização Redstone.
Se você precisar reverter para ela, por favor faça planos para atualizar de volta para v1.5.0 antes que os contratos sejam atualizados!
:::
