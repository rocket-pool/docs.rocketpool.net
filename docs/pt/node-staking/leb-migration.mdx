import { Tab, Tabs } from "@rspress/core/theme";

::: danger AVISO
Os depósitos de minipool estão atualmente desabilitados em preparação para Saturn 1.
:::

# Migrando um Minipool de 16-ETH para 8-ETH

Os operadores de nó têm a capacidade de **migrar diretamente** seus minipools existentes de 16-ETH para minipools de 8-ETH.
Fazer isso adicionará 8 ETH aos seus [saldos de crédito de depósito](./credit) que podem ser usados para **criar minipools adicionais sem exigir nenhum ETH dos operadores de nó**.

Na prática, este processo permite que um operador de nó **converta um minipool de 16-ETH em dois minipools de 8-ETH gratuitamente** (_embora ainda exija ETH para gas e exija garantia RPL suficiente para lidar com ambos os minipools_).

Migrar um minipool existente de 16-ETH para um de 8-ETH é formalmente conhecido como **redução de bond**.
É um processo de duas etapas e envolve validação pelo Oracle DAO.
Vamos orientá-lo por todo o processo nas seções abaixo.

### Regras de Redução de Bond

Uma redução de bond envolve as seguintes etapas:

1. Iniciar a redução de bond, feito pelo operador de nó.
2. Um período de espera (o "bond reduction scrub check"), permitindo ao Oracle DAO tempo para verificar se a redução de bond é legal e cancelar quaisquer reduções de bond que violem as regras.
3. Concluir a redução de bond, feito pelo operador de nó.

Para realizar uma redução de bond bem-sucedida sem ser cancelada, o minipool deve seguir estas regras:

1. O minipool deve ser atualizado para o [delegado Atlas](./minipools/delegates); o antigo delegado Redstone não pode ser usado.
1. O validador do minipool na Beacon Chain deve estar **pendente ou ativamente fazendo staking**. Ele não pode estar slashed, saindo / saído, ou retirado / withdrawable.
1. O saldo do validador do minipool na Beacon Chain deve ser **pelo menos 31,99 ETH** (32 ETH com uma pequena margem para complicações mal cronometradas resultando em attestations perdidas após um skim de recompensas).

O minipool deve obedecer a essas condições durante **toda a duração** do scrub check, durante o qual o Oracle DAO estará observando-o para garantir conformidade com as condições acima.

Se, a qualquer momento durante o scrub check, um minipool for encontrado em violação dessas condições, a redução de bond será **cancelada**.
O minipool em si não será afetado; ele continuará felizmente como um minipool de 16 ETH, validando e agindo como se todo o processo de redução de bond nunca tivesse acontecido.
No entanto, **ele não será mais elegível para reduções de bond**.
Uma vez que a redução de bond de um minipool é cancelada, ela nunca pode ser tentada novamente.

::: warning NOTA
Após uma redução de bond bem-sucedida, o valor do bond do minipool será reduzido de 16 ETH para 8 ETH e **a comissão do minipool será redefinida para qualquer que seja o valor atual da rede**.

Se você reduzir um minipool de 16 ETH com uma comissão de 20%, **você não manterá essa comissão de 20%**.
Ela será reduzida para o valor da rede (**atualmente definido em 14%**).

Observe que, como demonstrado pela seção de [exemplo de cálculo](./create-validator.mdx#rewards), um minipool de 8 ETH a 14% é _ainda mais lucrativo_ do que um minipool de 16 ETH a 20%, então manter uma taxa de comissão alta não é uma razão convincente para reter um bond de 16 ETH.
:::

### Etapa 1: Iniciando a Redução de Bond

Para iniciar o processo de redução de bond, digite o seguinte comando:

```shell
rocketpool minipool begin-bond-reduction
```

Isso começará fornecendo um breve resumo sobre o processo (embora, se você leu este guia, tudo já deve ser familiar para você).
Depois de reconhecer que entende o processo, ele mostrará quais minipools atualmente têm um bond que pode ser reduzido, juntamente com seu bond e comissão atuais:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)

```

Depois de selecionar um ou mais minipools para reduzir, o Smartnode verificará se esses minipools são elegíveis para redução de bond.

Para ser elegível, essas condições devem ser satisfeitas:

- O minipool foi atualizado para usar o [contrato de delegado de minipool Atlas](./minipools/delegates).
- O validador do minipool deve ter um saldo na Beacon Chain de pelo menos 32 ETH.
- O validador do minipool deve estar pendente ou ativo.
- Você tem RPL suficiente em stake para suportar o nível mínimo de colateral RPL que seria necessário _após_ a redução de bond.

Caso contrário, ele imprimirá um aviso de erro explicando o que precisa ser feito primeiro; por exemplo:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)
2

Cannot reduce bond for minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5:
The minipool version is too low. It must be upgraded first using `rocketpool minipool delegate-upgrade`.
You do not have enough RPL staked to support this bond reduction; it would bring you below the minimum RPL staking requirement. You will have to stake more RPL first.
```

Isso mostra que o minipool selecionado requer uma atualização de delegado e o nó precisa de mais RPL em stake para reduzir o bond desse minipool.

Quando você tiver satisfeito as pré-condições, selecionar um minipool neste comando simplesmente solicitará que você escolha seu preço de gas para a transação e confirmação da ação.
Ao aceitar a confirmação, a redução de bond do minipool começará.

### Monitorando o Timer do Scrub Check

Depois de iniciar uma redução de bond, você pode ver quanto tempo falta até que ela possa ser concluída nos logs do seu daemon `node`:

<div className="p-3">
  <Tabs>
    <Tab label="Docker e Modo Híbrido">
      Para usuários do **Modo Docker** e **Modo Híbrido**, isso pode ser feito com o seguinte comando:

      ```shell
      rocketpool service logs node
      ```
    </Tab>
    <Tab label="Modo Nativo">
      Consulte o script que você usa para revisar os logs do sistema do seu daemon de nó.
    </Tab>

  </Tabs>
</div>

Você verá uma nova entrada indicando quanto tempo falta até que o scrub check para sua redução de bond seja concluído:

```
rocketpool_node  | 2023/02/25 09:04:21 Checking for minipool bonds to reduce...
rocketpool_node  | 2023/02/25 09:04:21 Minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 has 12m0s left until it can have its bond reduced.
```

Quando este timer chegar a zero e não aparecer mais nesses logs, você pode concluir a redução de bond.

### Etapa 2: Concluindo a Redução de Bond

Quando o timer de scrub terminar com sucesso, há duas maneiras de concluir a redução de bond do seu minipool:

1. Deixe o daemon `node` lidar com isso para você; ele faz isso durante a verificação de rotina que executa a cada cinco minutos (a mesma que imprime a linha de tempo restante no log acima). Se ele perceber que você tem uma redução de bond elegível, **ele completará a redução automaticamente** - assim como faz com o staking de minipools pendentes e verificação do seu fee recipient. Você verá uma saída no log `node` mostrando quando ele detectou e concluiu uma redução de bond.
2. Complete a redução de bond manualmente usando o seguinte comando:
   ```shell
   rocketpool minipool reduce-bond
   ```
   O comando é simples; siga as instruções para concluir o processo quando seu minipool estiver elegível para redução de bond.

Durante a redução de bond, o Rocket Pool **distribui o saldo existente do seu minipool** usando o bond e comissão pré-redução de bond do minipool para garantir que tanto você quanto os stakers de rETH recebam sua parte justa do saldo existente, e a redução de bond não altere as recompensas que qualquer uma das partes _teria_ recebido sobre esse saldo.

### Os Resultados de um Bond Reduzido

Você pode verificar a redução de bond bem-sucedida usando `rocketpool minipool status`.

**Antes** da redução de bond, para o minipool de exemplo que estivemos seguindo, esse comando produziria a seguinte saída:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             15.000000%
Node deposit:         16.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            16.000000 ETH
Minipool Balance (EL): 0.150713 ETH
Your portion:          0.086660 ETH
Available refund:      0.000000 ETH
Total EL rewards:      0.086660 ETH
...
Beacon balance (CL):   32.000152 ETH
Your portion:          16.000087 ETH
...
```

**Após** a redução de bond, o comando retornaria esta saída:

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             14.000000%
Node deposit:         8.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 0.086769 ETH
Your portion:          0.000000 ETH
Available refund:      0.086769 ETH
Total EL rewards:      0.086769 ETH
...
Beacon balance (CL):   32.000037 ETH
Your portion:          8.000013 ETH
...
```

Observe como as coisas mudaram:

- `Node fee` (comissão) passou de 15% para 14%
- `Node deposit` (seu bond) passou de 16 ETH para 8 ETH
- `RP deposit` (o valor que você emprestou) passou de 16 ETH para 24 ETH
- `Minipool Balance (EL)` passou de 0,150713 ETH para 0,086769 ETH
- `Your portion (EL)` passou de 0,086660 ETH para 0 ETH
- `Available refund` passou de 0 ETH para 0,086769 ETH
- `Your portion (CL)` passou de 16,000087 ETH para 8,000013 ETH

As mudanças em `Node fee`, `Node deposit`, `RP deposit` e `Your portion (CL)` indicam que o bond foi reduzido com sucesso.

As mudanças em `Minipool Balance (EL)`, `Your portion (EL)` e `Available refund` indicam os resultados da **distribuição de saldo do minipool** que ocorreu como parte do processo de redução de bond.
Para esclarecer como interpretar esses resultados:

- Se você olhar [a transação](https://zhejiang.beaconcha.in/tx/0xf02f6b1a4ea68f356909e6f1974dc3c24d301ba115b97f3013c3c829ba2ca57c), você também verá que ela enviou 0,06413383 ETH do minipool para o pool de staking.
- No exemplo "antes", a parte do pool de staking é o saldo do minipool menos a porção do operador de nó, ou `0,150713 - 0,086660 = 0,064053`, que é o valor transferido para o pool de staking durante a redução de bond (mais uma pequena quantidade de um skim de recompensas que ocorreu durante o scrub check).
- A parte do _operador de nó_, por outro lado, não é enviada para o endereço de retirada do operador de nó. Em vez disso, é marcada como um **reembolso disponível**, razão pela qual o valor do reembolso aumentou de 0 ETH para o que era anteriormente o valor "your portion" do saldo do minipool na EL.
  - Você pode reivindicar este reembolso a qualquer momento usando o seguinte comando:
    ```shell
    rocketpool minipool refund
    ```

Há mais um resultado importante da redução de bond, que pode ser observado usando `rocketpool node status`:

```
Your Smartnode is currently using the Zhejiang Test Network.

=== Account and Balances ===
The node 0x9BA1401Eb7D779eC51f910B066e9C4351cD28911 has a balance of 347.796908 ETH and 16799.835547 RPL.
The node has 8.000000 ETH in its credit balance, which can be used to make new minipools.
```

O processo de redução de bond **aumentou o** [saldo de crédito de depósito](./credit) do nó em 8 ETH.
Este crédito pode ser usado para [fazer outro minipool de 8 ETH](./create-validator.mdx#depositing-eth-and-creating-a-minipool) gratuitamente (nenhum ETH necessário da carteira do nó, exceto para gas)!
