import claim_rewards_gb from "./images/claim-rewards-gb.png";
import autostake from "./images/autostake.png";

# Reivindicando Recompensas de Node Operator

Como node operator do Rocket Pool, você tem direito a recompensas regulares que serão fornecidas na forma do token RPL e (se você estiver optado no Smoothing Pool) algum ETH também.
Esta seção descreverá como essas recompensas funcionam e como você pode reivindicá-las.

## Recompensas e Checkpoints

Em intervalos regulares, o Rocket Pool sinalizará um **checkpoint** na rede.
Atualmente, os checkpoints ocorrem **a cada 28 dias**.

Em um novo checkpoint, o Oracle DAO criará coletivamente um **snapshot verdadeiro** do estado dos node operators na rede Rocket Pool, que será usado para determinar as recompensas de RPL e ETH do Smoothing Pool para cada node durante esse intervalo. Note que a "comissão bônus" para minipools Saturn 0 é distribuída usando recompensas do smoothing pool (minipools Saturn 0 são aqueles criados após 28/10/2024, que têm uma comissão de contrato de 5%).

Esta informação é compilada em uma [Árvore de Merkle](https://en.wikipedia.org/wiki/Merkle_tree) - uma maneira extremamente eficiente de disponibilizar todos os detalhes para contratos inteligentes.
A Árvore de Merkle é construída em um arquivo JSON e hospedada no [InterPlanetary File System (IPFS)](https://en.wikipedia.org/wiki/InterPlanetary_File_System) e espelhada em [um repositório GitHub que mantemos](https://github.com/rocket-pool/rewards-trees/).

Uma vez que a árvore é submetida, os contratos inteligentes do Rocket Pool criarão novos tokens RPL e os moverão, juntamente com todo o saldo ETH do Smoothing Pool, para o cofre do Rocket Pool para armazenamento seguro.
Você pode então visualizar quantas recompensas de RPL e ETH você ganhou durante esse intervalo e reivindicar essas recompensas.

O sistema de recompensas possui os seguintes recursos:

- Cada intervalo é independente. A quantidade de RPL e ETH que você ganhou em um intervalo não afeta os ganhos para intervalos subsequentes.
- Você pode **deixar as recompensas acumularem** pelo tempo que quiser. Você não precisa reivindicar recompensas até um momento específico; elas sempre estarão disponíveis para você reivindicar, e sempre fornecerão exatamente a mesma quantidade de RPL e ETH **independentemente de quando você as reivindicar**.
- Você pode reivindicar um intervalo por vez, ou **múltiplos intervalos** de uma só vez.
- Sua primeira transação de reivindicação usa cerca de 85k de gas. Cada transação de reivindicação subsequente custa cerca de 55k de gas.
  - Se você estiver reivindicando múltiplos intervalos de uma vez, cada intervalo suplementar custa **6k de gas**, então é mais econômico reivindicar o máximo deles de uma vez possível.
- Você pode **reestaquear parte (ou toda) de suas recompensas de RPL** como parte da transação de reivindicação, então tudo é feito em uma única transação (o que reduz ainda mais os custos de gas).
- Atualmente, **todas as suas reivindicações devem estar na Mainnet**, mas temos a infraestrutura em vigor para construir a capacidade de reivindicar em redes Layer 2 em uma data posterior.

Para mais informações sobre como a Árvore de Merkle é construída e como as recompensas são calculadas, [visite nosso repositório `research` e veja as especificações oficiais](https://github.com/rocket-pool/rocketpool-research/tree/master/Merkle%20Rewards%20System).
Fornecemos uma breve explicação delas abaixo.

### Recompensas de RPL

A taxa de recompensas atual do RPL é **5% de inflação por ano** e as recompensas são pagas a cada período de 28 dias.
A partir de 21/10/2024, a inflação do último período foi de 77.533. Como 70% é distribuído aos node operators do Rocket Pool, isso foi 54.273 RPL naquele período.

Essa quantidade será dividida entre todos os node operators na rede, com base em seu [peso de node](https://rpips.rocketpool.net/RPIPs/RPIP-30#specification).
Node operators ganham o APY máximo para posições de RPL estaquedas valendo 0-15% do ETH emprestado.
O stake de RPL além de 15% do ETH emprestado ainda ganha recompensas adicionais, mas com um APY marginal reduzido.

Se menos de 28 dias se passaram entre o momento em que você registrou seu node e o checkpoint, suas recompensas naquele primeiro intervalo de recompensas serão **proporcionais** para contabilizar isso. Por exemplo, se você se registrou no dia 14 do intervalo, você receberia 50% das recompensas normais.

Depois desse primeiro intervalo, seu node terá sido registrado tempo suficiente nos intervalos subsequentes para que você receba recompensas completas para todos eles.

O comando `rocketpool node status` mostrará seu índice de colateralização atual em qualquer momento. Este índice de colateralização será baseado nos preços no momento em que você executar o comando. No entanto, se você quiser saber qual será seu índice de colateralização na próxima rodada de recompensas, siga as próximas etapas:

- Execute o comando `/when` no canal "random" do [Discord Rocketpool](https://discord.com/channels/405159462932971535/405503016234385409), e veja quantas horas faltam antes que o próximo período de recompensas comece.
- O oDAO faz um snapshot de preço a cada 19,2 horas (ou seja, cerca de 5760 blocos \* 12 segundos, excluindo blocos perdidos). Portanto, verificar o contrato de submissão de preço do oDAO no Etherscan dirá se um snapshot de preço foi feito nas 19,2 horas anteriores antes do momento declarado no ponto acima. Se for esse o caso, o snapshot de preço foi feito. Se não, ainda está por ser feito e você pode estimar quando acontecerá olhando para a última rodada de submissões de preço do oDAO e adicionando 19,2 horas.
- Para verificar qual proporção de preço RPL/ETH foi usada como snapshot pelo oDAO para a próxima rodada de recompensas, verifique o contrato de submissão de preço do oDAO no Etherscan (que você pode obter executando o comando `/get_address_of_contract contract:rocketNetworkPrices` no canal "random" do Discord Rocketpool). Depois, abra uma ou mais das transações submetidas pelos membros do oDAO. <a href="/images/node/rewards/rewards-1.png" target="_blank"><img src="/images/node/rewards/rewards-1.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Role para baixo e na seção "More Details", clique em **"+ Click to show more"**, e depois clique em **"Decode Input Data"**. <a href="/images/node/rewards/rewards-2.png" target="_blank"><img src="/images/node/rewards/rewards-2.png" style={{ display: "block", margin: "0 auto" }} /></a>
- O preço RPL (mostrado em unidades wei) exibido na caixa Input Data, dividido por 10^18 (para convertê-lo em unidades ETH) multiplicado pelo número de RPL estaquedos, deve ser >= 1,6 ETH (para minipools de 16 ETH) e >= 2,4 ETH (para LEB8s), vezes o número de minipools de cada tipo que você opera. <a href="/images/node/rewards/rewards-3.png" target="_blank"><img src="/images/node/rewards/rewards-3.png" style={{ display: "block", margin: "0 auto" }} /></a>
- Se seu índice de colateral estiver abaixo da quantidade necessária conforme explicado no ponto anterior, você pode estaquear RPL adicional no tempo entre o oDAO ter feito o último snapshot de preço (veja o ponto 3 acima), e o momento em que a próxima rodada de recompensas começa (veja os pontos 1 e 2 acima), a fim de trazer seu node de volta para um índice de colateralização >=10%.
- Uma alternativa para verificar as submissões de preço do oDAO no etherscan é ficar de olho no canal "events" do Discord Rocketpool, e procurar pela mensagem **RPL Price Update** do bot Rocket Watch (veja o exemplo abaixo) nas últimas 19,2 horas antes do início do próximo período de recompensas. <a href="/images/node/rewards/rewards-4.png" target="_blank"><img src="/images/node/rewards/rewards-4.png" style={{ display: "block", margin: "0 auto" }} /></a>

### Recompensas de ETH do Smoothing Pool

Juntamente com recompensas de RPL, todo o saldo ETH do Smoothing Pool é distribuído durante checkpoints de recompensas.
Do saldo total de recompensas do Smoothing Pool, a porcentagem que corresponde aos stakers do pool (50% para minipools de 16 ETH, ou 75% para LEB8s), menos a respectiva comissão do node, será enviada ao contrato rETH. Lá pode 1) ser queimado por ETH de stakers do pool que querem sair, ou 2) ser usado para criar mais minipools.
A porção restante será distribuída entre os node operators elegíveis.

Nodes que estão optados no smoothing pool para o intervalo, mesmo que apenas parte do tempo, são elegíveis para uma porção do saldo total do Smoothing Pool.
O saldo é fotografado no checkpoint de recompensas, e o Oracle DAO determina a porção de cada node elegível.
A porção é determinada pelos seguintes fatores:

- Quantidade de tempo no Smoothing Pool neste intervalo
- Performance de atestação na Beacon Chain para cada minipool
- A comissão de cada minipool

Se você quiser saber mais, consulte o repositório `research` vinculado acima para uma análise completa de como as recompensas são calculadas.

### (Opcional) Gerando a Árvore de Recompensas

Quando um novo checkpoint de recompensas é alcançado, o Oracle DAO começará a construir a árvore de recompensas para esse intervalo.
Construir esta árvore atualmente leva aproximadamente 2 horas, e as recompensas para o intervalo não estão disponíveis para reivindicação até que a árvore tenha sido construída e submetida.
Uma vez disponível, seu node fará o download automático deste arquivo e você poderá visualizar e reivindicar suas recompensas para esse intervalo.

Se você quiser gerar a árvore você mesmo em vez de baixar a pré-construída do Oracle DAO, você pode fazê-lo!

- Entre na TUI `rocketpool service config`.
- Navegue até a seção `Smartnode and TX Fees`.
- Mude o `Rewards Tree Mode` de `Download` para `Generate`.
- Se seu cliente Execution primário não for um node de arquivo, você pode adicionar uma URL para um node de arquivo separado na caixa `Archive-Mode EC URL`.
  - Isso é necessário para gerar árvores de recompensas históricas.
  - O EC de Arquivo será usado apenas para geração de árvore; não será usado para nenhuma outra tarefa do Smartnode.
  - [Infura](https://infura.io/product/ethereum) e [Alchemy](https://www.alchemy.com/supernode) oferecem acesso a node de arquivo. **Note que os níveis gratuitos geralmente não são suficientes para lidar com a geração de árvores, então você precisará de um dos níveis pagos.**

Agora seu Smartnode construirá a árvore completamente independente do Oracle DAO, usando apenas os dados fornecidos por seus clientes Execution e Consensus.
Você pode assistir durante um checkpoint de intervalo de recompensas com `rocketpool service logs watchtower`.

Se você quiser reconstruir árvores passadas de intervalos anteriores, você pode fazer isso com o seguinte comando:

```shell
rocketpool network generate-rewards-tree
```

Siga os prompts, e depois use `rocketpool service logs watchtower` para visualizar seu progresso.

## Reivindicando Recompensas

Para visualizar suas recompensas pendentes não reivindicadas, execute o seguinte comando:

```shell
rocketpool node claim-rewards
```

À medida que os intervalos passam e você acumula recompensas, a saída será parecida com esta:

<img src={claim_rewards_gb} width="100%" height="auto" />

Aqui você pode ver rapidamente quantas recompensas você ganhou em cada intervalo, e pode decidir qual(is) você quer reivindicar.

Você também pode especificar uma quantidade que deseja reestaquear durante esta reivindicação:

<img src={autostake} width="100%" height="auto" />

Isso permitirá que você componha suas recompensas de RPL em uma transação, o que economiza custos de gas.

Simplesmente siga os prompts, certifique-se de que sua carteira de node tenha ETH suficiente para pagar os custos de gas da reivindicação, e pronto!
**Suas recompensas serão enviadas para seu endereço de retirada.**

::: tip TIP
Para visualizar as recompensas totais do seu node, incluindo aquelas que você já reivindicou, use o seguinte comando:

```shell
rocketpool node rewards
```

Isso fornecerá uma divisão de quanto RPL e ETH você reivindicou até agora, e quanto ainda não está reivindicado:

```
=== ETH ===
You have earned 8.1935 ETH from the Beacon Chain (including your commissions) so far.
You have claimed 0.0634 ETH from the Smoothing Pool.
You still have 3.4788 ETH in unclaimed Smoothing Pool rewards.

=== RPL ===
The current rewards cycle started on 27 Sep 22 21:26 EDT.
It will end on 30 Sep 22 21:26 EDT (20h35m17s from now).
You currently have 675.616380 unclaimed RPL from staking rewards.

Your estimated RPL staking rewards for this cycle: 36.851544 RPL (this may change based on network activity).
Based on your current total stake of 6615.797278 RPL, this is approximately 67.77% APR.
Your node has received 208.551820 RPL staking rewards in total.

You may claim these rewards at any time. You no longer need to claim them within this interval.
```

:::

## Recompensas da Execution-Layer no seu Fee Distributor

Se você **não está** optado no Smoothing Pool, a porção da Execution-layer de suas recompensas de propostas de bloco (incluindo taxas de transação e recompensas MEV) será enviada para o contrato [Fee Distributor](./fee-distrib-sp#fee-distributors-and-the-smoothing-pool) do seu node.

Para verificar o saldo do seu Fee Distributor, você pode usar um explorador de chain como [https://etherscan.io](https://etherscan.io) ou simplesmente executar `rocketpool node status` - haverá uma seção chamada **Fee Distributor and Smoothing Pool** que o mostra:

```
=== Fee Distributor and Smoothing Pool ===
The node is not opted into the Smoothing Pool.
To learn more about the Smoothing Pool, please visit /pt/legacy/redstone/whats-new.html#smoothing-pool.
The node's fee distributor 0xA0bfbFC582f5814585f8455Ed6D7B620eA9a9EE4 has a balance of 1.143598 ETH.
```

### Distribuindo o Saldo

Para acessar o saldo do Fee Distributor, você vai **distribuí-lo** (daí o nome, _Fee Distributor_).
Isso calculará sua parte das recompensas (com base na comissão média de minipool do seu node) e a enviará para o endereço de retirada do seu node; o resto é enviado para o staking pool.

A distribuição pode ser feita **a qualquer momento**.
Você pode manter o saldo e deixá-lo acumular se desejar, ou distribuí-lo regularmente.

Para distribuir o saldo, execute o seguinte comando:

```shell
rocketpool node distribute-fees
```

Isso mostrará quanto vai para você e quanto vai para o staking pool:

```
Your node's average commission is 15.00%.
Your fee distributor's balance of 1.143599 ETH will be distributed as follows:
 Your withdrawal address will receive 0.657569 ETH.
 rETH pool stakers will receive 0.486030 ETH.
```

Simplesmente confirme o preço de gas que você deseja e submeta a transação.
Uma vez concluída, sua porção das recompensas estará disponível no endereço de retirada do seu node.
