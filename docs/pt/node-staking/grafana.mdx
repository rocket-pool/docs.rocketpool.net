import { Tab, Tabs } from "@rspress/core/theme";

# Configurando o Dashboard do Grafana

Agora que você tem seu nó funcionando, você provavelmente vai querer ter uma maneira conveniente de monitorar tudo sobre ele rapidamente para garantir que está funcionando corretamente (e que tipo de ganhos está gerando para você).

Existem muitas ferramentas por aí que fazem esse trabalho.
Uma das mais populares é chamada [Grafana](https://grafana.com/) - um sistema de dashboard de uso geral e fácil de usar que você pode acessar com um navegador.

Rocket Pool vem pronto para uso com suporte para Grafana e suas dependências; ele ainda vem com um dashboard pré-construído para cada um dos clientes de Consenso.
Por exemplo, aqui está uma imagem do que o dashboard parece na rede de teste Hoodi:

![](./images/grafana-1.3.jpg)

O dashboard padrão inclui as seguintes informações, tudo em um formato conveniente:

- **Superior esquerdo:** algumas estatísticas importantes sobre a saúde e desempenho da sua máquina, e quaisquer atualizações de sistema pendentes
- **Superior direito:** a atividade e desempenho dos seus validadores na Beacon Chain, juntamente com algumas estatísticas do cliente de Execução e Consenso
- **Inferior esquerdo:** detalhes sobre toda a rede Rocket Pool, para referência
- **Inferior direito:** detalhes sobre suas recompensas de staking, tanto ETH quanto RPL

Neste guia, vamos mostrar como habilitar o sistema de métricas do Rocket Pool para que você possa usar este dashboard - ou até construir o seu próprio!

## Visão Geral da Pilha de Métricas do Rocket Pool

Se você optar por habilitar métricas durante o processo de configuração do Smartnode, seu nó adicionará os seguintes processos:

- [Prometheus](https://prometheus.io/) - um sistema de coleta, armazenamento e relatório de dados que captura todas as métricas que você vê acima (e muitas mais) e as armazena, para que possam ser consultadas ao longo do tempo
- O [Node Exporter](https://github.com/prometheus/node_exporter) do Prometheus - um serviço que coleta informações sobre a saúde da sua máquina (como uso de CPU, uso de RAM, espaço livre em disco e espaço de swap, etc.) e relata para o Prometheus
- Grafana, a ferramenta que expõe os dados do Prometheus através de um site conveniente hospedado no seu nó
- Um conjunto opcional de scripts personalizados que relatará quaisquer atualizações de Sistema Operacional disponíveis ao Prometheus, para que você saiba se seu sistema precisa ser atualizado

A configuração padrão criará contêineres Docker com todos esses serviços que vivem ao lado dos outros contêineres Docker do Smartnode.
Ela abrirá uma porta na sua máquina de nó para Grafana, para que você possa acessar seu dashboard de qualquer máquina na sua rede local com um navegador.

## Habilitando o Servidor de Métricas

<div className="p-3">
  <Tabs>
    <Tab label="Docker">
      Habilitar métricas no modo Docker é o mais fácil de todos.

      Comece executando o comando de configuração do Smartnode novamente:

      ```shell
      rocketpool service config
      ```

      Vá para a seção `Monitoring / Metrics` e marque a caixa `Enable Metrics`.

      Para aqueles que preferem ajustar suas configurações de porta, você pode fazer isso aqui.
      Observe que todas essas portas estão restritas à rede interna do Docker com exceção da porta do Grafana - essa será aberta na sua máquina (para que você possa acessá-la através de um navegador de outras máquinas, como seu desktop ou telefone) então você pode querer mudá-la se a porta padrão entrar em conflito com algo que você já tem.

      Salve e saia, e o smartnode iniciará os contêineres Docker do Prometheus, Node Exporter e Grafana para você.

      Ele também modificará seus clientes de Consenso e Validador para que exponham suas próprias métricas ao Prometheus.

      O rastreador de atualizações do Sistema Operacional e do Rocket Pool **não é instalado por padrão** para máxima flexibilidade, mas o processo é simples.
      Se você gostaria de instalá-lo para que seu dashboard mostre quantas atualizações estão disponíveis para seu sistema, você pode fazer isso com este comando:

      ```shell
      rocketpool service install-update-tracker
      ```

      Por baixo dos panos, isso instalará um serviço que se conecta ao gerenciador de pacotes do seu Sistema Operacional, verifica periodicamente por atualizações e envia essa informação ao Prometheus.
      Este serviço é diferente para cada Sistema Operacional, mas foi confirmado que funciona nos seguintes:

      - Ubuntu 20.04+
      - Debian 9 e 10
      - CentOS 7 e 8
      - Fedora 34


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTA</p>
        Habilitar o serviço automaticamente é incompatível com SELinux.
        Se seu sistema tem SELinux habilitado por padrão (como é o caso com CentOS e Fedora), o comando de instalação levará você _quase até o fim_, mas também lhe dará instruções sobre como terminar o processo manualmente no final.
      </p>


      Durante essa verificação, ele também comparará sua versão instalada do Rocket Pool Smartnode com a versão mais recente, e informará se há uma nova versão disponível.

      Se você habilitou o rastreador de atualizações, o último passo é reiniciar o Node Exporter com o seguinte comando:

      ```shell
      docker restart rocketpool_exporter
      ```

      Depois disso, você deve estar pronto.
    </Tab>
    <Tab label="Hybrid">
      O Modo Híbrido funciona semelhante ao Modo Docker; a única diferença é que você deve adicionar manualmente os sinalizadores de linha de comando adequados para habilitar métricas à sua definição de serviço do Cliente de Execução e Consenso.

      Primeiro, atualizaremos seu Cliente de Execução.
      Abra o arquivo de unidade `systemd` que você criou quando instalou seu Cliente de Execução e certifique-se de que tem os sinalizadores corretos, com base em qual cliente você está executando:

      <div className="p-3">
        <Tabs>
          <Tab label="Geth">
            ```
            --metrics --metrics.addr 0.0.0.0 --metrics.port 9105
            ```
          </Tab>
          <Tab label="Nethermind">
            ```
            --Metrics.Enabled true --Metrics.ExposePort 9105
            ```
          </Tab>
          <Tab label="Besu">
            ```
            --metrics-enabled --metrics-host=0.0.0.0 --metrics-port=9105
            ```
          </Tab>
        </Tabs>
      </div>

      Em seguida, atualizaremos seu Cliente de Consenso.
      Abra o arquivo de unidade `systemd` que você criou quando instalou seu Cliente de Consenso e certifique-se de que tem os sinalizadores corretos, com base em qual cliente você está executando:

      <div className="p-3">
        <Tabs>
          <Tab label="Lighthouse">
            ```
            --metrics --metrics-address 0.0.0.0 --metrics-port 9100 --validator-monitor-auto
            ```
          </Tab>
          <Tab label="Lodestar">
            ```
            --metrics --metrics.address 0.0.0.0 --metrics.port 9100
            ```
          </Tab>
          <Tab label="Nimbus">
            ```
            --metrics --metrics-address=0.0.0.0 --metrics-port=9100
            ```
          </Tab>
          <Tab label="Prysm">
            ```
            --monitoring-host 0.0.0.0 --monitoring-port 9100
            ```

            Se você vir o sinalizador `--disable-monitoring`, remova-o.
          </Tab>
          <Tab label="Teku">
            ```
            --metrics-enabled=true --metrics-interface=0.0.0.0 --metrics-port=9100 --metrics-host-allowlist=*
            ```
          </Tab>

        </Tabs>
      </div>

      Se você já tem esses sinalizadores definidos e está usando portas diferentes para o monitoramento do seu validador solo, deixe-os como estão e anote quais portas você está usando.

      Agora, role para cima e siga as instruções na aba `Docker` desta seção para terminar o processo - tendo em mente que você deve substituir as portas listadas lá por quaisquer portas personalizadas que você usa quando executar `rocketpool service config`.

    </Tab>
    <Tab label="Native">
      A instalação nativa do Grafana e Prometheus é recomendada apenas para usuários avançados. Ela requer habilidades de administração Linux como `systemd`, permissões de arquivos, usuários e gerenciamento de rede.

      Primeiro, certifique-se de que seu Cliente de Execução e Cliente de Consenso têm métricas habilitadas. Consulte a aba 'Hybrid' para detalhes.

      Em seguida, verifique os pacotes pré-construídos do prometheus e node_exporter em [a página oficial de download](https://prometheus.io/download/).
      Escolha pacotes com arquitetura adequada para sua plataforma (amd64 ou arm64).
      A versão LTS (Long Time Support) mais recente do Prometheus é recomendada.

      Por exemplo, para baixar o prometheus v2.45.3 LTS e node_exporter v1.7.0 para Linux amd64 com `wget`, faça:

      ```shell
      wget https://github.com/prometheus/prometheus/releases/download/v2.45.3/prometheus-2.45.3.linux-amd64.tar.gz
      wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz
      wget https://github.com/prometheus/alertmanager/releases/download/v0.26.0/alertmanager-0.26.0.linux-amd64.tar.gz
      ```

      Extraia os executáveis prometheus e node_exporter dos arquivos baixados.

      ```shell
      sudo tar -zxvf prometheus-2.45.3.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/prometheus' --strip-components=1
      sudo tar -zxvf node_exporter-1.7.0.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/node_exporter' --strip-components=1
      sudo tar -zxvf alertmanager-0.26.0.linux-amd64.tar.gz -C /usr/local/bin --wildcards '*/alertmanager' --strip-components=1
      ```

      Crie diretórios para configurações do prometheus e alertmanager.

      ```shell
      sudo mkdir /etc/prometheus
      sudo mkdir /etc/alertmanager
      sudo mkdir /var/lib/prometheus
      sudo mkdir /var/lib/alertmanager
      ```

      Crie o arquivo `/etc/prometheus/prometheus.yml` com o seguinte conteúdo:

      ```yaml
      global:
      scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
      scrape_timeout: 12s # Timeout must be shorter than the interval
      evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.

      scrape_configs:
      - job_name: "prometheus"
      static_configs:
      - targets: ["localhost:9091"]

      - job_name: "node"
      static_configs:
      - targets: ["localhost:9103"]
      #     - targets: ['localhost:9103', 'node_hostname:9103']
      - job_name: "eth1"
      static_configs:
      - targets: ["localhost:9105"]
      # Uncomment the line below if you are using geth as Execution Client
      #metrics_path: /debug/metrics/prometheus

      - job_name: "eth2"
      static_configs:
      - targets: ["localhost:9100"]

      - job_name: "validator"
      static_configs:
      - targets: ["validator:9101"]

      - job_name: "rocketpool"
      scrape_interval: 5m
      scrape_timeout: 5m
      static_configs:
      - targets: ["node:9102"]

      - job_name: "watchtower"
      scrape_interval: 5m
      scrape_timeout: 5m
      static_configs:
      - targets: ["watchtower:9104"]

      alerting:
      alertmanagers:
      - static_configs:
      - targets: ["localhost:9093"]
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTA</p>
        Altere os números de porta para o Cliente de Execução e Cliente de Consenso, se necessário.

        Você pode estar executando seu nó em um host diferente do host executando o prometheus. Nesse caso,
        instale o node_exporter no host do seu nó rocketpool e atualize os `targets` do job `node` para incluir todas as máquinas que você deseja monitorar.
        Além disso, ajuste `metrics_path` se seu Cliente de Execução for geth - ele expõe um endpoint não padrão para métricas.
      </p>

      Crie o `/etc/alertmanager/alertmanager.yml` com o seguinte conteúdo:

      ```yaml
      global:
      # ResolveTimeout is the default value used by alertmanager if the alert does
      # not include EndsAt, after this time passes it can declare the alert as resolved if it has not been updated.
      # This has no impact on alerts from Prometheus, as they always include EndsAt.
      # default = 5m
      resolve_timeout: 5m

      route:
      # The labels by which incoming alerts are grouped together.
      group_by: ["alertname"]
      # How long to initially wait to send a notification for a group
      # of alerts. Allows to wait for an inhibiting alert to arrive or collect
      # more initial alerts for the same group.
      group_wait: 30s
      # How long to wait before sending a notification about new alerts that
      # are added to a group of alerts for which an initial notification has
      # already been sent. (Usually ~5m or more.)
      group_interval: 5m
      # How long to wait before sending a notification again if it has already been sent successfully for an alert.
      repeat_interval: 4h
      routes:
      # severity=info: Don't send the follow-up resolved notification.
      - match:
      severity: info
      continue: false
      # The notification destination
      receiver: "node_operator_no_resolved"
      # all other alerts get sent notifications for the initial firing _and_ resolved notifications.
      - receiver: "node_operator_default"
      #match: We want this to match all alerts (severity=info is first though so it will stop)

      # The notification destination
      receiver: "node_operator_default"

      receivers:
      - name: "node_operator_default"
      discord_configs:
      - webhook_url: "https://discord.com/api/webhooks/1206697259694170212/_Pk1eVVgXFLdwU1k0rfwehSvNLiAQJytVV_Ze8QYOhupHnhiB5c8awPBTfuw41lN9GJk"

      - name: "node_operator_no_resolved"
      discord_configs:
      - webhook_url: "https://discord.com/api/webhooks/1206697259694170212/_Pk1eVVgXFLdwU1k0rfwehSvNLiAQJytVV_Ze8QYOhupHnhiB5c8awPBTfuw41lN9GJk"
      send_resolved: false

      inhibit_rules:
      # Inhibit rules mute a new alert (target) that matches an existing alert (source).
      - source_match:
      # if the existing alert (source) is severity=critical
      severity: "critical"
      target_match:
      # and the new alert (target) is severity=warning
      severity: "warning"
      # and the alertname, job, and instance labels have the same value
      equal: ["alertname", "job", "instance"]
      ```

      Crie usuário de sistema para prometheus e alertmanager.

      ```shell
      sudo useradd -r -s /sbin/nologin prometheus
      sudo useradd -r -s /sbin/nologin alertmanager
      ```

      Altere a propriedade e permissões dos arquivos do prometheus/alertmanager.

      ```shell
      sudo chown prometheus:prometheus /usr/local/bin/prometheus
      sudo chown alertmanager:alertmanager /usr/local/bin/alertmanager
      sudo chown prometheus:prometheus /usr/local/bin/node_exporter
      sudo chown -R prometheus:prometheus /etc/prometheus
      sudo chown -R alertmanager:alertmanager /etc/alertmanager
      sudo chown -R prometheus:prometheus /var/lib/prometheus
      sudo chown -R alertmanager:alertmanager /var/lib/alertmanager
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/prometheus
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/alertmanager
      sudo chmod u+sx,g+sx,o-wx /usr/local/bin/node_exporter
      ```

      Crie o arquivo `/lib/systemd/system/node-exporter.service` para a configuração do serviço node_exporter.

      ```
      [Unit]
      Description=Node metrics exporter for Prometheus
      Documentation=https://prometheus.io/docs/introduction/overview
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=prometheus
      Group=prometheus
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/prometheus
      RuntimeDirectory=node-exporter
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/node_exporter --web.listen-address=:9103

      [Install]
      WantedBy=multi-user.target
      ```


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTA</p>
        Se você quiser alterar a porta na qual o node_exporter está executando, modifique o comando no parâmetro `ExecStart`. A porta padrão é 9100.
      </p>

      Crie o arquivo `/lib/systemd/system/prometheus.service` para a configuração do serviço prometheus.

      ```
      [Unit]
      Description=Prometheus instance
      Documentation=https://prometheus.io/docs/introduction/overview
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=prometheus
      Group=prometheus
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/prometheus
      RuntimeDirectory=prometheus
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/prometheus --config.file /etc/prometheus/prometheus.yml --web.listen-address=:9091

      [Install]
      WantedBy=multi-user.target
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTA</p>
        Se você quiser alterar a porta na qual o prometheus está executando, modifique o comando no parâmetro `ExecStart`. A porta padrão é 9090.
      </p>

      Crie o arquivo `/lib/systemd/system/alertmanager.service` para a configuração do serviço alertmanager.

      ```
      [Unit]
      Description=Alertmanager instance
      Documentation=https://prometheus.io/docs/alerting/latest/alertmanager/
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=alertmanager
      Group=alertmanager
      Type=simple
      Restart=on-failure
      WorkingDirectory=/var/lib/alertmanager
      RuntimeDirectory=alertmanager
      RuntimeDirectoryMode=0750
      ExecStart=/usr/local/bin/alertmanager --config.file /etc/alertmanager/alertmanager.yml --web.listen-address=:9093

      [Install]
      WantedBy=multi-user.target
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTA</p>
        Se você quiser alterar a porta na qual o alertmanager está executando, modifique o comando no parâmetro `ExecStart`. A porta padrão é 9093.
      </p>

      Informe ao `systemd` sobre os novos serviços.

      ```shell
      sudo systemctl daemon-reload
      ```

      Habilite e inicie o serviço node-exporter.

      ```shell
      sudo systemctl enable node-exporter
      sudo systemctl start node-exporter
      ```

      Verifique o status do serviço para garantir que está em execução.

      ```shell
      sudo systemctl status node-exporter
      ```

      Habilite e inicie o serviço prometheus.

      ```shell
      sudo systemctl enable prometheus
      sudo systemctl start prometheus
      ```

      Habilite e inicie o serviço alertmanager.

      ```shell
      sudo systemctl enable alertmanager
      sudo systemctl start alertmanager
      ```

      Verifique o status do serviço para garantir que está em execução.

      ```shell
      sudo systemctl status prometheus
      sudo systemctl status alertmanager
      ```

      Configure o repositório de pacotes para o Grafana.

      ```shell
      sudo apt-get update
      sudo apt-get install -y apt-transport-https software-properties-common
      sudo mkdir -p /etc/apt/keyrings/
      wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null
      echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
      ```

      Instale o Grafana.

      ```shell
      sudo apt-get update
      sudo apt-get install grafana
      ```

      Verifique as configurações em `/etc/grafana/grafana.ini`. Altere o `http_port` para 3100 para estar alinhado com as outras seções fornecidas neste documento.

      Configure a fonte de dados para visualizar métricas do Prometheus no Grafana. Crie o arquivo `/etc/grafana/provisioning/datasources/prometheus.yml`.

      ```yaml
      apiVersion: 1

      deleteDatasources:
      - name: Prometheus
      orgId: 1

      datasources:
      - name: Prometheus
      type: prometheus
      access: proxy
      orgId: 1
      url: http://localhost:9091
      basicAuth: false
      isDefault: true
      version: 1
      editable: true
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">NOTA</p>
        Edite `url` se você alterou a porta de escuta do Prometheus.
      </p>

      Habilite e inicie o serviço para o Grafana.

      ```shell
      sudo systemctl daemon-reload
      sudo systemctl enable grafana-server
      sudo systemctl start grafana-server
      ```

      Verifique se o Grafana está funcionando.

      ```shell
      sudo systemctl status grafana-server
      ```

      Isso é praticamente tudo.
    </Tab>

  </Tabs>
</div>

## Configure o firewall para permitir conexões para monitoramento

::: warning NOTA
Se você tem UFW habilitado conforme referenciado na seção [Protegendo seu Nó](./securing-your-node), você precisará abrir algumas portas para permitir conexões locais entre o Prometheus e seus Clientes de Execução/Consenso. Siga os passos abaixo.
:::

<div className="p-3">
  <Tabs>
    <Tab label="Docker">
      Execute o seguinte, e substitua as portas conforme necessário:

      ```shell
      RP_NET=$(docker inspect rocketpool_net | grep -Po "(?<=\"Subnet\": \")[0-9./]+")
      sudo ufw allow from $RP_NET to any port 9105 comment "Allow Prometheus access to Execution Client"
      sudo ufw allow from $RP_NET to any port 9100 comment "Allow Prometheus access to Consensus Client"
      sudo ufw allow from $RP_NET to any port 9103 comment "Allow Prometheus access to Exporter"
      ```
    </Tab>
    <Tab label="Native">
      Se o seu nó RocketPool e Prometheus residem em hosts diferentes, você precisa configurar o firewall no host do seu nó para permitir tráfego de entrada
      do IP do host do Prometheus para as portas de monitoramento do nó.
      Você também precisa configurar o UFW na máquina do Prometheus para permitir tráfego de saída do host do Prometheus para o host do nó RocketPool.

      Tendo o IP do host do nó `192.168.1.5` e o IP do host do Prometheus `192.168.1.6`, as regras UFW para o nó serão:

      ```shell
      sudo ufw allow from 192.168.1.6 to any port 9100:9105 proto tcp comment 'Allow Prometheus host to scrape metrics of this host'
      ```

      E para o host do Prometheus:

      ```shell
      sudo ufw allow out from any to 192.168.1.5 port 9100:9105 proto tcp comment 'Allow this host to scrape node metrics'
      ```

      Assumindo que sua porta de escuta do Grafana é 3100, continue lendo para descobrir como expor o Grafana na sua rede.
    </Tab>

  </Tabs>
</div>

Você pode então abrir o firewall para permitir que dispositivos externos acessem seu dashboard do Grafana.

<div className="p-3">
  <Tabs>
    <Tab label="Network">
      Use isso se você quiser acessar o Grafana de qualquer máquina dentro da sua rede local, mas negar acesso em todos os outros lugares.
      Este será o caso de uso mais comum.

      Verifique primeiro se sua rede local usa a estrutura `192.168.1.xxx`.
      Você pode ter que alterar o comando abaixo para corresponder à configuração da sua rede local se ela usar uma estrutura de endereço diferente (por exemplo, `192.168.99.xxx`).

      ```shell
      # This assumes your local IP structure is 192.168.1.xxx
      sudo ufw allow from 192.168.1.0/24 proto tcp to any port 3100 comment 'Allow grafana from local network'
      ```

    </Tab>
    <Tab label="Subnet">
      Use isso se o seu nó Rocket Pool não estiver conectado à mesma sub-rede que o dispositivo de onde você está visualizando o Grafana. Isso pode acontecer quando seu nó está conectado diretamente ao modem do seu provedor de internet e o dispositivo que você usa para visualizar o Grafana está conectado a um roteador secundário.

      Verifique primeiro se sua rede local usa a estrutura `192.168.1.xxx`.
      Você pode ter que alterar o comando abaixo para corresponder à configuração da sua rede local se ela usar uma estrutura de endereço diferente (por exemplo, `192.168.99.xxx`).

      ```shell
      # To allow any devices in the broader subnet
      # for example allowing 192.168.2.20 to access
      # grafana on 192.168.1.20
      sudo ufw allow from 192.168.1.0/16 proto tcp to any port 3100 comment 'Allow grafana from local subnets'
      ```
    </Tab>
    <Tab label="Anywhere">
      Isso permitirá que você acesse o Grafana de qualquer lugar.
      Se você quiser acessá-lo de fora da sua rede local, você ainda precisará encaminhar a porta do Grafana (padrão 3100) nas configurações do seu roteador.

      ```shell
      # Allow any IP to connect to Grafana
      sudo ufw allow 3100/tcp comment 'Allow grafana from anywhere'
      ```
    </Tab>

  </Tabs>
</div>

## Configurando o Grafana

Agora que o servidor de métricas está pronto, você pode acessá-lo com qualquer navegador na sua rede local.

Consulte as abas abaixo para o seu modo de instalação do Smartnode.

Navegue para a seguinte URL, substituindo as variáveis pela sua configuração conforme necessário:

```
http://<your node IP>:<grafana port>
```

Por exemplo, se o IP do seu nó fosse `192.168.1.5` e você usasse a porta padrão do Grafana de `3100`, então você iria para esta URL no seu navegador:

```
http://192.168.1.5:3100
```

Você verá uma tela de login assim:

<img src="./images/grafana-login.png" width="100%" height="auto" />

As informações padrão do Grafana são:

```
Username: admin
Password: admin
```

Você será então solicitado a alterar a senha padrão da conta `admin`.
Escolha algo forte e não esqueça!

::: tip Dica
Se você perder a senha do admin, pode redefini-la usando o seguinte comando no seu nó:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      ```shell
      docker exec -it rocketpool_grafana grafana-cli admin reset-admin-password admin
      ```

    </Tab>
    <Tab label="Native">
      ```shell
      sudo grafana-cli admin reset-admin-password admin
      ```
    </Tab>

  </Tabs>
</div>

Você poderá fazer login no Grafana usando as credenciais padrão `admin` novamente, e então será solicitado a alterar a senha da conta `admin`.
:::

Graças ao trabalho do membro da comunidade **tedsteen**, o Grafana se conectará automaticamente à sua instância do Prometheus para que tenha acesso às métricas que coleta.
Tudo que você precisa fazer é obter o dashboard!

## Importando o Dashboard do Rocket Pool

Agora que você tem o Grafana anexado ao Prometheus, você pode importar o dashboard padrão (ou construir o seu próprio usando as métricas que ele fornece, se você estiver familiarizado com esse processo).

Comece indo para o menu **Create** (o ícone de mais na barra lateral direita) e clique em **Import**:

<img src="./images/grafana-import.png" width="100%" height="auto" />

Quando solicitado para o ID do dashboard na caixa **Import via grafana.com**, digite `21863` ou use a URL completa ([(https://grafana.com/grafana/dashboards/21863](https://grafana.com/grafana/dashboards/21863)) e pressione o botão **Load**.

Você será solicitado com algumas informações sobre o dashboard aqui, como seu nome e onde você gostaria de armazená-lo (a pasta padrão **General** é boa a menos que você use muitos dashboards e queira organizá-los).

Sob o menu suspenso **Prometheus** na parte inferior, você deve ter apenas uma única opção rotulada **Prometheus (default)**.
Selecione esta opção.

Sua tela deve parecer com isto:

<img src="./images/grafana-import2.png" width="100%" height="auto" />

Se a sua corresponder, clique no botão **Import** e você será imediatamente levado ao seu novo dashboard.

À primeira vista, você deve ver muitas informações sobre seu nó e seus validadores.
Cada caixa vem com uma dica útil no canto superior esquerdo (o ícone `i`) sobre a qual você pode passar o mouse para saber mais sobre ela.
Por exemplo, aqui está a dica para a caixa **Your Validator Share**:

<img src="./images/tooltip.png" width="100%" height="auto" />

No entanto, ainda não terminamos de configurar as coisas - ainda há um pouco mais de configuração a fazer.

::: warning NOTA
Algumas das caixas (notadamente as de APR) foram temporariamente desabilitadas devido à maneira como Shapella fornece recompensas skimmed.

Elas serão habilitadas novamente em uma versão futura do Smartnode que pode rastrear recompensas históricas adequadamente.
:::

## Ajustando o Monitor de Hardware ao seu Sistema

Agora que o dashboard está funcionando, você pode notar que algumas caixas estão vazias, como **SSD Latency** e **Network Usage**.
Temos que ajustar o dashboard ao seu hardware específico para que ele saiba como capturar essas coisas.

### CPU Temp

Para atualizar seu medidor de temperatura da CPU, clique no título da caixa **CPU Temp** e selecione **Edit** no menu suspenso.
Sua tela agora ficará algo assim:

<img src="./images/cpu-temp.png" width="100%" height="auto" />

Este é o modo de edição do Grafana, onde você pode alterar o que é exibido e como parece.
Estamos interessados na caixa de consulta destacada em vermelho, à direita do botão **Metrics browser**.

Por padrão, essa caixa tem isto nela:

```
node_hwmon_temp_celsius{job="node", chip="", sensor=""}
```

Existem dois campos neste texto que estão atualmente em branco: `chip` e `sensor`.
Estes são únicos para cada máquina, então você terá que preenchê-los com base no que sua máquina fornece.

Para fazer isso, siga estes passos:

1. Remova a parte `, sensor=""` para que termine com `chip=""}`. Para clareza, o todo agora deve ser `node_hwmon_temp_celsius{job="node", chip=""}`.
2. Coloque seu cursor entre as aspas de `chip=""` e pressione `Ctrl+Spacebar`. Isso abrirá uma caixa de preenchimento automático com as opções disponíveis, que se parece com isto:

<img src="./images/grafana-autocomplete.png" width="100%" height="auto" />

3. Selecione a opção que corresponde à CPU do seu sistema.
4. Uma vez selecionado, adicione `, sensor=""` de volta na string. Coloque seu cursor entre as aspas de `sensor=""` e pressione `Ctrl+Spacebar` para obter outro menu de preenchimento automático. Selecione o sensor que você deseja monitorar.

::: tip Dica
Se você não sabe qual `chip` ou `sensor` está correto, você terá que tentar todos eles até encontrar o que parece certo. Para ajudar com isso, instale o pacote `lm-sensors` (por exemplo, `sudo apt install lm-sensors` no Debian / Ubuntu) e execute o comando `sensors -u` para fornecer quais sensores seu computador tem. Você pode tentar correlacionar um ID de chip da lista do Grafana com o que você vê aqui com base em seus nomes e IDs.

Por exemplo, esta é uma das saídas do nosso comando `sensors -u`:

```
k10temp-pci-00c3
Tctl:
  temp1_input: 33.500
Tdie:
  temp2_input: 33.500
```

No nosso caso, o chip correspondente no Grafana é `pci0000:00_0000:00:18_3` e o sensor correspondente é `temp1`.
:::

Uma vez que você esteja satisfeito com suas seleções, clique no botão azul **Apply** no canto superior direito da tela para salvar as configurações.

::: warning NOTA
Nem todos os sistemas expõem informações de temperatura da CPU - notadamente máquinas virtuais ou sistemas baseados em nuvem.
Se o seu não tiver nada no campo de preenchimento automático para `chip`, este é provavelmente o caso e você não poderá monitorar a temperatura da sua CPU.
:::

### SSD Latency

O gráfico **SSD Latency** rastreia quanto tempo leva para operações de leitura/escrita ocorrerem.
Isso é útil para avaliar quão rápido seu SSD é, para que você saiba se ele se torna um gargalo se seu validador sofre de desempenho ruim.
Para atualizar o SSD que você deseja rastrear no gráfico, clique no título **SSD Latency** e selecione **Edit**.

Este gráfico tem quatro campos de consulta (quatro caixas de texto) com oito partes `device=""` no total.
Você precisará atualizar as primeiras quatro dessas partes com o dispositivo que você deseja rastrear.

Simplesmente coloque seu cursor entre as aspas e pressione `Ctrl+Spacebar` para obter a lista de preenchimento automático do Grafana, e selecione a opção correta de lá para cada uma das partes `device=""`.
**Você quer começar pela configuração vazia mais à esquerda primeiro, ou a lista de preenchimento automático pode não aparecer.**

::: tip Dica
Se você não sabe qual dispositivo rastrear, execute o seguinte comando:

```
lsblk
```

Isso exibirá uma árvore mostrando sua lista de dispositivos e partições, por exemplo:

```
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
...
loop25        7:25   0   132K  1 loop /snap/gtk2-common-themes/9
loop26        7:26   0  65,1M  1 loop /snap/gtk-common-themes/1515
nvme0n1     259:0    0 238,5G  0 disk
├─nvme0n1p1 259:1    0   512M  0 part /boot/efi
├─nvme0n1p2 259:2    0 150,1G  0 part /
├─nvme0n1p3 259:3    0  87,4G  0 part
└─nvme0n1p4 259:4    0   527M  0 part
```

Se você não mudou a localização padrão do Docker para um drive diferente durante sua instalação do Smartnode, então o disco que você quer rastrear será aquele em que seu Sistema Operacional está instalado.
Procure na coluna `MOUNTPOINT` por uma entrada simplesmente rotulada `/`, então siga isso de volta para seu dispositivo pai (aquele com `disk` na coluna `TYPE`).

Tipicamente isso será `sda` para drives SATA ou `nvme0n1` para drives NVMe.

Se você _mudou_ a localização padrão do Docker para um drive diferente, ou se você está executando uma configuração híbrida / nativa, você deve ser capaz de usar a mesma técnica de "seguir o ponto de montagem" para determinar em qual dispositivo seus dados de cadeia residem.
:::

Opcionalmente, você também pode rastrear a latência de um segundo disco no seu sistema.
Isso é destinado a pessoas que mantêm seu Sistema Operacional e dados de cadeia em drives separados.
Para configurar isso, simplesmente siga as instruções acima para os últimos dois campos de consulta, substituindo os valores da parte `device=""` com os do disco que você deseja rastrear.

Uma vez que você esteja satisfeito com suas seleções, clique no botão azul **Apply** no canto superior direito da tela para salvar as configurações.

### Network Usage

Este gráfico rastreia quanto dados você está enviando e recebendo em uma conexão de rede específica.
Como você deve esperar, o dashboard precisa saber qual rede você quer que ele rastreie.

Para alterá-la, clique no título **Network Usage** e selecione **Edit**.

Este gráfico tem dois campos de consulta com duas partes `device=""` no total.
Você precisará atualizar estes com a rede que você deseja rastrear.

Coloque seu cursor entre as aspas e pressione `Ctrl+Spacebar` para obter a lista de preenchimento automático do Grafana, e selecione a opção correta de lá para cada uma das partes `device=""`.

::: tip Dica
Se você não sabe qual dispositivo rastrear, execute o seguinte comando:

```shell
sudo route
```

A saída ficará algo assim:

```
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.1.1     0.0.0.0         UG    100    0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0
192.168.1.1     0.0.0.0         255.255.255.255 UH    100    0        0 eth0
```

Procure na coluna `Destination` pela linha com o valor de `default`.
Siga essa linha até o final da coluna `Iface`.
O dispositivo listado lá é o que você quer usar - neste exemplo, `eth0`.
:::

Uma vez que você esteja satisfeito com suas seleções, clique no botão azul **Apply** no canto superior direito da tela para salvar as configurações.

### Total Net I/O

Isso rastreia a quantidade total de dados que você enviou e recebeu.
Você pode achar útil observar se, por exemplo, seu provedor de internet limita você a uma certa quantidade de dados por mês.

A configuração é idêntica à caixa **Network Usage** acima, então simplesmente siga essas instruções para esta caixa também.

### Disk Space Used

Isso fica de olho em quão cheio seu disco do Sistema Operacional está ficando, para que você saiba quando é hora de limpar (e se seus dados de cadeia estiverem no mesmo drive, hora de [podar Geth ou Nethermind](./pruning)).

Os passos são os mesmos da caixa **SSD Latency** acima, então simplesmente siga essas instruções para esta caixa também.
Como lembrete, você quer o drive que abriga a partição que tem `/` na coluna `MOUNTPOINT` para este, porque esse será seu drive do Sistema Operacional.
Preencha isso no primeiro campo de consulta.

Opcionalmente, você também pode rastrear o espaço livre de um segundo disco no seu sistema.
Isso é destinado a pessoas que mantêm seu Sistema Operacional e dados de cadeia em drives separados.
Configure isso seguindo o mesmo processo, mas em vez de procurar qual partição tem `/` na coluna `MOUNTPOINT`, você quer procurar a que tem qualquer que seja o ponto de montagem do seu segundo drive.
Atualize o segundo campo de consulta com o disco associado a essa partição.

### Disk Temp

Isso rastreia a temperatura atual do seu disco do Sistema Operacional. Os passos são os mesmos da caixa **CPU Temp** acima, então simplesmente siga essas instruções para esta caixa também, substituindo valores de chip e sensor de CPU com os do seu disco do Sistema Operacional. Preencha esses valores no primeiro campo de consulta.

Opcionalmente, você também pode rastrear a temperatura atual de um segundo disco no seu sistema. Configure isso seguindo o mesmo processo, substituindo os valores de chip e sensor com os do seu segundo drive. Preencha esses valores no segundo campo de consulta.

## Personalizando o Dashboard

Embora o dashboard padrão tente fazer um bom trabalho capturando tudo que você gostaria de ver rapidamente, é bastante fácil personalizar um dashboard do Grafana como você quiser.
Você pode adicionar novos gráficos, alterar a aparência dos gráficos, mover as coisas, e muito mais!

Dê uma olhada na página [Tutoriais do Grafana](https://grafana.com/tutorials/) para aprender como brincar com ele e configurá-lo ao seu gosto.

## Personalizando a Pilha de Métricas

As ferramentas usadas na Pilha de Métricas do Rocket Pool oferecem uma ampla variedade de opções de configuração além do que está incluído na instalação padrão do Rocket Pool. Esta seção inclui exemplos de configuração para diferentes casos de uso.

Em geral, [opções de configuração do Grafana](https://grafana.com/docs/grafana/latest/administration/configuration/) devem ser passadas usando variáveis de ambiente em `override/grafana.yml`. Qualquer opção de configuração pode ser convertida em uma variável de ambiente usando a seguinte sintaxe:

```
GF_<SectionName>_<KeyName>
```

### Configurações SMTP do Grafana para Envio de Emails

Para enviar emails do Grafana, por exemplo, para alertas ou para convidar outros usuários, as configurações SMTP precisam ser configuradas na Pilha de Métricas do Rocket Pool.
Consulte a página [configuração SMTP do Grafana](https://grafana.com/docs/grafana/latest/administration/configuration/#smtp) para referência.

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      Abra `~/.rocketpool/override/grafana.yml` em um editor de texto.
      Adicione uma seção `environment` abaixo da linha `x-rp-comment: Add your customizations below this line`, substituindo os valores abaixo com os do seu provedor SMTP.

      ```yaml
      version: "3.7"
      services:
      grafana:
      x-rp-comment: Add your customizations below this line
      environment:
      ## SMTP settings start, replace values with those of your SMTP provider
      - GF_SMTP_ENABLED=true
      - GF_SMTP_HOST=mail.example.com:`port` # Gmail users should use smtp.gmail.com:587
      - GF_SMTP_USER=admin@example.com
      - GF_SMTP_PASSWORD=password
      - GF_SMTP_FROM_ADDRESS=admin@example.com
      - GF_SMTP_FROM_NAME="Rocketpool Grafana Admin"
      ## SMTP server settings end
      ```
    </Tab>
    <Tab label="Native">
      Abra `/etc/grafana/grafana.ini` em um editor de texto. Procure pela seção `[smtp]` e atualize-a, substituindo os valores abaixo com os do seu provedor SMTP.

      ```
      [smtp]
      enabled = true
      host = mail.example.com:`port` # Gmail users should use smtp.gmail.com:587
      user = admin@example.com
      # If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;"""
      password = """passw0rd"""
      from_address = admin@example.com
      from_name = "Rocketpool Grafana Admin"
      ```
    </Tab>

  </Tabs>
</div>

::: tip Dica
Se estiver usando Gmail e a [Verificação em 2 Etapas](https://support.google.com/accounts/answer/185839) estiver habilitada, crie uma [Senha de App](https://support.google.com/mail/answer/185833?hl=pt) para este serviço.
:::

Depois de fazer essas modificações, **execute o seguinte para aplicar as alterações**:

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      ```shell
      docker stop rocketpool_grafana

      rocketpool service start
      ```
    </Tab>
    <Tab label="Native">
      ```shell
      sudo systemctl restart grafana-server
      ```
    </Tab>

  </Tabs>
</div>

Para testar as configurações SMTP, vá para o menu **Alerting** e clique em **Contact points**.

<img src="./images/grafana-contact-points.png" width="100%" height="auto" />

Clique em **New contact point** e selecione **Email** como tipo de Contact point.
Digite um endereço de email na seção **Addresses** e clique em **Test**.

<img src="./images/grafana-new-contact-point.png" width="100%" height="auto" />

Verifique se o email de teste foi recebido.
Clique em **Save contact point\*** quando terminar.
