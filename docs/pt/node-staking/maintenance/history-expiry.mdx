import { Tab, Tabs } from "@rspress/core/theme";

# Expirando Histórico Pré-Merge

Todos os clientes de Execution agora suportam expiração parcial de histórico de acordo com a [EIP-4444](https://eips.ethereum.org/EIPS/eip-4444). Os usuários podem reduzir substancialmente
os requisitos de armazenamento do seu node removendo o histórico de blocos pré-merge a partir da versão do Smartnode `v1.17.0`. Sinta-se à vontade para conferir
este post do blog para aprender mais sobre expiração parcial de histórico: https://blog.ethereum.org/2025/07/08/partial-history-exp

::: tip NOTA

    Tenha em mente que as etapas para remover o histórico pré-merge dependem do cliente de Execution selecionado do seu node:
    - Usuários de Nethermind precisarão de uma ressincronização completa para remover o histórico pré-merge.
    - Usuários de Geth podem usar o comando `rocketpool service prune-eth1` ou conduzir uma ressincronização completa.
    - Usuários de Besu e Reth podem realizar uma poda online enquanto seu node continua a atestar.

:::

As seguintes etapas para remover o histórico pré-merge são apenas para nodes no modo Docker. Se você estiver usando um cliente externo no modo Hybrid
ou modo Native, consulte a documentação fornecida pelo seu cliente de Execution.

Comece abrindo o Settings Manager:

```shell
rocketpool service config
```

Para alterar o modo de poda do Execution Client, vá ao menu `Execution Client (ETH1)` e selecione a configuração `History Expiry` no menu suspenso de `Pruning Mode`

![](../images/tui-history-expiry.png)

Depois de fazer a seleção, pressione `escape` para retornar ao menu principal, depois pressione `tab` para destacar o botão `Review Changes and Save`. Pressione
a tecla `enter` para continuar. Você será apresentado a um menu para visualizar as alterações nas configurações do seu cliente de Execution.

![](../images/tui-review-history-expiry.png)

Pressione a tecla `enter` em `Save Settings` para salvar e sair do Settings Manager, depois digite `y` para reiniciar seu container `rocketpool_eth1`.

```shell
Your changes have been saved!
The following containers must be restarted for the changes to take effect:
	rocketpool_eth1
Would you like to restart them automatically now? [y/n]
```

A partir deste ponto, as etapas diferem dependendo de qual cliente de Execution você está usando:

<div className="p-3">
  <Tabs>

        <Tab label="Nethermind">
        Nodes Nethermind requerem uma ressincronização completa para remover o histórico pré-merge. Você deve ressincronizar seu cliente de Execution depois de salvar
        a configuração `History Expiry` e reiniciar seu container `eth1`.

        ::: warning AVISO
        Se você não tiver um node de fallback configurado, seu node parará de validar durante uma ressincronização. Um node de fallback
        permitirá que seu node primário continue atestando e propondo blocos durante uma poda ou ressincronização. Clique [aqui](/pt/node-staking/fallback)
        para aprender como configurar um node de fallback.
        :::

        Use o seguinte comando para ressincronizar seu cliente de Execution:
        ```shell
        rocketpool service resync-eth1
        ```

        Está tudo pronto! O node não armazenará mais dados pré-merge, melhorando substancialmente a viabilidade de encaixar um node em um drive de 2 TB.
        Recomendamos monitorar o progresso usando o seguinte comando.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Geth">

        Nodes Geth requerem uma poda offline para remover o histórico pré-merge. Você deve podar seu cliente de Execution depois de salvar
        a configuração `History Expiry` e reiniciar seu container `eth1`. Alternativamente, você pode optar por conduzir uma ressincronização completa para remover o histórico pré-merge.

        ::: tip NOTA
        Recomendamos podar ao invés de conduzir uma ressincronização completa. Se você deseja começar do zero com um banco de dados Geth limpo ou tem um problema
        com a poda, você pode ressincronizar o cliente de Execution usando `rocketpool service resync-eth1`. Ambas as escolhas devem resultar em histórico pré-merge expirado.
        :::

        ::: warning AVISO
        Se você não tiver um node de fallback configurado, seu node parará de validar durante uma poda ou ressincronização. Um node de fallback
        permitirá que seu node primário continue atestando e propondo blocos durante uma poda ou ressincronização. Clique [aqui](/pt/node-staking/fallback)
        para aprender como configurar um node de fallback.
        :::

        Execute o seguinte comando para podar seu cliente de Execution:
        ```shell
        rocketpool service prune-eth1
        ```
        Você pode clicar [aqui](/pt/node-staking/pruning#starting-a-prune) para aprender mais sobre poda.

        Está tudo pronto! O node não armazenará mais dados pré-merge, melhorando substancialmente a viabilidade de encaixar um node em um drive de 2 TB.
        Recomendamos monitorar o progresso usando o seguinte comando.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Besu">

        Está tudo pronto! Nodes Besu realizarão uma poda online enquanto continuam a atestar e propor blocos.
        O node não armazenará mais dados pré-merge, melhorando substancialmente a viabilidade de encaixar um node em um drive de 2 TB.
        Recomendamos monitorar o progresso usando o seguinte comando.
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Reth">

        Está tudo pronto! Nodes Reth realizarão uma poda online enquanto continuam a atestar e propor blocos.
        O node não armazenará mais dados pré-merge, melhorando substancialmente a viabilidade de encaixar um node em um drive de 2 TB.
        Recomendamos monitorar o progresso usando o seguinte comando.
        ```shell
        rocketpool service logs eth1
         ```

    </Tab>

  </Tabs>
</div>
