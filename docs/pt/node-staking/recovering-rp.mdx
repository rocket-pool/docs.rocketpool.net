import { Tab, Tabs } from "@rspress/core/theme";

# Importando / Recuperando uma Carteira Existente

Se você já tem uma carteira que gostaria de usar para seu nó, ou se está recuperando uma carteira que já criou com o Smartnode anteriormente, este guia ajudará você através do processo de importação / recuperação.

Por favor, selecione a opção apropriada nas seções abaixo.

## Recuperando uma Carteira Smartnode

Se você gerou sua carteira de nó usando o Smartnode e está simplesmente recuperando-a em uma nova máquina, o processo é bastante simples.
Certifique-se de que já instalou o software Smartnode e, então, simplesmente execute o seguinte comando uma vez que esteja instalado:

```shell
rocketpool wallet recover
```

::: warning NOTA
Se, por algum motivo, você deseja recuperar a carteira mas _não_ nenhuma das chaves de validador anexadas aos minipools do seu nó, você pode especificar a flag `-k` para pular o processo de reconstrução:

```shell
rocketpool wallet recover -k
```

Se você não especificar esta flag, o Smartnode tentará recuperar as chaves de validador para seus minipools; no entanto, note que isso não funcionará até que seu cliente Execution tenha terminado de sincronizar.
Por favor, observe seu arquivo de log para ver quando terminar; uma vez que termine, você pode executar este passo.
:::

Isso primeiro perguntará uma senha que você deseja usar para criptografar sua carteira.
Depois disso, perguntará pela sua **frase de recuperação mnemônica de 24 palavras**.
Digite-a com cuidado - ela não será mostrada na tela por segurança, e é muito fácil cometer um erro ao digitá-la, então tome seu tempo.

Quando terminar, você deve ver uma saída semelhante a esta:

```shell
$ rocketpool wallet recover

Please enter a password to secure your wallet with:

Please confirm your password:

Please enter your recovery mnemonic phrase:

Recovering node wallet...
The node wallet was successfully recovered.
Node account: <your wallet address>
No validator keys were found.
```

Se você não vir nenhum erro, então sua carteira e validadores serão recuperados.

Uma vez que termine, certifique-se de reiniciar o cliente Validator com o seguinte comando para usuários de modo Docker e Híbrido:

```shell
docker restart rocketpool_validator
```

Usuários de **modo Nativo** simplesmente terão que reiniciar seu processo de container Validator.

Isso garantirá que o VC pegue todas as chaves de validador recém-restauradas.

## Importando um Endereço Existente como Carteira de Nó

Se você tem um endereço que gostaria de usar para um nó, mas _não_ o criou com o Smartnode (por exemplo, você o criou com MetaMask ou uma hardware wallet), então esta é a seção a seguir.

::: danger AVISO
Ao fazer isso, seu endereço se tornará uma **hot wallet**.
A chave privada será armazenada na sua máquina de nó.

Se você está importando um endereço que é uma cold wallet, como uma hardware wallet, esteja ciente de que **a proteção fornecida pela hardware wallet não existirá mais!**

Se você usa esta carteira para _qualquer outra atividade de criptomoeda_, **você deve migrar todos os seus fundos para um endereço separado (por exemplo, uma hardware wallet diferente) antes de importá-la para seu nó! Deixe apenas ETH suficiente neste endereço para os custos de gas do seu nó (tipicamente 0.5 ETH é suficiente).**

Por favor, certifique-se de que protegeu sua máquina o máximo possível seguindo os passos no guia [Protegendo seu Nó](./securing-your-node) antes de importar seu endereço como carteira de nó.
:::

Esta capacidade só está disponível com Smartnode **v1.4.3 ou superior**.
Se você tem uma versão inferior, precisará atualizar primeiro.

Este é um processo de várias etapas, então siga as seções abaixo cuidadosamente.

### Passo 1: Adicionar Chaves de Validador Geradas Externamente

**Se você não tem nenhum minipool existente anexado ao endereço que está importando, você pode pular este passo.**

Se seu endereço já foi registrado como uma carteira de nó Rocket Pool (como através de um serviço como **Allnodes**) e já tem minipools ativos, e você gostaria de importá-los para o stack Smartnode junto com seu endereço, você precisará fornecer os arquivos de keystore privados para cada um de seus validadores correspondentes.
Esses arquivos serão criptografados com uma senha de sua própria escolha, então você precisará dessa senha para cada arquivo também.

Você precisa obter esses arquivos do serviço que está atualmente executando seu nó para importá-lo.
Alguns provedores de serviço podem ser capazes de recuperar esses arquivos mediante solicitação.
Se você usa Allnodes, pode obter esses arquivos durante seu processo de configuração inicial mas **não será capaz de recuperá-los no futuro a menos que os tenha salvado durante a criação do minipool.**

Selecione seu modo de instalação e siga os passos abaixo.

<div className="p-3">
  <Tabs>
    <Tab label="Docker e Modo Híbrido">
      Primeiro, certifique-se de ter iniciado o Smartnode com `rocketpool service start`.
      Isso criará uma pasta especial que pode ser usada para armazenar os arquivos de keystore criptografados para seus validadores.

      Por padrão, a pasta está localizada em `~/.rocketpool/data/custom-keys`.
      Se você personalizou sua instalação ou diretórios de dados, substitua apropriadamente para encontrar a pasta `custom-keys`.

      Verifique com um explorador de arquivos ou o comando `ls` para ter certeza de que esta pasta existe.
      Se não, sem problemas - apenas crie a pasta com o seguinte comando:

      ```shell
      mkdir ~/.rocketpool/data/custom-keys
      ```
    </Tab>
    <Tab label="Native Mode">
      Crie uma pasta chamada `custom-keys` dentro da pasta `data` do seu Smartnode (por exemplo, `/srv/rocketpool/data/custom-keys`).
    </Tab>

  </Tabs>
</div>

Em seguida, coloque cada um dos arquivos de keystore de validador nesta pasta.
Os nomes dos arquivos não importam, mas eles devem ser arquivos JSON que estejam em conformidade com o formato [EIP-2335](https://eips.ethereum.org/EIPS/eip-2335#scrypt-test-vector).

O Smartnode procurará neste diretório por quaisquer arquivos de keystore que você tenha colocado aqui nos próximos passos.

::: warning NOTA
O processo de importação _apenas_ procurará chaves de validador que estejam anexadas a minipools registrados no endereço que você está importando.
Você **não pode** usar este processo para importar outras chaves de validador, como para validadores de solo staking, no cliente Validator gerenciado pelo stack Smartnode.

Por favor, veja a documentação para executar em [Modo Híbrido Reverso](./advanced-config#allowing-external-validator-clients-to-connect-to-the-smartnode) se você está interessado em fazer isso.
:::

### Passo 2 (Opcional): Testar Importação do Endereço

Se você gostaria de testar o processo de recuperação para garantir que tem o mnemônico e senhas corretos **sem realmente regenerar a chave privada da carteira do seu nó ou importar suas chaves de validador**, você pode fazer isso com o seguinte comando:

```shell
rocketpool wallet test-recovery -a 0x1234abcd...
```

Onde `0x1234abcd...` é o endereço que você deseja importar, começando com o prefixo `0x`.
**Você precisará da sua frase mnemônica para importar a chave privada do seu endereço.**

::: tip DICA
Se, por algum motivo, você deseja recuperar a carteira mas _não_ nenhuma das chaves de validador para seus minipools, você pode especificar a flag `-k` para pular o processo de recuperação de chave de validador.
Por exemplo:

```shell
rocketpool wallet test-recovery -a 0x1234abcd... -k
```

:::

O Smartnode procurará automaticamente através dos caminhos de derivação mais populares (por exemplo, os usados por Ledger Live, MyEtherWallet, Trezor e o stack Smartnode) e índices de endereço para encontrar as configurações que correspondem ao endereço que você forneceu.

::: tip DICA
Se você tem um caminho de derivação personalizado, use a flag `-d` para especificá-lo.
Por exemplo:

```shell
rocketpool wallet test-recovery -d "m/44'/60'/0'/%d"
```

Use `%d` para a parte do caminho que pode ser iterada para usar diferentes índices.

Se você tem um índice de endereço personalizado, use a flag `-i` para especificá-lo.
Por exemplo, se seu endereço fosse o 6º no caminho de derivação padrão, você poderia usar:

```shell
rocketpool wallet test-recovery -i 5
```

Você pode usar ambas as flags `-d` e `-i` ao mesmo tempo se necessário.
:::

Primeiro, você será solicitado pela frase mnemônica do seu endereço:

```
Please enter the number of words in your mnemonic phrase (24 by default):
24

Enter Word Number 1 of your mnemonic:
```

Digite-a com cuidado, e o Smartnode começará a pesquisar através de todas as opções padrão para encontrá-la (a menos que você as tenha especificado explicitamente usando as flags `-d` e/ou `-i`).

Em seguida, se você tiver arquivos de keystore privados para importar do Passo 1, você será solicitado pelas senhas de cada um desses arquivos de keystore:

```
It looks like you have some custom keystores for your minipool's validators.
You will be prompted for the passwords each one was encrypted with, so they can be loaded into the Validator Client that Rocket Pool manages for you.

Please enter the password that the keystore for <validator pubkey> was encrypted with:
```

Eles serão organizados pela lista de **pubkey**, **não pelos nomes dos arquivos**.
Certifique-se de saber qual arquivo corresponde a qual pubkey de validador para que você digite as senhas corretas.

Uma vez que tenha feito isso, o processo de recuperação de teste prosseguirá e relatará se foi bem-sucedido ou falhou:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

O acima indica uma recuperação de teste bem-sucedida.

### Passo 3: Importar o Endereço

::: danger AVISO
Se seu endereço é um nó Rocket Pool que _não_ é gerenciado pelo seu próprio Smartnode auto-hospedado (por exemplo, hospedado por um serviço externo como **Allnodes**), **É CRÍTICO** que você coordene com o serviço executando seu nó **antes de começar este processo de importação** e informe que gostaria de migrar para seu próprio sistema auto-hospedado.

Você **DEVE CONFIRMAR** que eles desligaram a validação para seu nó e **NUNCA a retomarão**, e confirmar manualmente que seus validadores não estão mais atestando usando um explorador de Blockchain como [https://beaconcha.in](https://beaconcha.in).
Você deve confirmar que cada validador perdeu **PELO MENOS 2 ATTESTATIONS** para garantir que pode migrar com segurança.
Caso contrário, vocês dois atestarão ao mesmo tempo e **SEUS MINIPOOLS SERÃO SLASHED!**

O Smartnode exigirá que você confirme que fez isso antes de permitir que prossiga com o processo de importação.
:::

Se a recuperação de teste foi bem-sucedida, ou se você a pulou, você em seguida importará a carteira e regenerará todos os seus arquivos de chave associados.
O processo é exatamente o mesmo que o acima, mas use o comando `recover` em vez do comando `test-recovery`:

```shell
rocketpool wallet recover -a 0x1234abcd...
```

Quando você executar este comando, primeiro será solicitado por uma senha para criptografar sua carteira de nó importada.

```
Please enter a password to secure your wallet with:

Please confirm your password:
```

Depois disso, os prompts de mnemônico e senha de keystore de validador personalizado prosseguirão como fizeram antes.

Uma vez que tenha digitado todas essas informações, o Smartnode recuperará seu endereço e (se não desabilitado) as chaves de validador personalizadas para seus minipools:

```
Searching for the derivation path and index for wallet 0x1234abcd...
NOTE: this may take several minutes depending on how large your wallet's index is.
The node wallet was successfully recovered.
Derivation path: m/44'/60'/0'/0/%d
Wallet index:    0
Node account:    0x1234abcd...
Validator keys:
<validator pubkey>
```

A chave privada do seu endereço agora será armazenada no arquivo `data/wallet` (por exemplo, `~/.rocketpool/data/wallet`), e a senha para ela será armazenada no arquivo `data/password` (por exemplo, `~/.rocketpool/data/password`).

As chaves privadas para cada um de seus validadores serão armazenadas nas pastas `data/validators` para cada um dos clientes de Consenso que o Smartnode suporta.

::: danger NOTA
Ao importar um endereço desta forma, as chaves de validador **não** foram derivadas da sua carteira de nó e, portanto, elas **não podem** ser recuperadas mais tarde simplesmente executando `rocketpool wallet recover` como com uma carteira de nó normal.

Se você precisar recuperar ou importar esta carteira novamente, precisará seguir este mesmo processo, o que significa que **você precisará ter esses keystores privados de validador e suas senhas em backup em algum lugar seguro.**

Se você os perder, **não será mais capaz de recuperar essas chaves de validador!**
:::

### Passo 4: Limpeza

Neste ponto, você pode agora deletar todos os arquivos de keystore privados no diretório `data/custom-keys`.
O Smartnode já os terá importado e atribuído senhas aleatórias a eles, então esses arquivos de keystore não são mais necessários.

Finalmente, certifique-se de que **não** há um arquivo chamado `custom-key-passwords` no seu diretório `data` (por exemplo, `~/.rocketpool/data/custom-key-passwords`).
O Smartnode construirá este arquivo temporário apenas durante o processo de recuperação e o removerá automaticamente independentemente de o processo de recuperação ter sido bem-sucedido ou não; se por algum motivo falhou em removê-lo, ele o alertará na saída do console.
No entanto, nunca é demais ser cuidadoso demais.

## Próximos Passos

Uma vez que tenha importado ou recuperado sua carteira de nó, siga os próximos passos no guia [Introdução à Interface de Linha de Comando](./cli-intro).
