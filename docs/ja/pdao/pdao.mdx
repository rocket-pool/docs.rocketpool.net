import proposal_diagram from "./images/proposal_diagram.png";
import proposal_checker from "./images/proposal_checker.png";

# The Protocol DAO (pDAO)

Rocket Pool Protocol DAO (pDAO)は、プロトコルの方向性を形作る責任を負い、RPLガバナンスによって運営されています。そのメンバーと投票権は、大小を問わずNode Operatorで構成されており、すべてプロトコルに直接参加しています。これは、rETHホルダー、Node Operator、RPLホルダーを含むRocket Poolコミュニティ全体にサービスを提供します。pDAOは、Rocket Poolプロトコルの安全性とEthereumネットワークの健全性を優先します。pDAOが誰で何であるかの明確な定義については、[pDAO charter](https://rpips.rocketpool.net/RPIPs/RPIP-23)をご覧ください。

## HoustonにおけるpDAOの新機能

### pDAO責任のオンチェーン実行

Houston Upgradeは、pDAOガバナンスシステムの実行プロセスのオンチェーン代替を導入します。これは、任意のNode Operatorがプロポーザルを提起し、「pDAOプロトコルパラメータ」を調整したり、財務資金を使用したりするプロポーザルに投票できる楽観的詐欺証明システムを使用しています。pDAO制御可能なパラメータの包括的なリストについては、[こちら](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table)をクリックしてください。
Houston以前は、コアチームがコミュニティガバナンスプロセスの要請に応じてpDAOの任務を実行する責任を負っていました。たとえば、チームはガバナンスで投票された支払いスケジュールに従って、毎月のIMCとGMCの支払いを実行します。この権限は、これらの責任を引き継ぐ新しい権力構造が設定されるまで、一時的にチームに付与される予定でした。Houstonは、チームへのこの依存関係を取り除き、プロトコルをより分散化し、トラストレスにします。

### Security Council

Houston upgradeには、プロトコルの潜在的な問題が発生した場合に迅速に対応できる新しいsecurity councilも含まれています。これらのメンバーはpDAOによって選出され、遅延なしに変更を提案して実行する能力を持っています。pDAOは、security councilからメンバーを選出および削除する権限を持っています。これは重大な役割であり、pDAOは強力な参加要件と古いメンバーを排除するプロセスを開発する必要があります。pDAO guardianは、Houstonの開始時にsecurity councilの唯一のメンバーになります。

### 定期的な財務支出

RPLには5%のインフレ率があります。このインフレの22%は、[RPIP-25](https://rpips.rocketpool.net/RPIPs/RPIP-25)で定義されているように、pDAOに向けられています。pDAOは、これらの資金をさまざまな目的に使用できます。たとえば、流動性プロバイダー(LP)ボーナスなどのインセンティブ、サードパーティの改善とプロジェクトの助成金と報奨金、Rocket Poolプロトコルの開発への資金提供などです。Houston upgradeには、各報酬期間に指定された受益者に対して行われる定期的な財務支払いを可能にする新機能も導入されています。

## Protocol DAO (pDAO) プロポーザル

投票権がゼロでないノードは、いつでもpDAOプロポーザルを提起または参加できます。プロポーザルは次のタイプのいずれかです:

- pDAO設定の変更
- 一時的な財務支出
- 定期的な財務支出(管理委員会)
- Security Councilメンバーシップ

詳細と根拠については、[プロポーザルタイプ](https://rpips.rocketpool.net/RPIPs/RPIP-33#proposal-types)を参照してください。pDAOプロポーザルは、プロトコルレベルで変更を実行するために存在するオンチェーンエンティティであることを理解することが重要です。

## pDAOプロポーザルのライフサイクル

プロポーザルは、オンチェーンに到達する前に、[ガバナンスプロセス](./participate#governance-process)によって予測される必要があります。これは、すべてpDAO[制御可能なパラメータ](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table)である4つの期間で構成されています:

- Vote Delay Period: `proposal.vote.delay.time`
- Vote Phase 1: `proposal.vote.phase1.time`
- Vote Phase 2: `proposal.vote.phase2.time`
- Execution: `proposal.execute.time	`

<img src={proposal_diagram} width="100%" height="auto" />

### Vote Delay Period

プロポーザルの結果を決定するために、プロトコルは必要な定足数を知っている必要があります。提案者はこの値をオフチェーンで計算し、プロポーザルと一緒に提出します。値は楽観的に受け入れられますが、詐欺の場合、検証者はチャレンジ/レスポンスプロセスを実行して、値が正しくないことを証明できます。無効なプロポーザルは破棄されます。

提案者とチャレンジャーがRPLをロックする必要がある理由がいくつかあります。

- `proposal.bond`は、有効なプロポーザルにインセンティブを与え、スパムを抑止します。
- `proposal.challenge.bond`は、無効/悪意のあるプロポーザルの撤回にインセンティブを与えます。

チャレンジャーは、誤りであると主張しているMerkle-sumツリーへのインデックスを提供します。任意のNode Operatorは、詐欺的なプロポーザルへのチャレンジに参加できます(そして報酬を獲得できます)。オプトインに興味がある場合は、[pDAO Challenge Process](./pdao#challenge-process)について読んでください。vote delay periodの終わりまでにチャレンジで敗北しなかったプロポーザルは、投票段階に入ります。

::: tip NOTE
`proposal.vote.delay.time`が期限切れになると、プロポーザルはチャレンジまたは敗北できなくなります。
:::

### Vote Period 1

投票期間中、Node OperatorとDelegateは4つのオプションのいずれかで投票できます:

```
1. Abstain: 投票者の投票権は定足数に貢献しますが、プロポーザルに賛成でも反対でもありません。
2. For: 投票者はプロポーザルの実行に賛成票を投じます。
3. Against: 投票者はプロポーザルの実行に反対票を投じます。
4. Veto: 投票者はプロポーザルに反対票を投じ、プロポーザルをスパムまたは悪意のあるものと見なしていることを示します。
```

投票権は、選択したオプションに含まれます。

これは、次のコマンドを使用して実行できます:

```shell
rocketpool pdao proposals vote
```

veto quorum(`proposal.veto.quorum`パラメータで定義)が満たされると、プロポーザルはすぐに敗北し、提案者はボンドを失います。これは、スパム、低品質のプロポーザル、またはオフチェーンプロセスを最初に経ていないプロポーザルを抑止するためです。smartnodeコマンド`rocketpool pdao proposals finalize`は、提案者のロックされたRPLボンドを燃やすことによって、拒否されたプロポーザルを最終化するために使用されます。

期間1の期間は、`proposal.vote.phase1.time`パラメータによって決定されます。`proposal.quorum`に到達したかどうかに関係なく、プロポーザルはフェーズ2に移行します。

### Vote Period 2

Delegateはvote period 2中に投票できますが、彼らの投票は**ローカル投票権**のみの価値があります。期間1で投票しなかった投票者は、期間2で投票できます。委任先の選択に同意しないNode Operatorは、委任先の投票を覆す機会を得ます。

投票を覆すプロセスは非常に簡単で、vote period 2中に`rocketpool pdao proposals vote`を呼び出して、プロンプトに従うだけです。委任先の投票権は、委任者の投票権によって覆されます。

プロポーザルの結果は、vote period 2が終わったときに結論付けられます。結果が決定(および実行)されるためには、`proposal.vote.phase2.time`の終わりまでに`proposal.quorum`合計投票権に到達する必要があります。定足数が満たされ、合意が得られると、プロポーザルは投票期間を通過し、成功としてマークされます。

::: tip NOTE
`proposal.quorum`が満たされない場合、それ以上のアクションは実行できません。定足数が満たされない場合、プロポーザルは終了し最終的と見なされます。
:::

### Execution

両方の投票期間が経過し、プロポーザルが成功すると、プロポーザルを実行でき、変更(ペイロードで定義)がRocket Poolプロトコルに適用されます。プロポーザルを実行するには、次のコマンドを使用します:

```shell
rocketpool pdao proposals execute
```

実行するプロポーザルを選択するようにプロンプトが表示されます。このステップの後、プロポーザルがプロトコルに適用されます!

プロポーザルが投票期間を通過した後、提案者はチャレンジまたは拒否によって敗北しない限り、ロックされたRPLボンドを[請求](./participate#claiming-bonds-and-rewards)できます。

::: tip NOTE
プロポーザルを実行できるウィンドウ`proposal.execute.time`があります。このタイマーが終了に達すると、プロポーザルは期限切れになります。
:::

以上です! 上記で言及されたすべての変数がpDAO制御可能なパラメータであることに注意してください。pDAOがオンチェーンプロポーザルを使用して変更する権限を持つすべてのパラメータの包括的なリストについては、[こちら](https://rpips.rocketpool.net/RPIPs/RPIP-33#parameter-table)をクリックしてください。

## Challenge Process

完全なネットワーク投票権ツリーは、ガス制限のためオフチェーンに保存されます。ユーザーが新しいプロポーザルを提出すると、ターゲットブロック番号でネットワーク投票ツリーを構築する責任を負います。このツリーはオフチェーンで生成されますが、オンチェーンで提出されたMerkleルートを介して検証可能です。プロトコルは、提案者によって提出された詳細をチェックするために**検証者**に依存しています。

任意のノードが、プロポーザルの正確性の追跡と検証に参加できます。この責任にオプトインするには、コマンド`rocketpool service config`を使用し、**Smartnode and TX Fee Settings**メニューに移動し、`Enable PDAO Proposal Checker`チェックボックスをオンにします。

<img src={proposal_checker} width="100%" height="auto" />

この設定が有効になっている場合、ノードは新しいプロポーザルをチェックし、正確性を検証し、無効なプロポーザルにチャレンジを提出します。唯一の前提条件は、[RPL Locking](./participate#allowing-rpl-locking)が有効になっていることです。

このチェックは、他のいくつかのノード関連の任務と連携して5分ごとに実行されます。詐欺的なプロポーザルにチャレンジする例を見ていきます。smartnodeコマンド`rocketpool service logs node`を使用して進行状況を監視できます:

```
rocketpool_node  | 2024/04/05 02:19:16 Checking for Protocol DAO proposal challenges to defend...
rocketpool_node  | 2024/04/05 02:19:26 Checking for Protocol DAO proposals to challenge...
rocketpool_node  | 2024/04/05 02:19:26 [Network Tree] Couldn't load network tree for block 1283202 from disk, so it must be regenerated.
rocketpool_node  | 2024/04/05 02:19:26 [PDAO Proposals] Network tree for block 1283202 didn't exist, creating one.
rocketpool_node  | 2024/04/05 02:19:26 [Voting Info Snapshot] Couldn't load network tree for block 1283202 from disk, so it must be regenerated.
rocketpool_node  | 2024/04/05 02:19:26 [PDAO Proposals] Voting info snapshot for block 1283202 didn't exist, creating one.
rocketpool_node  | 2024/04/05 02:19:26 Proposal 177 does not match the local tree artifacts and must be challenged.
rocketpool_node  | 2024/04/05 02:19:26 [Voting Info Snapshot] Loaded file [vi-1283202.json.zst].
rocketpool_node  | 2024/04/05 02:19:26 [Network Tree] Loaded file [network-tree-1283202.json.zst].
rocketpool_node  | 2024/04/05 02:19:26 Submitting challenge against proposal 177, index 5...
rocketpool_node  | 2024/04/05 02:19:26 This transaction will use a max fee of 16.067134 Gwei, for a total of up to 0.003252 - 0.004878 ETH.
rocketpool_node  | 2024/04/05 02:19:26 Transaction has been submitted with hash 0x327e59e398bf2141a0d9273947d1da5c255606c45afaca428ab092186300eac2.
rocketpool_node  | 2024/04/05 02:19:26 You may follow its progress by visiting:
rocketpool_node  | 2024/04/05 02:19:26 https://holesky.etherscan.io/tx/0x327e59e398bf2141a0d9273947d1da5c255606c45afaca428ab092186300eac2

```

ノードが詐欺的なプロポーザルを検出し、チャレンジのプロセスを開始したことがわかります。ブロック`1283202`はプロポーザル177が提起されたブロックであり、このプロポーザルの投票権はブロック`1283202`で計算されることを意味します。これらの**Voting Info Snapshots**がどのように見えるかに興味がある場合は、このディレクトリで見つけることができます: `~/.rocketpool/data/voting`

提案者が誤った投票情報を提出したことが発覚したため、ノードはプロポーザル177のインデックス5で`Function: createChallenge`コントラクト呼び出しを行い、提案者がチャレンジに応答するのを待ちます。

```
rocketpool3_node  | 2024/04/05 02:56:51 Checking for Protocol DAO proposal challenges to defend...
rocketpool3_node  | 2024/04/05 02:57:01 Checking for Protocol DAO proposals to challenge...
rocketpool3_node  | 2024/04/05 02:57:01 [Network Tree] Loaded file [network-tree-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 Proposal 177 does not match the local tree artifacts and must be challenged.
rocketpool3_node  | 2024/04/05 02:57:01 [Voting Info Snapshot] Loaded file [vi-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 [Network Tree] Loaded file [network-tree-1283202.json.zst].
rocketpool3_node  | 2024/04/05 02:57:01 Proposal 177 has been defeated with node index 20, submitting defeat...
rocketpool3_node  | 2024/04/05 02:57:01 This transaction will use a max fee of 19.078965 Gwei, for a total of up to 0.002061 - 0.003091 ETH.
rocketpool3_node  | 2024/04/05 02:57:01 Transaction has been submitted with hash 0x8cc01dff37205dc98e53f4e9fae7f3c802ecc1c69a01f53e734115a73401287e.
rocketpool3_node  | 2024/04/05 02:57:01 You may follow its progress by visiting:
rocketpool3_node  | 2024/04/05 02:57:01 https://holesky.etherscan.io/tx/0x8cc01dff37205dc98e53f4e9fae7f3c802ecc1c69a01f53e734115a73401287e
rocketpool3_node  |
rocketpool3_node  | 2024/04/05 02:57:01 Waiting for the transaction to be validated...
rocketpool3_node  | 2024/04/05 02:57:13 Successfully defeated proposal.
```

提案者の投票情報が正しくないため、時間内にチャレンジに応答できません(`proposal.challenge.period`によって決定)。プロポーザルはこの時点で敗北したと見なされます。プロポーザルが敗北すると、ノードは自動的にプロポーザル177のインデックス5で`defeatProposal`コントラクト呼び出しを行い、プロポーザルを終了します。

::: tip NOTE
プロポーザルの敗北に参加したチャレンジャーは、誤りであることが証明されたインデックスを提出した場合、提案者のボンドの比例額を支払われます。他のすべてのチャレンジャーは、ボンドのみを取り戻します。
:::

プロポーザルが敗北したので、ノード(チャレンジャー)は、元のRPLボンドと、詐欺的なプロポーザルを敗北させたことに対する報酬として提案者のRPLボンドを[請求](./participate#claiming-bonds-and-rewards)できます。

pDAOプロポーザルとチャレンジシステムの詳細に興味がある場合は、[技術仕様](https://github.com/rocket-pool/rocketpool-research/blob/houston/Protocol%20DAO/pdao-prop-challenge-spec.md#draft-protocol-dao-proposal-challenge-system-specification)をご覧ください。低レベルの詳細に入る例を研究することに興味がある場合は、[challenge process](https://github.com/rocket-pool/rocketpool-research/blob/houston/Protocol%20DAO/pdao-prop-challenge-spec.md#challenge-process)のこのセクションに自由にスキップしてください。
