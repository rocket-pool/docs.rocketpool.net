import { Tab, Tabs } from "@rspress/core/theme";
import nodeAddress from "./images/node_address.png";
import rplWithdrawalConfirmation from "./images/rpl_withdrawal_confirmation.png";

# RPL引き出しアドレスの設定

[プライマリ引き出しアドレス](../../node-staking/prepare-node#setting-your-primary-withdrawal-address)とRPL引き出しアドレスの違いを理解することが重要です。デフォルトでは、RPL引き出しアドレスは未設定であり、プライマリ引き出しアドレスは、すべてのRPLチェックポイント報酬、ステーキングされたRPL、およびBeacon Chain ETHが送信される場所です。

希望する場合は、[RPLの個別の引き出しアドレス](https://rpips.rocketpool.net/RPIPs/RPIP-31)を設定できます。設定されている場合、RPL引き出しアドレスはインフレーション報酬からRPLをトリガーおよび請求でき、ETHコンセンサス報酬やETHに関連するものには影響しません。この場合、プライマリ引き出しアドレスはRPL関連のアクションに対する権限を失います。

これにより、RPLへのエクスポージャーを望まないノードオペレーターにエンティティがRPLを供給できる興味深い機会が生まれます。そのエンティティは、ノードに必要な保険担保を提供することでRPL報酬を請求できます。言い換えれば、これにより、異なる関係者が各担保タイプを供給できるようになります。

::: warning 注意
ノードを初めて設定する際、RPL引き出しアドレスはデフォルトで未設定になっています。
RPL引き出しアドレスを設定することを選択する場合、**コールドウォレットで管理される別のアドレスに設定することが非常に重要です。**
コールドウォレットは、ハードウェアウォレット（[Ledger](https://www.ledger.com/)、[Trezor](https://trezor.io/)、または[Grid+](https://gridplus.io/)など）、またはスマートコントラクトウォレット（[Safe](https://app.safe.global/welcome)など）である可能性があります。

RPL引き出しアドレスとしてMetaMaskなどのホットウォレットを使用**しない**ことを強くお勧めします。

こうすることで、ノードウォレットが侵害された場合でも、攻撃者は強制的に退出させることであなたのステーキングされたRPLにアクセスすることができません。これらの資金はすべて別のコールドウォレット（うまくいけば彼らがアクセスできない）に送信されるためです。

RPL引き出しアドレスはノードオペレーターレベルで設定されます。
複数のミニプールを作成する場合、それらはすべて同じRPL引き出しアドレスを参照するため、このセットアップを実行する必要があるのは1回だけです。

Ethereum Foundationからのウォレットセキュリティの基本については、[こちらを参照](https://ethereum.org/en/security/#wallet-security)してください。
:::

これを行うには2つの異なる方法があります。
以下の両方のオプションを読んで、どちらが適用されるかを判断してください。

<div className="p-3">
  <Tabs>
    <Tab label="方法1">
      *新しいRPL引き出しアドレスがMetaMaskまたはWalletConnect経由でトランザクションに署名するために使用できる場合は、この方法を使用してください。**

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        この方法では、新しいRPL引き出しアドレスから**トランザクションを送信**する必要があるため、**そのアドレスに少量のETHがすでに必要です。**
      </p>

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        **Ledger**ハードウェアウォレットのユーザーの場合、Ledger LiveはまだMetaMaskまたはWalletConnectをネイティブにサポートしていないことに注意してください。
        代わりにMetaMaskを使用してLedgerに接続する必要があります。
        これを行うには、[公式のLedgerの指示](https://www.ledger.com/academy/security/the-safest-way-to-use-metamask)に従ってください。

        Rocket Poolウェブサイトで動作するには、Ledgerを接続し、ロックを解除し、ETHアプリを開いている必要があります。
        また、現在のセッションの**「ブラインド署名」を有効にする**必要があります。これは、デバイスのETHアプリの設定部分にあります。
        バインド署名は、セッションを閉じた後、自動的に無効になります。

        Hoodi Testnetを使用していて、LedgerをRPL引き出しアドレスとして使用したい場合、テストネットワークにライブアドレスを接続して混乱を招かないように、**Ledgerに新しいEthereumウォレットを最初に作成する必要があります。**
        LedgerをMetaMaskに接続する際は、ネットワーク選択ドロップダウンで**Hoodi Testnet**を必ず選択してください。
        Ledger Liveはテストネットワークでの残高を表示しませんが、テストネットワークをサポートする他のアプリケーション（MetaMaskやEtherscanなど）では表示できることに注意してください。
      </p>

      1. `rocketpool node set-rpl-withdrawal-address 'your cold wallet address or ENS name'`を実行します。新しいRPL引き出しアドレスは「保留中」としてマークされます。確認するまで、**古いRPL引き出しアドレスが引き続き使用されます**。
      2. 確認するには、**新しいRPL引き出しアドレスから**ミニプールコントラクトに特別なトランザクションを送信して、RPL引き出しアドレスを所有していることを確認する必要があります。
      1. これを行う最も簡単な方法は、Rocket Pool RPL引き出しアドレスサイト（[Hoodi Testnet](https://testnet.node.rocketpool.net/rpl-withdrawal-address)または[Mainnet](https://node.rocketpool.net/rpl-withdrawal-address)用）にアクセスすることです。
      3. Rocket PoolウェブサイトにMetamaskまたはWalletConnectをまだ接続していない場合は、今すぐ接続してください。画面中央の**select wallet**ボタンをクリックし、使用したいウォレットに基づいてMetaMaskまたはWalletConnectを選択します。その後、接続を確認するプロンプトが表示されます。たとえば、MetaMaskを使用する場合:

      **Next**をクリックし、次に**Confirm**をクリックして、Rocket Poolウェブサイトがウォレットを使用できるようにします。3. 上部メニュー（またはモバイルデバイスの場合は左側のハンバーガーメニュー）から**RPL Withdrawal Address**を選択します。4. このプロンプトが表示されます:

      4. **ノードウォレットアドレス**をここに入力し、オレンジ色の**Find**ボタンをクリックして続行します。

      <img src={nodeAddress} width="100%" height="auto"/>

      1.  保留中のRPL引き出しアドレスを確認するプロンプトが表示されます。これは、以前にこのコマンドを実行したときに使用したアドレスと同じである必要があります: `rocketpool node set-rpl-withdrawal-address` 準備ができたら**Confirm Pending**を選択します。
      2.  次に、ウォレットに新しい確認ダイアログが表示されます。再度、MetaMaskを例として使用すると、MetaMaskアイコンをクリックして開き、次のようなものが表示されるはずです:

      **Confirm**をクリックして、トランザクションをネットワークに送信します。これがブロックに含まれるまで時間がかかりますが、含まれると確認ダイアログが表示されます:

      <img src={rplWithdrawalConfirmation} width="100%" height="auto"/>

      5. 新しいRPL引き出しアドレスが確認されてアクティブになります。`rocketpool node status`で確認できます。
    </Tab>
    <Tab label="方法2">
      **RPL引き出しアドレスがMetaMaskまたはWalletConnect経由でトランザクションに署名するために使用_できない_場合にのみ、この方法を使用してください。**

      この方法では、次のコマンドを実行します:

      ```shell
      rocketpool node set-rpl-withdrawal-address --force `your cold wallet address`
      ```

      これを確認する前に、正しいアドレスを持っていることを確認するために、テストトランザクションを送信する機会が提供されます。
      プロンプトが表示されたときにこのコマンドを確認すると、新しいRPL引き出しアドレスがすぐに設定されます。


      <p className="rspress-directive danger">
        これを行うことで、新しいアドレスを所有していることを証明する必要がある方法1に関連する安全対策をバイパスします。
        ここでタイプミスをした場合、元に戻す方法はなく、**ミニプールの報酬は永久に失われます**。

        確認する前にテストトランザクションメカニズムを使用することを**強く**お勧めします。可能であれば、方法1を代わりに使用してください。
      </p>
    </Tab>

  </Tabs>
</div>

これが完了すると、`set-rpl-withdrawal-address`コマンドを使用してRPL引き出しアドレスを変更できなく**なります**。
変更するには、**アクティブな**RPL引き出しアドレス（今切り替えたもの）から署名されたトランザクションを送信する必要があります。
Rocket Poolウェブサイトには、これを行うのに役立つ機能があります。

RPL引き出しアドレスの設定を解除したい場合、プロセスは非常に簡単です。まず、Rocket PoolウェブサイトのRPL引き出しアドレスページに戻ります。

<div className="p-3">
  <Tabs>
    <Tab label="Hoodi Testnet">https://testnet.node.rocketpool.net/rpl-withdrawal-address</Tab>
    <Tab label="Mainnet">https://node.rocketpool.net/rpl-withdrawal-address</Tab>
  </Tabs>
</div>

ノードのRPL引き出しアドレスでサインインしている場合、ここの右側にある**unset**ボタンをクリックできるはずです:

<img src="./images/unset_rpl_withdrawal.png" width="100%" height="auto" />

**unset**をクリックすると、詳細を確認できるページに移動します。表示されている内容に満足している場合は、オレンジ色の**unset**ボタンをクリックして、トランザクションをネットワークに送信します。

RPL引き出しアドレスの設定は以上です！プロセスが迅速で簡単だったことを願っています。

お気軽に[Discordサーバー](https://discord.gg/G46XgK264a)にお立ち寄りいただき、プロジェクトが進化するにつれて意見をお聞かせください。
