import { Tab, Tabs } from "@rspress/core/theme";

# Rocket Poolの起動

この時点で、Smartnodeスタック、Executionクライアント、Consensusクライアントを含む完全なRocket Poolインフラストラクチャが実行されているはずです。
また、外部攻撃者からオペレーティングシステムを強化しているはずです。
これらの両方の手順を完了している場合、Rocket Poolノードを作成してステーキングを開始する準備が整っています。
まだ完了していない場合は、前のセクションを確認し、これらの手順を完了してからここに戻ってください。

## Rocket Poolサービスの起動と停止

<div className="p-3">
  <Tabs>
    <Tab label="Docker（デフォルト）モード">
      Smartnodeがインストールされたので、スタックの起動は簡単です。
      次のコマンドを入力するだけです:

      ```shell
      rocketpool service start
      ```

      このコマンドは、まだ存在しない場合は必要なすべてのDockerイメージを作成し、Rocket PoolのDockerネットワークとストレージボリュームが初期化されていることを確認し、`rocketpool service config`のUIの設定と一致しなくなった場合はコンテナを更新します。

      初めて実行すると、出力は次のようになります:

      ```
      $ rocketpool service start

      Creating network "rocketpool_net" with the default driver
      Creating volume "rocketpool_eth1clientdata" with default driver
      Creating volume "rocketpool_eth2clientdata" with default driver
      Creating rocketpool_eth1 ...
      Creating rocketpool_eth1 ... done
      Creating rocketpool_eth2 ...
      Creating rocketpool_api  ...
      Creating rocketpool_api  ... done
      Creating rocketpool_eth2 ... done
      Creating rocketpool_watchtower ...
      Creating rocketpool_mev-boost   ...
      Creating rocketpool_mev-boost   ... done
      Creating rocketpool_node       ...
      Creating rocketpool_validator  ...
      Creating rocketpool_validator  ... done
      Creating rocketpool_node       ... done
      Creating rocketpool_watchtower ... done
      ```

      このようになっていれば、Smartnodeスタックが正常に初期化され、実行されています。

      サービスを停止する必要がある場合（例えば、アップグレード中やメンテナンスが必要な場合）、`rocketpool service stop`を使用してすべてをシャットダウンできます。
      出力は次のようになります:

      ```
      $ rocketpool service stop

      Are you sure you want to pause the Rocket Pool service? Any staking minipools will be penalized! [y/n]
      y

      Stopping rocketpool_node       ...
      Stopping rocketpool_validator  ...
      Stopping rocketpool_watchtower ...
      Stopping rocketpool_mev-boost  ...
      Stopping rocketpool_eth2       ...
      Stopping rocketpool_api        ...
      Stopping rocketpool_eth1       ...
      Stopping rocketpool_validator  ... done
      Stopping rocketpool_node       ... done
      Stopping rocketpool_watchtower ... done
      Stopping rocketpool_api        ... done
      Stopping rocketpool_mev-boost  ... done
      Stopping rocketpool_eth2       ... done
      Stopping rocketpool_eth1       ... done
      ```

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        これを呼び出すと、システムの再起動後にRocket Poolは**自動的に**起動しません。
        すべてのDockerコンテナを起動し、再起動時の自動起動を再度有効にするには、`rocketpool service start`を呼び出す必要があります。
      </p>
    </Tab>
    <Tab label="ハイブリッドモード">
      Smartnodeがインストールされたので、スタックの起動は簡単です。
      次のコマンドを入力するだけです:

      ```shell
      rocketpool service start
      ```

      このコマンドは、まだ存在しない場合は必要なすべてのDockerイメージを作成し、Rocket PoolのDockerネットワークとストレージボリュームが初期化されていることを確認し、`rocketpool service config`のUIの設定と一致しなくなった場合はコンテナを更新します。

      初めて実行すると、出力は次のようになります:

      ```
      $ rocketpool service start

      Creating network "rocketpool_net" with the default driver
      Creating rocketpool_api  ...
      Creating rocketpool_api  ... done
      Creating rocketpool_watchtower ...
      Creating rocketpool_node       ...
      Creating rocketpool_validator  ...
      Creating rocketpool_validator  ... done
      Creating rocketpool_node       ... done
      Creating rocketpool_watchtower ... done
      ```

      このようになっていれば、Smartnodeスタックが正常に初期化され、実行されています。

      外部のExecutionクライアントやConsensusクライアントはここにリストされないことに注意してください。Rocket Poolはそれらを管理していないため、起動できません。
      それらを最初に作成したときに使用したメカニズムを使用して、別々に起動したことを確認する必要があります。

      サービスを停止する必要がある場合（例えば、アップグレード中やメンテナンスが必要な場合）、`rocketpool service stop`を使用してすべてをシャットダウンできます。
      出力は次のようになります:

      ```
      $ rocketpool service stop

      Are you sure you want to pause the Rocket Pool service? Any staking minipools will be penalized! [y/n]
      y

      Stopping rocketpool_node       ...
      Stopping rocketpool_validator  ...
      Stopping rocketpool_watchtower ...
      Stopping rocketpool_api        ...
      Stopping rocketpool_validator  ... done
      Stopping rocketpool_node       ... done
      Stopping rocketpool_watchtower ... done
      Stopping rocketpool_api        ... done
      ```

      繰り返しますが、必要に応じてExecutionクライアントとConsensusクライアントも適切に停止されていることを手動で確認する責任があります。

      <p className="rspress-directive tip">
        <p className="rspress-directive-title">注意</p>
        これを呼び出すと、システムの再起動後にRocket Poolは自動的に起動しません。
        すべてのDockerコンテナを起動し、再起動時の自動起動を再度有効にするには、`rocketpool service start`を呼び出す必要があります。
      </p>

    </Tab>
    <Tab label="ネイティブモード">
      ネイティブモードでは、[Dockerを使用しないネイティブRocket Poolノードの設定](./native)セクションの一部として、すでにSmartnodeサービスを設定して起動しています。

      それらを`systemd`サービスとして設定した場合、`sudo systemctl start ...`で起動できます。
      例えば、ExecutionにGeth、ConsensusにTekuを使用している場合:

      ```shell
      sudo systemctl start geth teku-bn teku-vc rp-node rp-watchtower
      ```

      停止も同じプロセスですが、`sudo systemctl stop ...`を使用します。

      サービスを停止しても**自動起動は無効になりません**。再起動時にプロセスは自動的に起動します。

    </Tab>

  </Tabs>
</div>

## 正しいバージョンとネットワークの確認

コンテナまたはサービスが起動したら、最初に行うべきことは、クライアントの正しいバージョンがあり、期待しているネットワークにいることを確認することです。
これは次のコマンドで確認できます:

```shell
rocketpool service version
```

出力は次のようになります**（ここに表示されているものよりも新しいバージョンがある可能性があります。これは単なる例です）**:

```
Your Smartnode is currently using the Ethereum Mainnet.

Rocket Pool client version: 1.6.4
Rocket Pool service version: 1.6.4
Selected Eth 1.0 client: Geth (Locally managed)
Image: ethereum/client-go:v1.10.25
Selected Eth 2.0 client: Lighthouse (Locally managed)
Image: sigp/lighthouse:v3.1.0
```

最初の行は、SmartnodeがEthereumメインネットとHoodiテストネットのどちらに設定されているかを示します。

::: warning 注意
**Docker / ハイブリッドユーザーの場合:**
期待しているネットワークにいない場合は、Rocket Poolのインストールセクションに戻り、インストール手順を確認してください。使用したいネットワークによって異なる手順の部分を見逃している可能性があります。

**ネイティブユーザーの場合:**
`rp service config`を初めて実行したときにデフォルト設定を受け入れた場合、ここで報告されているネットワークが正しくない可能性があります。
`rp service config` TUIの`Smartnode`セクションで適切なネットワークに切り替え、`node`および`watchtower`サービスを再起動してください。
:::

2番目の行のセットは、使用しているクライアントと、Rocket Poolの設定で定義されているそれらのバージョンを示します。

## サービスのステータスとログの確認

Smartnodeサービスが起動したので、エラーなく正しく実行されているかどうかを確認することをお勧めします。

<div className="p-3">
  <Tabs>
    <Tab label="Docker（デフォルト）モード">
      最初に確認することは、Dockerコンテナが正常に実行されているか、エラーのために常に再起動しているかどうかです。
      次のコマンドを実行します:

      ```shell
      docker ps
      ```

      結果は次のようになります:

      ```
      CONTAINER ID   IMAGE                         COMMAND                  CREATED       STATUS      PORTS                                                                                                         NAMES
      4c1de08a352b   prom/prometheus:v2.37.0       "/bin/prometheus --w…"   9 days ago    Up 9 days   9090/tcp                                                                                                      rocketpool_prometheus
      56940decdd1f   sigp/lighthouse:v2.5.1        "sh /setup/start-bn.…"   9 days ago    Up 9 days   0.0.0.0:9001->9001/tcp, 0.0.0.0:9001->9001/udp, :::9001->9001/tcp, :::9001->9001/udp                          rocketpool_eth2
      bd061e632535   grafana/grafana:8.5.9         "/run.sh"                9 days ago    Up 9 days   3000/tcp, 0.0.0.0:3100->3100/tcp, :::3100->3100/tcp                                                           rocketpool_grafana
      5c4db92762fb   ethereum/client-go:v1.10.21   "sh /setup/start-ec.…"   9 days ago    Up 9 days   8545-8546/tcp, 0.0.0.0:30303->30303/tcp, 0.0.0.0:30303->30303/udp, :::30303->30303/tcp, :::30303->30303/udp   rocketpool_eth1
      e20c560861fc   rocketpool/smartnode:v1.5.0   "/bin/sleep infinity"    9 days ago    Up 9 days                                                                                                                 rocketpool_api
      4cf8d364fb90   rocketpool/smartnode:v1.5.0   "/go/bin/rocketpool …"   9 days ago    Up 9 days                                                                                                                 rocketpool_watchtower
      9eb944c29997   rocketpool/smartnode:v1.5.0   "/go/bin/rocketpool …"   9 days ago    Up 9 days                                                                                                                 rocketpool_node
      2ca5d3dcb471   sigp/lighthouse:v2.5.1        "sh /setup/start-vc.…"   9 days ago    Up 9 days                                                                                                                 rocketpool_validator
      dedc577fe361   prom/node-exporter:v1.3.1     "/bin/node_exporter …"   2 weeks ago   Up 9 days                                                                                                                 rocketpool_exporter
      ```

      確認すべき重要なことは`STATUS`列です。
      エントリのいずれにも`Restarting...`と表示されていない場合、コンテナは正常に実行されているはずです（`rocketpool_validator`コンテナに関する例外については、以下の注意を参照してください）。


      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        ConsensusクライアントとしてPrysmまたはLodestarを使用している場合、`rocketpool_validator`コンテナが常に再起動していることに気付くでしょう。
        これは問題ありません！
        validatorコンテナは、[ミニプール（バリデータ）の作成](./create-validator)セクションで説明する`rocketpool node deposit`コマンドを使用して新しいバリデータが作成されるまで失敗します。
        これが完了すると、コンテナは正しく機能します。それまでは無視してください。
      </p>

      それでも、さまざまなサービスのログを確認すると便利かもしれません。

      ログを確認するには、`rocketpool service logs container`コマンドを使用します。ここで、`container`は`eth1`、`eth2`、`validator`、`api`、`node`、または`watchtower`のいずれかです。

      例えば、ETH1クライアントのログを確認するには:

      ```
      $ rocketpool service logs eth1

      Attaching to rocketpool_eth1
      eth1_1        | INFO [06-17|05:17:19.052] Imported new block receipts              count=25   elapsed=26.651ms    number=247,000   hash=6583ec..35eb1c age=2y3mo2w  size=15.72KiB
      eth1_1        | INFO [06-17|05:17:19.098] Imported new block headers               count=192  elapsed=18.515ms    number=247,551   hash=b7d5e4..d49faf age=2y3mo2w
      eth1_1        | INFO [06-17|05:17:19.334] Imported new block receipts              count=371  elapsed=46.450ms    number=247,371   hash=dd3240..1ed173 age=2y3mo2w  size=266.59KiB
      eth1_1        | INFO [06-17|05:17:19.354] Imported new state entries               count=1271 elapsed=2.866ms     processed=374,695 pending=3134  trieretry=0   coderetry=0  duplicate=0 unexpected=0
      eth1_1        | INFO [06-17|05:17:19.441] Imported new block headers               count=384  elapsed=35.331ms    number=247,935   hash=4c4dba..5bf8b6 age=2y3mo2w
      eth1_1        | INFO [06-17|05:17:19.460] Imported new block receipts              count=180  elapsed=33.648ms    number=247,551   hash=b7d5e4..d49faf age=2y3mo2w  size=128.73KiB
      eth1_1        | INFO [06-17|05:17:19.480] Imported new block headers               count=192  elapsed=19.122ms    number=248,127   hash=aa70b9..40d139 age=2y3mo1w
      eth1_1        | INFO [06-17|05:17:19.486] Imported new block receipts              count=6    elapsed=26.042ms    number=247,557   hash=fd6656..ca2439 age=2y3mo2w  size=3.77KiB
      ```

      両方の`eth1`と`eth2`に対してこれを行い、両方のクライアントがエラーなく実行されていることを確認してください。
    </Tab>
    <Tab label="ハイブリッドモード">
      最初に確認することは、Dockerコンテナが正常に実行されているか、エラーのために常に再起動しているかどうかです。
      次のコマンドを実行します:

      ```shell
      docker ps
      ```

      結果は次のようになります:

      ```
      CONTAINER ID   IMAGE                               COMMAND                  CREATED       STATUS         NAMES
      a3c22f54eff0   rocketpool/smartnode:v1.0.0-rc3     "/go/bin/rocketpool …"   2 hours ago   Up 2 minutes   rocketpool_node
      0d5818868ef6   sigp/lighthouse:v1.4.0              "sh /setup/start-val…"   2 hours ago   Up 2 minutes   rocketpool_validator
      88bea525fa89   rocketpool/smartnode:v1.0.0-rc3     "/go/bin/rocketpool …"   2 hours ago   Up 2 minutes   rocketpool_watchtower
      62314e5a0ecf   rocketpool/smartnode:v1.0.0-rc3     "/bin/sleep infinity"    2 hours ago   Up 2 minutes   rocketpool_api
      ```

      確認すべき重要なことは`STATUS`列です。
      エントリのいずれにも`Restarting...`と表示されていない場合、コンテナは正常に実行されているはずです（`rocketpool_validator`コンテナに関する例外については、以下の注意を参照してください）。

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        Consensusクライアントとして**Lodestar**または**Prysm**を使用している場合、`rocketpool_validator`コンテナが常に再起動していることに気付くでしょう。
        これは問題ありません！
        validatorコンテナは、[ミニプール（バリデータ）の作成](./create-validator)セクションで説明する`rocketpool node deposit`コマンドを使用して新しいバリデータが作成されるまで失敗します。
        これが完了すると、コンテナは正しく機能します。それまでは無視してください。
      </p>

      それでも、さまざまなサービスのログを確認すると便利かもしれません。

      ログを確認するには、`rocketpool service logs container`コマンドを使用します。ここで、`container`は`eth1`、`eth2`、`validator`、`api`、`node`、または`watchtower`のいずれかです。

      外部で保守している方に基づいて、`eth1`や`eth2`を無視できますが、Rocket Poolに管理させている場合は、このコマンドを使用して今すぐそのステータスを確認する必要があります。
    </Tab>
    <Tab label="ネイティブモード">
      ネイティブモードでステータスとログを確認する最も簡単な方法は、Smartnodeサービスを最初に設定したときに作成したログスクリプトを使用することです。

      例えば、Gethのログを確認するには、次を実行します:

      ```shell
      /srv/geth/log.sh
      ```

      エラーなくゆっくりと進んでいることがわかるはずです。
      ExecutionクライアントとConsensusクライアントに対してこれを実行し、正常に動作していることを確認してください。
    </Tab>

  </Tabs>
</div>

::: tip ヒント
ログを見終わったら、`Ctrl + C`を使用して終了し、コマンドプロンプトに戻ることができます。
:::

## ETHクライアントの同期を待つ

クライアントが起動したので、先に進む前にExecutionクライアントとConsensusクライアントがネットワークとの同期を完了するまで待つ必要があります。

同期ステータスを確認する簡単な方法の1つは、次のコマンドです:

```shell
rocketpool node sync
```

このコマンドは、ExecutionクライアントとConsensusクライアントが同期プロセスでどこまで進んでいるかを次のように表示します:

```shell
$ rocketpool node sync

Your Smartnode is currently using the Hoodi Test Network.

Your eth2 client is on the correct network.

Your primary execution client is fully synced.
You do not have a fallback execution client enabled.
Your consensus client is still syncing (99.69%).
```

これを時々呼び出して、クライアントの進行状況を確認できます。

同期時間の実際のETAを取得するには、それぞれ`rocketpool service logs eth1`および`rocketpool service logs eth2`でクライアントのログを確認するのが最も簡単です（ハイブリッド/ネイティブモードを使用している場合は、同等のログスクリプトコマンドを使用してください）。
各クライアントは通常、ログ出力で同期ステータスのETAを提供します。

::: tip 注意
マシンのハードウェアプロファイルとクライアントの選択によっては、ETH1とETH2の両方が完全に同期するまでに**数日**かかる場合があります。
**これは想定内です**。
座ってリラックスして、両方が完了するのを待ってください。
:::

::: warning 注意
ノードがまったく同期していないか、ピアがない場合、ルーターがポート30303と9001をブロックしている可能性があります。それらが閉じている場合は、ルーターでポート転送を設定する必要があります。また、ノードが新しいアドレスを取得してポート転送が壊れないように、ノードに静的なローカルIPアドレスがあることを確認してください。
:::

## 次のステップ

クライアントが同期されたら、これが最初のノードの場合は[新しいウォレットを作成](./wallet-init)する準備ができています。または、バックアップから復元する場合やAllnodesなどの別のプロバイダーから自分のハードウェアに移行する場合は、[既存のウォレットを復元](./recovering-rp)する準備ができています。

学びたい方を選択し、対応するガイドの手順に従ってください。
