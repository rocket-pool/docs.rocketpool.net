import { Tab, Tabs } from "@rspress/core/theme";

# マージ前履歴の期限切れ

すべてのExecutionクライアントは、[EIP-4444](https://eips.ethereum.org/EIPS/eip-4444)に従って部分的な履歴期限切れをサポートしています。ユーザーは、Smartnodeバージョン`v1.17.0`以降でマージ前のブロック履歴を削除することにより、ノードのストレージ要件を大幅に削減できます。部分的な履歴期限切れの詳細については、このブログ投稿をご覧ください: https://blog.ethereum.org/2025/07/08/partial-history-exp

::: tip 注意

    マージ前履歴を削除する手順は、ノードで選択されているExecutionクライアントによって異なることに注意してください:
    - Nethermindユーザーは、マージ前履歴を削除するために完全な再同期が必要です。
    - Gethユーザーは、`rocketpool service prune-eth1`コマンドを使用するか、完全な再同期を実行できます。
    - BesuおよびRethユーザーは、ノードがアテステーションを続けながらオンラインプルーニングを実行できます。

:::

以下のマージ前履歴を削除する手順は、Dockerモードのノードのみを対象としています。HybridモードまたはNativeモードで外部クライアントを使用している場合は、Executionクライアントが提供するドキュメントを参照してください。

まず、Settings Managerを開きます。

```shell
rocketpool service config
```

Execution Clientのプルーニングモードを変更するには、`Execution Client (ETH1)`メニューに移動し、`Pruning Mode`のドロップダウンメニューで`History Expiry`設定を選択します。

![](../images/tui-history-expiry.png)

選択を行った後、`escape`を押してメインメニューに戻り、次に`tab`を押して`Review Changes and Save`ボタンをハイライトします。`enter`キーを押して続行します。Executionクライアント設定の変更をプレビューするメニューが表示されます。

![](../images/tui-review-history-expiry.png)

`Save Settings`で`enter`キーを押して保存し、Settings Managerを終了します。次に、`y`を入力して`rocketpool_eth1`コンテナを再起動します。

```shell
Your changes have been saved!
The following containers must be restarted for the changes to take effect:
	rocketpool_eth1
Would you like to restart them automatically now? [y/n]
```

この時点から、使用しているExecutionクライアントによって手順が異なります。

<div className="p-3">
  <Tabs>

        <Tab label="Nethermind">
        Nethermindノードは、マージ前履歴を削除するために完全な再同期が必要です。`History Expiry`設定を保存し、`eth1`コンテナを再起動した後、Executionクライアントを再同期する必要があります。

        ::: warning 警告
        フォールバックノードが設定されていない場合、再同期中にノードは検証を停止します。フォールバックノードがあれば、プライマリノードはプルーニングまたは再同期中もアテステーションとブロック提案を続けることができます。フォールバックノードの設定方法については、[こちら](/ja/node-staking/fallback)をクリックしてください。
        :::

        以下のコマンドを使用してExecutionクライアントを再同期します。
        ```shell
        rocketpool service resync-eth1
        ```

        これで完了です! ノードはマージ前のデータを保存しなくなり、2 TBドライブにノードを収めることの実現可能性が大幅に向上します。
        以下のコマンドを使用して進行状況を監視することをお勧めします。
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Geth">

        Gethノードは、マージ前履歴を削除するためにオフラインプルーニングが必要です。`History Expiry`設定を保存し、`eth1`コンテナを再起動した後、Executionクライアントをプルーニングする必要があります。または、マージ前履歴を削除するために完全な再同期を実行することもできます。

        ::: tip 注意
        完全な再同期を実行するよりも、プルーニングを推奨します。新しいGethデータベースで最初からやり直したい場合、またはプルーニングに問題がある場合は、`rocketpool service resync-eth1`を使用してExecutionクライアントを再同期できます。どちらの選択肢も、マージ前履歴が期限切れになるはずです。
        :::

        ::: warning 警告
        フォールバックノードが設定されていない場合、プルーニングまたは再同期中にノードは検証を停止します。フォールバックノードがあれば、プライマリノードはプルーニングまたは再同期中もアテステーションとブロック提案を続けることができます。フォールバックノードの設定方法については、[こちら](/ja/node-staking/fallback)をクリックしてください。
        :::

        以下のコマンドを実行してExecutionクライアントをプルーニングしてください。
        ```shell
        rocketpool service prune-eth1
        ```
        プルーニングの詳細については、[こちら](/ja/node-staking/pruning#starting-a-prune)をクリックしてください。

        これで完了です! ノードはマージ前のデータを保存しなくなり、2 TBドライブにノードを収めることの実現可能性が大幅に向上します。
        以下のコマンドを使用して進行状況を監視することをお勧めします。
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Besu">

        これで完了です! Besuノードは、アテステーションとブロック提案を続けながらオンラインプルーニングを実行します。
        ノードはマージ前のデータを保存しなくなり、2 TBドライブにノードを収めることの実現可能性が大幅に向上します。
        以下のコマンドを使用して進行状況を監視することをお勧めします。
        ```shell
        rocketpool service logs eth1
        ```

    </Tab>

    <Tab label="Reth">

        これで完了です! Rethノードは、アテステーションとブロック提案を続けながらオンラインプルーニングを実行します。
        ノードはマージ前のデータを保存しなくなり、2 TBドライブにノードを収めることの実現可能性が大幅に向上します。
        以下のコマンドを使用して進行状況を監視することをお勧めします。
        ```shell
        rocketpool service logs eth1
         ```

    </Tab>

  </Tabs>
</div>
