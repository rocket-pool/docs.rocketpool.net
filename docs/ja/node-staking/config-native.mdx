import nimbus_dashboard from "./images/nimbus-dashboard.png";
import tui_checkbox_checked from "./images/tui-checkbox-checked.png";
import tui_checkbox_unchecked from "./images/tui-checkbox-unchecked.png";
import tui_dropdown_closed from "./images/tui-dropdown-closed.png";
import tui_dropdown_open from "./images/tui-dropdown-open.png";
import tui_native_cc_url from "./images/tui-native-cc-url.png";
import tui_native_cc from "./images/tui-native-cc.png";
import tui_native_ec from "./images/tui-native-ec.png";
import tui_native_finished from "./images/tui-native-finished.png";
import tui_native_metrics from "./images/tui-native-metrics.png";
import tui_native_mev from "./images/tui-native-mev.png";
import tui_native_network from "./images/tui-native-network.png";
import tui_native_welcome from "./images/tui-native-welcome.png";
import tui_native_other from "./images/tui-native-other.png";
import tui_native_review from "./images/tui-native-review.png";
import tui_native_settings_home from "./images/tui-native-settings-home.png";
import tui_native_smartnode from "./images/tui-native-smartnode.png";
import tui_textbox from "./images/tui-textbox.png";

# Smartnodeスタックの設定（Nativeモード）

このセクションでは、Dockerを全く使用しない**Nativeセットアップ**を使用している場合のSmartnodeの設定方法について説明します。

::: warning 注意
Dockerベースのセットアップを使用している場合は、代わりに[Docker設定ガイド](./config-docker)をご覧ください。
:::

設定方法は3つあります：

- [ウィザードUI](#ウィザードを使用した設定) - これが最も簡単な方法です。いくつかの基本的な質問のみを行い、その他については十分にテストされたデフォルト値を使用します。初めて`rocketpool service config`を実行したときに表示されます。
- [設定マネージャーUI](#設定マネージャーを使用した設定) - Smartnodeのすべての設定にアクセスできるため、必要に応じてすべてをカスタマイズできます。
- [コマンドライン](#コマンドラインを使用した設定)によるヘッドレス設定 - Smartnodeをヘッドレス（非対話型）環境で実行し、自動的に設定する必要がある人向けのオプションです。

上記のリストから詳しく知りたいモードを選択するか、以下の各オプションをスクロールしてください。

## ウィザードを使用した設定

Smartnodeを設定するには、設定コマンドを実行します：

```shell
rp service config
```

これにより、ターミナルベースのUIが起動し、ノードを迅速かつ簡単に設定できます。また、Nativeモードに関連する設定をオプションで細かく制御することもできます。

::: tip 注意
すでにSmartnodeを設定している場合は、代わりに[設定マネージャー](#設定マネージャーを使用した設定)が表示されます。
お好みであれば、そこからウィザードを再度開くこともでき、既存の設定がすべて事前選択されています。
:::

設定UIを初めて実行したとき（または後でウィザードを再度実行することを選択した場合）、次のような画面が表示されます：

<img src={tui_native_welcome} width="100%" height="auto" />

::: tip ヒント
ウィザードを使用するには、**`矢印キー`（上/下/左/右）を押して、ボタン（選択肢）やテキストボックスなどの間を移動します**。
お好みであれば`Tab`と`Shift+Tab`を使用することもできます - 同じ動作をします。

ボタンの場合、**現在選択されているものが緑色でハイライトされます**。
黒色のものは選択されていません。
上のスクリーンショットでは、`Next`が現在選択されており、`Quit`は選択されていません。

**`Enter`または`Space`を押してボタンを選択します**。これはマウスでクリックすることに相当します。

**何か考えを変えた場合は`Escape`を押して前のダイアログに戻ります**。
これは、ウィザードのさまざまなページを進める際に便利です。

**いつでも`Ctrl`を押しながら`C`を押すと、何も保存せずにウィザードを終了できます**。

たとえば、上の画面では、`左`と`右`の矢印キーを押して、`Next`と`Quit`ボタンの間を移動できます。

`Next`が選択されている状態で`Enter`を押すと、次の画面に進みます。
`Quit`が選択されている状態で`Enter`を押すと、保存せずにウィザードを終了します。
:::

準備ができたら、`Next`を押してください。

### ネットワークの選択

次の画面で、使用するネットワークを選択するよう求められます：

<img src={tui_native_network} width="100%" height="auto" />

`上`と`下`の矢印キー（または`Tab`と`Shift+Tab`）で異なる選択肢をハイライトできます。
選択肢を変更すると、右側の**Description**ボックスに各オプションの簡単な説明が表示されます。
これは、ネットワーク選択だけでなく、ウィザードのすべての選択肢ベースのページに当てはまるため、このスタイルのページは頻繁に表示されます。

無料で入手できる偽のETHとRPLを使用してHoodiテストネットワークでRocket Poolノードを実行する練習をしたい場合は、**Hoodi Testnet**を選択してください。

実際の報酬を獲得するためにMainnetで実際のRocket Poolノードを作成する準備ができている場合は、**Mainnet**を選択してください。

### Execution Clientのセットアップ

次の画面では、Execution clientのHTTPベースRPC APIのURLの入力を求められます：

<img src={tui_native_ec} width="100%" height="auto" />

Smartnodeと同じマシンでExecution clientを実行する予定の場合は、ここに`http://127.0.0.1:8545`と入力してください（このガイドの残りの部分では、これを行うと想定します）。
ただし、すでに他の場所にExecution clientをセットアップしている場合は、代わりにそのURLをここに使用してください。

後で`rp service config`を再度実行することで、いつでもこれを変更できることに注意してください。

### Consensus Clientのセットアップ

次に、使用している（または使用する予定の）Consensus clientを尋ねられます。
各Consensus clientは動作が若干異なるため、Smartnodeはどれを使用しているかを知る必要があり、それに応じて独自の動作を適応させることができます。
次の画面のリストからクライアントを選択してください：

<img src={tui_native_cc} width="100%" height="auto" />

次に、クライアントのAPI URLの入力を求める画面が表示されます：

<img src={tui_native_cc_url} width="100%" height="auto" />

Smartnodeと同じマシンでConsensus clientのBeacon Nodeを実行する予定の場合は、ここに`http://127.0.0.1:5052`と入力してください（このガイドの残りの部分では、これを行うと想定します）。
ただし、すでに他の場所にBeacon Nodeをセットアップしている場合は、代わりにそのURLをここに使用してください。

### その他の設定

次の画面には、その他のいくつかの設定があります：

<img src={tui_native_other} width="100%" height="auto" />

Smartnodeインストールに`/srv/rocketpool`以外のディレクトリを使用することを決定していない限り、これらをデフォルトオプションのままにしてください。

### フォールバッククライアント

Smartnodeスタックの1.5.0以降、プライマリクライアントがオフラインになった場合（Gethを使用していてプルーニングする必要がある場合など）に引き継ぐことができる「フォールバック」Execution clientとConsensus clientのペアを提供できます。
この状況では、プライマリノードマシンは引き続きminipoolのvalidatorキーを使用してアテステーションとブロック提案を行いますが、Execution layerとBeacon chainとのやり取りには外部マシンに接続します。

[フォールバックノードの詳細については、このセクションを参照し](./fallback)、完了したらここに戻ってください。

### メトリクス

Rocket PoolはPrometheusとGrafanaと統合して、ノードの健全性を一目で確認できる便利なWebベースのダッシュボードを生成する機能があります：

<img src={nimbus_dashboard} width="100%" height="auto" />

ウィザードの最後の質問で、これを有効にするかどうかを尋ねられます：

<img src={tui_native_metrics} width="100%" height="auto" />

有効にすることを選択した場合、プロセスの後半の[Grafanaダッシュボードのセットアップ](./grafana.mdx)セクションで、セットアップ方法と使用方法について詳しく学習します。

::: warning 注意
このシステムによって収集されるすべてのデータは**マシン上に留まります**。
Rocket Poolはテレメトリを収集したり、別のサービスに送信したりしません。
これは純粋に、独自のノードを監視できるようにするためのものです！
:::

### MEV設定

2022年9月のExecution layerとConsensus layerのMerge以降、Ethereumのvalidatorは優先手数料を獲得し、MEV（Maximal Extractable Value）に参加できるようになりました。

Smartnode v1.7.0以降、MEVは現在_オプトアウト_になっているため、初期セットアップの一環として、次の画面に示すように設定に関する通知が表示されます：

<img src={tui_native_mev} width="100%" height="auto" />

[MEV、その設定、およびウィザードのこのセクションで何をすべきかについて詳しく知るには、MEVガイドをお読みください。](./mev.mdx)
完了したらここに戻ってください。

### 完了

この質問の後、Smartnode設定のセットアップが完了しました。
次のダイアログが表示されます：

<img src={tui_native_finished} width="100%" height="auto" />

セットアップに満足し、Smartnodeを起動する準備ができている場合は、ここで`Save and Exit`をクリックしてください。

まだRocket Poolのインストールが完了していない場合は、今すぐNativeセットアップガイドに戻ってください。
それ以外の場合、次のステップはdaemonサービスを再起動することです：

```shell
sudo systemctl restart rp-node rp-watchtower
```

すべての設定を確認し、ウィザードに含まれていない多くの追加設定をカスタマイズしたい場合は、`Review All Settings`をクリックして[次のセクション](#設定マネージャーを使用した設定)に進んでください。

## 設定マネージャーを使用した設定

すでに`rp service config`を実行している場合、ウィザードではなく**設定マネージャー**画面が表示されます：

<img src={tui_native_settings_home} width="100%" height="auto" />

この画面には3つの主要な機能があります：

1. **カテゴリリスト**：Nativeモードに関連するSmartnodeスタックの各カテゴリの設定を詳しく見ることができます
2. **変更を確認して保存**ボタン：変更した設定を確認し、更新された設定を保存する準備ができたときに使用できます
3. **設定ウィザードを開く**ボタン：お好みであれば[セットアップウィザード](#ウィザードを使用した設定)に移動できます

::: tip ヒント
設定マネージャーを使用するには、**`矢印キー`（上/下/左/右）を押して、ホームページのオプション間を移動します**。

`Tab`を押して、画面下部の**カテゴリリスト（1）とボタン（2および3）の間を移動**します。
現在選択されているボタンは**緑色でハイライト**されます。

**`Enter`または`Space`を押してボタンを選択します**。これはマウスでクリックすることに相当します。

**いつでも`Ctrl`を押しながら`C`を押すと、何も保存せずに設定マネージャーを終了できます**。
:::

カテゴリリストをスクロールすると、各オプションの役立つ説明が画面右側の**Description Box**に表示されます。
自由に探索してください。**変更を確認して保存**ボタンから確認ダイアログを経由するまで何も保存されないため、ここで設定をいじっても誤って何かを壊すことはありません。いつでも**Ctrl+C**を押して保存せずに終了できます。

### 設定の構成

ホーム画面から、`Enter`キーでいずれかのカテゴリを選択して、そのカテゴリの設定を表示します。
たとえば、これは**Smartnode and TX Fees**カテゴリの画面です：

<img src={tui_native_smartnode} width="100%" height="auto" />

`矢印キー`を使用して設定間を上下に移動します。
現在選択されているものは、その終わりに白い四角が表示されます（テキストボックスまたはチェックボックスの場合）、または白色でハイライトされます（ドロップダウンの場合）。

完了したら`Escape`を押して、設定マネージャーのホーム画面に戻ります。

設定をスクロールすると、それぞれが右側の**Description Box**に何をするかの簡単な説明を表示します。
また、ストック設定に戻したい場合に備えて、そこに**デフォルト値**も表示されます。

この例では、**RPL Claim Gas Threshold**設定が現在選択されています（画面の左側に緑色のボックスでハイライトされています）。
`40`に変更されていますが、右上隅（**Description Box**の上部）でデフォルトが`150`であることがわかります。

::: tip ヒント
念のため、**変更を確認して保存**ボタンから確認ダイアログを経由するまで、ディスクに何も保存されません。
すべての設定を探索して学習することをお勧めします。
:::

### 設定タイプとその使用方法

設定マネージャーは次の設定タイプとUI要素を使用します：

#### テキストボックス

テキストボックスは、任意のテキストまたは数値の文字列を入力するために使用されます。
次のように見えます：

<img src={tui_textbox} width="100%" height="auto" />

希望する値を入力し、**`Enter`を押すか、`矢印キー`を使用して別の設定に移動して変更を保持します。**
そうしないと、設定マネージャーはまだその設定を更新していると想定し、変更済みとしてマークしません。

#### ドロップダウン

ドロップダウンは、選択肢のリストからオプションを選択するために使用されます。
次のように見えます（開いているとき）：

<img src={tui_dropdown_open} width="100%" height="auto" />

**緑色**のアイテムが現在選択されているものです。
`矢印キー`を使用してオプションを変更します - そうすると、右側の**Description Box**が更新されて、現在選択されているオプションについて詳しく説明されます。
選択に満足したら、`Enter`を押して選択したオプションを選択すると、ドロップダウンが閉じて、現在選択されているオプションが表示されます：

<img src={tui_dropdown_closed} width="100%" height="auto" />

#### チェックボックス

チェックボックスは、単純なYes/No質問に使用されます。
次のように見えます：

<img src={tui_checkbox_checked} width="100%" height="auto" />

チェックされている場合、上に示すように中央に`X`があります。
_チェックされていない_場合は、次のように単に空白になります：

<img src={tui_checkbox_unchecked} width="100%" height="auto" />

設定を変更するには、単にそれを選択して`Enter`を押します。

### 変更の保存

変更に満足し、保存する前に確認したい場合は、ホーム画面の**変更を確認して保存**ボタンを押してください。
念のため、それにアクセスするには`Tab`キーを押します。

次のようなビューが表示されます：

<img src={tui_native_review} width="100%" height="auto" />

ここの**Review Box**には、変更したすべての設定が表示され、古い値と新しい値が示されます。
たとえば、ここの最初の行は、**RPL Claim Gas Threshold**が`150`だったものが`40`に変更されたことを示しています。

::: tip 注意
この時点で、変更は**まだ保存されていません**。
何か変更したい場合は、`Escape`を押してホーム画面に戻ります。
:::

変更に満足したら、`Enter`を押して新しい設定をディスクに保存します。
その後、ターミナルUIを終了し、次のメッセージが表示されます：

```
Your changes have been saved!
Please restart your daemon service for them to take effect.
```

まだRocket Poolのインストールが完了していない場合は、今すぐNativeセットアップガイドに戻ってください。
それ以外の場合、次のコマンドでdaemonサービスを再起動できます：

```shell
sudo systemctl restart rp-node rp-watchtower
```

## コマンドラインを使用した設定

ターミナルUIと対話できないヘッドレス環境でSmartnodeを使用する場合、代わりにコマンドラインを使用してノードを設定できます。

`rocketpool service config`コマンドは、引数として、通常ターミナルUIを介して設定できるすべての設定を受け入れます。
次のコマンドを実行して、それらのリストを表示します（かなり長いことに注意してください）：

```
rocketpool service config --help
```

出力は次のようになります：

```
NAME:
   rocketpool service config - Configure the Rocket Pool service

USAGE:
   rocketpool service config

OPTIONS:
   --executionClientMode value  Choose which mode to use for your Execution client - locally managed (Docker Mode), or externally managed (Hybrid Mode).
                                Type: choice
                                Options: local, external
 (default: "local")
   --executionClient value  Select which Execution client you would like to run.
                            Type: choice
                            Options: geth, infura, pocket
 (default: "geth")
   --useFallbackExecutionClient         Enable this if you would like to specify a fallback Execution client, which will temporarily be used by the Smartnode and your Consensus client if your primary Execution client ever goes offline.
                                        Type: bool

...
```

各オプションには、名前、タイプ、デフォルト値、および（選択肢パラメータの場合）オプションがあります。
このテキストを使用して、設定したいオプションを見つけ、適切な引数を介して指定できます。

::: tip 注意
このコマンドは既存の設定の上に構築されるため、すでにいくつかの設定が保存されていて他の設定だけを変更したい場合、それらを繰り返す必要はありません。
このコマンドの引数として含める設定のみが更新されます。
:::

まだRocket Poolのインストールが完了していない場合は、今すぐNativeセットアップガイドに戻ってください。
それ以外の場合、次のステップはdaemonサービスを再起動することです：

```shell
sudo systemctl restart rp-node rp-watchtower
```
