---
next:
  text: Rescuing a Dissolved Minipool
  link: "/ja/node-staking/rescue-dissolved"
---

# Minipoolのシャットダウン

## バリデータの終了

minipoolを実行したくなくなり、Beacon Chainにロックされている全残高にアクセスしたい場合は、いくつかのステップを実行する必要があります。

1. Beacon ChainからminipoolのバリデータのボランタリーExit要求を送信します。
2. バリデータが終了するのを待ちます。
3. バリデータの残高がExecution Layer上のminipoolに引き出されるのを待ちます。
4. minipoolを閉じて報酬を分配し、資金にアクセスします。

以下で各ステップについて説明します。

### Exit要求の送信

minipoolに接続されているバリデータを終了したい場合は、次のコマンドを実行します。

```shell
rocketpool minipool exit
```

終了できるminipoolのリストが表示されます。

```
Please select a minipool to exit:
1: All available minipools
2: 0x7E5700bcd65B1770bA68abB288D3f53814d376aC (staking since 2023-02-08, 06:33 +0000 UTC)
3: 0xd8E804cFA64ADb386F52DB20717810130c90f674 (staking since 2023-02-08, 06:33 +0000 UTC)
```

終了を確認すると、ノードはBeacon Chainにボランタリーexit要求を送信します。
これは通常のExecution Layerトランザクション**ではない**ため、ガス代を支払う必要はありません。

終了したばかりのminipoolのバリデータ公開鍵が必要な場合は、`rocketpool minipool status`を使用して取得できます。
[https://beaconcha.in](https://beaconcha.in)（またはHoodi Testnetの場合は[https://hoodi.beaconcha.in](https://hoodi.beaconcha.in)）などのBeacon Chainエクスプローラーでバリデータの終了ステータスを確認できます。
ステータスが更新されるまでに時間がかかりますが、更新されると「exiting」状態で表示されます。

<img src="./images/exiting.png" width="100%" height="auto" />

ここでは、Statusが`Exiting`で、終了するエポック（5224）が強調表示され、「Exited」アイコンが緑色に点滅して操作が進行中であることを示しています。
バリデータが終了するまでに時間がかかることがあります。*特に*多数のバリデータが同時にBeacon Chainを終了している場合は注意してください。プロトコルはエポックごとに少数のバリデータのみが終了することを許可するように設計されているため、順番を待つ必要がある場合があります。

終了エポックが経過すると、バリデータは正式にチェーンを終了し、アテステーションやブロック提案を行わなくなります。
Validator Clientログまたはエクスプローラーで確認できます。

<img src="./images/exited.png" width="100%" height="auto" />

ステータスが`Exited`に変更され、その下に**withdrawable epoch**を示すテキストがあります（終了後256エポック、または約27時間後である必要があります）。
Beaconcha.inは、バリデータが終了する時刻と引き出し可能になる時刻のローカルタイムスタンプも便利に提供しています。

**withdrawable**状態に入ると、バリデータはBeacon Chainによって報酬分配のためにエンキューされます。
このキューは、現在引き出し中のバリデータの数によって異なります。
順番が来ると、Beacon Chainは*自動的に*残高をExecution Layer上のminipoolのアドレスに送信します。
この時点で、Smartnode CLIを使用して分配を実行してアクセスできます。

### 全報酬の分配

::: tip 注意
このプロセスでは、バリデータがBeacon Chainから終了し、バリデータの残高がminipoolコントラクトに転送されている必要があります。
そのプロセスの復習が必要な場合は、上記の[**バリデータの終了**](#exiting-your-validator)セクションを参照してください。完了したらここに戻ってください。
:::

Beacon Chainからバリデータを終了し、残高がminipoolコントラクトに入金されている場合は、1つのコマンドで全体を安全に引き出すことができます。
[手動分配](./skimming#manual-distribution)とは異なり、このプロセスは実際にminipoolを**ファイナライズ**し、閉じて非アクティブにします。
Beacon Chainから残高が引き出され、次のプロセスを経て資金にアクセスすると、minipoolの役割は終わります。

資金を取得してminipoolを閉じるには、次のコマンドを実行します。

```shell
rocketpool minipool close
```

これにより、閉鎖の対象となるminipoolのリストが表示されます。

```
Please select a minipool to close:
1: All available minipools
2: 0xd8E804cFA64ADb386F52DB20717810130c90f674 (32.007209 ETH available, 8.002559 ETH is yours plus a refund of 0.000000 ETH)
```

ここでは、対象となる各minipoolの総残高、その残高のうちあなたに分配される金額、および払い戻しとして予約されている残高の金額（これは分配をバイパスします）を確認できます。

リストから分配して閉じたいminipoolを選択し、アクションを確認して、トランザクションが検証されるのを待ちます。
完了すると、minipoolの残高のあなたの分（および払い戻し）が引き出しアドレスに送信され、minipoolは`finalized`状態になります。

ブロックエクスプローラーでトランザクションを確認することで検証できます。たとえば、[上記のminipoolを閉じるトランザクション（Goerli Testnet）](https://goerli.etherscan.io/tx/0xe81415b3b66f9b42d43ac17a0983e792725726c9fdd35ac855745bd12a053509)を参照してください。

### RPLのアンステーキング

この時点で、有効なRPLが更新され、このminipoolが計算から削除されます。
これで、ボンドされたETHの60%しきい値を超える可能性のあるRPLをアンステーキングできます。

ノードに対してRPLをアンステーキングするには、次のコマンドを実行します。

```shell
rocketpool node withdraw-rpl
```

::: tip 注意
RPL引き出しには2つの制限があります。

RPLはステーキング（または再ステーキング）してから28日以内に引き出すことはできません。minipoolを閉じる前にこれらの報酬を請求する場合は注意してください。RPL報酬の任意の量を再ステーキングすると、最後のステーキングアクションから28日間RPLを引き出すことができません。

RPLは、総ボンドETHの60%まで引き出すことができます。完全な終了の場合、すべてを引き出すことができます。部分的な終了の場合は、この制限を念頭に置いて計画してください。
:::

## 古いDelegateに関する注意

Rocket Poolの立ち上げからAtlasのデプロイまですべてのminipoolに割り当てられた**オリジナルのminipool delegate**は、2つの前提を念頭に置いて構築されました。

1. minipoolに残高がある唯一の時間は、バリデータがBeacon Chainを終了した後です。
2. Oracle DAOは、残高がBeacon Chainからminipoolコントラクトに転送されると、minipoolの状態を「staking」から「withdrawable」に変更します。

最初のポイントは、Ethereumがスキミングをサポートするためにアップグレードされているため、明らかにもはや関連していません。
2番目のポイントも*もはや真実ではありません*。なぜなら、Oracle DAOは「withdrawable」minipoolをフラグ**しなくなった**からです。
これは、Oracle DAOがRocket Poolノードオペレーターに対して持つ権限を減らし、信頼された当事者に対する追加要件なしに報酬にアクセスできるようにするための意図的な設計上の決定でした。

これらの欠陥のため、Smartnode CLIは、オリジナルのminipool delegateでの引き出しまたは資金分配を**もはやサポートしていません**。
報酬にアクセスしたい場合は、上記の新しい引き出し条件をサポートするAtlas delegateに**アップグレードする必要があります**。

::: danger 危険
上級ユーザーで、CLIをバイパスしてサードパーティツールを介してコントラクトで直接分配機能を呼び出す場合は、次の点に注意してください。

1. delegateの分配関数は、minipoolの残高が**16 ETH未満**の場合にリバートします。16 ETH未満の残高は**アクセスできません。**
2. minipoolの残高が**16 ETHから32 ETHの間**の場合、オリジナルのdelegateによる分配はバリデータが**スラッシュされた**と想定します。16 ETHをステーキングプールに返し、残りをあなたに与えます。minipoolの残高が32 ETHを超える場合にのみ、_適切に機能します_。
3. Oracle DAOはそれを`withdrawable`としてマークしないため、minipoolは`finalized`状態に入ることはありません。したがって、ETHにアクセスできる場合でも、**RPLはロックされます**。Atlas delegateにアップグレードするまでロックされます。

これらの理由から、最初からAtlas delegateにアップグレードして、これらを完全に回避することを**強くお勧めします**。
:::
