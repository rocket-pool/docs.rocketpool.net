import { Tab, Tabs } from "@rspress/core/theme";

::: danger 警告
Saturn 1の準備として、現在minipoolのデポジットは無効になっています。
:::

# 16-ETH Minipoolから8-ETH Minipoolへの移行

ノードオペレーターは、既存の16-ETH minipoolを8-ETH minipoolに**直接移行**する機能を持っています。
これにより、[デポジットクレジット残高](./credit)に8 ETHが追加され、**ノードオペレーターからのETHを必要とせずに追加のminipoolを作成するために使用**できます。

実際には、このプロセスにより、ノードオペレーターは**1つの16-ETH minipoolを無料で2つの8-ETH minipoolに変換**できます(_ただし、ガス代のETHが必要で、両方のminipoolを処理するのに十分なRPL担保が必要です_)。

既存の16-ETH minipoolを8-ETH minipoolに移行することは、正式には**bond reduction**として知られています。
これは2段階のプロセスであり、Oracle DAOによる検証が含まれます。
以下のセクションでプロセス全体を順を追って説明します。

### Bond Reductionのルール

bond reductionには次の手順が含まれます。

1. bond reductionの開始。ノードオペレーターが実行します。
2. 待機期間(「bond reduction scrub check」)。Oracle DAOがbond reductionが合法であることを確認し、ルールに違反するbond reductionをキャンセルする時間を提供します。
3. bond reductionの完了。ノードオペレーターが実行します。

スクラブされずに成功したbond reductionを実行するには、minipoolは次のルールに従う必要があります。

1. minipoolは[Atlas delegate](./minipools/delegates)にアップグレードされている必要があります。古いRedstone delegateは使用できません。
1. Beacon Chain上のminipoolのvalidatorは**pendingまたはactiveにstaking中**である必要があります。スラッシュされたり、exiting/exited、またはwithdrawable/withdrawnであってはなりません。
1. Beacon Chain上のminipoolのvalidator残高は**少なくとも31.99 ETH**(32 ETHに、報酬スキム後のタイミングが悪い合併症による逃したアテステーションのための小さなバッファを加えたもの)である必要があります。

minipoolは、スクラブチェックの**全期間**にわたってこれらの条件に従う必要があります。その間、Oracle DAOは上記の条件への準拠を確認するために監視します。

スクラブチェック中のいつでも、minipoolがこれらの条件に違反していることが判明した場合、bond reductionは**スクラブされます**。
minipool自体は影響を受けません。bond reductionプロセス全体が起こらなかったかのように、16 ETH minipoolとして引き続き検証および動作します。
ただし、**bond reductionの対象外になります**。
minipoolのbond reductionがスクラブされると、二度と試みることはできません。

::: warning 注意
成功したbond reduction後、minipoolのbond額は16 ETHから8 ETHに削減され、**minipoolの手数料は現在のネットワーク値にリセットされます**。

20%の手数料を持つ16-ETH minipoolを削減する場合、**その20%の手数料は維持されません**。
ネットワーク値(**現在は一律14%に設定されています**)に削減されます。

[サンプル計算](./create-validator.mdx#rewards)セクションで示されているように、14%の8-ETH minipoolは20%の16-ETH minipoolよりも*依然として収益性が高い*ため、高い手数料率を保持することは、16 ETH bondを維持する説得力のある理由ではありません。
:::

### ステップ1: Bond Reductionの開始

bond reductionプロセスを開始するには、次のコマンドを入力します。

```shell
rocketpool minipool begin-bond-reduction
```

これは、プロセスに関する簡単な説明から始まります(ただし、このガイドを読んでいれば、すべてがすでに馴染み深いはずです)。
プロセスを理解したことを確認すると、現在bondを削減できるminipoolとその現在のbondと手数料が表示されます。

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)

```

削減する1つ以上のminipoolを選択すると、Smartnodeはそれらのminipoolがbond reductionの資格があるかどうかを確認します。

資格を得るには、次の条件を満たす必要があります。

- minipoolは[Atlas minipool delegate contract](./minipools/delegates)を使用するようにアップグレードされている必要があります。
- minipoolのvalidatorは、Beacon Chain残高が少なくとも32 ETHである必要があります。
- minipoolのvalidatorはpendingまたはactiveである必要があります。
- bond reduction*後*に必要な最小RPL担保レベルをサポートするのに十分なRPLがステーキングされている必要があります。

そうでない場合、最初に何をする必要があるかを説明する警告エラーが出力されます。例えば:

```
Please select a minipool to begin the ETH bond reduction for:
1: All available minipools
2: 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 (Current bond: 16 ETH, commission: 15.00%)
3: 0x7E5704aD2a63eb90880426Dcd4a3811246dF3cB0 (Current bond: 16 ETH, commission: 15.00%)
4: 0x7E5705c149D11efc951fFc20349D7A96bc6b819C (Current bond: 16 ETH, commission: 15.00%)
5: 0x7E570625cE8F586c90ACa7fe8792EeAA79751778 (Current bond: 16 ETH, commission: 15.00%)
2

Cannot reduce bond for minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5:
The minipool version is too low. It must be upgraded first using `rocketpool minipool delegate-upgrade`.
You do not have enough RPL staked to support this bond reduction; it would bring you below the minimum RPL staking requirement. You will have to stake more RPL first.
```

これは、選択したminipoolがdelegate upgradeを必要とし、そのminipoolのbondを削減するためにノードにより多くのRPLをステーキングする必要があることを示しています。

前提条件を満たすと、このコマンドでminipoolを選択すると、トランザクションのガス価格とアクションの確認を選択するように求められます。
確認を受け入れると、minipoolのbond reductionが開始されます。

### Scrub Check Timerの監視

bond reductionを開始したら、`node`デーモンログで完了するまでの時間を表示できます。

<div className="p-3">
  <Tabs>
    <Tab label="Docker and Hybrid Mode">
      **Dockerモード**および**Hybridモード**ユーザーの場合、これは次のコマンドで実行できます。

      ```shell
      rocketpool service logs node
      ```
    </Tab>
    <Tab label="Native Mode">
      nodeデーモンのシステムログを確認するために使用するスクリプトを参照してください。
    </Tab>

  </Tabs>
</div>

bond reductionのスクラブチェックが完了するまでの残り時間を示す新しいエントリが表示されます。

```
rocketpool_node  | 2023/02/25 09:04:21 Checking for minipool bonds to reduce...
rocketpool_node  | 2023/02/25 09:04:21 Minipool 0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5 has 12m0s left until it can have its bond reduced.
```

このタイマーがゼロに達し、これらのログに表示されなくなると、bond reductionを完了できます。

### ステップ2: Bond Reductionの完了

スクラブタイマーが正常に終了したら、minipoolのbond reductionを完了する方法は2つあります。

1. `node`デーモンに処理させます。5分ごとに実行されるルーチンチェック中にこれを行います(上記のログで残り時間行を出力するのと同じもの)。資格のあるbond reductionがあることに気付くと、**自動的にreductionを完了します** - pendingのminipoolをステーキングし、fee recipientをチェックするのと同じように。`node`ログに、bond reductionを検出して完了したことを示す出力が表示されます。
2. 次のコマンドを使用してbond reductionを手動で完了します。
   ```shell
   rocketpool minipool reduce-bond
   ```
   コマンドは簡単です。minipoolがbond reductionの資格がある場合は、プロンプトに従ってプロセスを完了します。

bond reduction中、Rocket Poolは**minipoolの既存の残高を分配**し、minipoolのbond reduction前のbondと手数料を使用して、あなたとrETHステーカーの両方がその既存の残高の公正な割合を取得し、bond reductionが両当事者が*受け取ったはずの*報酬を変更しないようにします。

### Reduced Bondの結果

`rocketpool minipool status`を使用して、成功したbond reductionを確認できます。

bond reduction**前**は、これまでフォローしてきたサンプルminipoolの場合、そのコマンドは次の出力を生成します。

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             15.000000%
Node deposit:         16.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            16.000000 ETH
Minipool Balance (EL): 0.150713 ETH
Your portion:          0.086660 ETH
Available refund:      0.000000 ETH
Total EL rewards:      0.086660 ETH
...
Beacon balance (CL):   32.000152 ETH
Your portion:          16.000087 ETH
...
```

bond reduction**後**、コマンドは次の出力を返します。

```
Address:              0x7E5703fdA638CD86c316B9EbAF76927fF695ADC5
...
Node fee:             14.000000%
Node deposit:         8.000000 ETH
RP ETH assigned:       2023-02-08, 06:13 +0000 UTC
RP deposit:            24.000000 ETH
Minipool Balance (EL): 0.086769 ETH
Your portion:          0.000000 ETH
Available refund:      0.086769 ETH
Total EL rewards:      0.086769 ETH
...
Beacon balance (CL):   32.000037 ETH
Your portion:          8.000013 ETH
...
```

次のように変化したことに注目してください。

- `Node fee`(手数料)は15%から14%になりました
- `Node deposit`(あなたのbond)は16 ETHから8 ETHになりました
- `RP deposit`(借りた金額)は16 ETHから24 ETHになりました
- `Minipool Balance (EL)`は0.150713 ETHから0.086769 ETHになりました
- `Your portion (EL)`は0.086660 ETHから0 ETHになりました
- `Available refund`は0 ETHから0.086769 ETHになりました
- `Your portion (CL)`は16.000087 ETHから8.000013 ETHになりました

`Node fee`、`Node deposit`、`RP deposit`、`Your portion (CL)`の変更は、bondが正常に削減されたことを示しています。

`Minipool Balance (EL)`、`Your portion (EL)`、`Available refund`の変更は、bond reductionプロセスの一部として発生した**minipool balance distribution**の結果を示しています。
これらの結果を解釈する方法を明確にするために:

- [トランザクション](https://zhejiang.beaconcha.in/tx/0xf02f6b1a4ea68f356909e6f1974dc3c24d301ba115b97f3013c3c829ba2ca57c)を見ると、minipoolからstakingプールに0.06413383 ETHを送信したこともわかります。
- 「before」の例では、stakingプールのシェアはminipoolの残高からノードオペレーターの部分を引いたもの、つまり`0.150713 - 0.086660 = 0.064053`であり、これはbond reduction中にstakingプールに転送された金額です(スクラブチェック中に発生した報酬スキムからの少量が追加されています)。
- 一方、*ノードオペレーター*のシェアは、ノードオペレーターのwithdrawalアドレスに送信されません。代わりに**available refund**としてブックマークされます。そのため、refund額が0 ETHから、以前はEL上のminipoolの残高の「your portion」額だったものに増加しました。
  - このrefundは、次のコマンドを使用していつでも請求できます。
    ```shell
    rocketpool minipool refund
    ```

bond reductionのもう1つの重要な結果があります。これは`rocketpool node status`を使用して確認できます。

```
Your Smartnode is currently using the Zhejiang Test Network.

=== Account and Balances ===
The node 0x9BA1401Eb7D779eC51f910B066e9C4351cD28911 has a balance of 347.796908 ETH and 16799.835547 RPL.
The node has 8.000000 ETH in its credit balance, which can be used to make new minipools.
```

bond reductionプロセスにより、**ノードの**[デポジットクレジット残高](./credit)が8 ETH増加しました。
このクレジットを使用して、[別の8-ETH minipoolを作成](./create-validator.mdx#depositing-eth-and-creating-a-minipool)できます(ノードウォレットからのETHは不要で、ガス代のみ必要です)。
