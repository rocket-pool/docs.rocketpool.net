import { Tab, Tabs } from "@rspress/core/theme";
import nodeAddress from "./images/node_address.png";
import rplWithdrawalConfirmation from "./images/rpl_withdrawal_confirmation.png";

# RPL引き出しアドレスの設定

[プライマリ引き出しアドレス](../../node-staking/prepare-node#setting-your-primary-withdrawal-address)とRPL引き出しアドレスの違いを理解することが重要です。デフォルトでは、RPL引き出しアドレスは未設定であり、プライマリ引き出しアドレスは、すべてのRPLチェックポイント報酬、ステークされたRPL、およびBeacon Chain ETHの送信先です。

希望する場合は、[RPL専用の引き出しアドレス](https://rpips.rocketpool.net/RPIPs/RPIP-31)を設定できます。RPL引き出しアドレスが設定されている場合、インフレ報酬からRPLをトリガーして請求できるようになり、ETHコンセンサス報酬やETHに関連するものには影響しません。この場合、プライマリ引き出しアドレスはRPL関連のアクションに対する権限を持たなくなります。

これにより、RPLへのエクスポージャーを望まないノードオペレーターにエンティティがRPLを供給できる興味深い機会が生まれます。そのエンティティは、ノードに必要な保険担保を提供することでRPL報酬を請求できます。つまり、これにより異なるアクターがそれぞれの担保タイプを供給できるようになります。

::: warning 注意
初めてノードを設定する際、RPL引き出しアドレスはデフォルトで未設定になっています。
RPL引き出しアドレスを設定することを選択した場合、**コールドウォレットによって制御される別のアドレスに設定することが非常に重要です。**
コールドウォレットは、ハードウェアウォレット([Ledger](https://www.ledger.com/)、[Trezor](https://trezor.io/)、[Grid+](https://gridplus.io/)など)またはスマートコントラクトウォレット([Safe](https://app.safe.global/welcome)など)の可能性があります。

RPL引き出しアドレスとしてMetaMaskなどのホットウォレットを使用**しない**ことを**強く推奨**します。

こうすることで、ノードウォレットが侵害された場合でも、すべての資金が別のコールドウォレット(攻撃者がアクセスできないことを願う)に送信されるため、攻撃者が強制的に終了させることでステークされたRPLにアクセスすることができません。

RPL引き出しアドレスはノードオペレーターレベルで設定されます。
複数のミニプールを作成する場合、それらはすべて同じRPL引き出しアドレスを参照するため、このセットアップを一度だけ実行する必要があります。

Ethereum Foundationのウォレットセキュリティの基本については[こちらを参照](https://ethereum.org/en/security/#wallet-security)してください。
:::

これを行うには2つの異なる方法があります。
以下の両方のオプションを読んで、どちらが適用されるかを判断してください。

<div className="p-3">
  <Tabs>
    <Tab label="方法1">
      *新しいRPL引き出しアドレスがMetaMaskまたはWalletConnect経由でトランザクションに署名するために使用できる場合は、この方法を使用します。**

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        この方法では、新しいRPL引き出しアドレスから**トランザクションを送信**する必要があるため、**そのアドレスに既に少量のETHが必要です。**
      </p>

      <p className="rspress-directive warning">
        <p className="rspress-directive-title">注意</p>
        **Ledger**ハードウェアウォレットのユーザーの場合、Ledger LiveはまだMetaMaskまたはWalletConnectをネイティブでサポートしていないことに注意してください。
        代わりにMetaMaskを使用してLedgerに接続する必要があります。
        これを行うには、[公式のLedger指示](https://www.ledger.com/academy/security/the-safest-way-to-use-metamask)に従ってください。

        Rocket Poolウェブサイトで作業するには、Ledgerを接続し、ロックを解除し、ETHアプリを開いている必要があります。
        また、現在のセッションで**「blind signing」を有効にする**必要があります。これは、デバイスのETHアプリの設定部分で見つけることができます。
        Blind signingは、セッションを閉じた後に自動的に無効になります。

        Hoodi Testnetを使用していて、LedgerをRPL引き出しアドレスとして使用したい場合は、テストネットワークにライブアドレスを接続しないようにするために、**Ledgerに新しいEthereumウォレットを作成**する必要があります。これは混乱を引き起こす傾向があります。
        LedgerをMetaMaskに接続する際は、ネットワーク選択ドロップダウンで**Hoodi Testnet**を選択してください。
        Ledger Liveはテストネットワークの残高を表示しませんが、テストネットワークをサポートする他のアプリケーション(MetaMaskやEtherscanなど)は表示できます。
      </p>

      1. `rocketpool node set-rpl-withdrawal-address 'your cold wallet address or ENS name'`を実行します。新しいRPL引き出しアドレスは「保留中」とマークされます。確認するまで、**古いRPL引き出しアドレスが引き続き使用されます**。
      2. 確認するには、**新しいRPL引き出しアドレスから**ミニプールコントラクトに特別なトランザクションを送信して、RPL引き出しアドレスを所有していることを確認する必要があります。
      1. これを行う最も簡単な方法は、Rocket Pool RPL引き出しアドレスサイト([Hoodi Testnet](https://testnet.node.rocketpool.net/rpl-withdrawal-address)または[Mainnet](https://node.rocketpool.net/rpl-withdrawal-address))に移動することです。
      3. まだMetamaskまたはWalletConnectをRocket Poolウェブサイトに接続していない場合は、今すぐ接続してください。画面中央の**select wallet**ボタンをクリックし、使用したいウォレットに基づいてMetaMaskまたはWalletConnectを選択します。その後、接続を確認するよう求められます。例えば、MetaMaskを使用する場合:

      **Next**をクリックし、次に**Confirm**をクリックして、Rocket Poolウェブサイトがウォレットを使用できるようにします。3. 上部メニュー(またはモバイルデバイスの場合は左側のハンバーガーメニュー)から**RPL Withdrawal Address**を選択します。4. 次のプロンプトが表示されます:

      4. ここに**ノードウォレットアドレス**を入力し、オレンジ色の**Find**ボタンをクリックして続行します。

      <img src={nodeAddress} width="100%" height="auto"/>

      1.  保留中のRPL引き出しアドレスを確認するよう求められます。これは、以前にこのコマンドを実行したときに使用したアドレスと同じである必要があります: `rocketpool node set-rpl-withdrawal-address` 準備ができたら**Confirm Pending**を選択します。
      2.  これで、ウォレットに新しい確認ダイアログが表示されるはずです。繰り返しますが、MetaMaskを例として使用すると、MetaMaskアイコンをクリックして開くと、次のようなものが表示されるはずです:

      **Confirm**をクリックして、トランザクションをネットワークに送信します。これがブロックに含まれるまでに時間がかかりますが、含まれると確認ダイアログが表示されます:

      <img src={rplWithdrawalConfirmation} width="100%" height="auto"/>

      5. 新しいRPL引き出しアドレスが確認され、アクティブ化されました。`rocketpool node status`でこれを表示できます。
    </Tab>
    <Tab label="方法2">
      **RPL引き出しアドレスがMetaMaskまたはWalletConnect経由でトランザクションに署名するために使用_できない_場合にのみ、この方法を使用してください。**

      この方法では、次を実行します:

      ```shell
      rocketpool node set-rpl-withdrawal-address --force `your cold wallet address`
      ```

      正しいアドレスを持っていることを確認するために、これを確認する前にテストトランザクションを送信する機会があります。
      プロンプトが表示されたときにこのコマンドを確認すると、新しいRPL引き出しアドレスがすぐに設定されます。


      <p className="rspress-directive danger">
        これを行うことで、新しいアドレスを所有していることを証明する必要がある方法1に関連する安全措置をバイパスします。
        ここで誤字を入力すると、元に戻す方法はなく、**ミニプールの報酬は永遠に失われます**。

        これを確認する前に、テストトランザクションメカニズムを使用することを**強く**お勧めします。可能であれば、代わりに方法1を使用してください。
      </p>
    </Tab>

  </Tabs>
</div>

これが完了すると、**`set-rpl-withdrawal-address`コマンドを使用してRPL引き出しアドレスを変更できなくなります**。
変更するには、**アクティブな**RPL引き出しアドレス(今切り替えたもの)から署名されたトランザクションを送信する必要があります。
Rocket Poolウェブサイトには、これを行うための機能があります。

RPL引き出しアドレスを解除したい場合、プロセスは非常に簡単です。まず、Rocket PoolウェブサイトのRPL Withdrawl Addressページに戻ります。

<div className="p-3">
  <Tabs>
    <Tab label="Hoodi Testnet">https://testnet.node.rocketpool.net/rpl-withdrawal-address</Tab>
    <Tab label="Mainnet">https://node.rocketpool.net/rpl-withdrawal-address</Tab>
  </Tabs>
</div>

ノードのRPL引き出しアドレスでサインインしている場合、ここで右側の**unset**ボタンをクリックできるはずです:

<img src="./images/unset_rpl_withdrawal.png" width="100%" height="auto" />

**unset**をクリックすると、詳細を確認できるページに移動します。表示されている内容に満足したら、オレンジ色の**unset**ボタンをクリックして、トランザクションをネットワークに送信します。

RPL引き出しアドレスの設定は以上です! プロセスが迅速で簡単であることを願っています。

[Discordサーバー](https://discord.gg/G46XgK264a)にお気軽にお立ち寄りいただき、感想をお聞かせください。プロジェクトの進化を追跡してください。
